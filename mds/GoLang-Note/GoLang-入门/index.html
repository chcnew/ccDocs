
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="个人学习记录的知识笔记">
      
      
        <meta name="author" content="HC">
      
      
        <link rel="canonical" href="https://chcnew.github.io/ccDocs/mds/GoLang-Note/GoLang-%E5%85%A5%E9%97%A8/">
      
      
        <link rel="prev" href="../../Python-Note/FastAPI-Note/">
      
      
        <link rel="next" href="../../Vue3-Note/vue3-%E5%85%A5%E9%97%A8/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>GoLang-Note - CC学习文档库</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../static/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#01basicsciences" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="CC学习文档库" class="md-header__button md-logo" aria-label="CC学习文档库" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m99.3 256.1 69.4-119.9c-5.6-12.2-8.8-25.8-8.8-40.2 0-53 43-96 96-96s96 43 96 96c0 14.3-3.1 27.9-8.8 40.2l44.4 76.7c-23.1 26-53.7 45.1-88.4 53.8L256 191.9l-68.1 117.6c21.5 6.8 44.3 10.5 68.1 10.5 70.7 0 133.8-32.7 174.9-84 11.1-13.8 31.2-16 45-5s16 31.2 5 45C428.2 341.8 347 384 256.1 384c-35.4 0-69.4-6.4-100.7-18.1l-56.7 97.8c-4.7 8.1-11.7 14.7-20.1 18.9l-55.4 27.7c-5 2.5-10.9 2.2-15.6-.7S0 501.5 0 496v-55.4c0-8.4 2.2-16.7 6.5-24.1l60-103.7c-12.8-11.2-24.6-23.5-35.3-36.8-11.1-13.8-8.8-33.9 5-45s33.9-8.8 45 5c5.7 7.1 11.8 13.8 18.2 20.1zm281.8 151.8c32.5-13 62.4-31 88.9-52.9l35.6 61.5c4.2 7.3 6.5 15.6 6.5 24.1V496c0 5.5-2.9 10.7-7.6 13.6s-10.6 3.2-15.6.7l-55.4-27.7c-8.4-4.2-15.4-10.8-20.1-18.9zM256 128a32 32 0 1 0 0-64 32 32 0 1 0 0 64"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CC学习文档库
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GoLang-Note
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换至深色模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换至深色模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换至浅色模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至浅色模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Python-Note/Python-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="md-tabs__link">
          
  
  
  Python

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  Golang

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Vue3-Note/vue3-%E5%85%A5%E9%97%A8/" class="md-tabs__link">
          
  
  
  Vue3

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Docker-Note/DockerLearningNote/" class="md-tabs__link">
          
  
  
  Docker

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../数据库-Note/mysql优化实践.md" class="md-tabs__link">
          
  
  
  DataBase

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../LinuxEnv-Note/Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" class="md-tabs__link">
          
  
  
  LinuxEnvConf

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE-Note/http%E5%8D%8F%E8%AE%AE/" class="md-tabs__link">
          
  
  
  Others

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="CC学习文档库" class="md-nav__button md-logo" aria-label="CC学习文档库" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m99.3 256.1 69.4-119.9c-5.6-12.2-8.8-25.8-8.8-40.2 0-53 43-96 96-96s96 43 96 96c0 14.3-3.1 27.9-8.8 40.2l44.4 76.7c-23.1 26-53.7 45.1-88.4 53.8L256 191.9l-68.1 117.6c21.5 6.8 44.3 10.5 68.1 10.5 70.7 0 133.8-32.7 174.9-84 11.1-13.8 31.2-16 45-5s16 31.2 5 45C428.2 341.8 347 384 256.1 384c-35.4 0-69.4-6.4-100.7-18.1l-56.7 97.8c-4.7 8.1-11.7 14.7-20.1 18.9l-55.4 27.7c-5 2.5-10.9 2.2-15.6-.7S0 501.5 0 496v-55.4c0-8.4 2.2-16.7 6.5-24.1l60-103.7c-12.8-11.2-24.6-23.5-35.3-36.8-11.1-13.8-8.8-33.9 5-45s33.9-8.8 45 5c5.7 7.1 11.8 13.8 18.2 20.1zm281.8 151.8c32.5-13 62.4-31 88.9-52.9l35.6 61.5c4.2 7.3 6.5 15.6 6.5 24.1V496c0 5.5-2.9 10.7-7.6 13.6s-10.6 3.2-15.6.7l-55.4-27.7c-8.4-4.2-15.4-10.8-20.1-18.9zM256 128a32 32 0 1 0 0-64 32 32 0 1 0 0 64"/></svg>

    </a>
    CC学习文档库
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    首页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/Python-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    并发编程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/Python-%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    异步编程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/DRF-Note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DRF框架
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/celery-Note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    celery-Note
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/django%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    django项目部署
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/FastAPI-Note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FastAPI-Note
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Golang
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Golang
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    GoLang-Note
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    GoLang-Note
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      📚 开发环境配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 开发环境配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1 编译器下载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-window" class="md-nav__link">
    <span class="md-ellipsis">
      2 window开发环境配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-linux" class="md-nav__link">
    <span class="md-ellipsis">
      3 Linux开发环境配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4 目录结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5 相关编译、执行命令
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6 扩展：编译结果类型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      📚 包管理器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 包管理器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-go-mod" class="md-nav__link">
    <span class="md-ellipsis">
      1 go mod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-go" class="md-nav__link">
    <span class="md-ellipsis">
      2 Go语言常用命令
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      📚 变量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      1 变量声明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2 变量赋值
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      📚 常量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 常量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      1 常量声明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2 常量建议
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      📚 流程控制语句
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 流程控制语句">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-switch" class="md-nav__link">
    <span class="md-ellipsis">
      1. 使用表达式switch判断范围
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-fallthrough" class="md-nav__link">
    <span class="md-ellipsis">
      2. 使用fallthrough实现范围穿透
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 多个条件组合判断范围
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-switch" class="md-nav__link">
    <span class="md-ellipsis">
      4. 类型switch结合范围判断
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      📚编码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚编码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ascii" class="md-nav__link">
    <span class="md-ellipsis">
      1 ASCII编码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-unicode" class="md-nav__link">
    <span class="md-ellipsis">
      2 unicode万国码标准
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-utf-8" class="md-nav__link">
    <span class="md-ellipsis">
      3 utf-8编码
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      📚 数据类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 数据类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      1 整型之间转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      2 不同类型转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      3 字符串的本质
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    <span class="md-ellipsis">
      4 字符串常用方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    <span class="md-ellipsis">
      5 字符串与对应码点数互相转换
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      📚 进制转换函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 进制转换函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    <span class="md-ellipsis">
      1 十进制转其他进制（数字转字符串）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    <span class="md-ellipsis">
      2 其他进制转十进制（字符串转数字）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      📚 数组(长度固定)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 数组(长度固定)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    <span class="md-ellipsis">
      1 基本原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    <span class="md-ellipsis">
      2 数组可变与拷贝
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      📚 切片(长度可变)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 切片(长度可变)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_6" class="md-nav__link">
    <span class="md-ellipsis">
      1 切片概念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_5" class="md-nav__link">
    <span class="md-ellipsis">
      2 切片创建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    <span class="md-ellipsis">
      3 切片与数组区别
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    <span class="md-ellipsis">
      4 切片自动扩容
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 切片自动扩容">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 具体扩容因子变化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 特殊情况
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 最佳实践
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_2" class="md-nav__link">
    <span class="md-ellipsis">
      5 切片相关操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 切片相关操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 基本操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 追加元素
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52_1" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 “ 删除”元素
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 插入元素
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-map" class="md-nav__link">
    <span class="md-ellipsis">
      📚 哈希表-map
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 哈希表-map">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_7" class="md-nav__link">
    <span class="md-ellipsis">
      1 基本介绍
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 基本介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 重要特性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 性能特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 使用场景
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 遍历特性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_6" class="md-nav__link">
    <span class="md-ellipsis">
      2 声明 &amp; 初始化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    <span class="md-ellipsis">
      3 长度、容量及操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-key" class="md-nav__link">
    <span class="md-ellipsis">
      4 嵌套key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_3" class="md-nav__link">
    <span class="md-ellipsis">
      5 底层存储原理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 底层存储原理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51_1" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 初始化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52_2" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 写入数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53_1" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 读取数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54" class="md-nav__link">
    <span class="md-ellipsis">
      5.4 扩容
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55" class="md-nav__link">
    <span class="md-ellipsis">
      5.5 迁移
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#newmake" class="md-nav__link">
    <span class="md-ellipsis">
      📚 指针与new以及make
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 指针与new以及make">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_8" class="md-nav__link">
    <span class="md-ellipsis">
      1 内存地址与值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_7" class="md-nav__link">
    <span class="md-ellipsis">
      2 操作符
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_4" class="md-nav__link">
    <span class="md-ellipsis">
      3 指针的典型用途
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 指针的典型用途">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 避免大数据的拷贝
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 修改函数外部的变量
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 实现引用语义（如修改结构体字段）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_3" class="md-nav__link">
    <span class="md-ellipsis">
      4 指针的注意事项
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 指针的注意事项">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-nil-new" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 空指针（nil）与 new关键字
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42_1" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 不要对栈上逃逸的指针过度优化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43_1" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 指针与并发安全
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-make" class="md-nav__link">
    <span class="md-ellipsis">
      5 make函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 make函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51_2" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 核心作用总结：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-make-new" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 为什么需要 make？（与 new 的对比）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_1" class="md-nav__link">
    <span class="md-ellipsis">
      6 何时使用指针？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      7 指针两个高级操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7 指针两个高级操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 数组地址
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 指针加减
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      📚 函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_9" class="md-nav__link">
    <span class="md-ellipsis">
      1 一等公民：函数可以作为值传递、作为参数和返回值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_8" class="md-nav__link">
    <span class="md-ellipsis">
      2 匿名函数（闭包）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_5" class="md-nav__link">
    <span class="md-ellipsis">
      3 可变参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-defer" class="md-nav__link">
    <span class="md-ellipsis">
      4 延迟执行（defer）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_4" class="md-nav__link">
    <span class="md-ellipsis">
      5 方法（与类型关联的函数）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_2" class="md-nav__link">
    <span class="md-ellipsis">
      6 重点谈闭包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_1" class="md-nav__link">
    <span class="md-ellipsis">
      7 函数递归剖析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      8 命名返回值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-deferrecover" class="md-nav__link">
    <span class="md-ellipsis">
      9 异常处理（defer...recover...）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      📚 结构体
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 结构体">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_10" class="md-nav__link">
    <span class="md-ellipsis">
      1 结构体定义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_9" class="md-nav__link">
    <span class="md-ellipsis">
      2 结构体指针
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_6" class="md-nav__link">
    <span class="md-ellipsis">
      3 结构体赋值（拷贝）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_4" class="md-nav__link">
    <span class="md-ellipsis">
      4 结构体指针赋值（引用）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_5" class="md-nav__link">
    <span class="md-ellipsis">
      5 结构体嵌套数组、切片等赋值拷贝
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_3" class="md-nav__link">
    <span class="md-ellipsis">
      6 获取结构体字段名与标签
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_2" class="md-nav__link">
    <span class="md-ellipsis">
      7 结构体本身与指针用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_1" class="md-nav__link">
    <span class="md-ellipsis">
      8 类型方法与结构体方法定义
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8 类型方法与结构体方法定义">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-type" class="md-nav__link">
    <span class="md-ellipsis">
      8.1 项目开发中会为type声明类型编写一些方法，从而实现对象.方法操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82" class="md-nav__link">
    <span class="md-ellipsis">
      8.2 结构体方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      9 结构体方法继承
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      10 结构体工厂函数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      📚 接口
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 接口">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_11" class="md-nav__link">
    <span class="md-ellipsis">
      1 接口定义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_10" class="md-nav__link">
    <span class="md-ellipsis">
      2 接口作用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 接口作用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 空接口-代指任意类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 接口转化指定类型的数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 接口类型断言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 接口约束与规范
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go118" class="md-nav__link">
    <span class="md-ellipsis">
      📚 泛型（go1.18+）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 泛型（go1.18+）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_12" class="md-nav__link">
    <span class="md-ellipsis">
      1 基本语法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_11" class="md-nav__link">
    <span class="md-ellipsis">
      2 基于基础类型的自定义类型泛型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_7" class="md-nav__link">
    <span class="md-ellipsis">
      3 基于泛型继续定义泛型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_5" class="md-nav__link">
    <span class="md-ellipsis">
      4 规避指针类型写法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_6" class="md-nav__link">
    <span class="md-ellipsis">
      5 泛型接收器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_4" class="md-nav__link">
    <span class="md-ellipsis">
      6 泛型函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_3" class="md-nav__link">
    <span class="md-ellipsis">
      7 泛型接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_2" class="md-nav__link">
    <span class="md-ellipsis">
      8 泛型带来的接口语法变化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9_1" class="md-nav__link">
    <span class="md-ellipsis">
      9 预定义接口的使用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9 预定义接口的使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91" class="md-nav__link">
    <span class="md-ellipsis">
      9.1 支持可比较是否相等的类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92" class="md-nav__link">
    <span class="md-ellipsis">
      9.2 支持可比较大小的类型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      📚 反射
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 反射">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_13" class="md-nav__link">
    <span class="md-ellipsis">
      1 基本概念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_12" class="md-nav__link">
    <span class="md-ellipsis">
      2 反射的三大定律
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_6" class="md-nav__link">
    <span class="md-ellipsis">
      4 实例认识反射
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_7" class="md-nav__link">
    <span class="md-ellipsis">
      5 反射获取类型信息
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 反射获取类型信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51_3" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 获取对变量反射后继续反射信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52_3" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 反射获取方法注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_5" class="md-nav__link">
    <span class="md-ellipsis">
      6 反射判断类型是否实现了接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-valueof" class="md-nav__link">
    <span class="md-ellipsis">
      7 关于ValueOf常用操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7 关于ValueOf常用操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-typeofelemvalueofelem" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 明确TypeOf().Elem()与ValueOf().Elem()之间的区别
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72_1" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 反射获取与修改值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-type" class="md-nav__link">
    <span class="md-ellipsis">
      7.4 转Type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-value" class="md-nav__link">
    <span class="md-ellipsis">
      7.5 指针/Value(具体值类型)互转
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76-reflectvalue" class="md-nav__link">
    <span class="md-ellipsis">
      7.6 reflect.Value与具体类型互转
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#77" class="md-nav__link">
    <span class="md-ellipsis">
      7.7 空类型空指针与有类型空指针
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#78" class="md-nav__link">
    <span class="md-ellipsis">
      7.8 判断是否零值对象
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#79" class="md-nav__link">
    <span class="md-ellipsis">
      7.9 借助反射批量或单个调用函数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      📚 测试相关
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 测试相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_14" class="md-nav__link">
    <span class="md-ellipsis">
      1 基本结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_13" class="md-nav__link">
    <span class="md-ellipsis">
      2 单元测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-table-driven" class="md-nav__link">
    <span class="md-ellipsis">
      3 表驱动法（Table Driven）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_7" class="md-nav__link">
    <span class="md-ellipsis">
      4 测试辅助函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      5 基准测试 (Benchmark)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-go118" class="md-nav__link">
    <span class="md-ellipsis">
      6 模糊测试（Go1.18+）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmtstrconvstringsjsonbytes" class="md-nav__link">
    <span class="md-ellipsis">
      📚 内置包：fmt/strconv/strings/json/bytes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 内置包：fmt/strconv/strings/json/bytes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-fmt-io" class="md-nav__link">
    <span class="md-ellipsis">
      1 fmt 包 - 格式化I/O
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 fmt 包 - 格式化I/O">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11_1" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 格式化输出
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12_1" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 格式化输入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13_1" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 其他
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-strconv-" class="md-nav__link">
    <span class="md-ellipsis">
      2 strconv 包 - 字符串转换
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 strconv 包 - 字符串转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 字符串与基本类型转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 其他转换
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-strings-" class="md-nav__link">
    <span class="md-ellipsis">
      3 strings 包 - 字符串操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 strings 包 - 字符串操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31_1" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 字符串查询
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_1" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 字符串操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33_1" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 其他
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-encodingjson-json" class="md-nav__link">
    <span class="md-ellipsis">
      4 encoding/json 包 - JSON处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 encoding/json 包 - JSON处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41_1" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 编码(序列化)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42_2" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 解码(反序列化)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43_2" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 流式处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 其他
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 实际应用测试
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-bytes" class="md-nav__link">
    <span class="md-ellipsis">
      5 bytes 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 bytes 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-strings" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 常用函数（对标 strings 包）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.1 常用函数（对标 strings 包）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511" class="md-nav__link">
    <span class="md-ellipsis">
      5.1.1 比较与判断
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512" class="md-nav__link">
    <span class="md-ellipsis">
      5.1.2 查找与定位
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513" class="md-nav__link">
    <span class="md-ellipsis">
      5.1.3 操作与转换
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-bytesbuffer" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 bytes.Buffer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.2 bytes.Buffer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#521-buffer" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.1 创建 Buffer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#522-write" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.2 写入数据 (Write)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#523-read" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.3 读取数据 (Read)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#524" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.4 其它重要方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timeflagregexp" class="md-nav__link">
    <span class="md-ellipsis">
      📚 内置包：time/flag/regexp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 内置包：time/flag/regexp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-time" class="md-nav__link">
    <span class="md-ellipsis">
      1 time 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 time 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11_2" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 时间获取与显示
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12_2" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 时间与字符串之间转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13_2" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 时间计算与比较
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14_1" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 定时器与休眠
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15" class="md-nav__link">
    <span class="md-ellipsis">
      1.5 获取时间戳
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-flag" class="md-nav__link">
    <span class="md-ellipsis">
      2 flag 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 flag 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 基本使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-flag" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 自定义flag类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 其他方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-regexp-" class="md-nav__link">
    <span class="md-ellipsis">
      3 regexp 包 - 正则表达式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 regexp 包 - 正则表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31_2" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 基本匹配
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_2" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 分组捕获
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33_2" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 替换与分割
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 其他方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#osiofilepath" class="md-nav__link">
    <span class="md-ellipsis">
      📚 内置包：文件相关（os/io/filepath...）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 内置包：文件相关（os/io/filepath...）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-os" class="md-nav__link">
    <span class="md-ellipsis">
      1 os 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 os 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11_3" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 文件操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12_3" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 目录操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13_3" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 文件对象方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-pathfilepath" class="md-nav__link">
    <span class="md-ellipsis">
      2 path/filepath 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 path/filepath 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_2" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 处理跨平台的文件路径
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-io" class="md-nav__link">
    <span class="md-ellipsis">
      3 io 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 io 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-io" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 基础IO接口和工具函数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-iofs" class="md-nav__link">
    <span class="md-ellipsis">
      4 io/fs 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 io/fs 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-go-116" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 文件系统抽象接口(go 1.16+)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      📚 文件读写
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 文件读写">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_15" class="md-nav__link">
    <span class="md-ellipsis">
      1 普通读写方式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 普通读写方式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#12-read" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 读取文件内容（Read）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-write" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 写入文件内容（Write）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-seeker" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 写入文件位置（Seeker）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4 写入文件位置（Seeker）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.1 文件打开模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.2 文件权限模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-seeker" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.3 Seeker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-bufio" class="md-nav__link">
    <span class="md-ellipsis">
      2 高效缓冲读写包-bufio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 高效缓冲读写包-bufio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_3" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 高效读取文件（逐行读取）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22_2" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 处理标准输入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23_2" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 网络编程中的缓冲读写
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 高性能文件写入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 读取特定分隔符的数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26" class="md-nav__link">
    <span class="md-ellipsis">
      2.6 读取固定大小的数据块
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27" class="md-nav__link">
    <span class="md-ellipsis">
      2.7 性能敏感的日志处理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      📚 日志相关内容
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 日志相关内容">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-log" class="md-nav__link">
    <span class="md-ellipsis">
      1 自定义Log记录器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-go-zap2025" class="md-nav__link">
    <span class="md-ellipsis">
      2 go性能最快的日志库-zap（2025）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 go性能最快的日志库-zap（2025）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_4" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 基本配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22_3" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 自定义内容（完整）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2 自定义内容（完整）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.1 按文件大小分片
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2 按每天文件分片
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.3 按每天文件+错误单独文件分片
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.4 单独/全局日志对象使用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gogoroutine" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Go并发编程（Goroutine）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Go并发编程（Goroutine）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_16" class="md-nav__link">
    <span class="md-ellipsis">
      1 协程创建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-channel" class="md-nav__link">
    <span class="md-ellipsis">
      2 Channel类型（通道）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 Channel类型（通道）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-channel" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Channel死锁
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-channel" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Channel关闭特性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-channel" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Channel有缓冲/无缓冲创建场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 Channel有缓冲/无缓冲创建场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.1 有缓冲创建场景
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.2 无缓冲创建场景
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-channel" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 Channel三种取值写法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_8" class="md-nav__link">
    <span class="md-ellipsis">
      3 并发中锁应用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 并发中锁应用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-mutex" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 互斥锁（Mutex）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-rwmutex" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 读写锁（RWMutex）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Go语言的包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Go语言的包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_17" class="md-nav__link">
    <span class="md-ellipsis">
      1 包声明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_14" class="md-nav__link">
    <span class="md-ellipsis">
      2 导入路径
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_9" class="md-nav__link">
    <span class="md-ellipsis">
      3 导入别名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_8" class="md-nav__link">
    <span class="md-ellipsis">
      4 点导入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_8" class="md-nav__link">
    <span class="md-ellipsis">
      5 空白导入（匿名导入）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_6" class="md-nav__link">
    <span class="md-ellipsis">
      6 可见性规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-init" class="md-nav__link">
    <span class="md-ellipsis">
      7 init函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_3" class="md-nav__link">
    <span class="md-ellipsis">
      8 包文档
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-internal" class="md-nav__link">
    <span class="md-ellipsis">
      9 内部包(internal)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10_1" class="md-nav__link">
    <span class="md-ellipsis">
      10. 测试包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-go-111" class="md-nav__link">
    <span class="md-ellipsis">
      11. 模块支持(Go 1.11+)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12_4" class="md-nav__link">
    <span class="md-ellipsis">
      12. 包命名惯例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-go118" class="md-nav__link">
    <span class="md-ellipsis">
      13 工作空间（Go1.18+）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#goerror" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Go错误处理（error）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Go错误处理（error）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_18" class="md-nav__link">
    <span class="md-ellipsis">
      1 标准错误
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_15" class="md-nav__link">
    <span class="md-ellipsis">
      2 利用接口自定义错误
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_10" class="md-nav__link">
    <span class="md-ellipsis">
      3 错误封装
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 错误封装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-fmterrorf" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 fmt.Errorf()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#31-errorsjoingo120" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 errors.Join()（Go1.20+）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-panic-" class="md-nav__link">
    <span class="md-ellipsis">
      4 panic - 运行时错误
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gonet" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Go网络编程（net包）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Go网络编程（net包）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-tcp" class="md-nav__link">
    <span class="md-ellipsis">
      1 TCP网络编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 TCP网络编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-tcpserver-" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 tcpserver-服务端
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-tcpclient-" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 tcpclient-客户端
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-udp" class="md-nav__link">
    <span class="md-ellipsis">
      2 UDP网络编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 UDP网络编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-udpserver-" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 udpserver-服务端
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-udpclient-" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 udpclient-客户端
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-http" class="md-nav__link">
    <span class="md-ellipsis">
      3 HTTP网络编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 HTTP网络编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-httpserver" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 httpserver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-httpclient" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 httpclient
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gocontext" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Go语言Context
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Go语言Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-context" class="md-nav__link">
    <span class="md-ellipsis">
      1 根context
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 根context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-contextbackground" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 context.Background()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-contexttodo" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 context.TODO()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-context" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 根context派生
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-context" class="md-nav__link">
    <span class="md-ellipsis">
      2 超时控制context
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 超时控制context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-withtimeout" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 基本示例-WithTimeout()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-context" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 超时context相关内置方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-withtimeoutcause" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 WithTimeoutCause()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-context" class="md-nav__link">
    <span class="md-ellipsis">
      3 值传递context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-context" class="md-nav__link">
    <span class="md-ellipsis">
      4 可取消context
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 可取消context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-withcancelwithcancelcause" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 WithCancel()/WithCancelCause()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#41-withoutcancel" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 WithoutCancel()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-context" class="md-nav__link">
    <span class="md-ellipsis">
      5 指定时间取消context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-contextafterfunc" class="md-nav__link">
    <span class="md-ellipsis">
      6 声明式响应取消事件context.AfterFunc()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 声明式响应取消事件context.AfterFunc()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-contextafterfunc" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 适合使用 context.AfterFunc 的场景
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 对比传统的清理资源做法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    <span class="md-ellipsis">
      6.3 实际场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.3 实际场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#631" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.1 基本的资源清理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#632-stop" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.2 使用 stop 函数取消注册
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#633-contextafterfunc" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.3 多个 context.AfterFunc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-context" class="md-nav__link">
    <span class="md-ellipsis">
      7 context学习总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Vue3
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Vue3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Vue3-Note/vue3-%E5%85%A5%E9%97%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vue3-入门
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Vue3-Note/vue3-%E7%BB%84%E5%90%88%E5%BC%8FAPI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vue3-组合式API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Vue3-Note/Vue3%2BTS%2BPnpm-Note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vue3+TS+Pnpm-Note
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Docker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Docker-Note/DockerLearningNote/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker-Note
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Docker-Note/DockerVMLocalTest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker本地测试
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Docker-Note/DockerCSERVER/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker容器化部署
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DataBase
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            DataBase
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../数据库-Note/mysql优化实践.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MySQL优化实践
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%95%B0%E6%8D%AE%E5%BA%93-Note/MongoDBStudy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MongoDB-入门
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E6%95%B0%E6%8D%AE%E5%BA%93-Note/SqlAlchemyStudy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SqlAlchemyStudy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../数据库-Note/pymysqlStudy.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PyMySQLStudy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../数据库-Note/redisStdudy.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RedisStdudy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    LinuxEnvConf
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            LinuxEnvConf
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LinuxEnv-Note/Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nginx配置文件
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Others
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Others
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE-Note/http%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    http协议
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/uwsgi%2Bnginx%E4%B8%A4%E7%A7%8D%E5%8D%8F%E8%AE%AE%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uwsgi+nginx两种协议代理配置
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      📚 开发环境配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 开发环境配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1 编译器下载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-window" class="md-nav__link">
    <span class="md-ellipsis">
      2 window开发环境配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-linux" class="md-nav__link">
    <span class="md-ellipsis">
      3 Linux开发环境配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4 目录结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5 相关编译、执行命令
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6 扩展：编译结果类型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      📚 包管理器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 包管理器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-go-mod" class="md-nav__link">
    <span class="md-ellipsis">
      1 go mod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-go" class="md-nav__link">
    <span class="md-ellipsis">
      2 Go语言常用命令
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      📚 变量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      1 变量声明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2 变量赋值
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      📚 常量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 常量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      1 常量声明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2 常量建议
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      📚 流程控制语句
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 流程控制语句">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-switch" class="md-nav__link">
    <span class="md-ellipsis">
      1. 使用表达式switch判断范围
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-fallthrough" class="md-nav__link">
    <span class="md-ellipsis">
      2. 使用fallthrough实现范围穿透
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 多个条件组合判断范围
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-switch" class="md-nav__link">
    <span class="md-ellipsis">
      4. 类型switch结合范围判断
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      📚编码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚编码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ascii" class="md-nav__link">
    <span class="md-ellipsis">
      1 ASCII编码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-unicode" class="md-nav__link">
    <span class="md-ellipsis">
      2 unicode万国码标准
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-utf-8" class="md-nav__link">
    <span class="md-ellipsis">
      3 utf-8编码
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      📚 数据类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 数据类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      1 整型之间转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      2 不同类型转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      3 字符串的本质
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    <span class="md-ellipsis">
      4 字符串常用方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    <span class="md-ellipsis">
      5 字符串与对应码点数互相转换
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      📚 进制转换函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 进制转换函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    <span class="md-ellipsis">
      1 十进制转其他进制（数字转字符串）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    <span class="md-ellipsis">
      2 其他进制转十进制（字符串转数字）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      📚 数组(长度固定)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 数组(长度固定)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    <span class="md-ellipsis">
      1 基本原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    <span class="md-ellipsis">
      2 数组可变与拷贝
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      📚 切片(长度可变)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 切片(长度可变)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_6" class="md-nav__link">
    <span class="md-ellipsis">
      1 切片概念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_5" class="md-nav__link">
    <span class="md-ellipsis">
      2 切片创建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    <span class="md-ellipsis">
      3 切片与数组区别
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    <span class="md-ellipsis">
      4 切片自动扩容
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 切片自动扩容">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 具体扩容因子变化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 特殊情况
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 最佳实践
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_2" class="md-nav__link">
    <span class="md-ellipsis">
      5 切片相关操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 切片相关操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 基本操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 追加元素
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52_1" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 “ 删除”元素
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 插入元素
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-map" class="md-nav__link">
    <span class="md-ellipsis">
      📚 哈希表-map
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 哈希表-map">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_7" class="md-nav__link">
    <span class="md-ellipsis">
      1 基本介绍
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 基本介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 重要特性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 性能特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 使用场景
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 遍历特性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_6" class="md-nav__link">
    <span class="md-ellipsis">
      2 声明 &amp; 初始化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    <span class="md-ellipsis">
      3 长度、容量及操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-key" class="md-nav__link">
    <span class="md-ellipsis">
      4 嵌套key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_3" class="md-nav__link">
    <span class="md-ellipsis">
      5 底层存储原理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 底层存储原理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51_1" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 初始化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52_2" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 写入数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53_1" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 读取数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54" class="md-nav__link">
    <span class="md-ellipsis">
      5.4 扩容
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55" class="md-nav__link">
    <span class="md-ellipsis">
      5.5 迁移
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#newmake" class="md-nav__link">
    <span class="md-ellipsis">
      📚 指针与new以及make
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 指针与new以及make">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_8" class="md-nav__link">
    <span class="md-ellipsis">
      1 内存地址与值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_7" class="md-nav__link">
    <span class="md-ellipsis">
      2 操作符
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_4" class="md-nav__link">
    <span class="md-ellipsis">
      3 指针的典型用途
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 指针的典型用途">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 避免大数据的拷贝
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 修改函数外部的变量
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 实现引用语义（如修改结构体字段）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_3" class="md-nav__link">
    <span class="md-ellipsis">
      4 指针的注意事项
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 指针的注意事项">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-nil-new" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 空指针（nil）与 new关键字
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42_1" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 不要对栈上逃逸的指针过度优化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43_1" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 指针与并发安全
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-make" class="md-nav__link">
    <span class="md-ellipsis">
      5 make函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 make函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51_2" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 核心作用总结：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-make-new" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 为什么需要 make？（与 new 的对比）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_1" class="md-nav__link">
    <span class="md-ellipsis">
      6 何时使用指针？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      7 指针两个高级操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7 指针两个高级操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 数组地址
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 指针加减
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      📚 函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_9" class="md-nav__link">
    <span class="md-ellipsis">
      1 一等公民：函数可以作为值传递、作为参数和返回值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_8" class="md-nav__link">
    <span class="md-ellipsis">
      2 匿名函数（闭包）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_5" class="md-nav__link">
    <span class="md-ellipsis">
      3 可变参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-defer" class="md-nav__link">
    <span class="md-ellipsis">
      4 延迟执行（defer）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_4" class="md-nav__link">
    <span class="md-ellipsis">
      5 方法（与类型关联的函数）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_2" class="md-nav__link">
    <span class="md-ellipsis">
      6 重点谈闭包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_1" class="md-nav__link">
    <span class="md-ellipsis">
      7 函数递归剖析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      8 命名返回值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-deferrecover" class="md-nav__link">
    <span class="md-ellipsis">
      9 异常处理（defer...recover...）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      📚 结构体
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 结构体">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_10" class="md-nav__link">
    <span class="md-ellipsis">
      1 结构体定义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_9" class="md-nav__link">
    <span class="md-ellipsis">
      2 结构体指针
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_6" class="md-nav__link">
    <span class="md-ellipsis">
      3 结构体赋值（拷贝）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_4" class="md-nav__link">
    <span class="md-ellipsis">
      4 结构体指针赋值（引用）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_5" class="md-nav__link">
    <span class="md-ellipsis">
      5 结构体嵌套数组、切片等赋值拷贝
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_3" class="md-nav__link">
    <span class="md-ellipsis">
      6 获取结构体字段名与标签
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_2" class="md-nav__link">
    <span class="md-ellipsis">
      7 结构体本身与指针用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_1" class="md-nav__link">
    <span class="md-ellipsis">
      8 类型方法与结构体方法定义
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8 类型方法与结构体方法定义">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-type" class="md-nav__link">
    <span class="md-ellipsis">
      8.1 项目开发中会为type声明类型编写一些方法，从而实现对象.方法操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82" class="md-nav__link">
    <span class="md-ellipsis">
      8.2 结构体方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      9 结构体方法继承
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      10 结构体工厂函数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      📚 接口
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 接口">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_11" class="md-nav__link">
    <span class="md-ellipsis">
      1 接口定义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_10" class="md-nav__link">
    <span class="md-ellipsis">
      2 接口作用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 接口作用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 空接口-代指任意类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 接口转化指定类型的数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 接口类型断言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 接口约束与规范
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go118" class="md-nav__link">
    <span class="md-ellipsis">
      📚 泛型（go1.18+）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 泛型（go1.18+）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_12" class="md-nav__link">
    <span class="md-ellipsis">
      1 基本语法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_11" class="md-nav__link">
    <span class="md-ellipsis">
      2 基于基础类型的自定义类型泛型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_7" class="md-nav__link">
    <span class="md-ellipsis">
      3 基于泛型继续定义泛型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_5" class="md-nav__link">
    <span class="md-ellipsis">
      4 规避指针类型写法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_6" class="md-nav__link">
    <span class="md-ellipsis">
      5 泛型接收器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_4" class="md-nav__link">
    <span class="md-ellipsis">
      6 泛型函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_3" class="md-nav__link">
    <span class="md-ellipsis">
      7 泛型接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_2" class="md-nav__link">
    <span class="md-ellipsis">
      8 泛型带来的接口语法变化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9_1" class="md-nav__link">
    <span class="md-ellipsis">
      9 预定义接口的使用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9 预定义接口的使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91" class="md-nav__link">
    <span class="md-ellipsis">
      9.1 支持可比较是否相等的类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92" class="md-nav__link">
    <span class="md-ellipsis">
      9.2 支持可比较大小的类型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      📚 反射
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 反射">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_13" class="md-nav__link">
    <span class="md-ellipsis">
      1 基本概念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_12" class="md-nav__link">
    <span class="md-ellipsis">
      2 反射的三大定律
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_6" class="md-nav__link">
    <span class="md-ellipsis">
      4 实例认识反射
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_7" class="md-nav__link">
    <span class="md-ellipsis">
      5 反射获取类型信息
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 反射获取类型信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51_3" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 获取对变量反射后继续反射信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52_3" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 反射获取方法注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_5" class="md-nav__link">
    <span class="md-ellipsis">
      6 反射判断类型是否实现了接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-valueof" class="md-nav__link">
    <span class="md-ellipsis">
      7 关于ValueOf常用操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7 关于ValueOf常用操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-typeofelemvalueofelem" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 明确TypeOf().Elem()与ValueOf().Elem()之间的区别
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72_1" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 反射获取与修改值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-type" class="md-nav__link">
    <span class="md-ellipsis">
      7.4 转Type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-value" class="md-nav__link">
    <span class="md-ellipsis">
      7.5 指针/Value(具体值类型)互转
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76-reflectvalue" class="md-nav__link">
    <span class="md-ellipsis">
      7.6 reflect.Value与具体类型互转
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#77" class="md-nav__link">
    <span class="md-ellipsis">
      7.7 空类型空指针与有类型空指针
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#78" class="md-nav__link">
    <span class="md-ellipsis">
      7.8 判断是否零值对象
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#79" class="md-nav__link">
    <span class="md-ellipsis">
      7.9 借助反射批量或单个调用函数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      📚 测试相关
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 测试相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_14" class="md-nav__link">
    <span class="md-ellipsis">
      1 基本结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_13" class="md-nav__link">
    <span class="md-ellipsis">
      2 单元测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-table-driven" class="md-nav__link">
    <span class="md-ellipsis">
      3 表驱动法（Table Driven）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_7" class="md-nav__link">
    <span class="md-ellipsis">
      4 测试辅助函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      5 基准测试 (Benchmark)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-go118" class="md-nav__link">
    <span class="md-ellipsis">
      6 模糊测试（Go1.18+）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fmtstrconvstringsjsonbytes" class="md-nav__link">
    <span class="md-ellipsis">
      📚 内置包：fmt/strconv/strings/json/bytes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 内置包：fmt/strconv/strings/json/bytes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-fmt-io" class="md-nav__link">
    <span class="md-ellipsis">
      1 fmt 包 - 格式化I/O
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 fmt 包 - 格式化I/O">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11_1" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 格式化输出
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12_1" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 格式化输入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13_1" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 其他
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-strconv-" class="md-nav__link">
    <span class="md-ellipsis">
      2 strconv 包 - 字符串转换
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 strconv 包 - 字符串转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 字符串与基本类型转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 其他转换
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-strings-" class="md-nav__link">
    <span class="md-ellipsis">
      3 strings 包 - 字符串操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 strings 包 - 字符串操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31_1" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 字符串查询
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_1" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 字符串操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33_1" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 其他
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-encodingjson-json" class="md-nav__link">
    <span class="md-ellipsis">
      4 encoding/json 包 - JSON处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 encoding/json 包 - JSON处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41_1" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 编码(序列化)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42_2" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 解码(反序列化)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43_2" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 流式处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 其他
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 实际应用测试
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-bytes" class="md-nav__link">
    <span class="md-ellipsis">
      5 bytes 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 bytes 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-strings" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 常用函数（对标 strings 包）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.1 常用函数（对标 strings 包）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511" class="md-nav__link">
    <span class="md-ellipsis">
      5.1.1 比较与判断
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512" class="md-nav__link">
    <span class="md-ellipsis">
      5.1.2 查找与定位
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513" class="md-nav__link">
    <span class="md-ellipsis">
      5.1.3 操作与转换
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-bytesbuffer" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 bytes.Buffer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.2 bytes.Buffer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#521-buffer" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.1 创建 Buffer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#522-write" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.2 写入数据 (Write)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#523-read" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.3 读取数据 (Read)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#524" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.4 其它重要方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timeflagregexp" class="md-nav__link">
    <span class="md-ellipsis">
      📚 内置包：time/flag/regexp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 内置包：time/flag/regexp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-time" class="md-nav__link">
    <span class="md-ellipsis">
      1 time 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 time 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11_2" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 时间获取与显示
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12_2" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 时间与字符串之间转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13_2" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 时间计算与比较
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14_1" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 定时器与休眠
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15" class="md-nav__link">
    <span class="md-ellipsis">
      1.5 获取时间戳
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-flag" class="md-nav__link">
    <span class="md-ellipsis">
      2 flag 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 flag 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 基本使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-flag" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 自定义flag类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 其他方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-regexp-" class="md-nav__link">
    <span class="md-ellipsis">
      3 regexp 包 - 正则表达式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 regexp 包 - 正则表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31_2" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 基本匹配
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32_2" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 分组捕获
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33_2" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 替换与分割
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 其他方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#osiofilepath" class="md-nav__link">
    <span class="md-ellipsis">
      📚 内置包：文件相关（os/io/filepath...）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 内置包：文件相关（os/io/filepath...）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-os" class="md-nav__link">
    <span class="md-ellipsis">
      1 os 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 os 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11_3" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 文件操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12_3" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 目录操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13_3" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 文件对象方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-pathfilepath" class="md-nav__link">
    <span class="md-ellipsis">
      2 path/filepath 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 path/filepath 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_2" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 处理跨平台的文件路径
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-io" class="md-nav__link">
    <span class="md-ellipsis">
      3 io 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 io 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-io" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 基础IO接口和工具函数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-iofs" class="md-nav__link">
    <span class="md-ellipsis">
      4 io/fs 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 io/fs 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-go-116" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 文件系统抽象接口(go 1.16+)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      📚 文件读写
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 文件读写">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_15" class="md-nav__link">
    <span class="md-ellipsis">
      1 普通读写方式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 普通读写方式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#12-read" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 读取文件内容（Read）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-write" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 写入文件内容（Write）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-seeker" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 写入文件位置（Seeker）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4 写入文件位置（Seeker）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.1 文件打开模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.2 文件权限模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-seeker" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.3 Seeker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-bufio" class="md-nav__link">
    <span class="md-ellipsis">
      2 高效缓冲读写包-bufio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 高效缓冲读写包-bufio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_3" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 高效读取文件（逐行读取）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22_2" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 处理标准输入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23_2" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 网络编程中的缓冲读写
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 高性能文件写入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 读取特定分隔符的数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26" class="md-nav__link">
    <span class="md-ellipsis">
      2.6 读取固定大小的数据块
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27" class="md-nav__link">
    <span class="md-ellipsis">
      2.7 性能敏感的日志处理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      📚 日志相关内容
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 日志相关内容">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-log" class="md-nav__link">
    <span class="md-ellipsis">
      1 自定义Log记录器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-go-zap2025" class="md-nav__link">
    <span class="md-ellipsis">
      2 go性能最快的日志库-zap（2025）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 go性能最快的日志库-zap（2025）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_4" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 基本配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22_3" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 自定义内容（完整）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2 自定义内容（完整）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.1 按文件大小分片
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2 按每天文件分片
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.3 按每天文件+错误单独文件分片
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.4 单独/全局日志对象使用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gogoroutine" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Go并发编程（Goroutine）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Go并发编程（Goroutine）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_16" class="md-nav__link">
    <span class="md-ellipsis">
      1 协程创建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-channel" class="md-nav__link">
    <span class="md-ellipsis">
      2 Channel类型（通道）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 Channel类型（通道）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-channel" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Channel死锁
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-channel" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Channel关闭特性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-channel" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Channel有缓冲/无缓冲创建场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 Channel有缓冲/无缓冲创建场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.1 有缓冲创建场景
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.2 无缓冲创建场景
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-channel" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 Channel三种取值写法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_8" class="md-nav__link">
    <span class="md-ellipsis">
      3 并发中锁应用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 并发中锁应用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-mutex" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 互斥锁（Mutex）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-rwmutex" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 读写锁（RWMutex）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Go语言的包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Go语言的包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_17" class="md-nav__link">
    <span class="md-ellipsis">
      1 包声明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_14" class="md-nav__link">
    <span class="md-ellipsis">
      2 导入路径
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_9" class="md-nav__link">
    <span class="md-ellipsis">
      3 导入别名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_8" class="md-nav__link">
    <span class="md-ellipsis">
      4 点导入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_8" class="md-nav__link">
    <span class="md-ellipsis">
      5 空白导入（匿名导入）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_6" class="md-nav__link">
    <span class="md-ellipsis">
      6 可见性规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-init" class="md-nav__link">
    <span class="md-ellipsis">
      7 init函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_3" class="md-nav__link">
    <span class="md-ellipsis">
      8 包文档
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-internal" class="md-nav__link">
    <span class="md-ellipsis">
      9 内部包(internal)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10_1" class="md-nav__link">
    <span class="md-ellipsis">
      10. 测试包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-go-111" class="md-nav__link">
    <span class="md-ellipsis">
      11. 模块支持(Go 1.11+)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12_4" class="md-nav__link">
    <span class="md-ellipsis">
      12. 包命名惯例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-go118" class="md-nav__link">
    <span class="md-ellipsis">
      13 工作空间（Go1.18+）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#goerror" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Go错误处理（error）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Go错误处理（error）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_18" class="md-nav__link">
    <span class="md-ellipsis">
      1 标准错误
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_15" class="md-nav__link">
    <span class="md-ellipsis">
      2 利用接口自定义错误
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_10" class="md-nav__link">
    <span class="md-ellipsis">
      3 错误封装
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 错误封装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-fmterrorf" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 fmt.Errorf()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#31-errorsjoingo120" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 errors.Join()（Go1.20+）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-panic-" class="md-nav__link">
    <span class="md-ellipsis">
      4 panic - 运行时错误
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gonet" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Go网络编程（net包）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Go网络编程（net包）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-tcp" class="md-nav__link">
    <span class="md-ellipsis">
      1 TCP网络编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 TCP网络编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-tcpserver-" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 tcpserver-服务端
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-tcpclient-" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 tcpclient-客户端
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-udp" class="md-nav__link">
    <span class="md-ellipsis">
      2 UDP网络编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 UDP网络编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-udpserver-" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 udpserver-服务端
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-udpclient-" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 udpclient-客户端
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-http" class="md-nav__link">
    <span class="md-ellipsis">
      3 HTTP网络编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 HTTP网络编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-httpserver" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 httpserver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-httpclient" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 httpclient
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gocontext" class="md-nav__link">
    <span class="md-ellipsis">
      📚 Go语言Context
    </span>
  </a>
  
    <nav class="md-nav" aria-label="📚 Go语言Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-context" class="md-nav__link">
    <span class="md-ellipsis">
      1 根context
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 根context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-contextbackground" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 context.Background()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-contexttodo" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 context.TODO()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-context" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 根context派生
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-context" class="md-nav__link">
    <span class="md-ellipsis">
      2 超时控制context
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 超时控制context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-withtimeout" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 基本示例-WithTimeout()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-context" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 超时context相关内置方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-withtimeoutcause" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 WithTimeoutCause()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-context" class="md-nav__link">
    <span class="md-ellipsis">
      3 值传递context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-context" class="md-nav__link">
    <span class="md-ellipsis">
      4 可取消context
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 可取消context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-withcancelwithcancelcause" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 WithCancel()/WithCancelCause()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#41-withoutcancel" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 WithoutCancel()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-context" class="md-nav__link">
    <span class="md-ellipsis">
      5 指定时间取消context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-contextafterfunc" class="md-nav__link">
    <span class="md-ellipsis">
      6 声明式响应取消事件context.AfterFunc()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 声明式响应取消事件context.AfterFunc()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-contextafterfunc" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 适合使用 context.AfterFunc 的场景
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 对比传统的清理资源做法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    <span class="md-ellipsis">
      6.3 实际场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.3 实际场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#631" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.1 基本的资源清理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#632-stop" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.2 使用 stop 函数取消注册
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#633-contextafterfunc" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.3 多个 context.AfterFunc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-context" class="md-nav__link">
    <span class="md-ellipsis">
      7 context学习总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="01basicsciences">01BasicSciences核心笔记<a class="headerlink" href="#01basicsciences" title="Permanent link">&para;</a></h1>
<h2 id="_1">📚 开发环境配置<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="1">1 编译器下载<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p>https://golang.google.cn/doc/install</p>
<h3 id="2-window">2 window开发环境配置<a class="headerlink" href="#2-window" title="Permanent link">&para;</a></h3>
<p>参照linux配置</p>
<h3 id="3-linux">3 Linux开发环境配置<a class="headerlink" href="#3-linux" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 安装位置</span>
/opt/go

<span class="c1"># 可执行文件</span>
/opt/go/bin/go

<span class="c1"># 环境变量配置 ~/.bashrc 或 /etc/profile</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt/go/bin:<span class="nv">$PATH</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">GOROOT</span><span class="o">=</span>/opt/go
<span class="nb">export</span><span class="w"> </span><span class="nv">GOPATH</span><span class="o">=</span>/home/ccplayer/goProjects
<span class="nb">export</span><span class="w"> </span><span class="nv">GOBIN</span><span class="o">=</span>/home/ccplayer/goProjects/bin
</code></pre></div>
<h3 id="4">4 目录结构<a class="headerlink" href="#4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>/home/ccplayer/goProjects/
<span class="w">    </span>-bin
<span class="w">    </span>-pkg
<span class="w">    </span>-src
<span class="w">        </span>-crm
<span class="w">            </span>-app.go
<span class="w">        </span>-autoclick
<span class="w">            </span>-ac.go
</code></pre></div>
<h3 id="5">5 相关编译、执行命令<a class="headerlink" href="#5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 编译与运行</span>
go<span class="w"> </span>run<span class="w"> </span>app.go

<span class="c1"># 编译出二进制文件</span>
go<span class="w"> </span>build
go<span class="w"> </span>build<span class="w"> </span>-o<span class="w"> </span>myapp<span class="w"> </span>app.go
go<span class="w"> </span>install<span class="w">  </span><span class="c1"># 默认编译生成位置：$GOPATH/bin</span>
</code></pre></div>
<h3 id="6">6 扩展：编译结果类型<a class="headerlink" href="#6" title="Permanent link">&para;</a></h3>
<p>go install 可以产生结果文件存在 $GOPATH/bin 与 $GOPATH/pkg 下面，bin下是可执行文件，而pkg下面是包文件（供其他程序员引用）</p>
<p><code>GO111MODULE</code> 是 Go 语言的一个<strong>环境变量</strong>，用于控制 Go 的依赖管理模式（<strong>GOPATH</strong> 模式 vs <strong>Go Modules</strong> 模式）。它的名字来源于 Go 1.11 版本首次引入 Modules 功能</p>
<p>所以如果是编译二进制文件：<strong>GOPATH</strong> 模式 or <strong>Go Modules</strong> 模式都可以（set GO111MODULE=auto + 生成根目录下go.mod文件）；</p>
<p>如果是编译包文件：<strong>GOPATH</strong> 模式才会生成（set GO111MODULE=auto + 删除根目录下go.mod文件）</p>
<div class="highlight"><pre><span></span><code>go install
</code></pre></div>
<ul>
<li>产出可执行二进制文件</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 含有main函数的go文件</span>
go<span class="w"> </span>build<span class="w"> </span>或<span class="w"> </span>go<span class="w"> </span>install
</code></pre></div>
<ul>
<li>产出供其他开发者使用的包文件（.a文件）</li>
</ul>
<p><img alt="image-20250614180604868" src="image-20250614180604868.png" /> </p>
<p>IDE - goland可以支持配置单个项目对应的GOPATH目录，这样就方便每个项目单独的开发环境变量，产物生成在当前项目路径。</p>
<p>.a 文件作为中间产物，不支持直接在代码中导入使用。</p>
<h2 id="_2">📚 包管理器<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="1-go-mod">1 go mod<a class="headerlink" href="#1-go-mod" title="Permanent link">&para;</a></h3>
<p>---------- go mod包管理器模式设置 ----------</p>
<p>查看当前配置：go env</p>
<p>开发推荐使用包的方式，就需要配置go.mod文件</p>
<p>GO111MODULE=off，无模块支持，go命令行将不会支持module功能，寻找依赖包的方式将会沿用旧版本那种通过vendor目录或者GOPATH模式来查找。</p>
<p>GO111MODULE=on，模块支持，go命令行会使用modules，而一点也不会去GOPATH目录下查找。</p>
<p><strong>GO111MODULE=auto，默认值，go命令行将会根据当前目录来决定是否启用module功能，这种情况下可以分为两种情形：</strong></p>
<ol>
<li><strong>当前目录在GOPATH/src之外且该目录包含go.mod文件，开启模块支持；</strong></li>
<li><strong>当前文件在包含go.mod文件的目录下面。</strong></li>
</ol>
<p><strong>设置：</strong>GO111MODULE=on（1.11之后版本支持包管理）</p>
<div class="highlight"><pre><span></span><code>go<span class="w"> </span>env<span class="w"> </span>-w<span class="w"> </span><span class="nv">GO111MODULE</span><span class="o">=</span>on
</code></pre></div>
<p>国内代理设置：</p>
<div class="highlight"><pre><span></span><code>go<span class="w"> </span>env<span class="w"> </span>-w<span class="w"> </span><span class="nv">GOPROXY</span><span class="o">=</span>https://goproxy.cn,direct
</code></pre></div>
<p>linux：</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;export GO111MODULE=on&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.profile
<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;export GOPROXY=https://goproxy.cn&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.profile
<span class="nb">source</span><span class="w"> </span>~/.profile
</code></pre></div>
<p>----------理解go语言中包管理方式----------</p>
<p>main包（package main）：默认项目根目录中，且必须写一个main函数（程序入口），编译时，会生成对应的可执行文件。</p>
<h3 id="2-go">2 Go语言常用命令<a class="headerlink" href="#2-go" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>go<span class="w"> </span>mod<span class="w"> </span>tidy<span class="w"> </span><span class="c1"># 整理和优化项目的 go.mod 和 go.sum 文件（自动下载及删除依赖）</span>
go<span class="w"> </span>mod<span class="w"> </span>download<span class="w"> </span><span class="c1"># 下载依赖包</span>
go<span class="w"> </span>mod<span class="w"> </span>edit<span class="w"> </span><span class="c1"># 编辑go.mod文件</span>
go<span class="w"> </span>mod<span class="w"> </span>graph
go<span class="w"> </span>mod<span class="w"> </span>init<span class="w"> </span><span class="c1"># 在当前目录初始化mod</span>
go<span class="w"> </span>mod<span class="w"> </span>vendor<span class="w"> </span><span class="c1"># 将依赖复制到vendor下</span>
go<span class="w"> </span>mod<span class="w"> </span>verify<span class="w"> </span><span class="c1"># 验证依赖是否正确</span>
go<span class="w"> </span>mod<span class="w"> </span>why<span class="w"> </span><span class="c1"># 解释为什么需要依赖</span>

go<span class="w"> </span>get<span class="w"> </span>包<span class="w"> </span><span class="c1"># 下载依赖</span>
go<span class="w"> </span>get<span class="w"> </span>-u<span class="w"> </span>包<span class="w"> </span><span class="c1"># -u：更新或下载最新版本</span>
go<span class="w"> </span>get<span class="w"> </span>-u<span class="w"> </span>&lt;<span class="o">[</span>包<span class="o">]</span>@<span class="o">[</span>版本号<span class="o">]</span>&gt;<span class="w">  </span><span class="c1"># 下载指定版本</span>
</code></pre></div>
<h2 id="_3">📚 变量<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="1_1">1 变量声明<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;chc&quot;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;chc&quot;</span>
<span class="nx">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;chc&quot;</span><span class="w">  </span><span class="c1">// 推荐</span>
</code></pre></div>
<h3 id="2">2 变量赋值<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">name1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;tom&quot;</span>
<span class="nx">name2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">name1</span><span class="w">  </span><span class="c1">// 重新开辟一块内存空间存放 - 与都指向同一块内存地址的python不同</span>
</code></pre></div>
<p>对应内存图如下：</p>
<h2 id="_4">📚 常量<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="1_2">1 常量声明<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">NAME</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;chc&quot;</span>
<span class="w">    </span><span class="nx">AGE</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="mi">18</span>
<span class="w">    </span><span class="nx">GENDER</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;男&quot;</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="2_1">2 常量建议<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>公共常量</strong>：首字母大写驼峰式（如 <code>Name</code>）。</li>
<li><strong>私有常量</strong>：全小写或小驼峰（如 <code>defaultName</code>）。</li>
<li><strong>全大写</strong>：仅在需要强调常量属性（类似其他语言的 <code>CONST</code>）时使用，但非必须。</li>
</ul>
<h2 id="_5">📚 流程控制语句<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>在Go语言中，switch语句可以用来判断范围值，这与其他一些语言的switch语句有所不同。以下是几种使用switch判断范围值的方法：</p>
<h3 id="1-switch">1. 使用表达式switch判断范围<a class="headerlink" href="#1-switch" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">score</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">85</span>

<span class="k">switch</span><span class="w"> </span><span class="p">{</span>
<span class="k">case</span><span class="w"> </span><span class="nx">score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">90</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;优秀&quot;</span><span class="p">)</span>
<span class="k">case</span><span class="w"> </span><span class="nx">score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">80</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;良好&quot;</span><span class="p">)</span>
<span class="k">case</span><span class="w"> </span><span class="nx">score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">60</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;及格&quot;</span><span class="p">)</span>
<span class="k">default</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;不及格&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2-fallthrough">2. 使用fallthrough实现范围穿透<a class="headerlink" href="#2-fallthrough" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">temperature</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">25</span>

<span class="k">switch</span><span class="w"> </span><span class="p">{</span>
<span class="k">case</span><span class="w"> </span><span class="nx">temperature</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;冰冻&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">fallthrough</span>
<span class="k">case</span><span class="w"> </span><span class="nx">temperature</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;寒冷&quot;</span><span class="p">)</span>
<span class="k">case</span><span class="w"> </span><span class="nx">temperature</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;凉爽&quot;</span><span class="p">)</span>
<span class="k">case</span><span class="w"> </span><span class="nx">temperature</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">30</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;温暖&quot;</span><span class="p">)</span>
<span class="k">default</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;炎热&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3">3. 多个条件组合判断范围<a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">age</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">25</span>

<span class="k">switch</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="p">{</span>
<span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;婴幼儿&quot;</span><span class="p">)</span>
<span class="k">case</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;幼儿&quot;</span><span class="p">)</span>
<span class="k">case</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">:</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;儿童&quot;</span><span class="p">)</span>
<span class="k">default</span><span class="p">:</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;青少年&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;成年人&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;老年人&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="4-switch">4. 类型switch结合范围判断<a class="headerlink" href="#4-switch" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">checkType</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">v</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">int</span><span class="p">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;大整数&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;小整数&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">float64</span><span class="p">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;正浮点数&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;负浮点数或零&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;未知类型&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Go语言的switch语句非常灵活，不需要像其他语言那样在每个case后加break，默认不会穿透到下一个case。</p>
<p>如果需要穿透，可以显式使用<code>fallthrough</code>关键字。</p>
<h2 id="_6">📚编码<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<h3 id="1-ascii">1 ASCII编码<a class="headerlink" href="#1-ascii" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>00000000 00000000
... ...
11111111 11111111
</code></pre></div>
<p>最大能表示字符数量：2**16 = 65536 - 1</p>
<h3 id="2-unicode">2 unicode万国码标准<a class="headerlink" href="#2-unicode" title="Permanent link">&para;</a></h3>
<p>unicode是一种设计标准，不是具体的编码实现</p>
<div class="highlight"><pre><span></span><code>00000000 00000000 00000000 00000000
... ...
11111111 11111111 11111111 11111111
</code></pre></div>
<p>最大能表示字符数量：2**32 = 4294967296 - 1</p>
<h3 id="3-utf-8">3 utf-8编码<a class="headerlink" href="#3-utf-8" title="Permanent link">&para;</a></h3>
<p>对于含有中文表示的开发者来说，最常用的编码（兼容ASCII编码）：范围决定一个汉字一般都是3个字节（24位）</p>
<div class="highlight"><pre><span></span><code>00000000 00000000 00000000
... ...
11111111 11111111 11111111
</code></pre></div>
<h2 id="_7">📚 数据类型<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<h3 id="1_3">1 整型之间转换<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h3>
<p>int 类型数据转换时，需要注意各个位数表示值范围；从范围大的向小的转换，尤其要注意：</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="kt">int16</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">128</span>
<span class="w">    </span><span class="nx">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">int8</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 结果为 -128  -&gt; 数据溢出，则会按超过的数字轮询对应，不会报错</span>
</code></pre></div>
<h3 id="2_2">2 不同类型转换<a class="headerlink" href="#2_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 整型转为字符串</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="kt">int16</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">128</span>
<span class="w">    </span><span class="nx">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nx">a</span><span class="p">))</span><span class="w"> </span><span class="c1">// 传参只能是int类型；有一个值返回</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">))</span>

<span class="w">    </span><span class="c1">// 字符串转为整型</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;100&quot;</span>
<span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Atoi</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="c1">// 有两个值返回</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;转换失败：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;转换成功：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3_1">3 字符串的本质<a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;ch昌&quot;</span>
<span class="w">    </span><span class="nx">name2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;岑鸿昌&quot;</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">name1</span><span class="p">),</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">name2</span><span class="p">))</span><span class="w">                                       </span><span class="c1">// 字节长度</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">utf8</span><span class="p">.</span><span class="nx">RuneCountInString</span><span class="p">(</span><span class="nx">name1</span><span class="p">),</span><span class="w"> </span><span class="nx">utf8</span><span class="p">.</span><span class="nx">RuneCountInString</span><span class="p">(</span><span class="nx">name2</span><span class="p">))</span><span class="w"> </span><span class="c1">// 字符长度</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">name1</span><span class="p">),</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">name2</span><span class="p">))</span>

<span class="w">    </span><span class="nx">rs1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nb">rune</span><span class="p">(</span><span class="nx">name1</span><span class="p">)</span>
<span class="w">    </span><span class="nx">rs2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nb">rune</span><span class="p">(</span><span class="nx">name2</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">rs1</span><span class="p">,</span><span class="w"> </span><span class="nx">rs2</span><span class="p">)</span><span class="w"> </span><span class="c1">// unicode码点切片（十进制）</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">ru1</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">ru2</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span>

<span class="w">    </span><span class="nx">myList1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">][]</span><span class="kt">rune</span><span class="p">{</span><span class="nx">rs1</span><span class="p">,</span><span class="w"> </span><span class="nx">rs2</span><span class="p">}</span>
<span class="w">    </span><span class="nx">myList2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">][]</span><span class="kt">string</span><span class="p">{</span><span class="nx">ru1</span><span class="p">,</span><span class="w"> </span><span class="nx">ru2</span><span class="p">}</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">myList2</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">myList1</span><span class="p">);</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">myList1</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">myList2</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">myList2</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">FormatInt</span><span class="p">(</span><span class="nb">int64</span><span class="p">(</span><span class="nx">v</span><span class="p">),</span><span class="w"> </span><span class="mi">16</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">myList2</span><span class="p">)</span><span class="w"> </span><span class="c1">// unicode码点切片（十六进制）</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="4_1">4 字符串常用方法<a class="headerlink" href="#4_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nb">len</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="c1">// 字节长度</span>
<span class="nx">utf8</span><span class="p">.</span><span class="nx">RuneCountInString</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="c1">// 字符长度</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">HasPrefix</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xxx&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 是否以xxx开头</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">HasSuffix</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xxx&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 是否以xxx结尾</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xxx&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 是否包含xxx</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">ToLower</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="c1">// 英文变小写</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">ToUpper</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="c1">// 英文变大写</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">ToTitle</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="c1">// 英文变大写 - 针对某些拉丁文字，不同于ToUpper</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Title</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="c1">// 每个空格之后的第一个字母变大写 -- Go 1.18+ 已弃用</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Trim</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xxx&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 去除两边子串xxx</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">TrimLeft</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xxx&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 去除左边子串xxx</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">TrimRight</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xxx&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 去除右边子串xxx</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xv&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;YY&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// 从左到右查找到第1个匹配替换</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xv&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;YY&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 从左到右查找到前2个匹配替换</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xv&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;YY&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// 全部匹配替换</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">ReplaceAll</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Y&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 全部匹配替换</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 分割字符串 -&gt; []string 类型的切片</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 拼接 -&gt; 将[]string 类型的切片拼接</span>

<span class="c1">// 拼接字符串go 1.10+ 版本高效率写法：</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">builder</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Builder</span>
<span class="nx">builder</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
<span class="nx">builder</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)</span>
<span class="nx">builder</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">builder</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
</code></pre></div>
<h3 id="5_1">5 字符串与对应码点数互相转换<a class="headerlink" href="#5_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="mi">65</span><span class="p">))</span><span class="w">                   </span><span class="c1">// A -&gt; 码点转字符</span>
<span class="nx">num</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">utf8</span><span class="p">.</span><span class="nx">DecodeRuneInString</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 65 1 -&gt; 字符转码点，多个字符则只处理第一个字符</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="p">)</span>
</code></pre></div>
<h2 id="_8">📚 进制转换函数<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<h3 id="1_4">1 十进制转其他进制（数字转字符串）<a class="headerlink" href="#1_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2025</span>
<span class="w">    </span><span class="nx">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">FormatInt</span><span class="p">(</span><span class="nb">int64</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">))</span><span class="w"> </span><span class="c1">// 获取数据类型为string</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2_3">2 其他进制转十进制（字符串转数字）<a class="headerlink" href="#2_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// strconv.ParseInt函数参数解释：</span>
<span class="w">    </span><span class="c1">// 第1个参数：需要转换的字符</span>
<span class="w">    </span><span class="c1">// 第2个参数：把文本按填写对应进制去转换</span>
<span class="w">    </span><span class="c1">// 第3个参数：限定转换时使用的数字范围(与结果无关)</span>
<span class="w">    </span><span class="c1">// 注意：返回结果永远是int64类型的数字</span>
<span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;1010000101&quot;</span>
<span class="w">    </span><span class="nx">jz</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">ParseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">jz</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;转换失败：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">))</span><span class="w"> </span><span class="c1">// 获取数据类型为int64</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;转换成功：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">b</span><span class="p">))</span><span class="w"> </span><span class="c1">// 获取数据类型为int64</span>

<span class="w">        </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">FormatInt</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="c1">// 十进制转为其他进制，获取数据类型为string</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_9">📚 数组(长度固定)<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<h3 id="1_5">1 基本原理<a class="headerlink" href="#1_5" title="Permanent link">&para;</a></h3>
<p><img alt="image-20240803142127637" src="image-20240803142127637.png" /></p>
<p><strong>注意事项：</strong>数组是值类型，所以针对传入一个数组到函数内修改，当函数执行之后，并不会影响函数外的数组值，相当于在各自的栈内有效。</p>
<p><img alt="image-20240803161751451" src="image-20240803161751451.png" /></p>
<h3 id="2_4">2 数组可变与拷贝<a class="headerlink" href="#2_4" title="Permanent link">&para;</a></h3>
<p>可变：数组长度、类型不能修改，元素可以修改；</p>
<p>拷贝：数组变量在赋值时会重新拷贝</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;岑鸿昌&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cenhongchang&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">name2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">name1</span>
<span class="w">    </span><span class="nx">name2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;chc&quot;</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">name1</span><span class="p">,</span><span class="w"> </span><span class="nx">name2</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// 执行结果：[岑鸿昌 cenhongchang] [chc cenhongchang]</span>
<span class="w">    </span><span class="c1">// 结果表明：1.数组元素可以被修改；2.数组变量赋值时，会重新拷贝一份（这与python不同）</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_10">📚 切片(长度可变)<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<h3 id="1_6">1 切片概念<a class="headerlink" href="#1_6" title="Permanent link">&para;</a></h3>
<p>切片(slice)是 Golang 中一种比较特殊的数据结构，这种数据结构更便于使用和管理数据集合。</p>
<p>切片是围绕动态数组的概念构建的，可以按需自动增长和缩小。</p>
<p>切片的动态增长是通过内置函数 append() 来实现的，这个函数可以快速且高效地增长切片，也可以通过对切片再次切割，缩小一个切片的大小。因为切片的底层也是在连续的内存块中分配的，所以切片还能获得索引、迭代以及为垃圾回收优化的好处。</p>
<p><img alt="image-20240803202443993" src="image-20240803202443993.png" /></p>
<h3 id="2_5">2 切片创建<a class="headerlink" href="#2_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">方式一</span><span class="err">：；</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">numbers</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">numbers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">}</span>
<span class="nx">numbers</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">}</span>

<span class="nx">方式二</span><span class="err">：</span><span class="nb">make</span><span class="p">(</span><span class="kd">type</span><span class="p">,</span><span class="w"> </span><span class="nx">len</span><span class="p">,</span><span class="w"> </span><span class="nx">cap</span><span class="p">)</span><span class="w">  </span><span class="c1">//类型、长度、容量</span>
<span class="nx">numbers</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>

<span class="nx">两种方式创建的区别</span><span class="err">：</span>
<span class="nx">方式一创建的切片事先存在</span><span class="err">，</span><span class="nx">程序员可见</span><span class="err">；</span>
<span class="nx">方式二创建的切片会创建新的数组</span><span class="err">，</span><span class="nx">是由切片自身在底层维护</span><span class="err">，</span><span class="nx">程序员不可见</span><span class="err">。</span>

<span class="nx">易混淆点</span><span class="err">：</span>
<span class="nx">slicePointer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">([]</span><span class="kt">int</span><span class="p">)</span><span class="w">  </span><span class="c1">// new就是用来创建指针类型变量的，会自动初始化；slicePointer指向长度为0、容量为0的切片</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">slicePointer</span><span class="w"> </span><span class="o">*</span><span class="p">[]</span><span class="kt">int</span><span class="w">  </span><span class="c1">// slicePointer为nil，类型又是指针类型，所以也称空指针；空指针无法解引用获取值，会报错</span>
</code></pre></div>
<h3 id="3_2">3 切片与数组区别<a class="headerlink" href="#3_2" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th style="text-align: left;">特性</th>
<th style="text-align: left;">数组（Array）</th>
<th style="text-align: left;">切片（Slice）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>长度</strong></td>
<td style="text-align: left;">固定</td>
<td style="text-align: left;">动态可变</td>
</tr>
<tr>
<td style="text-align: left;"><strong>类型</strong></td>
<td style="text-align: left;">值类型（复制整个数据）</td>
<td style="text-align: left;">引用类型（共享底层数组）</td>
</tr>
<tr>
<td style="text-align: left;"><strong>内存分配</strong></td>
<td style="text-align: left;">通常在栈上</td>
<td style="text-align: left;">通常在堆上</td>
</tr>
<tr>
<td style="text-align: left;"><strong>声明长度</strong></td>
<td style="text-align: left;">必须显式或通过<code>[...]</code>推断</td>
<td style="text-align: left;">可动态扩展</td>
</tr>
<tr>
<td style="text-align: left;"><strong>性能</strong></td>
<td style="text-align: left;">无GC压力，但复制成本高</td>
<td style="text-align: left;">有GC压力，但操作灵活</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>数组</strong>：</li>
<li>需要固定大小且对内存敏感的场景（如加密算法中的块处理）。</li>
<li>明确知道元素数量且无需修改长度时（如月份名称）。</li>
<li><strong>切片</strong>：</li>
<li>绝大多数场景（动态数据集合、函数传参等）。</li>
<li>需要动态增删元素时（如读取文件、HTTP请求体）。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// 数组（值传递）</span>
<span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<span class="nx">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">a</span><span class="w">         </span><span class="c1">// 复制整个数组</span>
<span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="w">     </span><span class="c1">// 修改b不会影响a</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// [1 2 3]</span>

<span class="c1">// 切片（引用传递）</span>
<span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="w">         </span><span class="c1">// 共享底层数组</span>
<span class="nx">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="w">     </span><span class="c1">// 修改y会影响x</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="c1">// [100 2 3]</span>
</code></pre></div>
<h3 id="4_2">4 切片自动扩容<a class="headerlink" href="#4_2" title="Permanent link">&para;</a></h3>
<p>在 Go 语言的最新版本（如 Go 1.19 及以上），切片的自动扩容规则相较于旧版本（如 Go 1.17 及之前）有所调整，采用了更平滑的增长策略，而非简单的“小于 1024 时 2 倍扩容，大于等于 1024 时 1.25 倍扩容”的固定规则。以下是详细的扩容机制：</p>
<ul>
<li><strong>容量较小（&lt; 256）时</strong>：仍然采用 <strong>2 倍扩容</strong>，以减少频繁扩容带来的性能损耗18。</li>
<li><strong>容量较大（≥ 256）时</strong>：扩容因子会逐步降低，从 2.0 逐渐过渡到 1.25 倍左右，以减少内存浪费110。</li>
</ul>
<h4 id="41">4.1 具体扩容因子变化<a class="headerlink" href="#41" title="Permanent link">&para;</a></h4>
<p>不同初始容量下的扩容因子如下表所示：</p>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>初始容量（Starting Cap）</strong></th>
<th style="text-align: left;"><strong>扩容因子（Growth Factor）</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">256</td>
<td style="text-align: left;">2.0</td>
</tr>
<tr>
<td style="text-align: left;">512</td>
<td style="text-align: left;">1.63</td>
</tr>
<tr>
<td style="text-align: left;">1024</td>
<td style="text-align: left;">1.44</td>
</tr>
<tr>
<td style="text-align: left;">2048</td>
<td style="text-align: left;">1.35</td>
</tr>
<tr>
<td style="text-align: left;">4096</td>
<td style="text-align: left;">1.30</td>
</tr>
</tbody>
</table>
<p>这个变化使得扩容策略更加平滑，避免了大容量切片时内存的过度增长。</p>
<h4 id="42">4.2 特殊情况<a class="headerlink" href="#42" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>追加元素超出当前容量 2 倍</strong>：如果 <code>append</code> 操作后的新长度超过当前容量的 2 倍，则直接按新长度分配容量，而不是按增长因子计算46。</li>
<li><strong>内存对齐优化</strong>：Go 在计算新容量时还会考虑内存对齐，最终分配的容量可能会比计算值稍大，以减少内存碎片</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 容量足够，不扩容</span>
<span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">    </span><span class="c1">// 容量不足，扩容至 4（2 → 4）</span>
<span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="c1">// 容量不足，扩容至 8（4 → 8）</span>
</code></pre></div>
<h4 id="43">4.3 最佳实践<a class="headerlink" href="#43" title="Permanent link">&para;</a></h4>
<p>情景1：没有触发自动扩容，切片变量共享底层数组</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">v1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="c1">// [0]</span>
<span class="w">    </span><span class="nx">v2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="mi">99</span><span class="p">)</span><span class="w">    </span><span class="c1">// [0 99]</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">v2</span><span class="p">)</span><span class="w">     </span><span class="c1">// [0] [0 99]</span>
<span class="w">    </span><span class="nx">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">v2</span><span class="p">)</span><span class="w"> </span><span class="c1">// [-1] [-1 99]</span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p>情景2：触发自动扩容，新的切片会新对应一个新的底层数组</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">v1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">      </span><span class="c1">// [0]</span>
<span class="w">    </span><span class="nx">v2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="mi">88</span><span class="p">,</span><span class="w"> </span><span class="mi">77</span><span class="p">)</span><span class="w"> </span><span class="c1">// [0 99 88 77] -&gt; 添加元素已经超过容量，会自动扩容</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">v2</span><span class="p">)</span><span class="w">          </span><span class="c1">// [0] [0 99 88 77]</span>
<span class="w">    </span><span class="nx">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">v2</span><span class="p">)</span><span class="w"> </span><span class="c1">// [-1] [0 99 88 77]</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>预分配容量</strong>：如果已知切片最终大小，建议使用 <code>make([]T, 0, cap)</code> 预分配足够容量，避免频繁扩容</li>
<li><strong>避免共享底层数组</strong>：扩容后新切片可能指向新内存，而旧切片仍指向原数组，需注意数据一致性</li>
</ul>
<h3 id="5_2">5 切片相关操作<a class="headerlink" href="#5_2" title="Permanent link">&para;</a></h3>
<h4 id="51">5.1 基本操作<a class="headerlink" href="#51" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">val</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kt">int</span><span class="p">[],</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span><span class="w"> </span><span class="c1">// 长度</span>
<span class="nb">cap</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span><span class="w"> </span><span class="c1">// 容量</span>

<span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="c1">// 索引取值；索引最大值：len(val) - 1</span>

<span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="w">  </span><span class="c1">// 切片继续切片，获取第2个-第3个元素（取前不取后）</span>
<span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="nx">val</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="w">  </span><span class="c1">// 注意：切片通过再切片后得到的数据对应内存地址与原切片的对应，所以新切片或原切片修改某个元素值，都会互相影响被修改</span>
</code></pre></div>
<h4 id="52">5.2 追加元素<a class="headerlink" href="#52" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">v1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">}</span>
<span class="nx">vx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">88</span><span class="p">,</span><span class="w"> </span><span class="mi">99</span><span class="p">}</span>

<span class="nx">v2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">66</span><span class="p">)</span>
<span class="nx">v3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">vx</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>
<h4 id="52_1">5.2 “ 删除”元素<a class="headerlink" href="#52_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// go语言删除元素使用链表，这里用截取拼接方式（一般用的少）</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">v1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v1</span><span class="p">)</span>

<span class="w">    </span><span class="nx">deleteIndex</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nx">v2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">v1</span><span class="p">[:</span><span class="nx">deleteIndex</span><span class="p">],</span><span class="w"> </span><span class="nx">v1</span><span class="p">[</span><span class="nx">deleteIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v2</span><span class="p">)</span><span class="w"> </span><span class="c1">// [1 2 4 5 6]</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v1</span><span class="p">)</span><span class="w"> </span><span class="c1">// [1 2 4 5 6 6]</span>
<span class="p">}</span>
<span class="c1">// 这种方式注意：原切片v1会被修改</span>
</code></pre></div>
<h4 id="53">5.3 插入元素<a class="headerlink" href="#53" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">v1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">66</span><span class="p">}</span>
<span class="w">    </span><span class="nx">insertIndex</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="c1">// 在索引3的位置插入99</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">v1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">v1</span><span class="p">[:</span><span class="nx">insertIndex</span><span class="p">]</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="mi">99</span><span class="p">)</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">v1</span><span class="p">[</span><span class="nx">insertIndex</span><span class="p">:]</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// 效率低下 - 不推荐；不要直接用v1取切片去追加，那样也会导致元素覆盖问题</span>
</code></pre></div>
<h2 id="-map">📚 哈希表-map<a class="headerlink" href="#-map" title="Permanent link">&para;</a></h2>
<h3 id="1_7">1 基本介绍<a class="headerlink" href="#1_7" title="Permanent link">&para;</a></h3>
<p>map 是一种无序的集合类型，它将唯一键(key)映射到值(value)：</p>
<ul>
<li><strong>键(key)</strong>：必须是可比较是否相等的类型</li>
<li>
<p>可比较类型归类名称：booleans、numbers、strings、pointers、元素类型为可比较的channel和arrays、全部字段为可比较的structs</p>
</li>
<li>
<p>具体类型：<code>int</code>, <code>string</code>，<code>bool</code>, <code>float</code>, <code>array</code>, 指针等，但不能是 <code>slice</code>, <code>map</code>, <code>function</code>）</p>
</li>
<li>
<p><strong>值(value)</strong>：可以是任意类型</p>
</li>
<li>
<p><strong>无序性</strong>：元素存储和遍历顺序不固定</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// 声明</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="nx">keyType</span><span class="p">]</span><span class="nx">valueType</span>

<span class="c1">// 初始化</span>
<span class="nx">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="nx">keyType</span><span class="p">]</span><span class="nx">valueType</span><span class="p">)</span>

<span class="c1">// 声明并初始化简写</span>
<span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
<span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span>
</code></pre></div>
<h4 id="11">1.1 重要特性<a class="headerlink" href="#11" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>引用类型</strong>：map是引用类型，传递map不会拷贝底层数据</li>
<li><strong>动态增长</strong>：map会自动扩容，无需手动管理容量</li>
<li><strong>非线程安全</strong>：并发读写需要加锁（或使用 <code>sync.Map</code>）</li>
<li><strong>零值</strong>：未初始化的map零值是 <code>nil</code>，不能直接使用</li>
</ol>
<h4 id="12">1.2 性能特点<a class="headerlink" href="#12" title="Permanent link">&para;</a></h4>
<ol>
<li>平均时间复杂度：</li>
<li>插入：O(1)</li>
<li>查找：O(1)</li>
<li>删除：O(1)</li>
<li>内存开销比slice大</li>
<li>不适合小数据量（少量元素时slice+线性搜索可能更快）</li>
</ol>
<h4 id="13">1.3 使用场景<a class="headerlink" href="#13" title="Permanent link">&para;</a></h4>
<ul>
<li>快速查找表</li>
<li>去重操作</li>
<li>缓存实现</li>
<li>对象属性存储</li>
</ul>
<h4 id="14">1.4 遍历特性<a class="headerlink" href="#14" title="Permanent link">&para;</a></h4>
<p>Go 语言中，<strong>在 <code>range</code> 遍历 map 时直接删除当前正在遍历的元素</strong>是安全的</p>
<p>经典面试题：counter的值是多少？</p>
<p>答案：2或者3 （map是无序的，range遍历是遍历快照，修改原map不影响正在遍历的快照，但是原map会改变）</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;A&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;B&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;C&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">counter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">counter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">delete</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">counter</span><span class="o">++</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;counter is &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">counter</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Go 的 <code>range</code> 遍历 map 实现方式：</p>
<ol>
<li>内部会先对 map 的状态做一个快照</li>
<li>遍历是基于这个快照进行的</li>
<li>修改（包括删除）操作会影响原始 map，但不会影响正在进行的遍历</li>
</ol>
<h3 id="2_6">2 声明 &amp; 初始化<a class="headerlink" href="#2_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">userInfo</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{}</span>
<span class="nx">userInfo</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="nx">cenhongchang</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">}</span>

<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">])</span><span class="w">  </span><span class="c1">// 打印name的值</span>
<span class="nx">userInfo</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;chc&quot;</span><span class="w">  </span><span class="c1">// 修改name的值</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nx">userInfo</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
<span class="nx">userInfo</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span><span class="err">，</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w">  </span><span class="c1">// 指定长度</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span>
<span class="c1">// row[&quot;name&quot;] = &quot;chc&quot; -&gt; 会报错，一般只用于整体赋值情况</span>

<span class="nx">pointer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="c1">// 指针变量，也是用于整体赋值，相当于声明这是一个map的指针变量</span>
</code></pre></div>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">userInfo</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">userInfo</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;chc&quot;</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">)</span>

<span class="w">    </span><span class="nx">pointer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<span class="w">    </span><span class="nx">pointer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userInfo</span>

<span class="w">    </span><span class="nx">newData</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">*</span><span class="nx">pointer</span>
<span class="w">    </span><span class="nx">newData</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;18&quot;</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">)</span><span class="w">  </span><span class="c1">// 这时候都指向同一地址</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">newData</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3_3">3 长度、容量及操作<a class="headerlink" href="#3_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">userInfo</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="c1">// 容量不是长度，也没有像切片求容量的cap函数 -- 切记</span>
<span class="w">    </span><span class="nx">userInfo</span><span class="p">[</span><span class="s">&quot;姓名&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;cenhongchang&quot;</span>
<span class="w">    </span><span class="nx">userInfo</span><span class="p">[</span><span class="s">&quot;年龄&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;18&quot;</span>
<span class="w">    </span><span class="nx">userInfo</span><span class="p">[</span><span class="s">&quot;身高&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;172&quot;</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">))</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">)</span>
<span class="w">    </span><span class="nx">userInfo</span><span class="p">[</span><span class="s">&quot;体重&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;135&quot;</span><span class="w"> </span><span class="c1">// 增加</span>
<span class="w">    </span><span class="nb">delete</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;体重&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 删除</span>
<span class="w">    </span><span class="nx">userInfo</span><span class="p">[</span><span class="s">&quot;身高&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;180&quot;</span><span class="w"> </span><span class="c1">// 修改</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">[</span><span class="s">&quot;姓名&quot;</span><span class="p">])</span><span class="w"> </span><span class="c1">// 查看</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="4-key">4 嵌套key<a class="headerlink" href="#4-key" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="w"> </span><span class="p">]</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="c1">// 数组</span>
<span class="c1">// make(map[ []int ]string) // 切片 key -&gt; 报错不可哈希</span>
<span class="c1">// make(map[ map[int]string ]string)  // map key -&gt; 报错不可哈希</span>
</code></pre></div>
<h3 id="5_3">5 底层存储原理<a class="headerlink" href="#5_3" title="Permanent link">&para;</a></h3>
<p>创建map -&gt; hmap -&gt; 桶 -&gt; bmap</p>
<p>创建 -&gt; <code>make(map[string]string, 10)</code></p>
<p>hmap -&gt; 根据算法规则自动计算出合适的B值</p>
<p>桶的数量 -&gt; 2ᴮ（2的B次方个）</p>
<p>bmap -&gt; 每个桶正常最多存储8个键值对；当然可以使用指针扩展溢出桶</p>
<h4 id="51_1">5.1 初始化<a class="headerlink" href="#51_1" title="Permanent link">&para;</a></h4>
<h4 id="52_2">5.2 写入数据<a class="headerlink" href="#52_2" title="Permanent link">&para;</a></h4>
<h4 id="53_1">5.3 读取数据<a class="headerlink" href="#53_1" title="Permanent link">&para;</a></h4>
<h4 id="54">5.4 扩容<a class="headerlink" href="#54" title="Permanent link">&para;</a></h4>
<h4 id="55">5.5 迁移<a class="headerlink" href="#55" title="Permanent link">&para;</a></h4>
<h2 id="newmake">📚 指针与new以及make<a class="headerlink" href="#newmake" title="Permanent link">&para;</a></h2>
<p>Go 语言中，<strong>指针</strong>是一种存储<strong>变量内存地址</strong>的特殊变量。它<strong>允许你直接访问和修改内存中的数据，而不是操作数据的副本</strong>。这是高效操作大型数据结构和实现某些高级特性的关键机制。</p>
<h3 id="1_8">1 内存地址与值<a class="headerlink" href="#1_8" title="Permanent link">&para;</a></h3>
<ul>
<li>每个变量都存储在内存的某个位置（地址）。</li>
<li>指针保存的是这个地址，而不是值本身。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">42</span><span class="w">  </span><span class="c1">// 声明一个整型变量 a</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">a</span><span class="w"> </span><span class="c1">// p 是指向 a 的指针（保存 a 的内存地址）</span>
</code></pre></div>
<h3 id="2_7">2 操作符<a class="headerlink" href="#2_7" title="Permanent link">&para;</a></h3>
<ul>
<li><code>&amp;</code>（取地址符）：获取变量的内存地址</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出：0xc00000a0c8（示例地址）</span>
</code></pre></div>
<ul>
<li><code>*</code>（解引用符）：通过指针访问或修改该地址的值</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出：42（读取 p 指向的值）</span>
<span class="o">*</span><span class="nx">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="w">       </span><span class="c1">// 通过 p 修改 a 的值</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w">  </span><span class="c1">// 输出：100</span>
</code></pre></div>
<h3 id="3_4">3 指针的典型用途<a class="headerlink" href="#3_4" title="Permanent link">&para;</a></h3>
<h4 id="31">3.1 避免大数据的拷贝<a class="headerlink" href="#31" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">BigStruct</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">[</span><span class="mi">10000</span><span class="p">]</span><span class="kt">int</span><span class="w"> </span><span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">ModifyByValue</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="nx">BigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* 操作副本，效率低 */</span><span class="w"> </span><span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">ModifyByPointer</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">BigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* 直接操作原数据 */</span><span class="w"> </span><span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">big</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">BigStruct</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">ModifyByPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">big</span><span class="p">)</span><span class="w"> </span><span class="c1">// 只传递指针（8字节），避免拷贝整个结构体</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="32">3.2 修改函数外部的变量<a class="headerlink" href="#32" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">ResetToZero</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">*</span><span class="nx">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="c1">// 修改外部变量</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">99</span>
<span class="w">    </span><span class="nx">ResetToZero</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">x</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出：0</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="33">3.3  实现引用语义（如修改结构体字段）<a class="headerlink" href="#33" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="p">{</span><span class="w"> </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">Rename</span><span class="p">(</span><span class="nx">newName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">u</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">newName</span><span class="w"> </span><span class="c1">// 修改原结构体</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span><span class="s">&quot;Alice&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">user</span><span class="p">.</span><span class="nx">Rename</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Go 自动转换为指针调用</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出：&quot;Bob&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="4_3">4 指针的注意事项<a class="headerlink" href="#4_3" title="Permanent link">&para;</a></h3>
<h4 id="41-nil-new">4.1 空指针（<code>nil</code>）与 new关键字<a class="headerlink" href="#41-nil-new" title="Permanent link">&para;</a></h4>
<ul>
<li>未初始化的指针值为 <code>nil</code>，解引用会引发 panic：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">//无初始化的指针</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// panic: runtime error: invalid memory address</span>
</code></pre></div>
<ul>
<li>有初始化的指针</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">//有初始化的指针</span>
<span class="nx">tpointerb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;tpointerb:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tpointerb</span><span class="p">)</span>
<span class="o">*</span><span class="nx">tpointerb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10000000</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;tpointerb:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tpointerb</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>使用前务必检查：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">*</span><span class="nx">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">42</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="42_1">4.2 不要对栈上逃逸的指针过度优化<a class="headerlink" href="#42_1" title="Permanent link">&para;</a></h4>
<ul>
<li>Go 编译器会自动决定变量分配在栈还是堆上，无需手动管理内存。</li>
</ul>
<h4 id="43_1">4.3 指针与并发安全<a class="headerlink" href="#43_1" title="Permanent link">&para;</a></h4>
<ul>
<li>多个 goroutine 同时通过指针修改同一数据时，需用 <code>sync.Mutex</code> 等机制保护。</li>
</ul>
<h3 id="5-make">5 make函数<a class="headerlink" href="#5-make" title="Permanent link">&para;</a></h3>
<p><strong>make也是用于内存分配的，区别于new，它只用于slice、map以及chan的内存创建，而且它返回的类型就是这三个类型本身，而不是他们的指针类型，因为这三种类型就是引用类型，所以就没有必要返回他们的指针了。</strong>make函数的函数签名如下:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="nx">Type</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="o">...</span><span class="nx">IntegerType</span><span class="p">)</span><span class="w"> </span><span class="nx">Type</span>
</code></pre></div>
<p><strong>make函数是无可替代的</strong>，我们在使用slice、map以及channel的时候,都需要使用make进行初始化，然后才可以对它们进行操作。</p>
<p>总之：在 Go 语言中，<code>make</code> 是一个内置函数，专门用于<strong>初始化并分配内存</strong>给三种引用类型：<strong>切片（slice）</strong>、<strong>映射（map）</strong> 和<strong>通道（channel）</strong>。</p>
<p>它的核心作用是创建这些复杂类型的实例，并设置好底层数据结构和初始属性。</p>
<h4 id="51_2">5.1 核心作用总结：<a class="headerlink" href="#51_2" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>分配内存</strong>：为底层数据结构分配内存空间</li>
<li><strong>初始化数据结构</strong>：设置内部属性（如长度、容量、缓冲区等）</li>
<li><strong>返回可直接使用的实例</strong>：返回初始化后的引用类型（非指针）</li>
</ol>
<h4 id="52-make-new">5.2 为什么需要 <code>make</code>？（与 <code>new</code> 的对比）<a class="headerlink" href="#52-make-new" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th style="text-align: left;">特性</th>
<th style="text-align: left;"><code>make</code></th>
<th style="text-align: left;"><code>new</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>适用类型</strong></td>
<td style="text-align: left;">slice, map, channel</td>
<td style="text-align: left;">任意类型</td>
</tr>
<tr>
<td style="text-align: left;"><strong>返回值</strong></td>
<td style="text-align: left;">初始化后的<strong>引用类型</strong></td>
<td style="text-align: left;">指向零值内存的<strong>指针</strong> (<code>*T</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>初始化程度</strong></td>
<td style="text-align: left;">完全初始化，可直接使用</td>
<td style="text-align: left;">仅分配零值内存，未初始化数据结构</td>
</tr>
<tr>
<td style="text-align: left;"><strong>内存分配</strong></td>
<td style="text-align: left;">分配+初始化数据结构</td>
<td style="text-align: left;">仅分配内存</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="c1">// 错误示例：用 new 创建切片</span>
<span class="nx">sp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">([]</span><span class="kt">int</span><span class="p">)</span><span class="w">   </span><span class="c1">// 返回 *[]int 指针</span>
<span class="o">*</span><span class="nx">sp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="o">*</span><span class="nx">sp</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// 需要额外操作才能使用</span>

<span class="c1">// 正确示例：用 make 创建切片</span>
<span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="c1">// 直接可用的切片</span>
<span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">        </span><span class="c1">// 直接操作</span>
</code></pre></div>
<h3 id="6_1">6 何时使用指针？<a class="headerlink" href="#6_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>场景</strong></th>
<th style="text-align: left;"><strong>推荐方式</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">需要修改函数外部变量</td>
<td style="text-align: left;">指针</td>
</tr>
<tr>
<td style="text-align: left;">操作大型结构体/数组</td>
<td style="text-align: left;">指针（避免拷贝）</td>
</tr>
<tr>
<td style="text-align: left;">方法需修改接收者</td>
<td style="text-align: left;">指针接收者</td>
</tr>
<tr>
<td style="text-align: left;">基本类型（int等）小数据</td>
<td style="text-align: left;">值传递</td>
</tr>
</tbody>
</table>
<p>Go 中切片（slice）、映射（map）、通道（channel）本身是引用类型，传递时无需显式使用指针。</p>
<h3 id="7">7 指针两个高级操作<a class="headerlink" href="#7" title="Permanent link">&para;</a></h3>
<h4 id="71">7.1 数组地址<a class="headerlink" href="#71" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>

<span class="w">    </span><span class="nx">p1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">arr</span>
<span class="w">    </span><span class="nx">p2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">p1</span><span class="p">),</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">p2</span><span class="p">))</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">&amp;[1 2 3] 0xc000012108</span>
<span class="cm">*[3]int *int</span>
<span class="cm">*/</span>
</code></pre></div>
<h4 id="72">7.2 指针加减<a class="headerlink" href="#72" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">dataList</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">}</span>
<span class="w">    </span><span class="nx">p1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">dataList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="w">    </span><span class="nx">p2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">dataList</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="nx">p3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">dataList</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">,</span><span class="w"> </span><span class="nx">p3</span><span class="p">)</span>

<span class="w">    </span><span class="nx">ptr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">dataList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w">  </span><span class="c1">// 指针 -&gt; unsafe.Pointer</span>
<span class="w">    </span><span class="nx">targetAddr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uintptr</span><span class="p">(</span><span class="nx">ptr</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="o">*</span><span class="mi">1</span><span class="w">       </span><span class="c1">// 继续 unsafe.Pointer -&gt; uintptr + 偏移量（对应类型所需字节数/int64每个元素相差8个字节）</span>
<span class="w">    </span><span class="nx">newPtr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">targetAddr</span><span class="p">)</span><span class="w"> </span><span class="c1">// uintptr -&gt; unsafe.Pointer （逆回）</span>
<span class="w">    </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="kt">int</span><span class="p">)(</span><span class="nx">newPtr</span><span class="p">)</span><span class="w">              </span><span class="c1">// unsafe.Pointer -&gt; 指针（逆回）</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">value</span><span class="p">)</span><span class="w">           </span><span class="c1">// 打印指针地址、对应的值</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">0xc000012108 0xc000012110 0xc000012118</span>
<span class="cm">0xc000012110 22</span>
<span class="cm">*/</span>
</code></pre></div>
<h2 id="_11">📚 函数<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<p>Go语言中的函数是基本的代码块，用于执行特定任务。以下是Go函数的主要特性：</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">函数名</span><span class="p">(</span><span class="nx">参数列表</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">返回值列表</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 函数体</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// 无参数无返回值</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">sayHello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 有参数无返回值</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">greet</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Hello, %s!\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 有参数有返回值</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>

<span class="c1">// 多返回值</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">swap</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span>
<span class="p">}</span>

<span class="c1">// 命名返回值</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">divide</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="kt">float64</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;division by zero&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="1_9">1 一等公民：函数可以作为值传递、作为参数和返回值<a class="headerlink" href="#1_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">apply</span><span class="p">(</span><span class="nx">op</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">op</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2_8">2 匿名函数（闭包）<a class="headerlink" href="#2_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nx">add</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3_5">3 可变参数<a class="headerlink" href="#3_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">sum</span><span class="p">(</span><span class="nx">nums</span><span class="w"> </span><span class="o">...</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nx">total</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">nums</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="nx">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">num</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="nx">total</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="4-defer">4 延迟执行（defer）<a class="headerlink" href="#4-defer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">readFile</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;file.txt&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="k">return</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="c1">// 确保函数返回前关闭文件</span>
<span class="w">   </span><span class="c1">// 处理文件</span>
<span class="w">   </span><span class="c1">// ... ...</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="5_4">5 方法（与类型关联的函数）<a class="headerlink" href="#5_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Circle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nx">Radius</span><span class="w"> </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">Circle</span><span class="p">)</span><span class="w"> </span><span class="nx">Area</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Radius</span>
<span class="p">}</span>
</code></pre></div>
<p>Go语言的函数设计简洁而强大，支持多种编程范式，是构建Go程序的基础模块。</p>
<h3 id="6_2">6 重点谈闭包<a class="headerlink" href="#6_2" title="Permanent link">&para;</a></h3>
<p>闭包(closure)是指一个函数值引用了其函数体之外的变量。</p>
<p>示例：<strong>该示例在早期go版本，切片元素每个函数打印结果都会是5（循环已执行完毕，此时：i=5），但最新版本已修复，结果如下</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">funcList</span><span class="w"> </span><span class="p">[]</span><span class="kd">func</span><span class="p">()</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">f</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">funcList</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">funcList</span><span class="p">,</span><span class="w"> </span><span class="nx">f</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">funcList</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">f</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 0</span>
<span class="c1">// 1</span>
<span class="c1">// 2</span>
<span class="c1">// 3</span>
<span class="c1">// 4</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">funcList</span><span class="w"> </span><span class="p">[]</span><span class="kd">func</span><span class="p">()</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">f</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">arg</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">        </span><span class="nx">funcList</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">funcList</span><span class="p">,</span><span class="w"> </span><span class="nx">f</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">funcList</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">f</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 0</span>
<span class="c1">// 1</span>
<span class="c1">// 2</span>
<span class="c1">// 3</span>
<span class="c1">// 4</span>
</code></pre></div>
<h3 id="7_1">7 函数递归剖析<a class="headerlink" href="#7_1" title="Permanent link">&para;</a></h3>
<p><img alt="image-20240723001259815" src="image-20240723001259815.png" /> </p>
<p>递归函数就是每次压入新的栈，从最里层的栈还是由内向外运行，逐级释放。</p>
<h3 id="8">8 命名返回值<a class="headerlink" href="#8" title="Permanent link">&para;</a></h3>
<ul>
<li>在函数声明时直接为返回值指定名称</li>
<li>这些名称在函数体内作为普通变量使用</li>
<li>函数结束时可以直接<code>return</code>而不需要显式指定返回值</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">myTest</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span>
<span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="c1">// 等价于 return result, args</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">myTest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;计算结果:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;传入参数:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 计算结果: 3</span>
<span class="c1">// 传入参数: [10 3]</span>
</code></pre></div>
<h3 id="9-deferrecover">9 异常处理（defer...recover...）<a class="headerlink" href="#9-deferrecover" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">myTest</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// 提前指定返回变量的初始化；error类型零值为nil</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">recover</span><span class="p">();</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;捕获异常：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<span class="w">            </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;除数不能为零&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// 修改返回变量</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">myTest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;发生错误:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;计算结果:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 捕获异常： runtime error: integer divide by zero</span>
<span class="c1">// 发生错误: 除数不能为零</span>
</code></pre></div>
<h2 id="_12">📚 结构体<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">结构体名称</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">字段</span><span class="w">   </span><span class="nx">类型</span>
<span class="w">    </span><span class="o">...</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w">   </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">age</span><span class="w">    </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">gender</span><span class="w"> </span><span class="kt">bool</span>
<span class="w">    </span><span class="nx">height</span><span class="w"> </span><span class="kt">float64</span>
<span class="w">    </span><span class="nx">weight</span><span class="w"> </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cenhongchang</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cenhongchang&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nx">gender</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">:</span><span class="w"> </span><span class="mf">1.75</span><span class="p">,</span><span class="w"> </span><span class="nx">weight</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">cenhongchang</span><span class="p">)</span><span class="w"> </span><span class="c1">// {cenhongchang 20 true 1.75 60}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="1_10">1 结构体定义<a class="headerlink" href="#1_10" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 字段单独写</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w">   </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">age</span><span class="w">    </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">gender</span><span class="w"> </span><span class="kt">bool</span>
<span class="w">    </span><span class="nx">height</span><span class="w"> </span><span class="kt">float64</span>
<span class="w">    </span><span class="nx">weight</span><span class="w"> </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// 同类型字段一起写</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w">           </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">age</span><span class="w">            </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">gender</span><span class="w">         </span><span class="kt">bool</span>
<span class="w">    </span><span class="nx">height</span><span class="p">,</span><span class="w"> </span><span class="nx">weight</span><span class="w"> </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// 作为其中一个字段嵌套</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Animal</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">dog</span><span class="w">    </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">cat</span><span class="w">    </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">person</span><span class="w"> </span><span class="nx">Person</span>
<span class="p">}</span>

<span class="c1">//  匿名字段 -&gt; 省略字段名，默认就与嵌套进来的结构体名一致</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">NewPerson</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Person</span>
<span class="w">    </span><span class="nx">hobby</span><span class="w">  </span><span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2_9">2 结构体指针<a class="headerlink" href="#2_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 结构体指针 -&gt; 同样可以直接获取属性值</span>
<span class="w">    </span><span class="nx">p1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Person</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cenhongchang&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nx">gender</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">:</span><span class="w"> </span><span class="mf">1.75</span><span class="p">,</span><span class="w"> </span><span class="nx">weight</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>

<span class="w">    </span><span class="nx">p2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cenhongchang&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nx">gender</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">:</span><span class="w"> </span><span class="mf">1.75</span><span class="p">,</span><span class="w"> </span><span class="nx">weight</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">p2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w">   </span><span class="c1">// 先计算属性再计算指针 0xc000024750</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">((</span><span class="o">&amp;</span><span class="nx">p2</span><span class="p">).</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="c1">// 先计算指针再计算属性 cenhongchang</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3_6">3 结构体赋值（拷贝）<a class="headerlink" href="#3_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 结构体指针 -&gt; 同样可以直接获取属性值</span>
<span class="w">    </span><span class="nx">p1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cenhongchang&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nx">gender</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">:</span><span class="w"> </span><span class="mf">1.75</span><span class="p">,</span><span class="w"> </span><span class="nx">weight</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">}</span>
<span class="w">    </span><span class="nx">p2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">p1</span>
<span class="w">    </span><span class="nx">p1</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;chc&quot;</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="c1">// chc</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="c1">// cenhongchang</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="4_4">4 结构体指针赋值（引用）<a class="headerlink" href="#4_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 结构体指针 -&gt; 同样可以直接获取属性值</span>
<span class="w">    </span><span class="nx">p1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Person</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cenhongchang&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nx">gender</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">:</span><span class="w"> </span><span class="mf">1.75</span><span class="p">,</span><span class="w"> </span><span class="nx">weight</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">}</span>
<span class="w">    </span><span class="nx">p2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">p1</span>
<span class="w">    </span><span class="nx">p1</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;chc&quot;</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="c1">// chc</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="c1">// chc</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="5_5">5 结构体嵌套数组、切片等赋值拷贝<a class="headerlink" href="#5_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">type</span><span class="w"> </span><span class="nx">Address</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">city</span><span class="p">,</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w">    </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">age</span><span class="w">     </span><span class="kt">int</span>
<span class="w">        </span><span class="nx">hobby</span><span class="w">   </span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="kt">string</span>
<span class="w">        </span><span class="nx">num</span><span class="w">     </span><span class="p">[]</span><span class="kt">int</span>
<span class="w">        </span><span class="nx">parent</span><span class="w">  </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="w">        </span><span class="nx">address</span><span class="w"> </span><span class="nx">Address</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">p1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;二狗子&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">age</span><span class="p">:</span><span class="w">    </span><span class="mi">19</span><span class="p">,</span>
<span class="w">        </span><span class="nx">hobby</span><span class="p">:</span><span class="w">  </span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;裸奔&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;大保健&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nx">num</span><span class="p">:</span><span class="w">    </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">69</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="mi">38</span><span class="p">},</span>
<span class="w">        </span><span class="nx">parent</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;father&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alex&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mother&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Monika&quot;</span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p1</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>其实本质上都拷贝了，只不过由于数据存储方式的不同，导致拷贝的有些是数据，有些是内存地址（指针）。</p>
<p>感觉拷贝：字符串、数组、整型等</p>
<p>感觉不拷贝：map、切片</p>
<p>注意：对于那些默认拷贝的情况，可以改变为指针类型，让数据实现同步修改。</p>
<div class="highlight"><pre><span></span><code><span class="nx">p1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="nx">hobby</span><span class="p">:</span><span class="w">  </span><span class="o">*</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;裸奔&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;大保健&quot;</span><span class="p">},</span>
<span class="w">    </span><span class="o">...</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="6_3">6 获取结构体字段名与标签<a class="headerlink" href="#6_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">type</span><span class="w"> </span><span class="nx">Address</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">city</span><span class="p">,</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w">    </span><span class="kt">string</span><span class="w">            </span><span class="s">&quot;姓名&quot;</span>
<span class="w">        </span><span class="nx">age</span><span class="w">     </span><span class="kt">int</span><span class="w">               </span><span class="s">&quot;年龄&quot;</span>
<span class="w">        </span><span class="nx">hobby</span><span class="w">   </span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="kt">string</span><span class="w">         </span><span class="s">&quot;爱好&quot;</span>
<span class="w">        </span><span class="nx">num</span><span class="w">     </span><span class="p">[]</span><span class="kt">int</span><span class="w">             </span><span class="s">&quot;电话&quot;</span>
<span class="w">        </span><span class="nx">parent</span><span class="w">  </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="w"> </span><span class="s">&quot;父母&quot;</span>
<span class="w">        </span><span class="nx">address</span><span class="w"> </span><span class="nx">Address</span><span class="w">           </span><span class="s">&quot;地址&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">p1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;二狗子&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">age</span><span class="p">:</span><span class="w">    </span><span class="mi">19</span><span class="p">,</span>
<span class="w">        </span><span class="nx">hobby</span><span class="p">:</span><span class="w">  </span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;裸奔&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;大保健&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nx">num</span><span class="p">:</span><span class="w">    </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">69</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="mi">38</span><span class="p">},</span>
<span class="w">        </span><span class="nx">parent</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;father&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alex&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mother&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Monika&quot;</span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p1</span><span class="p">)</span>

<span class="w">    </span><span class="nx">p1Type</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">p1</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">p1Type</span><span class="p">.</span><span class="nx">NumField</span><span class="p">();</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p1Type</span><span class="p">.</span><span class="nx">Field</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p1Type</span><span class="p">.</span><span class="nx">Field</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">Tag</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="7_2">7 结构体本身与指针用法<a class="headerlink" href="#7_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">age</span><span class="w">  </span><span class="kt">int</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">}</span>

<span class="c1">// 使用结构体本身，会拷贝，用的是不同的两份数据</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">()</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">p</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">()</span>
<span class="w">    </span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Jerry&quot;</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w">  </span><span class="c1">// 未改变 Tom</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="c1">// 已改变 Jerry</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// 使用指针，不会拷贝，都使用一份数据</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Person</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">p</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">()</span>
<span class="w">    </span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Jerry&quot;</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w">  </span><span class="c1">// 未改变 Tom</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="c1">// 已改变 Jerry</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="8_1">8 类型方法与结构体方法定义<a class="headerlink" href="#8_1" title="Permanent link">&para;</a></h3>
<h4 id="81-type">8.1 项目开发中会为type声明类型编写一些方法，从而实现<code>对象.方法</code>操作<a class="headerlink" href="#81-type" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">MyInt</span><span class="w"> </span><span class="kt">int</span>

<span class="c1">// Incr 定义类型方法 -&gt; i相当于对象本身(类比self)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="nx">MyInt</span><span class="p">)</span><span class="w"> </span><span class="nx">Incr</span><span class="p">(</span><span class="nx">num1</span><span class="p">,</span><span class="w"> </span><span class="nx">num2</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">num1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">num2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">v1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">MyInt</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="nx">v2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">v1</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">v2</span><span class="p">)</span>

<span class="w">    </span><span class="nx">v3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">Incr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 10+1+2=13</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v3</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>也可以写为：</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">MyInt</span><span class="w"> </span><span class="kt">int</span>

<span class="c1">// Incr 定义类型方法 -&gt; i相当于对象本身(类比self)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="nx">MyInt</span><span class="p">)</span><span class="w"> </span><span class="nx">Incr</span><span class="p">(</span><span class="nx">num1</span><span class="p">,</span><span class="w"> </span><span class="nx">num2</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">num1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">num2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="o">*</span><span class="nx">i</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">v1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">MyInt</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="nx">v2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">v1</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v1</span><span class="p">,</span><span class="w"> </span><span class="nx">v2</span><span class="p">)</span>

<span class="w">    </span><span class="nx">v3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">v1</span><span class="p">.</span><span class="nx">Incr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 10+1+2=13</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v3</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// 用不到i的写法</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="w"> </span><span class="o">*</span><span class="nx">MyInt</span><span class="p">)</span><span class="w"> </span><span class="nx">Incr</span><span class="p">(</span><span class="nx">num1</span><span class="p">,</span><span class="w"> </span><span class="nx">num2</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">num1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">num2</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>
<p>func (i MyInt) Incr(num1, num2 int) int</p>
</li>
<li>
<p>这是一个值接收者方法</p>
</li>
<li>
<p>操作的是 MyInt 的副本</p>
</li>
<li>
<p>对 i 的修改不会影响原始值</p>
</li>
<li>
<p>func (i *MyInt) Incr(num1, num2 int) int</p>
</li>
<li>
<p>这是一个指针接收者方法</p>
</li>
<li>
<p>操作的是 MyInt 的实际地址</p>
</li>
<li>
<p>可以通过 *i 修改原始值</p>
</li>
</ul>
<p><strong>总结：</strong><strong>不需要修改接收者的值（只读操作）就不用指针；但对于</strong>接收者是较大的结构体，需要避免复制开销**，就用指针；具体看场景选择用哪一种。</p>
<h4 id="82">8.2 结构体方法<a class="headerlink" href="#82" title="Permanent link">&para;</a></h4>
<p>多数情况都是使用指针（确保使用一份数据）;</p>
<p>不使用指针的情况--函数内会拷贝新数据，有以下示例：</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w">   </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">age</span><span class="w">    </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">gender</span><span class="w"> </span><span class="kt">bool</span>
<span class="p">}</span>

<span class="c1">// 定义两个结构体函数，分别使用非指针、指针参数</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">getRealAge</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">age</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">getRealAgeWithPointer</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">age</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">Person</span><span class="p">)</span>
<span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;John&quot;</span>
<span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">18</span>
<span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">gender</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">age</span><span class="p">))</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span><span class="w"> </span><span class="c1">// 18 - 原始值</span>
<span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">getRealAge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span><span class="w">            </span><span class="c1">// 18 - 没改变--函数内值拷贝处理</span>
<span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">getRealAgeWithPointer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// 20 - 已改变--函数内操作原始值处理</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">age</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>总结：</strong></p>
<div class="highlight"><pre><span></span><code>1. 在结构体中，我们不需要关注调用结构体方法是`指针类型.方法`还是`值类型.方法`，它内部会根据你函数定义接收者（func关键字之后括号里的内容）是指针类型还是值类型接收者决定。（因为我们总是会考虑：`指针.方法`为啥没有异常？ -&gt; 结构体内部会自动判断处理）；
1. 示例没有返回值的时候，用函数传入指针就改变了原始值。
</code></pre></div>
<h3 id="9">9 结构体方法继承<a class="headerlink" href="#9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Father</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">age</span><span class="w">  </span><span class="kt">int</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Son</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w">   </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">age</span><span class="w">    </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">Father</span><span class="w"> </span><span class="c1">// -&gt; 继承父方法，需要匿名，否则不会继承父结构体方法</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Son</span><span class="p">)</span><span class="w"> </span><span class="nx">PlayGame</span><span class="p">(</span><span class="nx">gameName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;son&#39;s skill play game is: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">gameName</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">666</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">Father</span><span class="p">)</span><span class="w"> </span><span class="nx">MakeMoney</span><span class="p">(</span><span class="nx">workName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;father&#39;s skill work is: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">workName</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">999</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Son</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;son&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">}</span>
<span class="w">    </span><span class="nx">f</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Father</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;father&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="p">}</span>
<span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">PlayGame</span><span class="p">(</span><span class="s">&quot;lol&quot;</span><span class="p">)</span><span class="w">     </span><span class="c1">// son&#39;s skill play game is: lol</span>
<span class="w">    </span><span class="nx">f</span><span class="p">.</span><span class="nx">MakeMoney</span><span class="p">(</span><span class="s">&quot;coding&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// father&#39;s skill work is: coding</span>
<span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">MakeMoney</span><span class="p">(</span><span class="s">&quot;teach&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// father&#39;s skill work is: teach -&gt; 继承父方法</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="10">10 结构体工厂函数<a class="headerlink" href="#10" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 定义为私有结构体</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fd</span><span class="w">   </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// NewFile 创建结构体工厂函数 -- 定义为公有工厂函数</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewFile</span><span class="p">(</span><span class="nx">fd</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">File</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 其他封装代码</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">File</span><span class="p">{</span><span class="nx">fd</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">f1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewFile</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;./test1.txt&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">f2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewFile</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;./test2.txt&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">f1</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">f2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>如何保证代码一致性？</p>
<p><strong>强制使用工厂函数创建</strong>：结构体本身定义是私有，工厂函数定义是公有即可解决。</p>
<h2 id="_13">📚 接口<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<h3 id="1_11">1 接口定义<a class="headerlink" href="#1_11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 约束函数</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">接口名称</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">方法名</span><span class="p">(</span><span class="nx">参数列表</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">返回值列表</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 约束类型</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">接口名称</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">类型1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">类型2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">类型3</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// 示例</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Base</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">f1</span><span class="p">()</span>
<span class="w">    </span><span class="nx">f2</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">f3</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">f4</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>


<span class="kd">type</span><span class="w"> </span><span class="nx">baseType</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>接口中的方法只写输入输出规范格式，不写具体实现。</strong></p>
<h3 id="2_10">2 接口作用<a class="headerlink" href="#2_10" title="Permanent link">&para;</a></h3>
<p>go程序开发中，接口有两大作用：代指类型 与 约束输入输出</p>
<h4 id="21-">2.1 空接口-代指任意类型<a class="headerlink" href="#21-" title="Permanent link">&para;</a></h4>
<p>go语言源码中，空接口就包含两个信息：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 源码路径 .../runtime/runtime2.go</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">eface</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_type</span><span class="w"> </span><span class="o">*</span><span class="nx">_type</span><span class="w">  </span><span class="c1">// 类型信息</span>
<span class="w">    </span><span class="nx">data</span><span class="w">  </span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="w">  </span><span class="c1">// 数据信息 - 指向数据的指针</span>
<span class="p">}</span>
</code></pre></div>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Base</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w">  </span><span class="c1">// 空接口，什么都满足</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">slice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="nx">Base</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="c1">//slice := make([]interface{}, 0) // 简写形式</span>
<span class="w">    </span><span class="nx">slice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="nx">slice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">})</span>
<span class="w">    </span><span class="nx">slice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">})</span>
<span class="w">    </span><span class="nx">slice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;你好&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">slice</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// [&lt;nil&gt; [1 2 3] [11 22 33] 你好]</span>
</code></pre></div>
<p><strong>go1.18+支持使用any代指空接口</strong>: <code>type any = interface{}</code></p>
<p><strong>注意：</strong>有一种空集接口（这种是写法错误，但又可以通过编译）</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Empty</span><span class="w"> </span><span class="kd">interface</span><span class="p">{</span><span class="w"> </span><span class="c1">// 分行写导致空集接口，什么都不满足</span>
<span class="w">    </span><span class="kt">string</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span>
<span class="p">}</span>
</code></pre></div>
<h4 id="22">2.2 接口转化指定类型的数据<a class="headerlink" href="#22" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">age</span><span class="w">  </span><span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">arg</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tp</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">arg</span><span class="p">.(</span><span class="nx">Person</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;转换成功：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tp</span><span class="p">,</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">tp</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;转换失败!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tp</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;张三&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">}</span>
<span class="w">    </span><span class="nx">doSomething</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="c1">// 转换失败!</span>
<span class="w">    </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span><span class="w">   </span><span class="c1">// 转换成功： {张三 18} main.Person</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="23">2.3 接口类型断言<a class="headerlink" href="#23" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">age</span><span class="w">  </span><span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">arg</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">tp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">arg</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// switch 与 类型判断的固定用法</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">Person</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;struct&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tp</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">string</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tp</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">int</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tp</span><span class="p">)</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%T %v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tp</span><span class="p">,</span><span class="w"> </span><span class="nx">tp</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">doSomething</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="nx">doSomething</span><span class="p">(</span><span class="s">&quot;cenhc&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">Person</span><span class="p">{</span><span class="s">&quot;cenhh&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">})</span>
<span class="w">    </span><span class="nx">doSomething</span><span class="p">([]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">//int 100</span>
<span class="c1">//string cenhc</span>
<span class="c1">//struct cenhh</span>
<span class="c1">//[]int [1 2 3]</span>
</code></pre></div>
<h4 id="24">2.4 接口约束与规范<a class="headerlink" href="#24" title="Permanent link">&para;</a></h4>
<p>传入的实例一般是结构体指针</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 定义接口约束</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">IBase</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">f1</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span>
<span class="p">}</span>

<span class="c1">// 结构体 Person</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">age</span><span class="w">  </span><span class="kt">int</span>
<span class="p">}</span>
<span class="c1">// 结构体 Person 类型方法</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">f1</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">age</span>
<span class="p">}</span>

<span class="c1">// 结构体 User</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">username</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">password</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>
<span class="c1">// 结构体 User 类型方法</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">f1</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">u</span><span class="p">.</span><span class="nx">username</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 执行函数 - 自动判断传入对象类型调用对应方法</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">ibase</span><span class="w"> </span><span class="nx">IBase</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ibase</span><span class="p">.</span><span class="nx">f1</span><span class="p">()</span><span class="w">  </span><span class="c1">// 基于接口传入多种类型（多态）自动调用对应方法</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;执行结果：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Person</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;John&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">}</span>
<span class="w">    </span><span class="nx">u</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;john_doe&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;secret&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
<span class="w">    </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//执行结果： 30</span>
<span class="c1">//执行结果： 8</span>
</code></pre></div>
<p>实际案例：同时向微信、邮箱发送注册成功消息</p>
<div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm">接口实现场景：同时向微信、邮箱发送注册成功消息</span>
<span class="cm">*/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">IBase</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">send</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Email</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">email</span><span class="w">   </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">content</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">*</span><span class="nx">Email</span><span class="p">)</span><span class="w"> </span><span class="nx">send</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Wechat</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">wid</span><span class="w">     </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">content</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">*</span><span class="nx">Wechat</span><span class="p">)</span><span class="w"> </span><span class="nx">send</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>

<span class="c1">// 使用接口切片处理</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">runSend</span><span class="p">(</span><span class="nx">ibaseList</span><span class="w"> </span><span class="p">[]</span><span class="nx">IBase</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">ibaseList</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">obj</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">e</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Email</span><span class="p">{</span>
<span class="w">        </span><span class="nx">email</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;123@qq.com&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;邮箱端通知：注册成功！&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">w</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Wechat</span><span class="p">{</span>
<span class="w">        </span><span class="nx">wid</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;ccplayer&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;微信端通知：注册成功！&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">runSend</span><span class="p">([]</span><span class="nx">IBase</span><span class="p">{</span><span class="nx">e</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">//邮箱端通知：注册成功！</span>
<span class="c1">//微信端通知：注册成功！</span>
</code></pre></div>
<h2 id="go118">📚 泛型（go1.18+）<a class="headerlink" href="#go118" title="Permanent link">&para;</a></h2>
<h3 id="1_12">1 基本语法<a class="headerlink" href="#1_12" title="Permanent link">&para;</a></h3>
<p>泛型适合解决的问题场景：减少重复代码：避免为不同类型编写几乎相同的函数</p>
<ol>
<li><strong>语法</strong>：Go使用方括号<code>[]</code>而非尖括号<code>&lt;&gt;</code></li>
<li><strong>实现方式</strong>：Go在编译时生成具体类型的代码，而非运行时擦除类型</li>
<li><strong>限制</strong>：Go泛型相对保守，不支持某些高级特性如运算符重载</li>
<li><strong>注意</strong>：泛型不是说可以的多种数据类型混杂在一起，他只是其中一种；可以混杂在一起的数据类型是空接口</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">// 特别注意：泛型约束基础数据类型变量--使用接口</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">MyVar</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// MySlice 泛型切片定义</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">MySlice</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="w"> </span><span class="p">[]</span><span class="nx">T</span>

<span class="c1">// MyMap 泛型Map定义</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">MyMap</span><span class="p">[</span><span class="nx">K</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">V</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float32</span><span class="p">]</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="nx">V</span>

<span class="c1">// MyStruct 泛型结构体定义</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">MyStruct</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">data</span><span class="w">          </span><span class="p">[]</span><span class="nx">T</span>
<span class="w">    </span><span class="nx">length</span><span class="w">        </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">max</span><span class="p">,</span><span class="w"> </span><span class="nx">min</span><span class="p">,</span><span class="w"> </span><span class="nx">avg</span><span class="w"> </span><span class="nx">T</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// 定义一个类型约束</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Numeric</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// 泛型函数：计算切片中所有元素的和</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Sum</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="nx">Numeric</span><span class="p">](</span><span class="nx">numbers</span><span class="w"> </span><span class="p">[]</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="nx">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">total</span><span class="w"> </span><span class="nx">T</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">numbers</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">num</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">total</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 泛型类型--实例化</span>
<span class="w">    </span><span class="nx">ints</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
<span class="w">    </span><span class="nx">floats</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">float64</span><span class="p">{</span><span class="mf">1.1</span><span class="p">,</span><span class="w"> </span><span class="mf">2.2</span><span class="p">,</span><span class="w"> </span><span class="mf">3.3</span><span class="p">}</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">Sum</span><span class="p">(</span><span class="nx">ints</span><span class="p">))</span><span class="w">    </span><span class="c1">// 输出: 10</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">Sum</span><span class="p">(</span><span class="nx">floats</span><span class="p">))</span><span class="w">  </span><span class="c1">// 输出: 6.6</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2_11">2 基于基础类型的自定义类型泛型<a class="headerlink" href="#2_11" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 基于基础类型的自定义类型</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">MyInt</span><span class="w"> </span><span class="kt">int</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">YourInt</span><span class="w"> </span><span class="nx">MyInt</span>

<span class="c1">// 元素可以是基础类型为int的类型，包括自定义类型</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">IntSlice</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="o">~</span><span class="kt">int</span><span class="p">]</span><span class="w"> </span><span class="p">[]</span><span class="nx">T</span><span class="w">  </span><span class="c1">// ~符号表示底层类型约束</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">IntSlice</span><span class="p">[</span><span class="nx">MyInt</span><span class="p">]{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<span class="w">    </span><span class="nx">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">IntSlice</span><span class="p">[</span><span class="nx">YourInt</span><span class="p">]{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 如果需要相加，则将b转换为IntSlice[MyInt]类型</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">convertedB</span><span class="w"> </span><span class="nx">IntSlice</span><span class="p">[</span><span class="nx">MyInt</span><span class="p">]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">convertedB</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">convertedB</span><span class="p">,</span><span class="w"> </span><span class="nx">MyInt</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">convertedB</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [1 2 3 1 2 3]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3_7">3 基于泛型继续定义泛型<a class="headerlink" href="#3_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">MySlice</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float64</span><span class="p">]</span><span class="w"> </span><span class="p">[]</span><span class="nx">T</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">FloatSlice</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="kt">float32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float64</span><span class="p">]</span><span class="w"> </span><span class="nx">MySlice</span><span class="p">[</span><span class="nx">T</span><span class="p">]</span><span class="w"> </span><span class="c1">// 表示元素类型必须属于MySlice定义类型，含其他类型会报错</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">MyStruct</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="kt">float32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float64</span><span class="p">]</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">FiledsA</span><span class="w">        </span><span class="nx">MySlice</span><span class="p">[</span><span class="nx">T</span><span class="p">]</span>
<span class="w">    </span><span class="nx">FiledsB</span><span class="w">        </span><span class="nx">FloatSlice</span><span class="p">[</span><span class="nx">T</span><span class="p">]</span>
<span class="w">    </span><span class="nx">Height</span><span class="p">,</span><span class="w"> </span><span class="nx">Weight</span><span class="w"> </span><span class="nx">T</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">MyMap</span><span class="p">[</span><span class="nx">K</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">V</span><span class="w"> </span><span class="kt">float32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float64</span><span class="p">]</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="nx">MySlice</span><span class="p">[</span><span class="nx">V</span><span class="p">]</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">MyStruct</span><span class="p">[</span><span class="kt">float32</span><span class="p">]{</span>
<span class="w">        </span><span class="nx">FiledsA</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">float32</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<span class="w">        </span><span class="nx">FiledsB</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">float32</span><span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">},</span>
<span class="w">        </span><span class="nx">Height</span><span class="p">:</span><span class="w">  </span><span class="mf">1.75</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Weight</span><span class="p">:</span><span class="w">  </span><span class="mf">80.0</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">MyMap</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">float32</span><span class="p">]{</span><span class="w"> </span><span class="c1">// 注意格式变化</span>
<span class="w">        </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<span class="w">        </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>基于泛型定义，我们逐步清晰：T表示的就是基础数据类型，比如：int/float32/float64/string/bool等</p>
<h3 id="4_5">4 规避指针类型写法<a class="headerlink" href="#4_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// type myList1[T *int] []T  -&gt; 错误写法，会被认为是乘法运算，需要末尾加“,”；或者使用接口定义</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">myList1</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="p">,]</span><span class="w"> </span><span class="p">[]</span><span class="nx">T</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">myList2</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="kd">interface</span><span class="p">{</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">[]</span><span class="nx">T</span>
</code></pre></div>
<h3 id="5_6">5 泛型接收器<a class="headerlink" href="#5_6" title="Permanent link">&para;</a></h3>
<p><strong>一般应用场景：</strong>定义泛型结构体 -&gt; 定义结构体方法 -&gt; 定义方法接收器（实例化对象调用具体方法）</p>
<p><strong>泛型接收器的作用：</strong>  让一组具有共同处理方法的数据，可以实现统一方法调用；这里不同于接口对每个实现再去调用方式，示例如下：</p>
<div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm">定义泛型数值型的数据（int/float32/float64...），可调用其新增元素Add方法，实时更新最大值/最小值</span>
<span class="cm">*/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;sync&quot;</span>
<span class="p">)</span>

<span class="c1">// 定义结构体</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">myStruct</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float64</span><span class="p">]</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="nx">T</span>
<span class="w">    </span><span class="nx">max</span><span class="w">  </span><span class="nx">T</span>
<span class="w">    </span><span class="nx">min</span><span class="w">  </span><span class="nx">T</span>
<span class="w">    </span><span class="nx">sm</span><span class="w">   </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span><span class="w"> </span><span class="c1">// 考虑并发写入元素，使用互斥锁</span>
<span class="p">}</span>

<span class="c1">// 定义结构体方法 - 指针表示操作原始数据</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">myStruct</span><span class="p">[</span><span class="nx">T</span><span class="p">])</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">ele</span><span class="w"> </span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">myStruct</span><span class="p">[</span><span class="nx">T</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">m</span><span class="p">.</span><span class="nx">sm</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">sm</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

<span class="w">    </span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">ele</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">m</span><span class="p">.</span><span class="nx">max</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ele</span>
<span class="w">        </span><span class="nx">m</span><span class="p">.</span><span class="nx">min</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ele</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">m</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">max</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">ele</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">m</span><span class="p">.</span><span class="nx">max</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ele</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">min</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">ele</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">m</span><span class="p">.</span><span class="nx">min</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ele</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">m</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">myStruct</span><span class="p">[</span><span class="nx">T</span><span class="p">])</span><span class="w"> </span><span class="nx">GetMax</span><span class="p">()</span><span class="w"> </span><span class="nx">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">max</span>
<span class="p">}</span>

<span class="c1">// 泛型函数</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">myInitStruct</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float64</span><span class="p">](</span><span class="nx">value</span><span class="w"> </span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">myStruct</span><span class="p">[</span><span class="nx">T</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">myStruct</span><span class="p">[</span><span class="nx">T</span><span class="p">])</span>
<span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">p</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// int类型对象</span>
<span class="w">    </span><span class="nx">p1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">myStruct</span><span class="p">[</span><span class="kt">int</span><span class="p">])</span>
<span class="w">    </span><span class="nx">p1</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">Add</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nx">Add</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nx">Add</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">max</span><span class="p">,</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">min</span><span class="p">,</span><span class="w"> </span><span class="nx">p1</span><span class="p">.</span><span class="nx">GetMax</span><span class="p">())</span>
<span class="w">    </span><span class="c1">// float64类型对象使用同样方法处理</span>
<span class="w">    </span><span class="nx">p2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">myStruct</span><span class="p">[</span><span class="kt">float64</span><span class="p">])</span>
<span class="w">    </span><span class="nx">p2</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mf">1.1</span><span class="p">).</span><span class="nx">Add</span><span class="p">(</span><span class="mf">2.2</span><span class="p">).</span><span class="nx">Add</span><span class="p">(</span><span class="mf">3.3</span><span class="p">).</span><span class="nx">Add</span><span class="p">(</span><span class="mf">5.5</span><span class="p">).</span><span class="nx">Add</span><span class="p">(</span><span class="o">-</span><span class="mf">10.1</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">max</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">min</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">.</span><span class="nx">GetMax</span><span class="p">())</span>

<span class="w">    </span><span class="nx">p3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">myInitStruct</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// 泛型函数创建结构体-返回指针</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p3</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">max</span><span class="p">,</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">min</span><span class="p">,</span><span class="w"> </span><span class="nx">p3</span><span class="p">.</span><span class="nx">GetMax</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="6_4">6 泛型函数<a class="headerlink" href="#6_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">Sum</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">float64</span><span class="p">](</span><span class="nx">args</span><span class="w"> </span><span class="o">...</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">v</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Sum</span><span class="p">(</span><span class="s">&quot;你好！&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;中国&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--HELLO&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="7_3">7 泛型接口<a class="headerlink" href="#7_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 定义泛型接口</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Data</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Process</span><span class="p">(</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="nx">Save</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span>
<span class="p">}</span>

<span class="c1">// 定义结构体</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">JsonData</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">age</span><span class="w">  </span><span class="kt">int</span>
<span class="p">}</span>

<span class="c1">// 定义结构体方法-int类型</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">*</span><span class="nx">JsonData</span><span class="p">)</span><span class="w"> </span><span class="nx">Process</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="o">*</span><span class="nx">JsonData</span><span class="p">)</span><span class="w"> </span><span class="nx">Save</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// 实例具体使用</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="nx">Data</span><span class="p">[</span><span class="kt">int</span><span class="p">],</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;result:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">doSomethingNew</span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="nx">Data</span><span class="p">[</span><span class="kt">string</span><span class="p">],</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;result:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">person</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">JsonData</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;John&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">}</span>
<span class="w">    </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">person</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// var personNew = &amp;JsonData{name: &quot;tom&quot;, age: 50}</span>
<span class="w">    </span><span class="c1">// doSomethingNew(personNew, 200) // 会报错 -- 结构体没有实现string类的具体方法</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="8_2">8 泛型带来的接口语法变化<a class="headerlink" href="#8_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>

<span class="c1">// 定义接口（混合类型与函数约束）</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Data</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">~</span><span class="kt">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">~</span><span class="kt">float64</span>
<span class="w">    </span><span class="nx">Process</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="nx">Save</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span>
<span class="p">}</span>

<span class="c1">// 定义自定义类型（底层类型必须是接口约束的类型之一）</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">myType</span><span class="w"> </span><span class="kt">int</span>

<span class="c1">// 定义结构体方法-int类型</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="nx">myType</span><span class="p">)</span><span class="w"> </span><span class="nx">Process</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">j</span><span class="w"> </span><span class="nx">myType</span><span class="p">)</span><span class="w"> </span><span class="nx">Save</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// 具体实现--需要使用泛型函数</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">[</span><span class="nx">T</span><span class="w"> </span><span class="nx">Data</span><span class="p">](</span><span class="nx">d</span><span class="w"> </span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;result:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="nx">myType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="9_1">9 预定义接口的使用<a class="headerlink" href="#9_1" title="Permanent link">&para;</a></h3>
<h4 id="91">9.1 支持可比较是否相等的类型<a class="headerlink" href="#91" title="Permanent link">&para;</a></h4>
<p>定义泛型Map时，键必须是可比较是否相等的，使用的关键字：comparable；值用空接口即可（any）</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">myMap</span><span class="p">[</span><span class="nx">K</span><span class="w"> </span><span class="kt">comparable</span><span class="p">,</span><span class="w"> </span><span class="nx">V</span><span class="w"> </span><span class="kt">any</span><span class="p">]</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="nx">V</span>
</code></pre></div>
<h4 id="92">9.2 支持可比较大小的类型<a class="headerlink" href="#92" title="Permanent link">&para;</a></h4>
<p>类型集合分类（约定俗成的代码）：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 浮点型</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Float</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">~</span><span class="kt">float32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">~</span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// 有符号数</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Singed</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">~</span><span class="kt">int8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">~</span><span class="kt">int16</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">~</span><span class="kt">int32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">~</span><span class="kt">int64</span>
<span class="p">}</span>

<span class="c1">// 无符号数</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Unsigned</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">~</span><span class="kt">uint8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">~</span><span class="kt">uint16</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">~</span><span class="kt">uint32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">~</span><span class="kt">uint64</span>
<span class="p">}</span>

<span class="c1">// 整型</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Integer</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Singed</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Unsigned</span>
<span class="p">}</span>

<span class="c1">// 可比较排序型</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Ordered</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Integer</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Float</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">~</span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// 数值型</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Number</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Integer</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Float</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_14">📚 反射<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p>反射是Go语言中一个强大但需要谨慎使用的特性，它允许程序在运行时检查类型信息、操作对象和调用方法。下面是对Go语言反射的详细介绍：</p>
<h3 id="1_13">1 基本概念<a class="headerlink" href="#1_13" title="Permanent link">&para;</a></h3>
<p>反射主要通过<code>reflect</code>包实现，核心是两个类型：</p>
<ol>
<li><code>reflect.TypeOf</code> - 表示Go语言的类型信息</li>
<li><code>reflect.ValueOf</code> - 表示一个值的运行时表示</li>
</ol>
<h3 id="2_12">2 反射的三大定律<a class="headerlink" href="#2_12" title="Permanent link">&para;</a></h3>
<ul>
<li>源码中的定义：反射实际上就是interface与Type、Value之间转换过程</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">typeOf</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="nx">Type</span><span class="w">   </span><span class="p">{}</span><span class="w"> </span><span class="c1">// interface -&gt; Type</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">valueOf</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="nx">Value</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// interface -&gt; Value</span>
</code></pre></div>
<ol>
<li><strong>反射可以将interface类型变量转换为反射对象</strong></li>
</ol>
<div class="highlight"><pre><span></span><code>r := reflect.ValueOf(变量)
</code></pre></div>
<ol>
<li><strong>反射可以将反射对象还原为interface类型变量</strong></li>
</ol>
<div class="highlight"><pre><span></span><code>i := r.Interface()
</code></pre></div>
<ol>
<li><strong>要修改反射对象，其值必须是可设置的（addressable）</strong></li>
</ol>
<div class="highlight"><pre><span></span><code>r := reflect.ValueOf(&amp;变量).Elem()
</code></pre></div>
<ul>
<li><strong>三大定律示例：</strong></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// 反射三大定律</span>

<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">3.14</span>

<span class="w">  </span><span class="c1">// 1 - 反射可以将interface类型变量转换为反射对象</span>
<span class="w">  </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;类型：%T 值：%v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>

<span class="w">  </span><span class="c1">// 2 - 反射可以将反射对象还原为interface类型变量</span>
<span class="w">  </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Interface</span><span class="p">().(</span><span class="kt">float64</span><span class="p">)</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;类型：%T 值：%v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>

<span class="w">  </span><span class="c1">// 3 - 要修改反射对象，其值必须是可设置的（addressable）</span>
<span class="w">  </span><span class="nx">rpe</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">x</span><span class="p">).</span><span class="nx">Elem</span><span class="p">()</span>
<span class="w">  </span><span class="nx">rpe</span><span class="p">.</span><span class="nx">SetFloat</span><span class="p">(</span><span class="mf">7.1</span><span class="p">)</span><span class="w">             </span><span class="c1">// SetFloat方法针对的是interface类型数据</span>
<span class="w">  </span><span class="nx">rpe</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="mf">8.0</span><span class="p">))</span><span class="w"> </span><span class="c1">// Set方法针对的是反射对象（reflect.Value）数据</span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;类型：%T 值：%v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="4_6">4 实例认识反射<a class="headerlink" href="#4_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm">从代码实例学习反射</span>

<span class="cm">给定一个泛型User结构体，实现入参类型判断修改值</span>
<span class="cm">*/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;reflect&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">MyInt</span><span class="w"> </span><span class="kt">int</span>

<span class="c1">// 定义结构体</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">IdOrName</span><span class="w"> </span><span class="kt">any</span>
<span class="w">    </span><span class="nx">Age</span><span class="w">      </span><span class="nx">MyInt</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">u</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span>
<span class="w">        </span><span class="nx">IdOrName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;chc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Age</span><span class="p">:</span><span class="w">      </span><span class="mi">20</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改前：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">u</span><span class="p">.</span><span class="nx">IdOrName</span><span class="p">))</span>

<span class="w">    </span><span class="nx">uType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">u</span><span class="p">.</span><span class="nx">IdOrName</span><span class="p">)</span><span class="w"> </span><span class="c1">// 获取对象字段的具体类型 -- 这不是我要的</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">uType</span><span class="p">)</span><span class="w">                  </span><span class="c1">// string</span>

<span class="w">    </span><span class="nx">uValueType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">).</span><span class="nx">Elem</span><span class="p">()</span><span class="w"> </span><span class="c1">// 获取定义结构体字段类型 -- 这是我想要的</span>

<span class="w">    </span><span class="nx">rvIdOrName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uValueType</span><span class="p">.</span><span class="nx">FieldByName</span><span class="p">(</span><span class="s">&quot;IdOrName&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 类型：reflect.Value</span>
<span class="w">    </span><span class="nx">rvAge</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uValueType</span><span class="p">.</span><span class="nx">FieldByName</span><span class="p">(</span><span class="s">&quot;Age&quot;</span><span class="p">)</span><span class="w">           </span><span class="c1">// 类型：reflect.Value</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;IdOrName类型：%T\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rvIdOrName</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;IdOrName: type=%s, kind=%s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rvIdOrName</span><span class="p">.</span><span class="nx">Type</span><span class="p">(),</span><span class="w"> </span><span class="nx">rvIdOrName</span><span class="p">.</span><span class="nx">Kind</span><span class="p">())</span><span class="w"> </span><span class="c1">// IdOrName: type=interface {}, kind=interface</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Age: type=%s, kind=%s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rvAge</span><span class="p">.</span><span class="nx">Type</span><span class="p">(),</span><span class="w"> </span><span class="nx">rvAge</span><span class="p">.</span><span class="nx">Kind</span><span class="p">())</span><span class="w">                </span><span class="c1">// Age: type=main.MyInt, kind=int</span>

<span class="w">    </span><span class="c1">// 根据打印结果：.Type()获取自定义的类型；.Kind()获取基础数据类型</span>

<span class="w">    </span><span class="c1">// 现在根据传入值类型判断修改值</span>
<span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<span class="w">    </span><span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>

<span class="w">    </span><span class="c1">// 空接口类型可以设置任何类型值</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">rvIdOrName</span><span class="p">.</span><span class="nx">Kind</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="c1">// 转换为反射对象</span>
<span class="w">        </span><span class="nx">rvIdOrName</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">rvAge</span><span class="p">.</span><span class="nx">Kind</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Int</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">rvAge</span><span class="p">.</span><span class="nx">SetInt</span><span class="p">(</span><span class="nb">int64</span><span class="p">(</span><span class="nx">y</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">u</span><span class="p">.</span><span class="nx">IdOrName</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="5_7">5 反射获取类型信息<a class="headerlink" href="#5_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;reflect&quot;</span>
<span class="w">    </span><span class="s">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">hobbys</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">Age</span><span class="w">    </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;age&quot;`</span>
<span class="w">    </span><span class="nx">Gender</span><span class="w"> </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;gender&quot;`</span>
<span class="w">    </span><span class="nx">Person</span><span class="w"> </span><span class="s">`json:&quot;person&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ashes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Repeat</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w"> </span><span class="c1">// 定义20个-的字符串</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">ashes</span><span class="p">)</span>

<span class="w">    </span><span class="nx">u</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="nx">Gender</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span>
<span class="w">    </span><span class="nx">uType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">uType</span><span class="p">.</span><span class="nx">NumField</span><span class="p">();</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">field</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uType</span><span class="p">.</span><span class="nx">Field</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;第一个字段的反射信息中继续反射，获取包含有哪些字段：&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="c1">// 对第一个元素获取的信息也做反射获取字段（获取的信息本质也是一个结构体）</span>
<span class="w">            </span><span class="nx">fType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">fType</span><span class="p">.</span><span class="nx">NumField</span><span class="p">();</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">fType</span><span class="p">.</span><span class="nx">Field</span><span class="p">(</span><span class="nx">j</span><span class="p">).</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">ashes</span><span class="p">)</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;反射信息中包含有哪些方法（传入指针）：&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">fpType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">field</span><span class="p">)</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">fpType</span><span class="p">.</span><span class="nx">NumMethod</span><span class="p">();</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">fpType</span><span class="p">.</span><span class="nx">Method</span><span class="p">(</span><span class="nx">j</span><span class="p">).</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">ashes</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;反射中当前字段类型：%T\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">)</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">ashes</span><span class="p">)</span>

<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;反射获取信息如下：&quot;</span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;\n\t字段名：%v&quot;</span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;\n\t包路径：%v&quot;</span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;\n\t类型：%v&quot;</span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;\n\t标签：%v&quot;</span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;\n\t偏移量：%v&quot;</span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;\n\t索引：%v&quot;</span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;\n\t是否匿名字段：%v&quot;</span><span class="o">+</span>
<span class="w">            </span><span class="s">&quot;\n\t是否可见：%v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">PkgPath</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">Type</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">Tag</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">Offset</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">Index</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">Anonymous</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">IsExported</span><span class="p">())</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">ashes</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<h4 id="51_3">5.1 获取对变量反射后继续反射信息<a class="headerlink" href="#51_3" title="Permanent link">&para;</a></h4>
<p>对变量反射之后，继续反射可以观察变量反射之后有哪些信息和方法：</p>
<div class="highlight"><pre><span></span><code><span class="nx">uType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>
<span class="nx">fType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span>

<span class="c1">// 有哪些字段？</span>
<span class="k">for</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">fType</span><span class="p">.</span><span class="nx">NumField</span><span class="p">();</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="w"> </span><span class="p">{}</span>
<span class="c1">// 主要包含以下字段（相当于python定义类的属性）：</span>
<span class="c1">// Name</span>
<span class="c1">// PkgPath</span>
<span class="c1">// Type</span>
<span class="c1">// Tag</span>
<span class="c1">// Offset</span>
<span class="c1">// Index</span>
<span class="c1">// Anonymous</span>

<span class="c1">// 有哪些方法？</span>
<span class="k">for</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">fType</span><span class="p">.</span><span class="nx">NumMethod</span><span class="p">();</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="w"> </span><span class="p">{}</span>
<span class="c1">// IsExported 是否可见 -&gt; 不是指针参数方法（fType获取时，field不是指针） -- 指针参数可以获取全部方法；非指针参数只能获取非指针参数方法</span>

<span class="c1">// fpType := reflect.TypeOf(&amp;field)  // 传入的是指针参数</span>
</code></pre></div>
<h4 id="52_3">5.2 反射获取方法注意事项<a class="headerlink" href="#52_3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">uType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>
<span class="nx">fType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span><span class="w">   </span><span class="c1">// 非指针参数  -- 只能获取非指针参数方法</span>
<span class="nx">fpType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">field</span><span class="p">)</span><span class="w"> </span><span class="c1">// 指针参数  -- 可以获取全部方法</span>
</code></pre></div>
<p><strong>示例：</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">hobbys</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">Age</span><span class="w">    </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;age&quot;`</span>
<span class="w">    </span><span class="nx">Gender</span><span class="w"> </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;gender&quot;`</span>
<span class="w">    </span><span class="nx">Person</span><span class="w"> </span><span class="s">`json:&quot;person&quot;`</span>
<span class="p">}</span>

<span class="c1">// 非指针参数方法</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">SetName</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">name</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">p</span>
<span class="p">}</span>

<span class="c1">// 指针参数方法</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">StringInfo</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Name:%s, Age:%d, Gender:%t&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">Age</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">Gender</span><span class="p">)</span>
<span class="p">}</span>


<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ashes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Repeat</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w"> </span><span class="c1">// 定义20个-的字符串</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">ashes</span><span class="p">)</span>

<span class="w">    </span><span class="nx">u</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="nx">Gender</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span>
<span class="w">    </span><span class="c1">// uType := reflect.TypeOf(u)  // 这种打印结果：SetName</span>
<span class="w">    </span><span class="nx">uType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span><span class="w">  </span><span class="c1">// 这种打印结果：SetName StringInfo</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">uType</span><span class="p">.</span><span class="nx">NumMethod</span><span class="p">();</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">field</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uType</span><span class="p">.</span><span class="nx">Method</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="6_5">6 反射判断类型是否实现了接口<a class="headerlink" href="#6_5" title="Permanent link">&para;</a></h3>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;reflect&quot;</span>
<span class="w">    </span><span class="s">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="c1">// 定义接口</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">People</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">StringInfo</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">hobbys</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">Age</span><span class="w">    </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;age&quot;`</span>
<span class="w">    </span><span class="nx">Gender</span><span class="w"> </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;gender&quot;`</span>
<span class="w">    </span><span class="nx">Person</span><span class="w"> </span><span class="s">`json:&quot;person&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">StringInfo</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Hobbys:%v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">hobbys</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 重写父结构体方法 - 同时也是接口</span>
<span class="c1">// func (p *User) StringInfo() string {</span>
<span class="c1">//  return fmt.Sprintf(&quot;Name:%s, Age:%d, Gender:%t&quot;, p.Name, p.Age, p.Gender)</span>
<span class="c1">// }</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ashes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Repeat</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w"> </span><span class="c1">// 定义20个-的字符串</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">ashes</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 判断结构体User是否实现了People接口？</span>
<span class="w">    </span><span class="nx">ipeople</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">People</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)</span><span class="w"> </span><span class="c1">// 空指针类型-类型元信息-类比创建一个接口实例</span>
<span class="w">    </span><span class="nx">iType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">ipeople</span><span class="p">).</span><span class="nx">Elem</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;iType底层类型（kind）是否是一个接口？ &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">iType</span><span class="p">.</span><span class="nx">Kind</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Interface</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 判断Person和User是否实现了People接口？</span>
<span class="w">    </span><span class="nx">uType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">User</span><span class="p">{})</span>
<span class="w">    </span><span class="nx">upType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{})</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;user是否实现了People接口？&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">uType</span><span class="p">,</span><span class="w"> </span><span class="nx">uType</span><span class="p">.</span><span class="nx">Implements</span><span class="p">(</span><span class="nx">iType</span><span class="p">))</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;puser是否实现了People接口？&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">upType</span><span class="p">,</span><span class="w"> </span><span class="nx">upType</span><span class="p">.</span><span class="nx">Implements</span><span class="p">(</span><span class="nx">iType</span><span class="p">))</span>

<span class="w">    </span><span class="nx">pType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">Person</span><span class="p">{})</span>
<span class="w">    </span><span class="nx">ppType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Person</span><span class="p">{})</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;person是否实现了People接口？&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">pType</span><span class="p">,</span><span class="w"> </span><span class="nx">pType</span><span class="p">.</span><span class="nx">Implements</span><span class="p">(</span><span class="nx">iType</span><span class="p">))</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;pperson是否实现了People接口？&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ppType</span><span class="p">,</span><span class="w"> </span><span class="nx">ppType</span><span class="p">.</span><span class="nx">Implements</span><span class="p">(</span><span class="nx">iType</span><span class="p">))</span>

<span class="p">}</span>


<span class="c1">// iType底层类型（kind）是否是一个接口？  true</span>
<span class="c1">// user是否实现了People接口？ main.User false</span>
<span class="c1">// puser是否实现了People接口？ *main.User true</span>
<span class="c1">// person是否实现了People接口？ main.Person false</span>
<span class="c1">// pperson是否实现了People接口？ *main.Person true</span>
</code></pre></div>
<p><strong>结论总结：</strong></p>
<ul>
<li>
<p>判断是否实现接口，使用：<code>变量反射.Implements(reflect.TypeOf((*接口名称)(nil)).Elem())</code></p>
</li>
<li>
<p>变量反射时，依然遵循指针类型会判断是否实现对应的指针类型接口或值类型接口（其一即可）；值类型只会判断值类型接口是否实现</p>
</li>
<li>接口判断是否实现遵循继承，父类型实现了接口；子类型判断也是已实现</li>
<li>接口判断若有多个方法，则会判断是否全部实现；才会返回true；否则false</li>
</ul>
<h3 id="7-valueof">7 关于ValueOf常用操作<a class="headerlink" href="#7-valueof" title="Permanent link">&para;</a></h3>
<h4 id="71-typeofelemvalueofelem">7.1 明确TypeOf().Elem()与ValueOf().Elem()之间的区别<a class="headerlink" href="#71-typeofelemvalueofelem" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">u</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{}</span>
<span class="nx">t1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span><span class="w">          </span><span class="c1">// User 的类型</span>
<span class="nx">t2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">).</span><span class="nx">Elem</span><span class="p">()</span><span class="w">  </span><span class="c1">// 解引用后仍然是 User 的类型</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">t1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">t2</span><span class="p">)</span><span class="w">            </span><span class="c1">// true（类型相同）</span>

<span class="nx">v1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span><span class="w">          </span><span class="c1">// User 的值（副本）; v1 是 u 的一个副本的反射值（新内存地址）（副本的生命周期可能仅限于当前作用域）</span>
<span class="nx">v2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">).</span><span class="nx">Elem</span><span class="p">()</span><span class="w">  </span><span class="c1">// 解引用后指向原始 u 的反射值 ; v2 是 &amp;u 解引用后得到的原始 u 的反射值（原始内存地址）</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">v2</span><span class="p">)</span><span class="w">             </span><span class="c1">// false ; 两者的底层存储不同（一个是副本，一个是原始值）</span>
</code></pre></div>
<h4 id="72_1">7.2 反射获取与修改值<a class="headerlink" href="#72_1" title="Permanent link">&para;</a></h4>
<p>注意：修改结构体对象里面的值，必须为公有的（首字母大写）；私有的不允许修改；一般一定要修改私有变量；就需要写对应的函数去修改；</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">u</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;chc&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 反射获取Name的值</span>
<span class="w">    </span><span class="nx">uValueElem</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">).</span><span class="nx">Elem</span><span class="p">()</span>
<span class="w">    </span><span class="nx">uFieldByName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uValueElem</span><span class="p">.</span><span class="nx">FieldByName</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">uFieldByName</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// 反射修改Name的值 -- 注意使用指针参数获取反射</span>
<span class="w">    </span><span class="nx">uFieldByName</span><span class="p">.</span><span class="nx">SetString</span><span class="p">(</span><span class="s">&quot;xxx&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="74-type">7.4 转Type<a class="headerlink" href="#74-type" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 转Type</span>
<span class="nx">uTypeElem</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">).</span><span class="nx">Elem</span><span class="p">()</span>
<span class="nx">uType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uTypeElem</span><span class="p">.</span><span class="nx">Type</span><span class="p">()</span><span class="w"> </span><span class="c1">// 等价于：reflect.TypeOf(u)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">uType</span><span class="p">)</span>
</code></pre></div>
<h4 id="75-value">7.5 指针/Value(具体值类型)互转<a class="headerlink" href="#75-value" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">u</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;chc&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="c1">// 反射获取Name的值</span>
<span class="w">    </span><span class="nx">uValue</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span>
<span class="w">    </span><span class="nx">uValueElem</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uValue</span><span class="p">.</span><span class="nx">Elem</span><span class="p">()</span><span class="w">                           </span><span class="c1">// 指针转Value</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">uValueElem</span><span class="p">.</span><span class="nx">Type</span><span class="p">(),</span><span class="w"> </span><span class="nx">uValueElem</span><span class="p">.</span><span class="nx">Kind</span><span class="p">())</span><span class="w">     </span><span class="c1">// main.User struct</span>
<span class="w">    </span><span class="nx">uPointerAddr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uValueElem</span><span class="p">.</span><span class="nx">Addr</span><span class="p">()</span><span class="w">                     </span><span class="c1">// Value转指针</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">uPointerAddr</span><span class="p">.</span><span class="nx">Type</span><span class="p">(),</span><span class="w"> </span><span class="nx">uPointerAddr</span><span class="p">.</span><span class="nx">Kind</span><span class="p">())</span><span class="w"> </span><span class="c1">// *main.User ptr</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="76-reflectvalue">7.6 reflect.Value与具体类型互转<a class="headerlink" href="#76-reflectvalue" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">u</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;chc&quot;</span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 情况一：对值操作</span>
<span class="w">    </span><span class="c1">// User 转为 reflect.Value</span>
<span class="w">    </span><span class="nx">uValue</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span><span class="w"> </span><span class="c1">// reflect.TypeOf(uValue) = reflect.Value -&gt; 反射包装器本身类型</span>
<span class="w">    </span><span class="c1">// reflect.Value 转为 User</span>
<span class="w">    </span><span class="nx">uNew</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uValue</span><span class="p">.</span><span class="nx">Interface</span><span class="p">().(</span><span class="nx">User</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// 比较</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">DeepEqual</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="nx">uNew</span><span class="p">))</span><span class="w"> </span><span class="c1">// true（内容相同）</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">uNew</span><span class="p">)</span><span class="w">                </span><span class="c1">// false（内存地址不同）</span>

<span class="w">    </span><span class="c1">// 情况2：对指针操作</span>
<span class="w">    </span><span class="c1">// *User 转为 reflect.Value</span>
<span class="w">    </span><span class="nx">ptrValue</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span><span class="w"> </span><span class="c1">// reflect.TypeOf(uValue) = reflect.Value -&gt; 反射包装器本身类型</span>
<span class="w">    </span><span class="c1">// reflect.Value 转为 *User</span>
<span class="w">    </span><span class="nx">ptrNew</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ptrValue</span><span class="p">.</span><span class="nx">Interface</span><span class="p">().(</span><span class="o">*</span><span class="nx">User</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">DeepEqual</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">ptrNew</span><span class="p">))</span><span class="w"> </span><span class="c1">// true（内容相同）</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">ptrNew</span><span class="p">)</span><span class="w">                  </span><span class="c1">// true（指针地址相同）</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="77">7.7 空类型空指针与有类型空指针<a class="headerlink" href="#77" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="c1">// 空接口没有指向具体的类型 -- 可以认为：空类型空指针</span>
<span class="w">    </span><span class="nx">iType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">iType</span><span class="p">)</span><span class="w">                         </span><span class="c1">// &lt;invalid reflect.Value&gt;</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">iType</span><span class="p">.</span><span class="nx">IsValid</span><span class="p">(),</span><span class="w"> </span><span class="nx">iType</span><span class="p">.</span><span class="nx">Kind</span><span class="p">())</span><span class="w"> </span><span class="c1">// 是否有效的：fase；基础数据类型：invalid</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">Repeat</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">))</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">nil</span><span class="w">                 </span><span class="c1">// 有类型的空指针</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">u</span><span class="p">))</span><span class="w"> </span><span class="c1">// &lt;nil&gt; *main.User</span>
<span class="w">    </span><span class="nx">uValue</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">uValue</span><span class="p">)</span><span class="w">                                          </span><span class="c1">// &lt;nil&gt;</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">uValue</span><span class="p">.</span><span class="nx">IsValid</span><span class="p">(),</span><span class="w"> </span><span class="nx">uValue</span><span class="p">.</span><span class="nx">Kind</span><span class="p">(),</span><span class="w"> </span><span class="nx">uValue</span><span class="p">.</span><span class="nx">IsNil</span><span class="p">())</span><span class="w"> </span><span class="c1">// 是否有效的：true；基础数据类型：ptr；值是不是nil：true</span>
<span class="w">    </span><span class="c1">// 为nil；比如做操作会报错（nil.Call） -&gt; 空指针异常</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="78">7.8 判断是否零值对象<a class="headerlink" href="#78" title="Permanent link">&para;</a></h4>
<p>判断是否零值对象之前，尽量先判断是否有效（IsValid）；避免异常</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">vi</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">IsValid</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">vi</span><span class="p">.</span><span class="nx">IsZero</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;vi变量是无效的！无法判断是否零值对象~&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">u</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">User</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">vu</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">vu</span><span class="p">.</span><span class="nx">IsValid</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">vu</span><span class="p">.</span><span class="nx">IsZero</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;vi变量是无效的！无法判断是否零值对象~&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="79">7.9 借助反射批量或单个调用函数<a class="headerlink" href="#79" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;reflect&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">hobbys</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">Age</span><span class="w">    </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;age&quot;`</span>
<span class="w">    </span><span class="nx">Gender</span><span class="w"> </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;gender&quot;`</span>
<span class="w">    </span><span class="nx">Person</span><span class="w"> </span><span class="s">`json:&quot;person&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">StringInfo</span><span class="p">(</span><span class="nx">end</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Hobbys:%v%v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">hobbys</span><span class="p">,</span><span class="w"> </span><span class="nx">end</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">ShowInfo</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;ShowInfo:%v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">u</span><span class="w"> </span><span class="nx">User</span>
<span class="w">    </span><span class="c1">// 使用反射获取且调用User里面全部方法</span>
<span class="w">    </span><span class="nx">uValue</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">uValue</span><span class="p">.</span><span class="nx">NumMethod</span><span class="p">();</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uValue</span><span class="p">.</span><span class="nx">Method</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">        </span><span class="nx">prams</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Value</span><span class="p">{</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="s">&quot;_XXX&quot;</span><span class="p">)}</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">method</span><span class="p">.</span><span class="nx">Call</span><span class="p">(</span><span class="nx">prams</span><span class="p">))</span><span class="w"> </span><span class="c1">// [ShowInfo:_XXX] \n [Hobbys:[]_XXX]  -- 循环调用全部函数</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 只获取且调用某个方法</span>
<span class="w">    </span><span class="nx">results</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uValue</span><span class="p">.</span><span class="nx">MethodByName</span><span class="p">(</span><span class="s">&quot;StringInfo&quot;</span><span class="p">).</span><span class="nx">Call</span><span class="p">([]</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Value</span><span class="p">{</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="s">&quot;_ZZZZZZZ&quot;</span><span class="p">)})</span>
<span class="w">    </span><span class="c1">// 返回结果results里面的元素每个都是reflect.Value类型；需要转回原来结构体具体需要的类型</span>
<span class="w">    </span><span class="nx">srcValue</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Interface</span><span class="p">().(</span><span class="kt">string</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="nx">srcValue</span><span class="p">))</span><span class="w"> </span><span class="c1">// [Hobbys:[]_ZZZZZZZ] reflect.Value string</span>
<span class="p">}</span>
</code></pre></div>
<p>注意：运行时获取函数名，使用的是Type()/TypeOf()</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">u</span><span class="w"> </span><span class="nx">User</span>
<span class="w">    </span><span class="c1">// 使用反射获取且调用User里面全部方法</span>
<span class="w">    </span><span class="nx">uValue</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span>
<span class="w">    </span><span class="nx">uType</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uValue</span><span class="p">.</span><span class="nx">Type</span><span class="p">()</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">uValue</span><span class="p">.</span><span class="nx">NumMethod</span><span class="p">();</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uValue</span><span class="p">.</span><span class="nx">Method</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">        </span><span class="nx">methodName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uType</span><span class="p">.</span><span class="nx">Method</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">Name</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;函数对象: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="p">)</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;方法名: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">methodName</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_15">📚 测试相关<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<p>Go语言内置了强大的测试框架，使得编写单元测试变得简单高效。</p>
<h3 id="1_14">1 基本结构<a class="headerlink" href="#1_14" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>测试文件必须以<code>_test.go</code>结尾</strong></p>
</li>
<li>
<p>测试文件会被<code>go text</code>识别，不会被<code>go build</code>识别</p>
</li>
<li>
<p>测试文件与被测试文件必须在一个包当中</p>
</li>
<li>
<p><strong>测试函数签名</strong></p>
</li>
<li>
<p>单元测试：t *testing.T</p>
</li>
<li>基准测试：b *testing.B</li>
<li>模糊测试：f *testing.F</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestXxx</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span>

<span class="c1">// 函数名以`Test`开头</span>
<span class="c1">// `Xxx`部分首字母必须大写</span>
<span class="c1">// 接收`*testing.T`参数</span>
</code></pre></div>
<ul>
<li><strong>运行测试命令</strong></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 运行当前包的所有测试</span>
go<span class="w"> </span><span class="nb">test</span>

<span class="c1"># 显示详细测试信息</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v

<span class="c1"># 设置超时</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v<span class="w"> </span>-timeout<span class="w"> </span>5s

<span class="c1"># 设置用例测试次数</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v<span class="w"> </span>-count<span class="w"> </span><span class="m">3</span>

<span class="c1"># 运行特定测试函数</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v<span class="w"> </span>-run<span class="w"> </span>TestAdd

<span class="c1"># 运行包含&quot;Add&quot;的测试函数</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v<span class="w"> </span>-run<span class="w"> </span>Add

<span class="c1"># 显示测试覆盖率</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-cover

<span class="c1"># 生成覆盖率报告</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-coverprofile<span class="o">=</span>coverage.out
go<span class="w"> </span>tool<span class="w"> </span>cover<span class="w"> </span>-html<span class="o">=</span>coverage.out

<span class="c1"># 基准测试</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-bench
</code></pre></div>
<h3 id="2_13">2 单元测试<a class="headerlink" href="#2_13" title="Permanent link">&para;</a></h3>
<p>目录结构：</p>
<div class="highlight"><pre><span></span><code>project/
├──<span class="w"> </span>testcases/
│<span class="w">   </span>└──<span class="w"> </span>generics_test.go<span class="w"> </span><span class="c1"># 测试代码</span>
├──<span class="w"> </span>generics/
│<span class="w">   </span>├──<span class="w"> </span>generics.go<span class="w">      </span><span class="c1"># 泛型实现代码</span>
└──<span class="w"> </span>go.mod<span class="w">               </span><span class="c1"># 模块文件</span>
</code></pre></div>
<p>用例编写示例（表驱动法）：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;testing&quot;</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestRun</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tests</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="p">}{</span>
<span class="w">        </span><span class="c1">// TODO: Add test cases.</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;泛型相关功能函数测试&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Run</span><span class="p">()</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3-table-driven">3 表驱动法（Table Driven）<a class="headerlink" href="#3-table-driven" title="Permanent link">&para;</a></h3>
<p>上面的例子中已经用到了表驱动法创建用例，一般点击函数，右键选择生成即可有此格式代码文件生成；</p>
<p><strong>Table Driven</strong>主要包含三个部分内容：</p>
<ul>
<li><strong>测试用例定义</strong>：即每一个测试用例需要有什么</li>
<li><strong>具体的测试用例</strong>：设计的每一个测试用例都在这里</li>
<li><strong>执行测试用例</strong>：包括测试用例的断言</li>
</ul>
<h3 id="4_7">4 测试辅助函数<a class="headerlink" href="#4_7" title="Permanent link">&para;</a></h3>
<p>使用<code>t.Helper()</code>标记辅助函数，这样在错误报告中会跳过这些函数；</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">assertEqual</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">expected</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">Helper</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">expected</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;expected %d, got %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">expected</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestWithHelper</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">assertEqual</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assertEqual</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">Multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>如上面的测试用例：测试发生错误后，并不会输出 assertEqualha 函数的调用信息，而是显示错误位置在 TestWithHelper 中，这也有个好处，当有多个测试函数调用helper函数时，可以准确的知道发生错误的是哪个测试函数；但也要注意，当在辅助函数内部发生错误，可以将t.Helper()去掉，再去排查问题。</p>
<h3 id="5-benchmark">5 基准测试 (Benchmark)<a class="headerlink" href="#5-benchmark" title="Permanent link">&para;</a></h3>
<p>以<strong>Benchmark</strong> 开头的测试函数为基准测试函数，用于测试一段程序运行时的性能。</p>
<p><strong>参数：(b *testing.B)</strong></p>
<p>默认不会开启基准测试，需要开启基准测试，各个场景运行命令如下：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 参数需要跟一个目录</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v<span class="w"> </span>-bench<span class="o">=</span>.

<span class="c1"># ---其他参数----</span>
-cpu<span class="o">=</span><span class="m">10</span><span class="w">  </span><span class="c1"># 指定使用cup核心数</span>
-benchtime<span class="o">=</span>1000x<span class="w">  </span><span class="c1"># 指定执行次数1000次</span>
-benchmem<span class="w">  </span><span class="c1"># 显示内存占用信息 B/op：每次操作分配内存字节数；allocs/op：每次操作分配内存的次数</span>
</code></pre></div>
<p>示例：测试Sprintf函数与strconv.Formatint函数将int数字转为字符串性能对比</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;strconv&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">BenchmarkSprintf</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">ResetTimer</span><span class="p">()</span><span class="w"> </span><span class="c1">// 重置计时器，保证只记录到主要测试部分的性能数据</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">BenchmarkItoa</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">ResetTimer</span><span class="p">()</span><span class="w"> </span><span class="c1">// 重置计时器，保证只记录到主要测试部分的性能数据</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">BenchmarkFormatInt</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">ResetTimer</span><span class="p">()</span><span class="w"> </span><span class="c1">// 重置计时器，保证只记录到主要测试部分的性能数据</span>

<span class="w">    </span><span class="c1">// b.StopTimer() // 停止计时器</span>
<span class="w">    </span><span class="c1">// time.Sleep(5 * time.Second)  // 这里耗时不会加入计时</span>
<span class="w">    </span><span class="c1">// b.StartTimer() // 重新开启计时器</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">FormatInt</span><span class="p">(</span><span class="nb">int64</span><span class="p">(</span><span class="nx">num</span><span class="p">),</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">测试结果：</span>

<span class="cm">...\goteststdy&gt;go test -v -bench .</span>
<span class="cm">goos: windows</span>
<span class="cm">goarch: amd64</span>
<span class="cm">pkg: goteststdy</span>
<span class="cm">cpu: 12th Gen Intel(R) Core(TM) i5-12500</span>
<span class="cm">BenchmarkSprintf</span>
<span class="cm">BenchmarkSprintf-12             29605725                38.11 ns/op</span>
<span class="cm">BenchmarkItoa</span>
<span class="cm">BenchmarkItoa-12                942932173                1.273 ns/op</span>
<span class="cm">BenchmarkFormatInt</span>
<span class="cm">BenchmarkFormatInt-12           952647087                1.278 ns/op</span>
<span class="cm">PASS</span>
<span class="cm">ok      goteststdy      4.439s</span>
<span class="cm">*/</span>
</code></pre></div>
<p>关于基准测试的计时器有三种操作（注意停止/重新开启一般在循环中使用，且与<strong>b.N</strong>循环使用）：</p>
<ul>
<li><strong>b.ResetTimer()</strong> - 重置计时</li>
<li><strong>b.StopTimer()</strong> - 停止计时（可以重新开启）</li>
<li><strong>b.StartTimer()</strong> - 重新开始计时</li>
</ul>
<h3 id="6-go118">6 模糊测试（Go1.18+）<a class="headerlink" href="#6-go118" title="Permanent link">&para;</a></h3>
<p><strong>模糊测试</strong>：就是将一些非预期的输入并监测异常结果来发现问题，Go1.18+版本已经将模糊测试加入了标准库。</p>
<p><strong>参数：(f *testing.F)</strong></p>
<p>默认不会开启模糊测试，需要开启模糊测试命令如下：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 参数需要跟一个目录</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v<span class="w"> </span>-fuzz<span class="o">=</span>.
</code></pre></div>
<p>示例：除数不能为0</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 功能函数</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Div</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;testing&quot;</span>

<span class="c1">// 模糊测试</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">FuzzRun</span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">F</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">targetFunc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Div</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">f</span><span class="p">.</span><span class="nx">Fuzz</span><span class="p">(</span><span class="nx">targetFunc</span><span class="p">)</span><span class="w"> </span><span class="c1">// 模糊测试嵌入单元测试 - 自动生成多组测试数据</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="fmtstrconvstringsjsonbytes">📚 内置包：fmt/strconv/strings/json/bytes<a class="headerlink" href="#fmtstrconvstringsjsonbytes" title="Permanent link">&para;</a></h2>
<h3 id="1-fmt-io">1 fmt 包 - 格式化I/O<a class="headerlink" href="#1-fmt-io" title="Permanent link">&para;</a></h3>
<h4 id="11_1">1.1 格式化输出<a class="headerlink" href="#11_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w">                 </span><span class="c1">// 标准输出，不换行</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w">               </span><span class="c1">// 标准输出，自动换行</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w">  </span><span class="c1">// 格式化输出</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="c1">// 返回格式化字符串</span>
</code></pre></div>
<h4 id="12_1">1.2 格式化输入<a class="headerlink" href="#12_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">fmt</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w">                  </span><span class="c1">// 从标准输入读取</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Scanf</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w">  </span><span class="c1">// 格式化读取</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Scanln</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w">                </span><span class="c1">// 读取一行</span>
</code></pre></div>
<h4 id="13_1">1.3 其他<a class="headerlink" href="#13_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w">  </span><span class="c1">// 返回error类型</span>
</code></pre></div>
<h3 id="2-strconv-">2 strconv 包 - 字符串转换<a class="headerlink" href="#2-strconv-" title="Permanent link">&para;</a></h3>
<h4 id="21">2.1 字符串与基本类型转换<a class="headerlink" href="#21" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">strconv</span><span class="p">.</span><span class="nx">Atoi</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w">         </span><span class="c1">// 字符串转int</span>
<span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w">                  </span><span class="c1">// int转字符串</span>

<span class="nx">strconv</span><span class="p">.</span><span class="nx">ParseBool</span><span class="p">(</span><span class="nx">str</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="c1">// 字符串转bool</span>
<span class="nx">strconv</span><span class="p">.</span><span class="nx">FormatBool</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w">           </span><span class="c1">// bool转字符串</span>

<span class="nx">strconv</span><span class="p">.</span><span class="nx">ParseFloat</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">bitSize</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">float64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="c1">// 字符串转float</span>
<span class="nx">strconv</span><span class="p">.</span><span class="nx">FormatFloat</span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="kt">float64</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="w"> </span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">prec</span><span class="p">,</span><span class="w"> </span><span class="nx">bitSize</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="c1">// float转字符串</span>

<span class="nx">strconv</span><span class="p">.</span><span class="nx">ParseInt</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">base</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">bitSize</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="c1">// 字符串转int</span>
<span class="nx">strconv</span><span class="p">.</span><span class="nx">FormatInt</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="nx">base</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="c1">// int转字符串</span>
</code></pre></div>
<h4 id="22_1">2.2 其他转换<a class="headerlink" href="#22_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">strconv</span><span class="p">.</span><span class="nx">Quote</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w">              </span><span class="c1">// 添加双引号</span>
<span class="nx">strconv</span><span class="p">.</span><span class="nx">Unquote</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w">   </span><span class="c1">// 去除引号</span>
</code></pre></div>
<h3 id="3-strings-">3 strings 包 - 字符串操作<a class="headerlink" href="#3-strings-" title="Permanent link">&para;</a></h3>
<h4 id="31_1">3.1 字符串查询<a class="headerlink" href="#31_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">substr</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w">     </span><span class="c1">// 是否包含子串</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">HasPrefix</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">prefix</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w">     </span><span class="c1">// 是否有前缀</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">HasSuffix</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">suffix</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w">     </span><span class="c1">// 是否有后缀</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">substr</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w">         </span><span class="c1">// 子串首次出现位置</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">LastIndex</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">substr</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w">     </span><span class="c1">// 子串最后出现位置</span>
</code></pre></div>
<h4 id="32_1">3.2 字符串操作<a class="headerlink" href="#32_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">strings</span><span class="p">.</span><span class="nx">ToLower</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w">            </span><span class="c1">// 转小写</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">ToUpper</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w">            </span><span class="c1">// 转大写</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Trim</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">cutset</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w">       </span><span class="c1">// 去除两端字符</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">TrimSpace</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w">          </span><span class="c1">// 去除两端空白</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">old</span><span class="p">,</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="c1">// 替换</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">sep</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="w">       </span><span class="c1">// 分割字符串</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">elems</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">sep</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="c1">// 连接字符串</span>
</code></pre></div>
<h4 id="33_1">3.3 其他<a class="headerlink" href="#33_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">strings</span><span class="p">.</span><span class="nx">Repeat</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w">  </span><span class="c1">// 重复字符串</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">Count</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">substr</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w">         </span><span class="c1">// 子串出现次数</span>
<span class="nx">strings</span><span class="p">.</span><span class="nx">EqualFold</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w">         </span><span class="c1">// 不区分大小写比较</span>
</code></pre></div>
<h3 id="4-encodingjson-json">4 encoding/json 包 - JSON处理<a class="headerlink" href="#4-encodingjson-json" title="Permanent link">&para;</a></h3>
<h4 id="41_1">4.1 编码(序列化)<a class="headerlink" href="#41_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="c1">// 结构体转JSON</span>
<span class="nx">json</span><span class="p">.</span><span class="nx">MarshalIndent</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">prefix</span><span class="p">,</span><span class="w"> </span><span class="nx">indent</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="c1">// 带缩进的JSON</span>
</code></pre></div>
<h4 id="42_2">4.2 解码(反序列化)<a class="headerlink" href="#42_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="c1">// JSON转结构体</span>
</code></pre></div>
<h4 id="43_2">4.3 流式处理<a class="headerlink" href="#43_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">json</span><span class="p">.</span><span class="nx">NewEncoder</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">json</span><span class="p">.</span><span class="nx">Encoder</span><span class="w">  </span><span class="c1">// 创建编码器</span>
<span class="nx">json</span><span class="p">.</span><span class="nx">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Reader</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">json</span><span class="p">.</span><span class="nx">Decoder</span><span class="w">  </span><span class="c1">// 创建解码器</span>
</code></pre></div>
<h4 id="44">4.4 其他<a class="headerlink" href="#44" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">json</span><span class="p">.</span><span class="nx">Valid</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w">                </span><span class="c1">// 检查JSON是否有效</span>
</code></pre></div>
<h4 id="45">4.5 实际应用测试<a class="headerlink" href="#45" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm">encoding/json 包序列化与反序列化</span>
<span class="cm">*/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span><span class="w"> </span><span class="c1">// 首字母必须大写，序列化才会读取到，若需要序列化后改为小写或其他，就按格式写标签</span>
<span class="w">    </span><span class="nx">Age</span><span class="w">    </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;age&quot;`</span>
<span class="w">    </span><span class="nx">Gender</span><span class="w"> </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;gender&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">show</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;我是一个结构体，正在执行内部方法...&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">slice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">        </span><span class="s">&quot;压力山大&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="mf">3.14</span><span class="p">,</span>
<span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nx">Person</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;chc&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="nx">Gender</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// 序列化：字节切片类型-&gt;字符串类型</span>
<span class="w">    </span><span class="nx">marshal</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">slice</span><span class="p">)</span>
<span class="w">    </span><span class="nx">marshalStr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">marshal</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">marshalStr</span><span class="p">)</span><span class="w"> </span><span class="c1">// `[&quot;压力山大&quot;,5,true,3.14,[&quot;a&quot;,&quot;b&quot;],{&quot;1&quot;:&quot;a&quot;,&quot;2&quot;:&quot;b&quot;},{&quot;name&quot;:&quot;chc&quot;,&quot;age&quot;:18,&quot;gender&quot;:true}]`</span>

<span class="w">    </span><span class="c1">// 反序列化 -&gt; 切片</span>
<span class="w">    </span><span class="nx">newSlice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">marshalStr</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">newSlice</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// 注意：转换默认键值对类型对应是map，不是结构体，如需要，则进一步处理</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">newSlice</span><span class="p">)</span><span class="w"> </span><span class="c1">// [压力山大 5 true 3.14 [a b] map[1:a 2:b] map[age:18 gender:true name:chc]]</span>

<span class="w">    </span><span class="c1">// 获取反序列化的最有一个map元素</span>
<span class="w">    </span><span class="nx">dataMap</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">newSlice</span><span class="p">[</span><span class="mi">6</span><span class="p">].(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="c1">// .() -&gt; 表示类型断言，这里还是map类型</span>
<span class="w">    </span><span class="nx">dm</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">dataMap</span><span class="p">)</span><span class="w">                  </span><span class="c1">// 字节切片</span>

<span class="w">    </span><span class="c1">// map 转 结构体， 需要借助json序列化为字节切片再辅助转为对应结构体对象</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">person</span><span class="w"> </span><span class="nx">Person</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">dm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">person</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">person</span><span class="p">)</span>
<span class="w">    </span><span class="nx">person</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="5-bytes">5 bytes 包<a class="headerlink" href="#5-bytes" title="Permanent link">&para;</a></h3>
<p>Go 语言中的 <code>bytes</code> 包。这是一个极其重要且常用的包，主要用于操作字节切片（<code>[]byte</code>）。</p>
<h4 id="51-strings">5.1 常用函数（对标 strings 包）<a class="headerlink" href="#51-strings" title="Permanent link">&para;</a></h4>
<p>这些函数大多直接对 <code>[]byte</code> 进行操作，并返回处理后的新 <code>[]byte</code>。</p>
<h5 id="511">5.1.1 比较与判断<a class="headerlink" href="#511" title="Permanent link">&para;</a></h5>
<ul>
<li><code>func Compare(a, b []byte) int</code>： 比较两个字节切片，返回 <code>0</code>(a==b), <code>-1</code>(a &lt; b), <code>1</code>(a &gt; b)。</li>
<li><code>func Equal(a, b []byte) bool</code>： 更简单地判断两个字节切片是否相等。</li>
<li><code>func HasPrefix(s, prefix []byte) bool</code>： 判断字节切片 <code>s</code> 是否以 <code>prefix</code> 开头。</li>
<li><code>func Contains(b, subslice []byte) bool</code>： 判断 <code>b</code> 中是否包含子切片 <code>subslice</code>。</li>
</ul>
<h5 id="512">5.1.2 查找与定位<a class="headerlink" href="#512" title="Permanent link">&para;</a></h5>
<ul>
<li><code>func Index(b, sep []byte) int</code>： 返回 <code>sep</code> 在 <code>b</code> 中第一次出现的索引，未找到返回 <code>-1</code>。</li>
<li><code>func LastIndex(b, sep []byte) int</code>： 返回最后一次出现的索引。</li>
<li><code>func IndexAny(b []byte, chars string) int</code>： 返回 <code>chars</code> 中任何一个字符第一次出现的索引。</li>
</ul>
<h5 id="513">5.1.3 操作与转换<a class="headerlink" href="#513" title="Permanent link">&para;</a></h5>
<ul>
<li><code>func Split(s, sep []byte) [][]byte</code>： 用 <code>sep</code> 分割 <code>s</code>，返回一个切片组成的切片。</li>
<li><code>func Join(s [][]byte, sep []byte) []byte</code>： 用 <code>sep</code> 连接 <code>s</code> 中的多个 <code>[]byte</code>。</li>
<li><code>func Repeat(b []byte, count int) []byte</code>： 将 <code>b</code> 重复 <code>count</code> 次后返回。</li>
<li><code>func Replace(s, old, new []byte, n int) []byte</code>： 将 <code>s</code> 中的前 <code>n</code> 个 <code>old</code> 替换为 <code>new</code>。<code>n</code> 为 <code>-1</code> 时替换所有。</li>
<li><code>func ToUpper(s []byte) []byte</code>： 将所有字节转换为大写（仅对 ASCII 有效）。</li>
<li><code>func ToLower(s []byte) []byte</code>： 将所有字节转换为小写。</li>
<li><code>func Trim(s []byte, cutset string) []byte</code>： 去除 <code>s</code> 首尾包含在 <code>cutset</code> 字符集中的所有字符。</li>
</ul>
<h4 id="52-bytesbuffer">5.2 bytes.Buffer<a class="headerlink" href="#52-bytesbuffer" title="Permanent link">&para;</a></h4>
<p><code>bytes.Buffer</code> 是 <code>bytes</code> 包的灵魂，它是一个结构体，零值 (<code>var b bytes.Buffer</code>) 就是一个立即可用的空缓冲区。</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Buffer</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">buf</span><span class="w">      </span><span class="p">[]</span><span class="kt">byte</span><span class="w"> </span><span class="c1">// contents are the bytes buf[off : len(buf)]</span>
<span class="w">    </span><span class="nx">off</span><span class="w">      </span><span class="kt">int</span><span class="w">    </span><span class="c1">// read at &amp;buf[off], write at &amp;buf[len(buf)]</span>
<span class="w">    </span><span class="nx">lastRead</span><span class="w"> </span><span class="nx">readOp</span><span class="w"> </span><span class="c1">// last read operation, so that Unread* can work correctly.</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong><code>[]byte</code> (字节切片)</strong>： 本质是一个字节数组，是 Go 语言中表示二进制数据、文本数据（与 <code>string</code> 可相互转换）的常用形式。</li>
<li><strong><code>bytes.Buffer</code></strong>： 一个<strong>可变大小</strong>的字节缓冲区。它集读、写功能于一身，内部封装了一个 <code>[]byte</code>，并提供了非常高效的方法来操作它。它是处理字节拼接、缓存等任务的利器。</li>
</ul>
<h5 id="521-buffer">5.2.1 创建 Buffer<a class="headerlink" href="#521-buffer" title="Permanent link">&para;</a></h5>
<ul>
<li><code>var b bytes.Buffer</code>： 直接声明，初始为空。</li>
<li><code>b := bytes.NewBufferString("Hello")</code>： 根据字符串创建。</li>
<li><code>b := bytes.NewBuffer([]byte{0x01, 0x02})</code>： 根据已有的 <code>[]byte</code> 创建。</li>
</ul>
<h5 id="522-write">5.2.2 写入数据 (Write)<a class="headerlink" href="#522-write" title="Permanent link">&para;</a></h5>
<p><code>Buffer</code> 实现了多个 <code>Write</code> 开头的接口，非常方便。</p>
<ul>
<li><code>func (b *Buffer) Write(p []byte) (n int, err error)</code>： 实现了 <code>io.Writer</code> 接口，写入字节切片。</li>
<li><code>func (b *Buffer) WriteString(s string) (n int, err error)</code>： 直接写入字符串，<strong>避免 <code>[]byte</code> 转换，效率更高</strong>。</li>
<li><code>func (b *Buffer) WriteByte(c byte) error</code>： 写入单个字节。</li>
<li><code>func (b *Buffer) WriteRune(r rune) (n int, err error)</code>： 写入一个 Unicode 字符（如中文）。</li>
</ul>
<h5 id="523-read">5.2.3 读取数据 (Read)<a class="headerlink" href="#523-read" title="Permanent link">&para;</a></h5>
<p><code>Buffer</code> 也实现了多个 <code>Read</code> 开头的接口。</p>
<ul>
<li><code>func (b *Buffer) Read(p []byte) (n int, err error)</code>： 实现了 <code>io.Reader</code> 接口，将缓冲区内容读入 <code>p</code>，读出的数据会从缓冲区移除。</li>
<li><code>func (b *Buffer) ReadByte() (byte, error)</code>： 读出一个字节。</li>
<li><code>func (b *Buffer) ReadBytes(delim byte) (line []byte, err error)</code>： 一直读取直到遇到分隔符 <code>delim</code>（常用 <code>\n</code> 来读一行）。</li>
<li><code>func (b *Buffer) ReadString(delim byte) (line string, err error)</code>： 同上，但直接返回字符串。</li>
</ul>
<h5 id="524">5.2.4 其它重要方法<a class="headerlink" href="#524" title="Permanent link">&para;</a></h5>
<ul>
<li><code>func (b *Buffer) String() string</code>： 将缓冲区的内容以 <code>string</code> 形式返回，非常常用。</li>
<li><code>func (b *Buffer) Bytes() []byte</code>： 返回缓冲区未读部分的字节切片。</li>
<li><code>func (b *Buffer) Len() int</code>： 返回未读的字节数。</li>
<li><code>func (b *Buffer) Reset()</code>： 清空缓冲区，重置为空，便于复用。</li>
<li><code>func (b *Buffer) Grow(n int)</code>： 预先分配 <code>n</code> 字节的内存空间，避免多次写入时重复分配，<strong>性能优化关键</strong>。</li>
</ul>
<h2 id="timeflagregexp">📚 内置包：time/flag/regexp<a class="headerlink" href="#timeflagregexp" title="Permanent link">&para;</a></h2>
<h3 id="1-time">1 time 包<a class="headerlink" href="#1-time" title="Permanent link">&para;</a></h3>
<h4 id="11_2">1.1 时间获取与显示<a class="headerlink" href="#11_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">now</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span><span class="w">           </span><span class="c1">// 获取当前时间</span>
<span class="nx">year</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Year</span><span class="p">()</span><span class="w">         </span><span class="c1">// 年</span>
<span class="nx">month</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Month</span><span class="p">()</span><span class="w">       </span><span class="c1">// 月</span>
<span class="nx">day</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Day</span><span class="p">()</span><span class="w">           </span><span class="c1">// 日</span>
<span class="nx">hour</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Hour</span><span class="p">()</span><span class="w">         </span><span class="c1">// 小时</span>
<span class="nx">minute</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Minute</span><span class="p">()</span><span class="w">     </span><span class="c1">// 分钟</span>
<span class="nx">second</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Second</span><span class="p">()</span><span class="w">     </span><span class="c1">// 秒</span>
<span class="nx">nanosecond</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Nanosecond</span><span class="p">()</span><span class="w"> </span><span class="c1">// 纳秒</span>
<span class="nx">weekday</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Weekday</span><span class="p">()</span><span class="w">   </span><span class="c1">// 星期几</span>
</code></pre></div>
<h4 id="12_2">1.2 时间与字符串之间转换<a class="headerlink" href="#12_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 格式化时间</span>
<span class="nx">now</span><span class="p">.</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;2006-01-02 15:04:05&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// ```go的格式化时间必须使用2006-01-02 15:04:05这个时间点 / 这个常量也可以：time.DateTime</span>

<span class="c1">// 字符串转时间</span>
<span class="nx">targetTIme</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">DateTime</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2023-07-18 19:00:00&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="13_2">1.3 时间计算与比较<a class="headerlink" href="#13_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 时间加减</span>
<span class="nx">later</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Hour</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">      </span><span class="c1">// 2小时后</span>
<span class="nx">earlier</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="o">-</span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="c1">// 30分钟前</span>

<span class="c1">// 时间差</span>
<span class="nx">duration</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">later</span><span class="p">.</span><span class="nx">Sub</span><span class="p">(</span><span class="nx">now</span><span class="p">)</span><span class="w">  </span><span class="c1">// 返回Duration类型</span>
<span class="nx">hours</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">duration</span><span class="p">.</span><span class="nx">Hours</span><span class="p">()</span><span class="w">   </span><span class="c1">// 相差小时数</span>
<span class="nx">minutes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">duration</span><span class="p">.</span><span class="nx">Minutes</span><span class="p">()</span><span class="w"> </span><span class="c1">// 相差分钟数</span>

<span class="c1">// 时间比较</span>
<span class="nx">isAfter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">After</span><span class="p">(</span><span class="nx">earlier</span><span class="p">)</span><span class="w">  </span><span class="c1">// true</span>
<span class="nx">isBefore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Before</span><span class="p">(</span><span class="nx">later</span><span class="p">)</span><span class="w">  </span><span class="c1">// true</span>
<span class="nx">isEqual</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">now</span><span class="p">)</span><span class="w">      </span><span class="c1">// true</span>
</code></pre></div>
<h4 id="14_1">1.4 定时器与休眠<a class="headerlink" href="#14_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 休眠</span>
<span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 休眠2秒</span>

<span class="c1">// 定时器</span>
<span class="nx">timer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">NewTimer</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="o">&lt;-</span><span class="nx">timer</span><span class="p">.</span><span class="nx">C</span><span class="w"> </span><span class="c1">// 3秒后触发</span>

<span class="c1">// Ticker</span>
<span class="nx">ticker</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">NewTicker</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="k">for</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">ticker</span><span class="p">.</span><span class="nx">C</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Tick at&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// 需要手动停止，否则会一直执行</span>
<span class="w">    </span><span class="nx">ticker</span><span class="p">.</span><span class="nx">Stop</span><span class="p">()</span>
<span class="w">    </span><span class="k">break</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="15">1.5 获取时间戳<a class="headerlink" href="#15" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 获取各种精度的时间戳</span>
<span class="nx">sec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">Unix</span><span class="p">()</span><span class="w">        </span><span class="c1">// 秒</span>
<span class="nx">milli</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">UnixMilli</span><span class="p">()</span><span class="w"> </span><span class="c1">// 毫秒</span>
<span class="nx">micro</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">UnixMicro</span><span class="p">()</span><span class="w"> </span><span class="c1">// 微秒</span>
<span class="nx">nano</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">UnixNano</span><span class="p">()</span><span class="w">   </span><span class="c1">// 纳秒</span>
</code></pre></div>
<h3 id="2-flag">2 flag 包<a class="headerlink" href="#2-flag" title="Permanent link">&para;</a></h3>
<h4 id="21_1">2.1 基本使用<a class="headerlink" href="#21_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 定义flag</span>
<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">port</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">.</span><span class="nx">Int</span><span class="p">(</span><span class="s">&quot;port&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8080</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;server port&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;guest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user name&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">debug</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">.</span><span class="nx">Bool</span><span class="p">(</span><span class="s">&quot;debug&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;enable debug mode&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 解析flag</span>
<span class="w">    </span><span class="nx">flag</span><span class="p">.</span><span class="nx">Parse</span><span class="p">()</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Port:&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">port</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">name</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Debug:&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">debug</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 获取非flag参数</span>
<span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">flag</span><span class="p">.</span><span class="nx">Args</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Other args:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="22-flag">2.2 自定义flag类型<a class="headerlink" href="#22-flag" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 自定义flag类型</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">interval</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">flag</span><span class="p">.</span><span class="nx">DurationVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">interval</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;interval&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;interval duration&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">flag</span><span class="p">.</span><span class="nx">Parse</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Interval:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">interval</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="23_1">2.3 其他方法<a class="headerlink" href="#23_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">flag</span><span class="p">.</span><span class="nx">Usage</span><span class="p">()</span><span class="w"> </span><span class="c1">// 显示用法信息</span>
<span class="nx">flag</span><span class="p">.</span><span class="nx">NFlag</span><span class="p">()</span><span class="w"> </span><span class="c1">// 返回已设置的flag数量</span>
<span class="nx">flag</span><span class="p">.</span><span class="nx">NArg</span><span class="p">()</span><span class="w">  </span><span class="c1">// 返回非flag参数的数量</span>
<span class="nx">flag</span><span class="p">.</span><span class="nx">Arg</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="w">  </span><span class="c1">// 获取第i个非flag参数```</span>
</code></pre></div>
<h3 id="3-regexp-">3 regexp 包 - 正则表达式<a class="headerlink" href="#3-regexp-" title="Permanent link">&para;</a></h3>
<h4 id="31_2">3.1 基本匹配<a class="headerlink" href="#31_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 编译正则表达式</span>
<span class="nx">re</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`\d+`</span><span class="p">)</span><span class="w"> </span><span class="c1">// 匹配数字</span>

<span class="c1">// 检查是否匹配</span>
<span class="nx">matched</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">MatchString</span><span class="p">(</span><span class="s">&quot;123abc&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// true</span>
<span class="nx">matched</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">Match</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">))</span><span class="w">   </span><span class="c1">// false</span>

<span class="c1">// 查找第一个匹配</span>
<span class="nx">first</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">FindString</span><span class="p">(</span><span class="s">&quot;abc123def456&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// &quot;123&quot;</span>

<span class="c1">// 查找所有匹配</span>
<span class="nx">all</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">FindAllString</span><span class="p">(</span><span class="s">&quot;abc123def456&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// [&quot;123&quot;, &quot;456&quot;]</span>
</code></pre></div>
<h4 id="32_2">3.2 分组捕获<a class="headerlink" href="#32_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">re</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`(\d+)-(\d+)`</span><span class="p">)</span>
<span class="nx">str</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;123-456&quot;</span>

<span class="c1">// 提取分组</span>
<span class="nx">matches</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">FindStringSubmatch</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
<span class="c1">// matches[0] = &quot;123-456&quot; (完整匹配)</span>
<span class="c1">// matches[1] = &quot;123&quot; (第一个分组)</span>
<span class="c1">// matches[2] = &quot;456&quot; (第二个分组)</span>

<span class="c1">// 命名分组</span>
<span class="nx">re</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`(?P&lt;year&gt;\d{4})-(?P&lt;month&gt;\d{2})`</span><span class="p">)</span>
<span class="nx">match</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">FindStringSubmatch</span><span class="p">(</span><span class="s">&quot;2023-08&quot;</span><span class="p">)</span>
<span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">SubexpNames</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">match</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="33_2">3.3 替换与分割<a class="headerlink" href="#33_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">re</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`\d+`</span><span class="p">)</span>

<span class="c1">// 替换</span>
<span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">ReplaceAllString</span><span class="p">(</span><span class="s">&quot;abc123def456&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// &quot;abcXdefX&quot;</span>

<span class="c1">// 使用函数替换</span>
<span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">ReplaceAllStringFunc</span><span class="p">(</span><span class="s">&quot;abc123def456&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;]&quot;</span>
<span class="p">})</span><span class="w"> </span><span class="c1">// &quot;abc[123]def[456]&quot;</span>

<span class="c1">// 分割</span>
<span class="nx">parts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">re</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="s">&quot;abc123def456ghi789&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// [&quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;, &quot;&quot;]</span>
</code></pre></div>
<h4 id="34">3.4 其他方法<a class="headerlink" href="#34" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nx">re</span><span class="p">.</span><span class="nx">QuoteMeta</span><span class="p">(</span><span class="s">`.+?`</span><span class="p">)</span><span class="w"> </span><span class="c1">// 返回转义后的正则表达式字符串 `\.\+\?`</span>
<span class="nx">re</span><span class="p">.</span><span class="nx">NumSubexp</span><span class="p">()</span><span class="w">      </span><span class="c1">// 返回正则表达式中的分组数量</span>
<span class="nx">re</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span><span class="w">         </span><span class="c1">// 返回正则表达式的字符串表示</span>
</code></pre></div>
<h2 id="osiofilepath">📚 内置包：文件相关（os/io/filepath...）<a class="headerlink" href="#osiofilepath" title="Permanent link">&para;</a></h2>
<h3 id="1-os">1 os 包<a class="headerlink" href="#1-os" title="Permanent link">&para;</a></h3>
<h4 id="11_3">1.1 文件操作<a class="headerlink" href="#11_3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 打开文件</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Open</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">File</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">flag</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">perm</span><span class="w"> </span><span class="nx">FileMode</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">File</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>

<span class="c1">// 创建文件</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Create</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">File</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>

<span class="c1">// 文件信息</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Stat</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">FileInfo</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Lstat</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">FileInfo</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="c1">// 不跟随符号链接</span>

<span class="c1">// 删除/重命名</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Remove</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w">  </span><span class="c1">// 删除文件夹时，如果文件夹下不为空，会报错</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">RemoveAll</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w">  </span><span class="c1">// 强制删除，删除文件夹时，直接删除该文件夹及全部子文件</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Rename</span><span class="p">(</span><span class="nx">oldpath</span><span class="p">,</span><span class="w"> </span><span class="nx">newpath</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>

<span class="c1">// 权限</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Chmod</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">mode</span><span class="w"> </span><span class="nx">FileMode</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Chown</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">uid</span><span class="p">,</span><span class="w"> </span><span class="nx">gid</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Chtimes</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">atime</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">,</span><span class="w"> </span><span class="nx">mtime</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>

<span class="c1">// 判断是否是文件夹</span>
<span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="s">&quot;/temp/test&quot;</span><span class="p">)</span>
<span class="nx">tf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">IsDir</span><span class="p">()</span><span class="w"> </span><span class="c1">// 返回bool类型</span>

<span class="c1">// 其他</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Truncate</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="kt">int64</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Readlink</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="c1">// 读取符号链接</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Symlink</span><span class="p">(</span><span class="nx">oldname</span><span class="p">,</span><span class="w"> </span><span class="nx">newname</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<h4 id="12_3">1.2 目录操作<a class="headerlink" href="#12_3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">Mkdir</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">perm</span><span class="w"> </span><span class="nx">FileMode</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w">  </span><span class="c1">// 单级目录创建,已存在会报错</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">MkdirAll</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">perm</span><span class="w"> </span><span class="nx">FileMode</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="c1">// 多级目录创建，已存在不会报错</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">ReadDir</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="nx">DirEntry</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="c1">// 替代ioutil.ReadDir</span>
</code></pre></div>
<h4 id="13_3">1.3 文件对象方法<a class="headerlink" href="#13_3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">File</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 未导出字段</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">File</span><span class="p">)</span><span class="w"> </span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">File</span><span class="p">)</span><span class="w"> </span><span class="nx">Read</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">File</span><span class="p">)</span><span class="w"> </span><span class="nx">ReadAt</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">off</span><span class="w"> </span><span class="kt">int64</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">File</span><span class="p">)</span><span class="w"> </span><span class="nx">Write</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">File</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteAt</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">off</span><span class="w"> </span><span class="kt">int64</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">File</span><span class="p">)</span><span class="w"> </span><span class="nx">Seek</span><span class="p">(</span><span class="nx">offset</span><span class="w"> </span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="nx">whence</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">ret</span><span class="w"> </span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">File</span><span class="p">)</span><span class="w"> </span><span class="nx">Sync</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">File</span><span class="p">)</span><span class="w"> </span><span class="nx">Stat</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nx">FileInfo</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<h3 id="2-pathfilepath">2 path/filepath 包<a class="headerlink" href="#2-pathfilepath" title="Permanent link">&para;</a></h3>
<h4 id="21_2">2.1 处理跨平台的文件路径<a class="headerlink" href="#21_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 路径拼接</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Join</span><span class="p">(</span><span class="nx">elem</span><span class="w"> </span><span class="o">...</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>

<span class="c1">// 路径分割</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Split</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Dir</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Base</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Ext</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>

<span class="c1">// 路径清理</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Clean</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">ToSlash</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">FromSlash</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>

<span class="c1">// 绝对路径</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Abs</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Rel</span><span class="p">(</span><span class="nx">basepath</span><span class="p">,</span><span class="w"> </span><span class="nx">targpath</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="c1">////绝对路径示例</span>
<span class="nx">absPath</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="s">&quot;test/src&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// 返回项目目录+入参字符</span>

<span class="c1">// 路径匹配</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Match</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">matched</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Glob</span><span class="p">(</span><span class="nx">pattern</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">matches</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>

<span class="c1">// 遍历目录</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Walk</span><span class="p">(</span><span class="nx">root</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">fn</span><span class="w"> </span><span class="nx">WalkFunc</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">WalkDir</span><span class="p">(</span><span class="nx">root</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">fn</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">WalkDirFunc</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="c1">// 更高效</span>
<span class="c1">////遍历目录示例</span>
<span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Walk</span><span class="p">(</span><span class="nx">projectPath</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">FileInfo</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">info</span><span class="p">.</span><span class="nx">IsDir</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">})</span>

<span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">WalkDir</span><span class="p">(</span><span class="nx">projectPath</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">de</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">DirEntry</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">de</span><span class="p">.</span><span class="nx">IsDir</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">})</span>


<span class="c1">// 获取上一级目录</span>
<span class="nx">filepath</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;/temp/test/src&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 返回:/temp/test</span>
</code></pre></div>
<h3 id="3-io">3 io 包<a class="headerlink" href="#3-io" title="Permanent link">&para;</a></h3>
<h4 id="31-io">3.1 基础IO接口和工具函数<a class="headerlink" href="#31-io" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 基础接口</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Reader</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Read</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Writer</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Write</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Closer</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span>
<span class="p">}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Seeker</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Seek</span><span class="p">(</span><span class="nx">offset</span><span class="w"> </span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="nx">whence</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 组合接口</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ReadWriter</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reader</span><span class="p">;</span><span class="w"> </span><span class="nx">Writer</span><span class="w"> </span><span class="p">}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ReadCloser</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reader</span><span class="p">;</span><span class="w"> </span><span class="nx">Closer</span><span class="w"> </span><span class="p">}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">WriteCloser</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Writer</span><span class="p">;</span><span class="w"> </span><span class="nx">Closer</span><span class="w"> </span><span class="p">}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ReadWriteCloser</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reader</span><span class="p">;</span><span class="w"> </span><span class="nx">Writer</span><span class="p">;</span><span class="w"> </span><span class="nx">Closer</span><span class="w"> </span><span class="p">}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ReadSeeker</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reader</span><span class="p">;</span><span class="w"> </span><span class="nx">Seeker</span><span class="w"> </span><span class="p">}</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ReadSeekCloser</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Reader</span><span class="p">;</span><span class="w"> </span><span class="nx">Seeker</span><span class="p">;</span><span class="w"> </span><span class="nx">Closer</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// 工具函数</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Copy</span><span class="p">(</span><span class="nx">dst</span><span class="w"> </span><span class="nx">Writer</span><span class="p">,</span><span class="w"> </span><span class="nx">src</span><span class="w"> </span><span class="nx">Reader</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">written</span><span class="w"> </span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">CopyN</span><span class="p">(</span><span class="nx">dst</span><span class="w"> </span><span class="nx">Writer</span><span class="p">,</span><span class="w"> </span><span class="nx">src</span><span class="w"> </span><span class="nx">Reader</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="kt">int64</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">written</span><span class="w"> </span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="nx">Reader</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">ReadAtLeast</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="nx">Reader</span><span class="p">,</span><span class="w"> </span><span class="nx">buf</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">min</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">ReadFull</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="nx">Reader</span><span class="p">,</span><span class="w"> </span><span class="nx">buf</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">Writer</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<h3 id="4-iofs">4 io/fs 包<a class="headerlink" href="#4-iofs" title="Permanent link">&para;</a></h3>
<h4 id="41-go-116">4.1 文件系统抽象接口(go 1.16+)<a class="headerlink" href="#41-go-116" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">FS</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Open</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">File</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">File</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Stat</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nx">FileInfo</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="nx">Read</span><span class="p">([]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">FileInfo</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w">       </span><span class="c1">// 文件名</span>
<span class="w">    </span><span class="nx">Size</span><span class="p">()</span><span class="w"> </span><span class="kt">int64</span><span class="w">        </span><span class="c1">// 文件大小</span>
<span class="w">    </span><span class="nx">Mode</span><span class="p">()</span><span class="w"> </span><span class="nx">FileMode</span><span class="w">     </span><span class="c1">// 文件模式</span>
<span class="w">    </span><span class="nx">ModTime</span><span class="p">()</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="c1">// 修改时间</span>
<span class="w">    </span><span class="nx">IsDir</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w">        </span><span class="c1">// 是否是目录</span>
<span class="w">    </span><span class="nx">Sys</span><span class="p">()</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w">   </span><span class="c1">// 底层数据源</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">DirEntry</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">IsDir</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span>
<span class="w">    </span><span class="nx">Type</span><span class="p">()</span><span class="w"> </span><span class="nx">FileMode</span>
<span class="w">    </span><span class="nx">Info</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nx">FileInfo</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_16">📚 文件读写<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h2>
<h3 id="1_15">1 普通读写方式<a class="headerlink" href="#1_15" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">words</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;ZHE是一段bei伤的故事~~啊！&quot;</span>
<span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">words</span><span class="p">)</span>
<span class="w">    </span><span class="nx">totalBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">buf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">     </span><span class="c1">// 缓冲区每次读取4个字节</span>
<span class="w">        </span><span class="nx">n</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span><span class="w"> </span><span class="c1">// 使用缓冲区读取内容；n为每次读取字节数</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;reader对象全部内容读取完毕，n=%v；读取内容：%s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="p">,</span><span class="w"> </span><span class="nx">buf</span><span class="p">)</span>
<span class="w">                </span><span class="k">break</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;本次读取：n=%v；内容：%s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="p">,</span><span class="w"> </span><span class="nx">buf</span><span class="p">)</span>
<span class="w">        </span><span class="nx">totalBytes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">totalBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">buf</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;全部内容：%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">totalBytes</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="12-read">1.2 读取文件内容（Read）<a class="headerlink" href="#12-read" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;io&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">CusReadFile</span><span class="p">(</span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;读取文件错误&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="nx">totalBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">buf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span><span class="w">  </span><span class="c1">// 每次读取缓冲大小</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;file对象读取完毕&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="k">break</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;读取文件失败&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">totalBytes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">totalBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">buf</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">totalBytes</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">contentByte</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">CusReadFile</span><span class="p">(</span><span class="s">&quot;test.txt&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">contentByte</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>当然，一般我们真正读取文件不需要自己重新写带缓冲区的函数，使用现有的bufio包的方法即可：</p>
<p><strong>分行读取：</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">CusReadFile</span><span class="p">(</span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;读取文件错误&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">line</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">ReadLine</span><span class="p">()</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">line</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">CusReadFile</span><span class="p">(</span><span class="s">&quot;djangoServer.log&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>一次性读取（不适合大文件）</strong>：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">CusReadFile</span><span class="p">(</span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;打开文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="nx">stat</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Stat</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;获取文件信息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">buf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">stat</span><span class="p">.</span><span class="nx">Size</span><span class="p">())</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span><span class="w"> </span><span class="c1">// 记录实际读取的字节数</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">CusReadFile</span><span class="p">(</span><span class="s">&quot;djangoServer.log&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">ReadFile</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<h4 id="13-write">1.3 写入文件内容（Write）<a class="headerlink" href="#13-write" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">CusWriteFile</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span><span class="w">  </span><span class="c1">// 关闭文件</span>

<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">content</span><span class="p">))</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">CusWriteFile</span><span class="p">(</span><span class="s">&quot;今晚我要睡你家~&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test.txt&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>直接写入内容便捷函数：os.WriteFile()</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">WriteFile</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">perm</span><span class="w"> </span><span class="nx">FileMode</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<h4 id="14-seeker">1.4 写入文件位置（Seeker）<a class="headerlink" href="#14-seeker" title="Permanent link">&para;</a></h4>
<h5 id="141">1.4.1 文件打开模式<a class="headerlink" href="#141" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">O_RDONLY</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">syscall</span><span class="p">.</span><span class="nx">O_RDONLY</span><span class="w"> </span><span class="c1">// 只读模式</span>
<span class="w">    </span><span class="nx">O_WRONLY</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">syscall</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="w"> </span><span class="c1">// 只写模式</span>
<span class="w">    </span><span class="nx">O_RDWR</span><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">syscall</span><span class="p">.</span><span class="nx">O_RDWR</span><span class="w">   </span><span class="c1">// 读写模式</span>
<span class="w">    </span><span class="nx">O_APPEND</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">syscall</span><span class="p">.</span><span class="nx">O_APPEND</span><span class="w"> </span><span class="c1">// 追加模式</span>
<span class="w">    </span><span class="nx">O_CREATE</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">syscall</span><span class="p">.</span><span class="nx">O_CREAT</span><span class="w">  </span><span class="c1">// 如果不存在则创建</span>
<span class="w">    </span><span class="nx">O_EXCL</span><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">syscall</span><span class="p">.</span><span class="nx">O_EXCL</span><span class="w">   </span><span class="c1">// 与O_CREATE一起使用，文件必须不存在</span>
<span class="w">    </span><span class="nx">O_SYNC</span><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">syscall</span><span class="p">.</span><span class="nx">O_SYNC</span><span class="w">   </span><span class="c1">// 同步IO</span>
<span class="w">    </span><span class="nx">O_TRUNC</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">syscall</span><span class="p">.</span><span class="nx">O_TRUNC</span><span class="w">  </span><span class="c1">// 打开时清空文件</span>
<span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left;">模式组合</th>
<th style="text-align: left;">描述</th>
<th style="text-align: left;">等效于其他语言</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>os.O_RDONLY</code></td>
<td style="text-align: left;">只读打开</td>
<td style="text-align: left;">"r"</td>
</tr>
<tr>
<td style="text-align: left;"><code>os.O_WRONLY｜os.O_CREATE｜os.O_TRUNC</code></td>
<td style="text-align: left;">只写，创建，清空</td>
<td style="text-align: left;">"w"</td>
</tr>
<tr>
<td style="text-align: left;"><code>os.O_WRONLY｜os.O_CREATE｜os.O_APPEND</code></td>
<td style="text-align: left;">只写，创建，追加</td>
<td style="text-align: left;">"a"</td>
</tr>
<tr>
<td style="text-align: left;"><code>os.O_RDWR｜os.O_CREATE</code></td>
<td style="text-align: left;">读写，创建</td>
<td style="text-align: left;">"r+"</td>
</tr>
<tr>
<td style="text-align: left;"><code>os.O_RDWR｜os.O_CREATE｜os.O_TRUNC</code></td>
<td style="text-align: left;">读写，创建，清空</td>
<td style="text-align: left;">"w+"</td>
</tr>
<tr>
<td style="text-align: left;"><code>os.O_RDWR｜os.O_CREATE｜os.O_APPEND</code></td>
<td style="text-align: left;">读写，创建，追加</td>
<td style="text-align: left;">"a+"</td>
</tr>
</tbody>
</table>
<h5 id="142">1.4.2 文件权限模式<a class="headerlink" href="#142" title="Permanent link">&para;</a></h5>
<p><strong>Go使用Unix风格的权限位</strong>：</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="c1">// 基本权限位</span>
<span class="w">    </span><span class="nx">ModeDir</span><span class="w">        </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeDir</span><span class="w">        </span><span class="c1">// 目录</span>
<span class="w">    </span><span class="nx">ModeAppend</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeAppend</span><span class="w">     </span><span class="c1">// 只能追加</span>
<span class="w">    </span><span class="nx">ModeExclusive</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeExclusive</span><span class="w">  </span><span class="c1">// 独占使用</span>
<span class="w">    </span><span class="nx">ModeTemporary</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeTemporary</span><span class="w">  </span><span class="c1">// 临时文件</span>
<span class="w">    </span><span class="nx">ModeSymlink</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeSymlink</span><span class="w">    </span><span class="c1">// 符号链接</span>
<span class="w">    </span><span class="nx">ModeDevice</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeDevice</span><span class="w">     </span><span class="c1">// 设备文件</span>
<span class="w">    </span><span class="nx">ModeNamedPipe</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeNamedPipe</span><span class="w">  </span><span class="c1">// 命名管道</span>
<span class="w">    </span><span class="nx">ModeSocket</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeSocket</span><span class="w">     </span><span class="c1">// Unix域socket</span>
<span class="w">    </span><span class="nx">ModeSetuid</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeSetuid</span><span class="w">     </span><span class="c1">// set uid</span>
<span class="w">    </span><span class="nx">ModeSetgid</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeSetgid</span><span class="w">     </span><span class="c1">// set gid</span>
<span class="w">    </span><span class="nx">ModeCharDevice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeCharDevice</span><span class="w"> </span><span class="c1">// 字符设备</span>
<span class="w">    </span><span class="nx">ModeSticky</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeSticky</span><span class="w">     </span><span class="c1">// sticky bit</span>
<span class="w">    </span><span class="nx">ModeIrregular</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeIrregular</span><span class="w">  </span><span class="c1">// 非常规文件</span>

<span class="w">    </span><span class="c1">// 权限位掩码</span>
<span class="w">    </span><span class="nx">ModeType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModeType</span><span class="w">        </span><span class="c1">// 文件类型位</span>
<span class="w">    </span><span class="nx">ModePerm</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">ModePerm</span><span class="w">        </span><span class="c1">// 权限位 (rwxrwxrwx)</span>
<span class="p">)</span>
</code></pre></div>
<p><strong>常用权限值</strong>：</p>
<ul>
<li><code>0644</code>：用户读写，组和其他只读</li>
<li><code>0755</code>：用户读写执行，组和其他读执行</li>
<li><code>0600</code>：仅用户读写</li>
</ul>
<h5 id="143-seeker">1.4.3 Seeker<a class="headerlink" href="#143-seeker" title="Permanent link">&para;</a></h5>
<p>源码中的定义：</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Seeker</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Seek</span><span class="p">(</span><span class="nx">offset</span><span class="w"> </span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="nx">whence</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// whence：新偏移量起始值</span>
<span class="c1">// offset：基于起始值偏移量</span>

<span class="c1">// Seek whence values.</span>
<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">SeekStart</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="c1">// 基于文件开始位置</span>
<span class="w">    </span><span class="nx">SeekCurrent</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="c1">// 基于当前偏移量</span>
<span class="w">    </span><span class="nx">SeekEnd</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="c1">// 基于文件结束位置</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;io&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">CusSeekFile</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">O_RDWR</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">,</span><span class="w"> </span><span class="mi">655</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="nx">seek</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Seek</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">SeekStart</span><span class="p">)</span><span class="w"> </span><span class="c1">// 设置文件写入位置相对开始位置偏移量：2个字节</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;当前偏移量seek:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seek</span><span class="p">)</span>

<span class="w">    </span><span class="nx">file</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">content</span><span class="p">))</span>

<span class="w">    </span><span class="nx">seek</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">SeekCurrent</span><span class="p">)</span><span class="w"> </span><span class="c1">// 返回当前偏移量：18=2+15+1（2+len(byte[](&#39;今晚打老虎~&#39;))）</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;当前偏移量seek:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seek</span><span class="p">)</span>

<span class="w">    </span><span class="nx">seek</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Seek</span><span class="p">(</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">SeekCurrent</span><span class="p">)</span><span class="w"> </span><span class="c1">// 返回当前偏移量-16=2 -&gt;汉字占3个字节，如不匹配会乱码</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;当前偏移量seek:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seek</span><span class="p">)</span>

<span class="w">    </span><span class="nx">file</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;你好啊啊&quot;</span><span class="p">))</span><span class="w"> </span><span class="c1">// 此时写入会覆盖已有相同长度的字符内容，多余部分仍然不变</span>

<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">CusSeekFile</span><span class="p">(</span><span class="s">&quot;今晚打老虎~&quot;</span><span class="p">,</span><span class="s">&quot;test.txt&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2-bufio">2 高效缓冲读写包-bufio<a class="headerlink" href="#2-bufio" title="Permanent link">&para;</a></h3>
<p><strong>bufio 的主要优势：</strong></p>
<ol>
<li><strong>性能提升</strong>：减少系统调用次数，大幅提高 I/O 性能</li>
<li><strong>便捷的API</strong>：提供 <code>Scanner</code> 等高级接口，简化常见操作</li>
<li><strong>内存效率</strong>：通过缓冲减少内存分配和拷贝</li>
<li><strong>灵活性</strong>：支持自定义分割函数和读写操作</li>
</ol>
<p><strong>使用注意事项：</strong></p>
<ol>
<li><strong>记得调用 Flush()</strong>：对于写入操作，确保在结束时调用 <code>Flush()</code></li>
<li><strong>错误处理</strong>：总是检查 <code>Scanner.Err()</code> 和 <code>Writer</code> 的错误</li>
<li><strong>缓冲区大小</strong>：可以根据需要调整缓冲区大小</li>
<li><strong>资源释放</strong>：及时关闭底层资源</li>
</ol>
<p><code>bufio</code> 包是 Go 语言中处理 I/O 操作的重要工具，在需要高效读写数据的场景中非常有用。</p>
<h4 id="21_3">2.1 高效读取文件（逐行读取）<a class="headerlink" href="#21_3" title="Permanent link">&para;</a></h4>
<p>这是 <code>bufio</code> 最常见的应用场景，特别是处理文本文件：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">readFileByLine</span><span class="p">(</span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="nx">scanner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<span class="w">    </span><span class="nx">lineNumber</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">line</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Text</span><span class="p">()</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">lineNumber</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="p">)</span>
<span class="w">        </span><span class="nx">lineNumber</span><span class="o">++</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Err</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">readFileByLine</span><span class="p">(</span><span class="s">&quot;data.txt&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="22_2">2.2 处理标准输入<a class="headerlink" href="#22_2" title="Permanent link">&para;</a></h4>
<p>从标准输入读取数据时，使用缓冲可以提高效率：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="w">    </span><span class="s">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">readStdin</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">scanner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;请输入内容（输入 &#39;exit&#39; 退出）:&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">input</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Text</span><span class="p">()</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">ToLower</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;exit&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;您输入的是:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">readStdin</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="23_2">2.3 网络编程中的缓冲读写<a class="headerlink" href="#23_2" title="Permanent link">&para;</a></h4>
<p>在处理网络连接时，缓冲读写非常重要：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;net&quot;</span>
<span class="w">    </span><span class="s">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewWriter</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 读取直到换行符</span>
<span class="w">        </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">ReadString</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">message</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">TrimSpace</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;收到消息: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// 缓冲写入</span>
<span class="w">        </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;服务器回复: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">ToUpper</span><span class="p">(</span><span class="nx">message</span><span class="p">))</span>
<span class="w">        </span><span class="nx">writer</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
<span class="w">        </span><span class="nx">writer</span><span class="p">.</span><span class="nx">Flush</span><span class="p">()</span><span class="w"> </span><span class="c1">// 重要：确保数据被发送</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="24_1">2.4 高性能文件写入<a class="headerlink" href="#24_1" title="Permanent link">&para;</a></h4>
<p>当需要频繁写入小量数据时，使用缓冲可以显著提高性能：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">writeWithBuffer</span><span class="p">(</span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">lines</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewWriter</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">writer</span><span class="p">.</span><span class="nx">Flush</span><span class="p">()</span><span class="w"> </span><span class="c1">// 确保所有数据被写入</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">lines</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">writer</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">line</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">lines</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;第一行&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;第二行&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;第三行&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">writeWithBuffer</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">lines</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="25">2.5 读取特定分隔符的数据<a class="headerlink" href="#25" title="Permanent link">&para;</a></h4>
<p><code>bufio.Scanner</code> 可以自定义分割函数：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<span class="w">    </span><span class="s">&quot;bytes&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">readCSVData</span><span class="p">(</span><span class="nx">csvData</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">scanner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">csvData</span><span class="p">))</span>

<span class="w">    </span><span class="c1">// 自定义分割函数，按逗号分割</span>
<span class="w">    </span><span class="nx">split</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">atEOF</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">advance</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">atEOF</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bytes</span><span class="p">.</span><span class="nx">IndexByte</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="p">);</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nx">i</span><span class="p">],</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">atEOF</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="nx">split</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;字段: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Text</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">csvData</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;张三,25,程序员,北京\n李四,30,设计师,上海&quot;</span>
<span class="w">    </span><span class="nx">readCSVData</span><span class="p">(</span><span class="nx">csvData</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="26">2.6 读取固定大小的数据块<a class="headerlink" href="#26" title="Permanent link">&para;</a></h4>
<p>使用 <code>bufio.Reader</code> 读取特定大小的数据：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">readInChunks</span><span class="p">(</span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">chunkSize</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<span class="w">    </span><span class="nx">chunk</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">chunkSize</span><span class="p">)</span>
<span class="w">    </span><span class="nx">chunkCount</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">n</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">chunk</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">chunkCount</span><span class="o">++</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;块 %d: %d 字节\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">chunkCount</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// 处理 chunk[0:n] 的数据</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">readInChunks</span><span class="p">(</span><span class="s">&quot;largefile.bin&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4096</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="27">2.7 性能敏感的日志处理<a class="headerlink" href="#27" title="Permanent link">&para;</a></h4>
<p>在高性能日志处理中使用缓冲：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Logger</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">*</span><span class="nx">bufio</span><span class="p">.</span><span class="nx">Writer</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewLogger</span><span class="p">(</span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">Logger</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">O_APPEND</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewWriter</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Logger</span><span class="p">{</span><span class="nx">writer</span><span class="p">:</span><span class="w"> </span><span class="nx">writer</span><span class="p">},</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">Logger</span><span class="p">)</span><span class="w"> </span><span class="nx">Log</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;2006-01-02 15:04:05&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logEntry</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;[%s] %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>

<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">writer</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">logEntry</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">Logger</span><span class="p">)</span><span class="w"> </span><span class="nx">Flush</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">writer</span><span class="p">.</span><span class="nx">Flush</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">Logger</span><span class="p">)</span><span class="w"> </span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">l</span><span class="p">.</span><span class="nx">Flush</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// 实际项目中应该关闭底层文件</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_17">📚 日志相关内容<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h2>
<h3 id="1-log">1 自定义Log记录器<a class="headerlink" href="#1-log" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;gopkg.in/natefinch/lumberjack.v2&quot;</span>
<span class="w">    </span><span class="s">&quot;io&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="w">    </span><span class="s">&quot;path/filepath&quot;</span>
<span class="w">    </span><span class="s">&quot;runtime&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="c1">// LogLevel 定义日志级别类型</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">LogLevel</span><span class="w"> </span><span class="kt">int</span>

<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">DEBUG</span><span class="w"> </span><span class="nx">LogLevel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">iota</span>
<span class="w">    </span><span class="nx">INFO</span>
<span class="w">    </span><span class="nx">WARN</span>
<span class="w">    </span><span class="nx">ERROR</span>
<span class="w">    </span><span class="nx">FATAL</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">levelStrings</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;DEBUG&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;INFO&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;WARN&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;ERROR&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;FATAL&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">CustomLogger</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">*</span><span class="nx">log</span><span class="p">.</span><span class="nx">Logger</span>
<span class="w">    </span><span class="nx">fileWriter</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span>
<span class="p">}</span>

<span class="c1">// NewCustomLogger 创建日志实例</span>
<span class="c1">// console: 是否输出到控制台</span>
<span class="c1">// filePath: 日志文件路径，空字符串表示不写入文件</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">NewCustomLogger</span><span class="p">(</span><span class="nx">console</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">filePath</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">writers</span><span class="w"> </span><span class="p">[]</span><span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span>

<span class="w">    </span><span class="c1">// 1. 文件输出配置</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">filePath</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fileWriter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">lumberjack</span><span class="p">.</span><span class="nx">Logger</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Filename</span><span class="p">:</span><span class="w">   </span><span class="nx">filePath</span><span class="p">,</span>
<span class="w">            </span><span class="nx">MaxSize</span><span class="p">:</span><span class="w">    </span><span class="mi">20</span><span class="p">,</span><span class="w">    </span><span class="c1">// 每个日志文件最大尺寸(MB)</span>
<span class="w">            </span><span class="nx">MaxBackups</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w">     </span><span class="c1">// 保留旧日志文件的最大数量</span>
<span class="w">            </span><span class="nx">MaxAge</span><span class="p">:</span><span class="w">     </span><span class="mi">7</span><span class="p">,</span><span class="w">     </span><span class="c1">// 保留旧日志文件的最大天数</span>
<span class="w">            </span><span class="nx">Compress</span><span class="p">:</span><span class="w">   </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="c1">// 是否压缩旧日志文件</span>
<span class="w">            </span><span class="nx">LocalTime</span><span class="p">:</span><span class="w">  </span><span class="kc">true</span><span class="p">,</span><span class="w">  </span><span class="c1">// 使用本地时间</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">writers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">writers</span><span class="p">,</span><span class="w"> </span><span class="nx">fileWriter</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 2. 控制台输出配置</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">console</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">writers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">writers</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 3. 创建多输出writer</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">writers</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Discard</span><span class="w"> </span><span class="c1">// 无输出</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">writers</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">writers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">MultiWriter</span><span class="p">(</span><span class="nx">writers</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CustomLogger</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Logger</span><span class="p">:</span><span class="w">     </span><span class="nx">log</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">        </span><span class="nx">fileWriter</span><span class="p">:</span><span class="w"> </span><span class="nx">writers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="c1">// 保存文件writer引用</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 基础日志方法</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">log</span><span class="p">(</span><span class="nx">level</span><span class="w"> </span><span class="nx">LogLevel</span><span class="p">,</span><span class="w"> </span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">runtime</span><span class="p">.</span><span class="nx">Caller</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="c1">// 调整调用栈层级</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">file</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;???&quot;</span>
<span class="w">        </span><span class="nx">line</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">file</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Base</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;2006-01-02 15:04:05.000&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">prefix</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s %s:%d %s |&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="p">,</span><span class="w"> </span><span class="nx">levelStrings</span><span class="p">[</span><span class="nx">level</span><span class="p">])</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">format</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">msg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprint</span><span class="p">(</span><span class="nx">v</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">msg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">l</span><span class="p">.</span><span class="nx">Logger</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">prefix</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 普通日志方法</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Debug</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">DEBUG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Info</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Warn</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">WARN</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Error</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">FATAL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="o">...</span><span class="p">);</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="c1">// 格式化日志方法</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Debugf</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">DEBUG</span><span class="p">,</span><span class="w"> </span><span class="nx">format</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Infof</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">INFO</span><span class="p">,</span><span class="w"> </span><span class="nx">format</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Warnf</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">WARN</span><span class="p">,</span><span class="w"> </span><span class="nx">format</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Errorf</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ERROR</span><span class="p">,</span><span class="w"> </span><span class="nx">format</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Fatalf</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">l</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">FATAL</span><span class="p">,</span><span class="w"> </span><span class="nx">format</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 关闭文件写入器（如果需要）</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">closer</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">fileWriter</span><span class="p">.(</span><span class="nx">io</span><span class="p">.</span><span class="nx">Closer</span><span class="p">);</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">closer</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">Log</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">NewCustomLogger</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;./logs/atsexec_%d_%s.log&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getpid</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;20060102150405&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="2-go-zap2025">2 go性能最快的日志库-zap（2025）<a class="headerlink" href="#2-go-zap2025" title="Permanent link">&para;</a></h3>
<p>学习链接：<a href="https://www.fengfengzhidao.com/article/e8OCcZUB8lppN5cb7HmJ">zap第三方日志库</a></p>
<p>这是第三方日志库(lumberjack.v2支持分片)：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 下载命令</span>
go<span class="w"> </span>get<span class="w"> </span>-u<span class="w"> </span>go.uber.org/zap
go<span class="w"> </span>get<span class="w"> </span>-u<span class="w"> </span>gopkg.in/natefinch/lumberjack.v2
</code></pre></div>
<p>示例：utils/logger.go</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;go.uber.org/zap&quot;</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">Dev</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewDevelopment</span><span class="p">()</span>
<span class="w">    </span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Dev this is &quot;</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Warn</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;warn&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;error&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">Test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewExample</span><span class="p">()</span>
<span class="w">    </span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Test this is &quot;</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Warn</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;warn&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;error&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">Prod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewProduction</span><span class="p">()</span>
<span class="w">    </span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Prod this is &quot;</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Warn</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;warn&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;error&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="21_4">2.1 基本配置<a class="headerlink" href="#21_4" title="Permanent link">&para;</a></h4>
<p>utils/logger.go</p>
<p>1.支持直接输入两个参数：logger.info("%s 你好", "cenhongchang")</p>
<div class="highlight"><pre><span></span><code><span class="c1">// GetSLogger 直接获取日志打印器-支持格式化入参</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">GetSLogger</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">zap</span><span class="p">.</span><span class="nx">SugaredLogger</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewDevelopment</span><span class="p">()</span>
<span class="w">    </span><span class="nx">slogger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Sugar</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">slogger</span>
</code></pre></div>
<p>2.更多配置使用方式</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;go.uber.org/zap&quot;</span>
<span class="w">    </span><span class="s">&quot;go.uber.org/zap/zapcore&quot;</span>
<span class="p">)</span>

<span class="c1">// 定义颜色</span>
<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">colorRed</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[31m&quot;</span>
<span class="w">    </span><span class="nx">colorGreen</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[32m&quot;</span>
<span class="w">    </span><span class="nx">colorYellow</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[33m&quot;</span>
<span class="w">    </span><span class="nx">colorBlue</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[34m&quot;</span>
<span class="w">    </span><span class="nx">colorReset</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[0m&quot;</span>
<span class="p">)</span>

<span class="c1">// 自定义 EncodeLevel-美化颜色</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">coloredLevelEncoder</span><span class="p">(</span><span class="nx">level</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">,</span><span class="w"> </span><span class="nx">enc</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">PrimitiveArrayEncoder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">level</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">:</span>
<span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">colorBlue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;DEBUG&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">InfoLevel</span><span class="p">:</span>
<span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">colorGreen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;INFO&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">WarnLevel</span><span class="p">:</span>
<span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">colorYellow</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;WARN&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">ErrorLevel</span><span class="p">,</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">DPanicLevel</span><span class="p">,</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">PanicLevel</span><span class="p">,</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">FatalLevel</span><span class="p">:</span>
<span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;ERROR&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">)</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">level</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span><span class="w"> </span><span class="c1">// 默认行为</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// GetLogger 通过配置获取日志打印器</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">GetLogger</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">zap</span><span class="p">.</span><span class="nx">Logger</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cfg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewDevelopmentConfig</span><span class="p">()</span>
<span class="w">    </span><span class="nx">cfg</span><span class="p">.</span><span class="nx">Level</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewAtomicLevelAt</span><span class="p">(</span><span class="nx">zap</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">)</span><span class="w">                                  </span><span class="c1">// 设置日志打印最小级别为info</span>
<span class="w">    </span><span class="nx">cfg</span><span class="p">.</span><span class="nx">EncoderConfig</span><span class="p">.</span><span class="nx">EncodeTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">TimeEncoderOfLayout</span><span class="p">(</span><span class="s">&quot;2006-01-02 15:04:05&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 时间格式化</span>
<span class="w">    </span><span class="nx">cfg</span><span class="p">.</span><span class="nx">EncoderConfig</span><span class="p">.</span><span class="nx">EncodeLevel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">coloredLevelEncoder</span><span class="w">                               </span><span class="c1">// 自定义颜色显示函数</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cfg</span><span class="p">.</span><span class="nx">Build</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">logger</span>
<span class="p">}</span>

<span class="cm">/* </span>

<span class="cm">// 测试代码</span>
<span class="cm">func main() {</span>
<span class="cm">    logger := utils.GetLogger() // 默认不支持格式化入参</span>
<span class="cm">    prefixStr := &quot;这是一条日志，打印机别：&quot;</span>
<span class="cm">    logger.Info(prefixStr + &quot;info&quot;)</span>
<span class="cm">    logger.Warn(prefixStr + &quot;warn&quot;)</span>
<span class="cm">    logger.Error(prefixStr + &quot;error&quot;)</span>
<span class="cm">}</span>

<span class="cm">*/</span>
</code></pre></div>
<h4 id="22_3">2.2 自定义内容（完整）<a class="headerlink" href="#22_3" title="Permanent link">&para;</a></h4>
<p>zap支持自定义日志前缀，比如想定义为：某个项目名或应用名等...</p>
<div class="highlight"><pre><span></span><code>go<span class="w"> </span>get<span class="w"> </span>-u<span class="w"> </span>gopkg.in/natefinch/lumberjack.v2
</code></pre></div>
<h5 id="221">2.2.1 按文件大小分片<a class="headerlink" href="#221" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;go.uber.org/zap&quot;</span>
<span class="w">    </span><span class="s">&quot;go.uber.org/zap/buffer&quot;</span>
<span class="w">    </span><span class="s">&quot;go.uber.org/zap/zapcore&quot;</span>
<span class="w">    </span><span class="s">&quot;gopkg.in/natefinch/lumberjack.v2&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">colorRed</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[31m&quot;</span>
<span class="w">    </span><span class="nx">colorGreen</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[32m&quot;</span>
<span class="w">    </span><span class="nx">colorYellow</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[33m&quot;</span>
<span class="w">    </span><span class="nx">colorBlue</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[34m&quot;</span>
<span class="w">    </span><span class="nx">colorReset</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[0m&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">enableColor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">isTerminal</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">levelColors</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorBlue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;DEBUG&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">InfoLevel</span><span class="p">:</span><span class="w">   </span><span class="nx">colorGreen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;INFO&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">WarnLevel</span><span class="p">:</span><span class="w">   </span><span class="nx">colorYellow</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;WARN&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">ErrorLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;ERROR&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">DPanicLevel</span><span class="p">:</span><span class="w"> </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;DPANIC&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">PanicLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;PANIC&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">FatalLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;FATAL&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// 控制台颜色编码</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">coloredLevelEncoder</span><span class="p">(</span><span class="nx">level</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">,</span><span class="w"> </span><span class="nx">enc</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">PrimitiveArrayEncoder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">enableColor</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">levelColors</span><span class="p">[</span><span class="nx">level</span><span class="p">];</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">level</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// 文件用的纯文本编码</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">plainLevelEncoder</span><span class="p">(</span><span class="nx">level</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">,</span><span class="w"> </span><span class="nx">enc</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">PrimitiveArrayEncoder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">level</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// 自定义 Encoder，加前缀</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">myEncoder</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Encoder</span>
<span class="w">    </span><span class="nx">Prefix</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">myEncoder</span><span class="p">)</span><span class="w"> </span><span class="nx">EncodeEntry</span><span class="p">(</span><span class="nx">entry</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Entry</span><span class="p">,</span><span class="w"> </span><span class="nx">fields</span><span class="w"> </span><span class="p">[]</span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Field</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">buf</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">Encoder</span><span class="p">.</span><span class="nx">EncodeEntry</span><span class="p">(</span><span class="nx">entry</span><span class="p">,</span><span class="w"> </span><span class="nx">fields</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">logLine</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">buf</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
<span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nx">Reset</span><span class="p">()</span>
<span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">Prefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">logLine</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">buf</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">isTerminal</span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">os</span><span class="p">.</span><span class="nx">File</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fi</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">Stat</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">fi</span><span class="p">.</span><span class="nx">Mode</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">ModeCharDevice</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>

<span class="c1">// InitLogger 初始化全局 Logger</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">InitLogger</span><span class="p">(</span><span class="nx">prefix</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">logFile</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">zap</span><span class="p">.</span><span class="nx">Logger</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 控制台编码（彩色）</span>
<span class="w">    </span><span class="nx">consoleCfg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewDevelopmentEncoderConfig</span><span class="p">()</span>
<span class="w">    </span><span class="nx">consoleCfg</span><span class="p">.</span><span class="nx">EncodeTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">TimeEncoderOfLayout</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">DateTime</span><span class="p">)</span>
<span class="w">    </span><span class="nx">consoleCfg</span><span class="p">.</span><span class="nx">EncodeLevel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">coloredLevelEncoder</span>

<span class="w">    </span><span class="nx">consoleEncoder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewConsoleEncoder</span><span class="p">(</span><span class="nx">consoleCfg</span><span class="p">)</span>

<span class="w">    </span><span class="nx">consoleCore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewCore</span><span class="p">(</span>
<span class="w">        </span><span class="nx">myEncoder</span><span class="p">{</span><span class="nx">Encoder</span><span class="p">:</span><span class="w"> </span><span class="nx">consoleEncoder</span><span class="p">,</span><span class="w"> </span><span class="nx">Prefix</span><span class="p">:</span><span class="w"> </span><span class="nx">prefix</span><span class="p">},</span>
<span class="w">        </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">AddSync</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">),</span>
<span class="w">        </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 文件编码（无颜色）</span>
<span class="w">    </span><span class="nx">fileCfg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewProductionEncoderConfig</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fileCfg</span><span class="p">.</span><span class="nx">EncodeTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">TimeEncoderOfLayout</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">DateTime</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fileCfg</span><span class="p">.</span><span class="nx">EncodeLevel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">plainLevelEncoder</span><span class="w"> </span><span class="c1">// 不加颜色</span>

<span class="w">    </span><span class="nx">fileEncoder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewConsoleEncoder</span><span class="p">(</span><span class="nx">fileCfg</span><span class="p">)</span>

<span class="w">    </span><span class="nx">fileWriter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">AddSync</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lumberjack</span><span class="p">.</span><span class="nx">Logger</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Filename</span><span class="p">:</span><span class="w">   </span><span class="nx">logFile</span><span class="p">,</span>
<span class="w">        </span><span class="nx">MaxSize</span><span class="p">:</span><span class="w">    </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="c1">// MB</span>
<span class="w">        </span><span class="nx">MaxBackups</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nx">MaxAge</span><span class="p">:</span><span class="w">     </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="c1">// days</span>
<span class="w">        </span><span class="nx">Compress</span><span class="p">:</span><span class="w">   </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">fileCore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewCore</span><span class="p">(</span>
<span class="w">        </span><span class="nx">myEncoder</span><span class="p">{</span><span class="nx">Encoder</span><span class="p">:</span><span class="w"> </span><span class="nx">fileEncoder</span><span class="p">,</span><span class="w"> </span><span class="nx">Prefix</span><span class="p">:</span><span class="w"> </span><span class="nx">prefix</span><span class="p">},</span>
<span class="w">        </span><span class="nx">fileWriter</span><span class="p">,</span>
<span class="w">        </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">InfoLevel</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 合并 -- 类似python添加多个handler</span>
<span class="w">    </span><span class="nx">core</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewTee</span><span class="p">(</span><span class="nx">consoleCore</span><span class="p">,</span><span class="w"> </span><span class="nx">fileCore</span><span class="p">)</span>

<span class="w">    </span><span class="nx">logger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">core</span><span class="p">,</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">AddCaller</span><span class="p">(),</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">AddStacktrace</span><span class="p">(</span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">ErrorLevel</span><span class="p">))</span>
<span class="w">    </span><span class="nx">zap</span><span class="p">.</span><span class="nx">ReplaceGlobals</span><span class="p">(</span><span class="nx">logger</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">logger</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="222">2.2.2 按每天文件分片<a class="headerlink" href="#222" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;go.uber.org/zap&quot;</span>
<span class="w">    </span><span class="s">&quot;go.uber.org/zap/buffer&quot;</span>
<span class="w">    </span><span class="s">&quot;go.uber.org/zap/zapcore&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="w">    </span><span class="s">&quot;path/filepath&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">colorRed</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[31m&quot;</span>
<span class="w">    </span><span class="nx">colorGreen</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[32m&quot;</span>
<span class="w">    </span><span class="nx">colorYellow</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[33m&quot;</span>
<span class="w">    </span><span class="nx">colorBlue</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[34m&quot;</span>
<span class="w">    </span><span class="nx">colorReset</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[0m&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">enableColor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">isTerminal</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">levelColors</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorBlue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;DEBUG&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">InfoLevel</span><span class="p">:</span><span class="w">   </span><span class="nx">colorGreen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;INFO&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">WarnLevel</span><span class="p">:</span><span class="w">   </span><span class="nx">colorYellow</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;WARN&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">ErrorLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;ERROR&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">DPanicLevel</span><span class="p">:</span><span class="w"> </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;DPANIC&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">PanicLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;PANIC&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">FatalLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;FATAL&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// 控制台颜色编码</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">coloredLevelEncoder</span><span class="p">(</span><span class="nx">level</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">,</span><span class="w"> </span><span class="nx">enc</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">PrimitiveArrayEncoder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">enableColor</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">levelColors</span><span class="p">[</span><span class="nx">level</span><span class="p">];</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">level</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// 文件纯文本编码</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">plainLevelEncoder</span><span class="p">(</span><span class="nx">level</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">,</span><span class="w"> </span><span class="nx">enc</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">PrimitiveArrayEncoder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">level</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// 自定义 Encoder，加前缀</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">myEncoder</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Encoder</span>
<span class="w">    </span><span class="nx">Prefix</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">myEncoder</span><span class="p">)</span><span class="w"> </span><span class="nx">EncodeEntry</span><span class="p">(</span><span class="nx">entry</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Entry</span><span class="p">,</span><span class="w"> </span><span class="nx">fields</span><span class="w"> </span><span class="p">[]</span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Field</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">buf</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">Encoder</span><span class="p">.</span><span class="nx">EncodeEntry</span><span class="p">(</span><span class="nx">entry</span><span class="p">,</span><span class="w"> </span><span class="nx">fields</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">logLine</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">buf</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
<span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nx">Reset</span><span class="p">()</span>
<span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">Prefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">logLine</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">buf</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// 判断输出是否是终端</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">isTerminal</span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">os</span><span class="p">.</span><span class="nx">File</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fi</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">Stat</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">fi</span><span class="p">.</span><span class="nx">Mode</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">ModeCharDevice</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>

<span class="c1">// 获取当天的日志文件路径</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">getDailyLogFile</span><span class="p">(</span><span class="nx">baseDir</span><span class="p">,</span><span class="w"> </span><span class="nx">baseName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">date</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Format</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">DateOnly</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">baseDir</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s_%s.log&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">baseName</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// InitLogger 按天分割日志</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">InitLogger</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span><span class="w"> </span><span class="nx">baseDir</span><span class="p">,</span><span class="w"> </span><span class="nx">baseName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">zap</span><span class="p">.</span><span class="nx">Logger</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 确保日志目录存在</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">MkdirAll</span><span class="p">(</span><span class="nx">baseDir</span><span class="p">,</span><span class="w"> </span><span class="mo">0755</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 控制台编码（彩色）</span>
<span class="w">    </span><span class="nx">consoleCfg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewDevelopmentEncoderConfig</span><span class="p">()</span>
<span class="w">    </span><span class="nx">consoleCfg</span><span class="p">.</span><span class="nx">EncodeTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">TimeEncoderOfLayout</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">DateTime</span><span class="p">)</span>
<span class="w">    </span><span class="nx">consoleCfg</span><span class="p">.</span><span class="nx">EncodeLevel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">coloredLevelEncoder</span>
<span class="w">    </span><span class="nx">consoleEncoder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewConsoleEncoder</span><span class="p">(</span><span class="nx">consoleCfg</span><span class="p">)</span>

<span class="w">    </span><span class="nx">consoleCore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewCore</span><span class="p">(</span>
<span class="w">        </span><span class="nx">myEncoder</span><span class="p">{</span><span class="nx">Encoder</span><span class="p">:</span><span class="w"> </span><span class="nx">consoleEncoder</span><span class="p">,</span><span class="w"> </span><span class="nx">Prefix</span><span class="p">:</span><span class="w"> </span><span class="nx">prefix</span><span class="p">},</span>
<span class="w">        </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">AddSync</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">),</span>
<span class="w">        </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 文件编码（无颜色）</span>
<span class="w">    </span><span class="nx">fileCfg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewProductionEncoderConfig</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fileCfg</span><span class="p">.</span><span class="nx">EncodeTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">TimeEncoderOfLayout</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">DateTime</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fileCfg</span><span class="p">.</span><span class="nx">EncodeLevel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">plainLevelEncoder</span>
<span class="w">    </span><span class="nx">fileEncoder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewConsoleEncoder</span><span class="p">(</span><span class="nx">fileCfg</span><span class="p">)</span>

<span class="w">    </span><span class="nx">logFile</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getDailyLogFile</span><span class="p">(</span><span class="nx">baseDir</span><span class="p">,</span><span class="w"> </span><span class="nx">baseName</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fileWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">logFile</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">O_APPEND</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;无法创建日志文件: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">fileCore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewCore</span><span class="p">(</span>
<span class="w">        </span><span class="nx">myEncoder</span><span class="p">{</span><span class="nx">Encoder</span><span class="p">:</span><span class="w"> </span><span class="nx">fileEncoder</span><span class="p">,</span><span class="w"> </span><span class="nx">Prefix</span><span class="p">:</span><span class="w"> </span><span class="nx">prefix</span><span class="p">},</span>
<span class="w">        </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">AddSync</span><span class="p">(</span><span class="nx">fileWriter</span><span class="p">),</span>
<span class="w">        </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">InfoLevel</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="nx">core</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewTee</span><span class="p">(</span><span class="nx">consoleCore</span><span class="p">,</span><span class="w"> </span><span class="nx">fileCore</span><span class="p">)</span>

<span class="w">    </span><span class="nx">logger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">core</span><span class="p">,</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">AddCaller</span><span class="p">(),</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">AddStacktrace</span><span class="p">(</span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">ErrorLevel</span><span class="p">))</span>
<span class="w">    </span><span class="nx">zap</span><span class="p">.</span><span class="nx">ReplaceGlobals</span><span class="p">(</span><span class="nx">logger</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">logger</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="223">2.2.3 按每天文件+错误单独文件分片<a class="headerlink" href="#223" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;go.uber.org/zap&quot;</span>
<span class="w">    </span><span class="s">&quot;go.uber.org/zap/buffer&quot;</span>
<span class="w">    </span><span class="s">&quot;go.uber.org/zap/zapcore&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="w">    </span><span class="s">&quot;path/filepath&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">colorRed</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[31m&quot;</span>
<span class="w">    </span><span class="nx">colorGreen</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[32m&quot;</span>
<span class="w">    </span><span class="nx">colorYellow</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[33m&quot;</span>
<span class="w">    </span><span class="nx">colorBlue</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[34m&quot;</span>
<span class="w">    </span><span class="nx">colorReset</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;\033[0m&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">enableColor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">isTerminal</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">levelColors</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorBlue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;DEBUG&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">InfoLevel</span><span class="p">:</span><span class="w">   </span><span class="nx">colorGreen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;INFO&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">WarnLevel</span><span class="p">:</span><span class="w">   </span><span class="nx">colorYellow</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;WARN&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">ErrorLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;ERROR&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">DPanicLevel</span><span class="p">:</span><span class="w"> </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;DPANIC&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">PanicLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;PANIC&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">FatalLevel</span><span class="p">:</span><span class="w">  </span><span class="nx">colorRed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;FATAL&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colorReset</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// 控制台颜色编码</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">coloredLevelEncoder</span><span class="p">(</span><span class="nx">level</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">,</span><span class="w"> </span><span class="nx">enc</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">PrimitiveArrayEncoder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">enableColor</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">levelColors</span><span class="p">[</span><span class="nx">level</span><span class="p">];</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">level</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// 文件无颜色编码</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">plainLevelEncoder</span><span class="p">(</span><span class="nx">level</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">,</span><span class="w"> </span><span class="nx">enc</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">PrimitiveArrayEncoder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">enc</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">level</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// 自定义 Encoder，加前缀</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">myEncoder</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Encoder</span>
<span class="w">    </span><span class="nx">Prefix</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="nx">myEncoder</span><span class="p">)</span><span class="w"> </span><span class="nx">EncodeEntry</span><span class="p">(</span><span class="nx">entry</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Entry</span><span class="p">,</span><span class="w"> </span><span class="nx">fields</span><span class="w"> </span><span class="p">[]</span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Field</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">buf</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">Encoder</span><span class="p">.</span><span class="nx">EncodeEntry</span><span class="p">(</span><span class="nx">entry</span><span class="p">,</span><span class="w"> </span><span class="nx">fields</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">logLine</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">buf</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
<span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nx">Reset</span><span class="p">()</span>
<span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nx">AppendString</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">Prefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">logLine</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">buf</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// 判断输出是否是终端</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">isTerminal</span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">os</span><span class="p">.</span><span class="nx">File</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fi</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">Stat</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">fi</span><span class="p">.</span><span class="nx">Mode</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">ModeCharDevice</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>

<span class="c1">// 获取当天日志文件路径</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">getDailyLogFile</span><span class="p">(</span><span class="nx">baseDir</span><span class="p">,</span><span class="w"> </span><span class="nx">baseName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">date</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;2006-01-02&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">baseDir</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s_%s.log&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">baseName</span><span class="p">,</span><span class="w"> </span><span class="nx">date</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// InitLogger 按天分割并将 error 单独输出</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">InitLogger</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span><span class="w"> </span><span class="nx">baseDir</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">zap</span><span class="p">.</span><span class="nx">Logger</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">MkdirAll</span><span class="p">(</span><span class="nx">baseDir</span><span class="p">,</span><span class="w"> </span><span class="mo">0755</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 控制台（彩色）</span>
<span class="w">    </span><span class="nx">consoleCfg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewDevelopmentEncoderConfig</span><span class="p">()</span>
<span class="w">    </span><span class="nx">consoleCfg</span><span class="p">.</span><span class="nx">EncodeTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">TimeEncoderOfLayout</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">DateTime</span><span class="p">)</span>
<span class="w">    </span><span class="nx">consoleCfg</span><span class="p">.</span><span class="nx">EncodeLevel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">coloredLevelEncoder</span>
<span class="w">    </span><span class="nx">consoleEncoder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewConsoleEncoder</span><span class="p">(</span><span class="nx">consoleCfg</span><span class="p">)</span>

<span class="w">    </span><span class="nx">consoleCore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewCore</span><span class="p">(</span>
<span class="w">        </span><span class="nx">myEncoder</span><span class="p">{</span><span class="nx">Encoder</span><span class="p">:</span><span class="w"> </span><span class="nx">consoleEncoder</span><span class="p">,</span><span class="w"> </span><span class="nx">Prefix</span><span class="p">:</span><span class="w"> </span><span class="nx">prefix</span><span class="p">},</span>
<span class="w">        </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">AddSync</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">),</span>
<span class="w">        </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 文件（Info 及以上，不含 Error）</span>
<span class="w">    </span><span class="nx">infoCfg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewProductionEncoderConfig</span><span class="p">()</span>
<span class="w">    </span><span class="nx">infoCfg</span><span class="p">.</span><span class="nx">EncodeTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">TimeEncoderOfLayout</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">DateTime</span><span class="p">)</span>
<span class="w">    </span><span class="nx">infoCfg</span><span class="p">.</span><span class="nx">EncodeLevel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">plainLevelEncoder</span>
<span class="w">    </span><span class="nx">infoEncoder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewConsoleEncoder</span><span class="p">(</span><span class="nx">infoCfg</span><span class="p">)</span>

<span class="w">    </span><span class="nx">infoFile</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getDailyLogFile</span><span class="p">(</span><span class="nx">baseDir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">infoWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">infoFile</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">O_APPEND</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;无法创建 info 日志文件: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">infoCore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewCore</span><span class="p">(</span>
<span class="w">        </span><span class="nx">myEncoder</span><span class="p">{</span><span class="nx">Encoder</span><span class="p">:</span><span class="w"> </span><span class="nx">infoEncoder</span><span class="p">,</span><span class="w"> </span><span class="nx">Prefix</span><span class="p">:</span><span class="w"> </span><span class="nx">prefix</span><span class="p">},</span>
<span class="w">        </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">AddSync</span><span class="p">(</span><span class="nx">infoWriter</span><span class="p">),</span>
<span class="w">        </span><span class="nx">zap</span><span class="p">.</span><span class="nx">LevelEnablerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">lvl</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">lvl</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">ErrorLevel</span><span class="w"> </span><span class="c1">// 只记录 Debug, Info, Warn</span>
<span class="w">        </span><span class="p">}),</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 文件（Error 及以上）</span>
<span class="w">    </span><span class="nx">errCfg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewProductionEncoderConfig</span><span class="p">()</span>
<span class="w">    </span><span class="nx">errCfg</span><span class="p">.</span><span class="nx">EncodeTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">TimeEncoderOfLayout</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">DateTime</span><span class="p">)</span>
<span class="w">    </span><span class="nx">errCfg</span><span class="p">.</span><span class="nx">EncodeLevel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">plainLevelEncoder</span>
<span class="w">    </span><span class="nx">errEncoder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewConsoleEncoder</span><span class="p">(</span><span class="nx">errCfg</span><span class="p">)</span>

<span class="w">    </span><span class="nx">errorFile</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getDailyLogFile</span><span class="p">(</span><span class="nx">baseDir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;error&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">errorWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">errorFile</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">O_APPEND</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;无法创建 error 日志文件: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">errorCore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewCore</span><span class="p">(</span>
<span class="w">        </span><span class="nx">myEncoder</span><span class="p">{</span><span class="nx">Encoder</span><span class="p">:</span><span class="w"> </span><span class="nx">errEncoder</span><span class="p">,</span><span class="w"> </span><span class="nx">Prefix</span><span class="p">:</span><span class="w"> </span><span class="nx">prefix</span><span class="p">},</span>
<span class="w">        </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">AddSync</span><span class="p">(</span><span class="nx">errorWriter</span><span class="p">),</span>
<span class="w">        </span><span class="nx">zap</span><span class="p">.</span><span class="nx">LevelEnablerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">lvl</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">lvl</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">ErrorLevel</span><span class="w"> </span><span class="c1">// 只记录 Error 及以上</span>
<span class="w">        </span><span class="p">}),</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 合并三个输出</span>
<span class="w">    </span><span class="nx">core</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">NewTee</span><span class="p">(</span><span class="nx">consoleCore</span><span class="p">,</span><span class="w"> </span><span class="nx">infoCore</span><span class="p">,</span><span class="w"> </span><span class="nx">errorCore</span><span class="p">)</span>

<span class="w">    </span><span class="nx">logger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">core</span><span class="p">,</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">AddCaller</span><span class="p">(),</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">AddStacktrace</span><span class="p">(</span><span class="nx">zapcore</span><span class="p">.</span><span class="nx">ErrorLevel</span><span class="p">))</span>
<span class="w">    </span><span class="nx">zap</span><span class="p">.</span><span class="nx">ReplaceGlobals</span><span class="p">(</span><span class="nx">logger</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">logger</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="224">2.2.4 单独/全局日志对象使用<a class="headerlink" href="#224" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="c1">// 单独新logger对象</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">utils</span><span class="p">.</span><span class="nx">InitLogger</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;logs/app.log&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">utils</span><span class="p">.</span><span class="nx">InitLogger</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;logs/app1.log&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Sync</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">logger1</span><span class="p">.</span><span class="nx">Sync</span><span class="p">()</span>

<span class="w">    </span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;这是一条日志，打印级别：&quot;</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Debug</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;debug&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Warn</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;warn&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;error&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">logger1</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger1</span><span class="p">.</span><span class="nx">Warn</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;warn&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger1</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">prefixStr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;error&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// 全局日志对象</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">InitLogger</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;logs/global.log&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">zap</span><span class="p">.</span><span class="nx">L</span><span class="p">().</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">zap</span><span class="p">.</span><span class="nx">S</span><span class="p">().</span><span class="nx">Infof</span><span class="p">(</span><span class="s">&quot;hello %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;world&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="gogoroutine">📚 Go并发编程（Goroutine）<a class="headerlink" href="#gogoroutine" title="Permanent link">&para;</a></h2>
<p>编程中，如果细化并行与并发，那么解释如下：</p>
<p>并行：多个cpu中，做到真正的同一时刻，同时运行；</p>
<p>并发：单个cpu中，一段时间内，通过不停的切换时间片达到快速执行任务；</p>
<p>一般的话，两者我们都统称并发。</p>
<p>go语言有自己实现协程的线程模型-GMP（混合型线程模型）</p>
<h3 id="1_16">1 协程创建<a class="headerlink" href="#1_16" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">showMessage</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello Goroutine; i=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">showMessage</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// 协程中，如果不加等待时间，主协程不会等待创建的其他子协程结束而直接结束，可能什么都不打印；也可能打印少量信息</span>
<span class="w">    </span><span class="c1">// 加了时间后，协程时并发执行，所以打印顺序是不确定的</span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2-channel">2 Channel类型（通道）<a class="headerlink" href="#2-channel" title="Permanent link">&para;</a></h3>
<p>go语言Channel是为Goroutine做数据通信的类型，是一种队列，遵循先入先出；</p>
<p>创建channel数据语法：<code>make(chan 类型, &lt;缓冲大小&gt;)</code></p>
<p>channel有三种操作：发送(send)、接收(receive)与关闭(close)；发送接收都使用 &lt;- 符号</p>
<h4 id="21-channel">2.1 Channel死锁<a class="headerlink" href="#21-channel" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w">  </span><span class="c1">// 没有缓冲，队列长度=0；相当于发送值没有存的地方，造成死锁</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="nx">receiver</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">receiver</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="22-channel">2.2 Channel关闭特性<a class="headerlink" href="#22-channel" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">20</span>

<span class="w">    </span><span class="nx">receiver1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">receiver1</span><span class="p">)</span><span class="w"> </span><span class="c1">// 10</span>
<span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span><span class="w">              </span><span class="c1">// 关闭通道，队列变量可以继续取值；发送的值取完之后默认会取零值</span>

<span class="w">    </span><span class="nx">receiver2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">receiver2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 0</span>

<span class="w">    </span><span class="nx">receiver3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">receiver3</span><span class="p">)</span><span class="w"> </span><span class="c1">// 0</span>
<span class="p">}</span>


<span class="c1">// 10</span>
<span class="c1">// 20</span>
<span class="c1">// 0</span>
</code></pre></div>
<p><strong>Channel关闭之后有以下特点</strong>：</p>
<ul>
<li>对关闭通道再发送值会导致panic</li>
<li>对关闭通道可以继续取值，取完发送值之后，会默认继续可以取对应类型零值</li>
<li>对关闭通道再关闭会导致panic</li>
</ul>
<h4 id="23-channel">2.3 Channel有缓冲/无缓冲创建场景<a class="headerlink" href="#23-channel" title="Permanent link">&para;</a></h4>
<h5 id="231">2.3.1 有缓冲创建场景<a class="headerlink" href="#231" title="Permanent link">&para;</a></h5>
<p>有缓冲创建就相当于先存在里面，再取出</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="nx">receiver</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span><span class="w">  </span><span class="c1">// ok是判断是否通道已关闭（发送值取完后会自动关闭），当取完之后，ok值为false</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">receiver</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="232">2.3.2 无缓冲创建场景<a class="headerlink" href="#232" title="Permanent link">&para;</a></h5>
<p>一般使用在创建Goroutine，例如：</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">recv</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span><span class="w"> </span><span class="c1">// 必须先创建协程，再发送值；不然相当于没有接收者，同样会死锁</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">10</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">recv</span><span class="p">(</span><span class="nx">ch</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;接收值：&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="24-channel">2.4 Channel三种取值写法<a class="headerlink" href="#24-channel" title="Permanent link">&para;</a></h4>
<p><strong>第一种：判断是否已经取完</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;长度：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">ch</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;容量：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">ch</span><span class="p">))</span>

<span class="w">    </span><span class="c1">// 匿名函数循环送入值</span>
<span class="w">    </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">i</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nb">close</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span><span class="w"> </span><span class="c1">// 关闭通道</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="c1">// 循环取值打印 -- 如果发送值时没有对应关闭，取值超过通道的长度就会报错（即使没有达到容量）</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;i=&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ok=&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>第二种：for...range...直接取值（依然需要关闭通道，否则会发生panic）（推荐）</strong></p>
<p>for...range...使用在这里只能获取值，没有索引。</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;长度：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">ch</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;容量：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">ch</span><span class="p">))</span>

<span class="w">    </span><span class="c1">// 匿名函数循环送入值</span>
<span class="w">    </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">i</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nb">close</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span><span class="w"> </span><span class="c1">// 关闭通道</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="c1">// 循环取值打印 -- 直接取出对应值</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">ch</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;v=&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>第三种：select语句，一种高效的多路复用通道机制语法，允许再多个通道等待并处理消息</strong></p>
<p>select语句是 Go 语言并发编程中非常重要的控制结构，专门为通道设计，使用方式非常灵活。</p>
<p>语法伪代码：</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">channel1</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// channel1准备完毕</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">channel2</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// channel2准备完毕,且可以读取到数据data</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">channel3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">data</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// channel2准备完毕,且可以写入数据data</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// 没有通道准备完毕...</span>
<span class="p">}</span>
</code></pre></div>
<p>示例：任务超时判断</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 协程中停留3秒之后，发送一个值：10</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">        </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span><span class="p">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;接收值：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;通道已关闭&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nx">After</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">):</span><span class="w">  </span><span class="c1">// time.After返回一个只读的 Time 类型通道；如果时间早于其他通道；那就会走超时~</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;任务执行已超时！&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3_8">3 并发中锁应用<a class="headerlink" href="#3_8" title="Permanent link">&para;</a></h3>
<h4 id="31-mutex">3.1 互斥锁（Mutex）<a class="headerlink" href="#31-mutex" title="Permanent link">&para;</a></h4>
<p>互斥锁（<code>sync.Mutex</code>）是最基本的锁类型，它保证同一时间只有一个 goroutine 可以访问共享资源。</p>
<p><strong>特点：</strong></p>
<ol>
<li><strong>排他性</strong>：同一时刻只有一个 goroutine 能持有锁</li>
<li><strong>阻塞性</strong>：其他 goroutine 必须等待锁释放</li>
<li><strong>不可重入</strong>：同一个 goroutine 不能重复锁定已持有的锁（会导致死锁）</li>
</ol>
<p><strong>适用场景：</strong></p>
<ul>
<li>对共享数据的简单读写操作</li>
<li>临界区代码执行时间较短的情况</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">shareInt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="w">    </span><span class="c1">// 共享全局变量</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">lock</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span><span class="w"> </span><span class="c1">// 互斥锁</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

<span class="c1">// 定义功能函数</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">AutoAdd</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span><span class="w">  </span><span class="c1">// 任务完成，计数器减1</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">5000</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">lock</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span><span class="w">  </span><span class="c1">// 加锁</span>
<span class="w">        </span><span class="nx">shareInt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">shareInt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nx">lock</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span><span class="w">  </span><span class="c1">// 解锁</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="c1">// Goroutine任务个数</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">AutoAdd</span><span class="p">()</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">AutoAdd</span><span class="p">()</span>
<span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;shareInt:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">shareInt</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="32-rwmutex">3.2 读写锁（RWMutex）<a class="headerlink" href="#32-rwmutex" title="Permanent link">&para;</a></h4>
<p><strong>读写锁（<code>sync.RWMutex</code>）提供了更细粒度的控制：</strong></p>
<ul>
<li>多个 goroutine 可以同时持有读锁</li>
<li>写锁是排他的（与互斥锁相同）</li>
</ul>
<p><strong>特点：</strong></p>
<ol>
<li><strong>读共享</strong>：多个读操作可以同时进行</li>
<li><strong>写互斥</strong>：写操作是排他的</li>
<li><strong>读写互斥</strong>：有写操作时不能有读操作，反之亦然</li>
</ol>
<p><strong>适用场景：</strong></p>
<ul>
<li>读多写少的场景</li>
<li>共享数据被频繁读取但很少修改的情况</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;sync&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">shareInt</span><span class="w"> </span><span class="kt">int</span><span class="w">            </span><span class="c1">// 共享全局变量</span>
<span class="w">    </span><span class="nx">wg</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span><span class="w"> </span><span class="c1">// 同步等待组</span>
<span class="w">    </span><span class="nx">lock</span><span class="w">     </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span><span class="w">     </span><span class="c1">// 互斥锁 -- 测试耗时：2153ms</span>
<span class="w">    </span><span class="nx">rwLock</span><span class="w">   </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span><span class="w">   </span><span class="c1">// 读写锁-读多写少场景应用 -- 测试耗时：1008ms</span>
<span class="p">)</span>

<span class="c1">// 定义功能函数</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Read</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// defer wg.Done()</span>
<span class="w">    </span><span class="c1">// defer lock.Unlock()</span>
<span class="w">    </span><span class="c1">// lock.Lock()</span>

<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">rwLock</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span><span class="w"> </span><span class="c1">// 解读锁</span>
<span class="w">    </span><span class="nx">rwLock</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span><span class="w">         </span><span class="c1">// 加读锁</span>

<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// 设读操作需要1毫秒</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">Write</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// defer wg.Done()</span>
<span class="w">    </span><span class="c1">// defer lock.Unlock()</span>
<span class="w">    </span><span class="c1">// lock.Lock()</span>

<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">rwLock</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span><span class="w"> </span><span class="c1">// 解写锁</span>
<span class="w">    </span><span class="nx">rwLock</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span><span class="w">         </span><span class="c1">// 加写锁</span>

<span class="w">    </span><span class="nx">shareInt</span><span class="o">++</span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="c1">// 设写操作需要10毫秒</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// 读操作-10000次</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">Read</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 写操作-100次</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">Write</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">start</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="w">    </span><span class="nx">Run</span><span class="p">()</span>
<span class="w">    </span><span class="nx">usedTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nx">Milliseconds</span><span class="p">()</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;usedTime: %dms\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">usedTime</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;shareInt:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">shareInt</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>注意：</p>
<div class="highlight"><pre><span></span><code>sync.RWMutex.Lock() 与 sync.Mutex.Lock() 是有区别的，**互斥锁**：只有一个状态——加锁/解锁；**读写锁**：分为读锁（RLock）和写锁（Lock）；

读写锁之中的`Lock()`：写锁，独占；当写锁被持有时，读写都被阻塞。
</code></pre></div>
<h2 id="go">📚 Go语言的包<a class="headerlink" href="#go" title="Permanent link">&para;</a></h2>
<h3 id="1_17">1 包声明<a class="headerlink" href="#1_17" title="Permanent link">&para;</a></h3>
<ul>
<li>每个Go文件必须以<code>package</code>声明开头</li>
<li>主程序必须声明为<code>package main</code></li>
<li>同一目录下的所有文件必须属于同一个包</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w">  </span><span class="c1">// 主程序包</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2_14">2 导入路径<a class="headerlink" href="#2_14" title="Permanent link">&para;</a></h3>
<ul>
<li>标准库包直接使用短名称(如"fmt", "net/http")</li>
<li>第三方包使用完整路径(如"github.com/gin-gonic/gin")</li>
<li>本地包使用相对于<code>GOPATH</code>或模块根目录的路径</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span><span class="w">                </span><span class="c1">// 标准库</span>
<span class="w">    </span><span class="s">&quot;math/rand&quot;</span><span class="w">          </span><span class="c1">// 标准库子包</span>

<span class="w">    </span><span class="s">&quot;github.com/foo/bar&quot;</span><span class="w"> </span><span class="c1">// 第三方包</span>
<span class="w">    </span><span class="s">&quot;mymodule/mypkg&quot;</span><span class="w">     </span><span class="c1">// 本地模块包</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="3_9">3 导入别名<a class="headerlink" href="#3_9" title="Permanent link">&para;</a></h3>
<p>可以为导入的包指定别名，解决命名冲突或简化长包名：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;crypto/rand&quot;</span>
<span class="w">    </span><span class="nx">mrand</span><span class="w"> </span><span class="s">&quot;math/rand&quot;</span><span class="w">  </span><span class="c1">// 别名</span>
<span class="w">    </span><span class="nx">f</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span><span class="w">            </span><span class="c1">// 简短别名</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="4_8">4 点导入<a class="headerlink" href="#4_8" title="Permanent link">&para;</a></h3>
<p>使用点(.)导入包时，可以省略包名前缀(不推荐常用)：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;直接使用Println而不需要fmt前缀&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="5_8">5 空白导入（匿名导入）<a class="headerlink" href="#5_8" title="Permanent link">&para;</a></h3>
<p>使用下划线导入包<strong>仅执行包的init函数</strong>而不直接使用其功能：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;image/png&quot;</span><span class="w">  </span><span class="c1">// 注册PNG解码器</span>
</code></pre></div>
<h3 id="6_6">6 可见性规则<a class="headerlink" href="#6_6" title="Permanent link">&para;</a></h3>
<ul>
<li>大写字母开头的标识符(变量、函数、类型等)是公开的(exported)</li>
<li>小写字母开头的标识符是包私有的</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">mypkg</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">PublicVar</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="c1">// 可被其他包访问</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">privateVar</span><span class="w"> </span><span class="kt">int</span><span class="w">   </span><span class="c1">// 仅本包内可访问</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">PublicFunc</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span><span class="c1">// 可被其他包调用</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">privateFunc</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// 仅本包内可调用</span>
</code></pre></div>
<h3 id="7-init">7 init函数<a class="headerlink" href="#7-init" title="Permanent link">&para;</a></h3>
<ul>
<li>每个包可以包含多个init函数</li>
<li>init函数在程序启动时自动调用</li>
<li>执行顺序：导入的包先初始化，同一包内按文件名字母顺序</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">mypkg</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 初始化代码</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 可以有多个init函数</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="8_3">8 包文档<a class="headerlink" href="#8_3" title="Permanent link">&para;</a></h3>
<ul>
<li>包注释应紧接在package声明之前</li>
<li>使用完整的句子，以包名开头</li>
<li>可以使用godoc工具生成文档</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// Package mypkg provides some useful utilities.</span>
<span class="c1">// This is a sample package documentation.</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">mypkg</span>
</code></pre></div>
<h3 id="9-internal">9 内部包(internal)<a class="headerlink" href="#9-internal" title="Permanent link">&para;</a></h3>
<ul>
<li>放置在<code>internal</code>目录下的包只能被其父目录及其子目录中的代码导入</li>
<li>Go 1.4引入的机制，用于限制包的使用范围</li>
</ul>
<div class="highlight"><pre><span></span><code>mymodule/
├── internal/
│   └── myinternal/  // 只能被mymodule及其子目录导入
└── mypkg/
</code></pre></div>
<h3 id="10_1">10. 测试包<a class="headerlink" href="#10_1" title="Permanent link">&para;</a></h3>
<ul>
<li>测试文件以<code>_test.go</code>结尾</li>
<li>测试函数以<code>Test</code>开头</li>
<li>测试包可以与主包同名或加<code>_test</code>后缀</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">mypkg_test</span><span class="w">  </span><span class="c1">// 外部测试包</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>
<span class="w">    </span><span class="s">&quot;mymodule/mypkg&quot;</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="11-go-111">11. 模块支持(Go 1.11+)<a class="headerlink" href="#11-go-111" title="Permanent link">&para;</a></h3>
<ul>
<li>使用go.mod文件定义模块</li>
<li>模块路径成为包的导入路径</li>
<li>版本控制更加明确</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">module</span><span class="w"> </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">username</span><span class="o">/</span><span class="nx">mymodule</span>

<span class="k">go</span><span class="w"> </span><span class="mf">1.21</span>

<span class="nx">require</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">some</span><span class="o">/</span><span class="nx">dependency</span><span class="w"> </span><span class="nx">v1</span><span class="mf">.2.3</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="12_4">12. 包命名惯例<a class="headerlink" href="#12_4" title="Permanent link">&para;</a></h3>
<ul>
<li>包名应简短、小写、有意义</li>
<li>避免使用下划线或混合大小写</li>
<li>单数形式命名(如<code>url</code>而非<code>urls</code>)</li>
<li>避免与标准库重名</li>
</ul>
<h3 id="13-go118">13 工作空间（Go1.18+）<a class="headerlink" href="#13-go118" title="Permanent link">&para;</a></h3>
<p>多个模块方法引用：使用workspace处理</p>
<div class="highlight"><pre><span></span><code>WORKDEMO
├─app
│      go.mod
│      main.go
│
└─common
        go.mod
        utils.go
</code></pre></div>
<p>main.go需要使用common模块里面的utils包中的方法，如何做？Go1.18之前需要使用replace处理，这里不做示例；推荐使用Go1.18+的方式，使用工作空间建立联系.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 初始化工作空间-创建work文件</span>
go<span class="w"> </span>work<span class="w"> </span>init

<span class="c1"># 添加需要使用的模块（go.work文件会自动写入内容）</span>
go<span class="w"> </span>work<span class="w"> </span>use<span class="w"> </span>app<span class="w"> </span>common
</code></pre></div>
<p>执行命令之后，go.work文件内容变更为：</p>
<div class="highlight"><pre><span></span><code><span class="k">go</span><span class="w"> </span><span class="mf">1.24.5</span>

<span class="nx">use</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">.</span><span class="o">/</span><span class="nx">app</span>
<span class="w">    </span><span class="p">.</span><span class="o">/</span><span class="nx">common</span>
<span class="p">)</span>
</code></pre></div>
<p>这样再去main.go中导入包使用完全没问题了~</p>
<h2 id="goerror">📚 Go错误处理（error）<a class="headerlink" href="#goerror" title="Permanent link">&para;</a></h2>
<h3 id="1_18">1 标准错误<a class="headerlink" href="#1_18" title="Permanent link">&para;</a></h3>
<p>Go语言错误接口定义：任何实现此接口的类型，都被当成是错误。</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Error</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>
</code></pre></div>
<p>go语言是一种面向失败的编程，理论上每一个函数都应该返回error；以保证对错误的处理。</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;errors&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;reflect&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// 判断是否存在字段</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">HasField</span><span class="p">(</span><span class="nx">obj</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">fieldName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 获取结构体的反射值</span>
<span class="w">    </span><span class="nx">val</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 如果是指针，需要解引用</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">Kind</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Ptr</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">Elem</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 检查是否是结构体</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">Kind</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 获取字段</span>
<span class="w">    </span><span class="nx">field</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">FieldByName</span><span class="p">(</span><span class="nx">fieldName</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">IsValid</span><span class="p">()</span><span class="w"> </span><span class="c1">// 如果字段存在，返回 true</span>
<span class="p">}</span>

<span class="c1">// 获取字段值-注意返回接口类型-需要转换</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">GetFieldValue</span><span class="p">(</span><span class="nx">obj</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">fieldName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">val</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">Kind</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Ptr</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">Elem</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">Kind</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;not a struct&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">field</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">FieldByName</span><span class="p">(</span><span class="nx">fieldName</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">IsValid</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;field does not exist&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">Interface</span><span class="p">(),</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// 设置字段值-自动判断类型是否与原来匹配</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">SetFieldValue</span><span class="p">(</span><span class="nx">obj</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">fieldName</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">newValue</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">val</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">Kind</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Ptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">Elem</span><span class="p">().</span><span class="nx">Kind</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;must be a pointer to struct&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">field</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">val</span><span class="p">.</span><span class="nx">Elem</span><span class="p">().</span><span class="nx">FieldByName</span><span class="p">(</span><span class="nx">fieldName</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">IsValid</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;field does not exist&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">field</span><span class="p">.</span><span class="nx">CanSet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;field cannot be set (unexported?)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">newVal</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">newValue</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="nx">Type</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">newVal</span><span class="p">.</span><span class="nx">Type</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;type mismatch&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">field</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">newVal</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">GetFieldValue</span><span class="p">(</span><span class="nx">field</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">HasField</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;field &#39;%s&#39; not found&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">setErr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">SetFieldValue</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">)</span><span class="w"> </span><span class="c1">// 设置字段值</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">setErr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Error setting value:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">setErr</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">val</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">GetFieldValue</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">)</span><span class="w"> </span><span class="c1">// 获取字段值</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">val</span><span class="p">.(</span><span class="kt">string</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cenhongchang&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">GetFieldValue</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2_15">2 利用接口自定义错误<a class="headerlink" href="#2_15" title="Permanent link">&para;</a></h3>
<p>示例：实现错误接口 / 自定义错误 / 判断返回的是自定义哪种错误 / 将error接口对象转为struct对象获取其中错误信息</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;errors&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="c1">// 定义错误结构体</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">MyError</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Message</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// 自定义错误myError结构体实现错误接口-Error()</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">*</span><span class="nx">MyError</span><span class="p">)</span><span class="w"> </span><span class="nx">Error</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Message</span>
<span class="p">}</span>

<span class="c1">// 利用结构体实例化自定义错误</span>
<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">MoneyNotEnough</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">MyError</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;not enough money&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">MoneyTooMuch</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">MyError</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pay too much&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">Pay</span><span class="p">(</span><span class="nx">money</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">money</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">MoneyNotEnough</span><span class="w"> </span><span class="c1">// 返回具体自定义的错误</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">money</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">MoneyTooMuch</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">User</span><span class="p">)</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Pay</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="c1">// 定义函数时返回的是error接口/不是结构体类型-需要注意；当然也可以改为对应结构体指针</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">MoneyNotEnough</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;错误原因是MoneyNotEnough:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="c1">// 把接口转为具体的结构体类型</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">myError</span><span class="w"> </span><span class="o">*</span><span class="nx">MyError</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">As</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">myError</span><span class="p">);</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;已将返回的接口err对象转为具体结构体对象指针，错误信息：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">myError</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">MoneyTooMuch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;错误原因是MoneyTooMuch:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;错误原因非自定义错误:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;支付成功&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3_10">3 错误封装<a class="headerlink" href="#3_10" title="Permanent link">&para;</a></h3>
<h4 id="31-fmterrorf">3.1 fmt.Errorf()<a class="headerlink" href="#31-fmterrorf" title="Permanent link">&para;</a></h4>
<p>使用fmt.Errorf()，可以将一个错误进行封装，封装后的错误和之前的相等</p>
<ul>
<li>使用%w 嵌套生成一个新的错误</li>
<li>errors.Unwrap用于将一个错误对象展开，得到下一层错误对象（未封装前的）</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">originalErr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;原始错误&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// %w 嵌套生成一个新的错误</span>
<span class="w">    </span><span class="nx">newError</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;error: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">originalErr</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;newError:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">newError</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">newError</span><span class="p">,</span><span class="w"> </span><span class="nx">originalErr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;这两个错误相等&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// errors.Unwrap用于将一个错误对象展开，得到下一层错误对象</span>
<span class="w">    </span><span class="nx">originalErr1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Unwrap</span><span class="p">(</span><span class="nx">newError</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;originalErr1:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">originalErr1</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">originalErr</span><span class="p">,</span><span class="w"> </span><span class="nx">originalErr1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;这两个错误相等&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="31-errorsjoingo120">3.1 errors.Join()（Go1.20+）<a class="headerlink" href="#31-errorsjoingo120" title="Permanent link">&para;</a></h4>
<p><code>errors.Join()</code> 是 Go 1.20 版本引入的一个实用函数，用于将多个错误合并为一个复合错误。</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;errors&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">err1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;error 1&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">err2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;error 2&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">err3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;error 3&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">combinedErr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">err1</span><span class="p">,</span><span class="w"> </span><span class="nx">err2</span><span class="p">,</span><span class="w"> </span><span class="nx">err3</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">combinedErr</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// 输出: error 1</span>
<span class="w">    </span><span class="c1">//       error 2</span>
<span class="w">    </span><span class="c1">//       error 3</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>主要特性</strong>:</p>
<ol>
<li><strong>自动过滤nil错误</strong>：</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;real error&quot;</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="c1">// 只包含&quot;real error&quot;</span>
</code></pre></div>
<ol>
<li>
<p><strong>单错误优化</strong>：</p>
</li>
<li>
<p>如果只传入一个非nil错误，直接返回该错误</p>
</li>
<li>
<p>如果所有错误都是nil，返回nil</p>
</li>
<li>
<p><strong>多行错误信息</strong>：</p>
</li>
<li>
<p>复合错误的<code>Error()</code>方法返回多行字符串</p>
</li>
<li>每行对应一个子错误</li>
</ol>
<h3 id="4-panic-">4 panic - 运行时错误<a class="headerlink" href="#4-panic-" title="Permanent link">&para;</a></h3>
<p>直接处理：</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">recover</span><span class="p">();</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;捕获到异常：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;程序异常，将自动退出...&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>赋值给函数错误对象返回值：</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">myTest</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// 提前指定返回变量的初始化；error类型零值为nil</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">recover</span><span class="p">();</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;捕获异常：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<span class="w">            </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;除数不能为零&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// 修改返回变量</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">myTest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;发生错误:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;计算结果:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 捕获异常： runtime error: integer divide by zero</span>
<span class="c1">// 发生错误: 除数不能为零</span>
</code></pre></div>
<h2 id="gonet">📚 Go网络编程（net包）<a class="headerlink" href="#gonet" title="Permanent link">&para;</a></h2>
<h3 id="1-tcp">1 TCP网络编程<a class="headerlink" href="#1-tcp" title="Permanent link">&para;</a></h3>
<p><strong>TCP协议：TCP（Transmission Control Protocol，传输控制协议）</strong> 是一种面向连接的、可靠的、基于字节流的传输层通信协议。</p>
<ol>
<li><strong>传输层协议</strong>：它工作在 OSI 模型的第四层（或 TCP/IP 模型的第三层），负责为上层应用（如 HTTP、FTP、电子邮件）提供端到端的通信服务。</li>
<li><strong>面向连接</strong>：在数据传输开始之前，通信双方必须首先建立一个可靠的连接（通过“三次握手”），传输结束后再断开连接（通过“四次挥手”）。这就像打电话，需要先拨通，通话，再挂断。</li>
<li><strong>可靠的</strong>：TCP 使用各种机制（如确认应答、超时重传、序列号等）来确保数据能够准确、不重复、不失序地到达对方。</li>
<li><strong>基于字节流</strong>：TCP 将应用层交下来的数据仅仅视为一连串无结构的字节流。它不关心这些字节流代表什么含义（如图片、文字），它只负责将这些字节流可靠地传输到对端。接收方应用程序需要自己解析这些字节流。</li>
</ol>
<h4 id="11-tcpserver-">1.1 tcpserver-服务端<a class="headerlink" href="#11-tcpserver-" title="Permanent link">&para;</a></h4>
<ul>
<li>阻塞监听IP+端口</li>
<li>客户端请求接收，建立连接</li>
<li>创建goroutine处理请求</li>
<li>关闭连接</li>
<li>关闭监听服务</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;net&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 监听IP+端口 -&gt; 标识某一个程序</span>
<span class="w">    </span><span class="nx">listen</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Listen</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;127.0.0.1:8080&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">listen</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 队列消息接收 / 建立连接</span>
<span class="w">        </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">listen</span><span class="p">.</span><span class="nx">Accept</span><span class="p">()</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">continue</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// 协程处理</span>
<span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>

<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">buf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span>
<span class="w">        </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<span class="w">        </span><span class="nx">n</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span><span class="w"> </span><span class="c1">// 读取数据 - 接收</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[client] %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">]))</span>

<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span><span class="w"> </span><span class="c1">// 写入数据 - 返回</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="12-tcpclient-">1.2 tcpclient-客户端<a class="headerlink" href="#12-tcpclient-" title="Permanent link">&para;</a></h4>
<ul>
<li>建立于服务端的连接</li>
<li>进行数据收发</li>
<li>关闭连接</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;net&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="w">    </span><span class="s">&quot;strings&quot;</span>
<span class="w">    </span><span class="s">&quot;unicode/utf8&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">dial</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Dial</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;127.0.0.1:8080&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">dial</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">)</span><span class="w"> </span><span class="c1">// 接收用户输入</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">ReadString</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 读取用户输入</span>
<span class="w">        </span><span class="nx">trim</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Trim</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\r\n&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">count</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">utf8</span><span class="p">.</span><span class="nx">RuneCountInString</span><span class="p">(</span><span class="nx">trim</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;输入的字符长度不能超过50个字符&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">continue</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">ToUpper</span><span class="p">(</span><span class="nx">trim</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Q&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="w"> </span><span class="c1">// 如果读取输入的是q/Q，则退出输入</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 输入一次写入一次数据 / 数据交换 - 发起请求</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dial</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">trim</span><span class="p">))</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 数据读取 - 返回接收</span>
<span class="w">        </span><span class="nx">buf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">trim</span><span class="p">))</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dial</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[server] %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2-udp">2 UDP网络编程<a class="headerlink" href="#2-udp" title="Permanent link">&para;</a></h3>
<p><strong>UDP协议：UDP</strong> 是一种<strong>无连接的、不可靠的</strong>传输层协议；实时性好，通常用于开发网络直播应用场景。</p>
<ol>
<li><strong>传输层协议</strong>：和 TCP 一样，工作在 OSI 模型的第四层，为应用层提供服务。</li>
<li><strong>无连接</strong>：在通信之前不需要先建立连接。想发送数据时直接发送即可。这就像寄明信片，写上地址内容就直接投递，不关心对方是否收到。</li>
<li><strong>不可靠</strong>：它不提供数据包的分组、组装、排序，也不保证数据包一定会到达目的地。如果报文在中途丢失，UDP 不会重传。它的核心任务就是“发送”，至于结果如何，它不管。</li>
<li><strong>基于数据报</strong>：与 TCP 的“字节流”不同，UDP 传输的是一个个独立的报文（称为数据报）。每个报文都是一个独立的单元，发送和接收都有明确的边界。应用程序发送多少次，接收方就会收到多少次，不会出现粘包问题。</li>
</ol>
<h4 id="21-udpserver-">2.1 udpserver-服务端<a class="headerlink" href="#21-udpserver-" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;net&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">listenUDP</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">ListenUDP</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;udp&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;</span><span class="nx">net</span><span class="p">.</span><span class="nx">UDPAddr</span><span class="p">{</span>
<span class="w">            </span><span class="nx">IP</span><span class="p">:</span><span class="w">   </span><span class="nx">net</span><span class="p">.</span><span class="nx">IPv4</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">            </span><span class="nx">Port</span><span class="p">:</span><span class="w"> </span><span class="mi">30030</span><span class="p">,</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">listenUDP</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// /////////UDP协议不需要连接/////////</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">buf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span>
<span class="w">        </span><span class="nx">n</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">listenUDP</span><span class="p">.</span><span class="nx">ReadFromUDP</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span><span class="w"> </span><span class="c1">// 读取数据会获取到发送的IP地址</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="s">&quot;error reading UDP msg buf:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[server] [%s] %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="p">,</span><span class="w"> </span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">listenUDP</span><span class="p">.</span><span class="nx">WriteToUDP</span><span class="p">(</span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">],</span><span class="w"> </span><span class="nx">addr</span><span class="p">)</span><span class="w"> </span><span class="c1">// 向发送的IP地址返回数据</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="22-udpclient-">2.2 udpclient-客户端<a class="headerlink" href="#22-udpclient-" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cm">/**/</span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;net&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="w">    </span><span class="s">&quot;strings&quot;</span>
<span class="w">    </span><span class="s">&quot;unicode/utf8&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">dialUDP</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">DialUDP</span><span class="p">(</span><span class="s">&quot;udp&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">net</span><span class="p">.</span><span class="nx">UDPAddr</span><span class="p">{</span>
<span class="w">        </span><span class="nx">IP</span><span class="p">:</span><span class="w">   </span><span class="nx">net</span><span class="p">.</span><span class="nx">IPv4</span><span class="p">(</span><span class="mi">127</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Port</span><span class="p">:</span><span class="w"> </span><span class="mi">30030</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">dialUDP</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">)</span><span class="w"> </span><span class="c1">// 接收用户输入</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">ReadString</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 读取用户输入</span>
<span class="w">        </span><span class="nx">trim</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Trim</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\r\n&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">count</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">utf8</span><span class="p">.</span><span class="nx">RuneCountInString</span><span class="p">(</span><span class="nx">trim</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;输入的字符长度不能超过50个字符&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">continue</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">ToUpper</span><span class="p">(</span><span class="nx">trim</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Q&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="w"> </span><span class="c1">// 如果读取输入的是q/Q，则退出输入</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 输入一次写入一次数据 / 数据交换 - 发起请求</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dialUDP</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">trim</span><span class="p">))</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 数据读取 - 返回接收</span>
<span class="w">        </span><span class="nx">buf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">trim</span><span class="p">))</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dialUDP</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[client] %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<h3 id="3-http">3 HTTP网络编程<a class="headerlink" href="#3-http" title="Permanent link">&para;</a></h3>
<h4 id="31-httpserver">3.1 httpserver<a class="headerlink" href="#31-httpserver" title="Permanent link">&para;</a></h4>
<p>这部分属于web后端开发内容</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/login&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">login</span><span class="p">)</span><span class="w">         </span><span class="c1">// 单独添加回调函数</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8000&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span><span class="w"> </span><span class="c1">// IP:PORT、回调函数</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">login</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 请求信息</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;请求IP:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;请求方式：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;请求路径：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Header：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Header</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Body：&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 获取GET请求数据</span>
<span class="w">    </span><span class="nx">username</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Query</span><span class="p">().</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;username&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">password</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Query</span><span class="p">().</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[client] username:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">username</span><span class="p">)</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[client] password:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">username</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;admin&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;123456&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;登录成功&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;用户名或密码错误&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="32-httpclient">3.2 httpclient<a class="headerlink" href="#32-httpclient" title="Permanent link">&para;</a></h4>
<p>一般浏览器就是一种http客户端，包括像postman等网络接口测试软件</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;io&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 发送GET请求</span>
<span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://localhost:8000/login?username=admin&amp;password=123456&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// body, err := io.ReadAll(resp.Body) // 一次性读取全部内容</span>
<span class="w">    </span><span class="c1">// log.Printf(&quot;[client] %s&quot;, string(body))</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">totalBytes</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 读取响应信息</span>
<span class="w">        </span><span class="nx">buf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span>
<span class="w">        </span><span class="nx">n</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">break</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">totalBytes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">totalBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="p">]</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[client] %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">totalBytes</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="gocontext">📚 Go语言Context<a class="headerlink" href="#gocontext" title="Permanent link">&para;</a></h2>
<p>并发编程是Go语言的特色；有效管理并发对就见稳定健壮的程序至关重要！</p>
<p><code>context</code> 是编写健壮、可控制的并发 Go 程序的基石，尤其是在网络服务中，几乎是必不可少的工具。</p>
<p>它的主要设计目的是<strong>在多个 Goroutine 之间传递请求域的截止时间、取消信号以及其他键值对信息</strong>。</p>
<h3 id="1-context">1 根context<a class="headerlink" href="#1-context" title="Permanent link">&para;</a></h3>
<p>context的设计就像是一棵树，层层派生结构。</p>
<p>Go 的 <code>context</code> 包提供了两个函数来创建根 Context：</p>
<h4 id="11-contextbackground">1.1 context.Background()<a class="headerlink" href="#11-contextbackground" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>这是最常用的、标准的根 Context。</strong></li>
<li><strong>使用场景</strong>：</li>
<li>用在 <code>main</code> 函数的开头。</li>
<li>用在初始化函数（<code>init</code>）中。</li>
<li>用作测试的起点。</li>
<li><strong>简单说：当你是整个调用链的发起者时，就用它。</strong></li>
</ul>
<h4 id="12-contexttodo">1.2 context.TODO()<a class="headerlink" href="#12-contexttodo" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>它和 <code>Background()</code> 在功能上完全一样</strong>，也是一个空的、永不取消的根 Context。</li>
<li><strong>使用场景</strong>：</li>
<li><strong>占位符</strong>：当你不确定该使用哪个 Context 时，先用 <code>TODO()</code> 占位。</li>
<li><strong>重构期</strong>：在重构代码，准备添加 Context 参数但还没想好如何集成时使用。</li>
<li><strong>静态分析</strong>：它的名字 <code>TODO</code> 就像一个给开发者和代码分析工具的<strong>显式提醒</strong>——“这里将来可能需要一个真正的 Context，但目前暂时这样”。你应该在最终代码中将它替换为合适的 Context。</li>
<li><strong>记忆技巧</strong>：就像你在代码里写 <code>// TODO: Implement this later</code> 一样，<code>context.TODO()</code> 是一个待办事项。</li>
</ul>
<h4 id="13-context">1.3 根context派生<a class="headerlink" href="#13-context" title="Permanent link">&para;</a></h4>
<p><code>context</code> 包提供了函数来基于父 Context 创建子 Context，从而添加上下文信息：</p>
<table>
<thead>
<tr>
<th style="text-align: left;">函数</th>
<th style="text-align: left;">引入版本</th>
<th style="text-align: left;">核心功能</th>
<th style="text-align: left;">常用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong><code>WithCancel</code></strong></td>
<td style="text-align: left;">Go 1.7</td>
<td style="text-align: left;">创建可<strong>手动取消</strong>的 Context。</td>
<td style="text-align: left;">手动控制取消，如用户中断。</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>WithTimeout</code></strong></td>
<td style="text-align: left;">Go 1.7</td>
<td style="text-align: left;">创建<strong>相对超时</strong>后自动取消的 Context。</td>
<td style="text-align: left;"><strong>最常用</strong>，为操作设置最大执行时间。</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>WithDeadline</code></strong></td>
<td style="text-align: left;">Go 1.7</td>
<td style="text-align: left;">创建<strong>绝对截止时间</strong>后自动取消的 Context。</td>
<td style="text-align: left;">操作必须在某个具体时间点前完成。</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>WithValue</code></strong></td>
<td style="text-align: left;">Go 1.7</td>
<td style="text-align: left;">创建携带<strong>请求域键值对</strong>的 Context。</td>
<td style="text-align: left;">传递请求ID、用户令牌等（谨慎使用）。</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>WithCancelCause</code></strong></td>
<td style="text-align: left;">Go 1.20/1.21</td>
<td style="text-align: left;">创建可附带<strong>具体原因</strong>的取消 Context。</td>
<td style="text-align: left;">需要明确区分和传递取消原因的高级场景。</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>WithoutCancel</code></strong></td>
<td style="text-align: left;">Go 1.21</td>
<td style="text-align: left;">创建<strong>脱离父Context取消链</strong>的 Context。</td>
<td style="text-align: left;">执行不受主请求影响的独立后台任务。</td>
</tr>
</tbody>
</table>
<p>根 Context 本身没什么用，它的强大之处在于作为<strong>派生</strong>的起点。</p>
<p>整个 Context 的使用流程就像一棵树的生长：<strong>根 Context -&gt; 派生具有功能的子 Context -&gt; 继续派生 -&gt; ... -&gt; 在 Goroutine 中使用</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 第1步：创建根Context</span>
<span class="w">    </span><span class="c1">// 这里是整个程序的起点，所以我们用 Background()</span>
<span class="w">    </span><span class="nx">rootCtx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// 第2步：从根Context派生一个子Context</span>
<span class="w">    </span><span class="c1">// 这个子Context具备了超时取消的功能（1秒后自动取消）</span>
<span class="w">    </span><span class="c1">// ctx 是新的子Context</span>
<span class="w">    </span><span class="c1">// cancelFunc 是一个函数，调用它可以手动提前取消这个ctx</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancelFunc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">rootCtx</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// 非常重要：确保cancel函数被调用，以释放相关资源，防止泄露</span>
<span class="w">    </span><span class="c1">// 即使超时自动发生，调用cancel也是安全的（幂等操作）</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cancelFunc</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// 第3步：将派生出的、有功能的ctx传递给需要它的函数</span>
<span class="w">    </span><span class="c1">// 这个函数会监听ctx的取消信号</span>
<span class="w">    </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 创建一个通道，模拟一个需要长时间运行的任务（5秒）</span>
<span class="w">    </span><span class="nx">done</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kd">struct</span><span class="p">{})</span>

<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span><span class="w"> </span><span class="c1">// 模拟耗时工作</span>
<span class="w">        </span><span class="nb">close</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span><span class="w">                 </span><span class="c1">// 工作完成，关闭通道</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="c1">// 使用select同时等待两个事件：要么工作完成，要么ctx被取消</span>
<span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">done</span><span class="p">:</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;工作完成了！&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span><span class="w"> </span><span class="c1">// 监听ctx的取消信号。如果父context超时或调用了cancel，这里会立即触发</span>
<span class="w">        </span><span class="c1">// ctx.Err() 会告诉我们取消的原因</span>
<span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Err</span><span class="p">()</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;工作被取消了，原因: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2-context">2 超时控制context<a class="headerlink" href="#2-context" title="Permanent link">&para;</a></h3>
<h4 id="21-withtimeout">2.1 基本示例-WithTimeout()<a class="headerlink" href="#21-withtimeout" title="Permanent link">&para;</a></h4>
<p><strong>WithTimeout</strong>: 返回一个具有超时时间的 Context。<strong>使用频率很高</strong>，例如为数据库查询设置超时</p>
<p>假设我们需要从多个API并发获取数据，某个接口超时了，就将其请求取消掉；一般这种情景都是向外部API获取数据，这里用本地接口做实验。</p>
<p><strong>外部的服务：实际场景本地服务需要调用外部服务接口（实验用的本地接口）</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;io&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;sync&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Result</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Url</span><span class="w">     </span><span class="kt">string</span><span class="w">         </span><span class="s">`json:&quot;url&quot;`</span><span class="w">             </span><span class="c1">// 请求的 URL 地址</span>
<span class="w">    </span><span class="nx">Message</span><span class="w"> </span><span class="kt">string</span><span class="w">         </span><span class="s">`json:&quot;message&quot;`</span><span class="w">         </span><span class="c1">// 设置信息</span>
<span class="w">    </span><span class="nx">Error</span><span class="w">   </span><span class="kt">error</span><span class="w">          </span><span class="s">`json:&quot;error,omitempty&quot;`</span><span class="w"> </span><span class="c1">// 请求过程中发生的错误</span>
<span class="w">    </span><span class="nx">Latency</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w">  </span><span class="s">`json:&quot;latency&quot;`</span><span class="w">         </span><span class="c1">// 请求耗时（从开始到结束的时间间隔）</span>
<span class="w">    </span><span class="nx">Size</span><span class="w">    </span><span class="kt">int64</span><span class="w">          </span><span class="s">`json:&quot;size&quot;`</span><span class="w">            </span><span class="c1">// 响应体（Response Body）的大小（字节数）</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">  </span><span class="kt">int</span><span class="w">            </span><span class="s">`json:&quot;status&quot;`</span><span class="w">          </span><span class="c1">// HTTP 状态码（如 200, 404, 500等）</span>
<span class="w">    </span><span class="nx">Resp</span><span class="w">    </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="w"> </span><span class="s">`json:&quot;-&quot;`</span><span class="w">               </span><span class="c1">// 使用 - 忽略该字段</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)</span>
<span class="w">    </span><span class="nx">callTime</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">DateTime</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2025-08-23 00:00:00&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// callTime := time.Now().Add(5 * time.Second)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">callTime</span><span class="p">)</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithDeadline</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">callTime</span><span class="p">)</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span><span class="w"> </span><span class="c1">// 保证最终任务都要结束</span>

<span class="w">    </span><span class="nx">urls</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;http://localhost:8000/test1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;http://localhost:8000/test2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;http://localhost:8000/test3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 执行结果通道数据</span>
<span class="w">    </span><span class="nx">results</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="nx">Result</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">urls</span><span class="p">))</span>

<span class="w">    </span><span class="c1">// 使用WaitGroup等待所有goroutine完成</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">urls</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// 匿名函数方便获取执行是否结束</span>
<span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<span class="w">            </span><span class="nx">fetchAPI</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="nx">results</span><span class="p">)</span>
<span class="w">        </span><span class="p">}(</span><span class="nx">url</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">marshal</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">marshal</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">fetchAPI</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="kd">chan</span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">Result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">startTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Result</span><span class="p">{</span><span class="nx">Url</span><span class="p">:</span><span class="w"> </span><span class="nx">url</span><span class="p">}</span>

<span class="w">    </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewRequestWithContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Message</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Failed to create request object based on context, err: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Latency</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">startTime</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// result.Error = err</span>
<span class="w">        </span><span class="nx">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">result</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">DefaultClient</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Message</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Fetch API exception, err: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Latency</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">startTime</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// result.Error = err</span>
<span class="w">        </span><span class="nx">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">result</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="c1">// 结束时关闭请求数据流</span>

<span class="w">    </span><span class="nx">respBody</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Message</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Read body exception, err: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Latency</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">startTime</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// result.Error = err</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Resp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">resp</span>
<span class="w">        </span><span class="nx">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">result</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;resp.Body:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">respBody</span><span class="p">))</span>

<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">Message</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Fetch API Success, Url: %s, Status: %v, Content: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">,</span><span class="w"> </span><span class="nx">respBody</span><span class="p">)</span>
<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">Latency</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">startTime</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// result.Error = err</span>
<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">Size</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">respBody</span><span class="p">))</span>
<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span>
<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">Resp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">resp</span>
<span class="w">    </span><span class="nx">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">result</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>我们的服务：需要调用外部服务接口（实验用的本地接口）</strong></p>
<ol>
<li>创建结果存储的结构体；</li>
<li>创建协程通道存储结果结构体；</li>
<li>创建协程上下文超时管理器（context.WithTimeout）；</li>
<li>协程执行函数中，使用协程上下文超时管理器去创建请求（req,_  := http.NewRequestWithContext(ctx, "GET", url, nil)）；</li>
<li>使用sync.WaitGroup等待所有goroutine执行完成；</li>
<li>使用http默认客户端函数发送请求（http.DefaultClient.Do(req)）</li>
<li>对请求处理，将预期结果赋值到结果结构体</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;io&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;sync&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Result</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Url</span><span class="w">     </span><span class="kt">string</span><span class="w">         </span><span class="s">`json:&quot;url&quot;`</span><span class="w">             </span><span class="c1">// 请求的 URL 地址</span>
<span class="w">    </span><span class="nx">Message</span><span class="w"> </span><span class="kt">string</span><span class="w">         </span><span class="s">`json:&quot;message&quot;`</span><span class="w">         </span><span class="c1">// 设置信息</span>
<span class="w">    </span><span class="nx">Error</span><span class="w">   </span><span class="kt">error</span><span class="w">          </span><span class="s">`json:&quot;error,omitempty&quot;`</span><span class="w"> </span><span class="c1">// 请求过程中发生的错误</span>
<span class="w">    </span><span class="nx">Latency</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w">  </span><span class="s">`json:&quot;latency&quot;`</span><span class="w">         </span><span class="c1">// 请求耗时（从开始到结束的时间间隔）</span>
<span class="w">    </span><span class="nx">Size</span><span class="w">    </span><span class="kt">int64</span><span class="w">          </span><span class="s">`json:&quot;size&quot;`</span><span class="w">            </span><span class="c1">// 响应体（Response Body）的大小（字节数）</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">  </span><span class="kt">int</span><span class="w">            </span><span class="s">`json:&quot;status&quot;`</span><span class="w">          </span><span class="c1">// HTTP 状态码（如 200, 404, 500等）</span>
<span class="w">    </span><span class="nx">Resp</span><span class="w">    </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="w"> </span><span class="s">`json:&quot;-&quot;`</span><span class="w">               </span><span class="c1">// 使用 - 忽略该字段</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="mi">5</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span><span class="w"> </span><span class="c1">// 保证最终任务都要结束</span>

<span class="w">    </span><span class="nx">urls</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;http://localhost:8000/test1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;http://localhost:8000/test2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;http://localhost:8000/test3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 执行结果通道数据</span>
<span class="w">    </span><span class="nx">results</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="nx">Result</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">urls</span><span class="p">))</span>

<span class="w">    </span><span class="c1">// 使用WaitGroup等待所有goroutine完成</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">urls</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// 匿名函数方便获取执行是否结束</span>
<span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<span class="w">            </span><span class="nx">fetchAPI</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="nx">results</span><span class="p">)</span>
<span class="w">        </span><span class="p">}(</span><span class="nx">url</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span><span class="w">  </span><span class="c1">// 等全部执行完成</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">marshal</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">marshal</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">fetchAPI</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="kd">chan</span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">Result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">startTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Result</span><span class="p">{</span><span class="nx">Url</span><span class="p">:</span><span class="w"> </span><span class="nx">url</span><span class="p">}</span>

<span class="w">    </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewRequestWithContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Message</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Failed to create request object based on context, err: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Latency</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">startTime</span><span class="p">)</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Error</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="nx">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">result</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">DefaultClient</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Message</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Fetch API exception, err: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Latency</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">startTime</span><span class="p">)</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Error</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="nx">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">result</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="c1">// 结束时关闭请求数据流</span>

<span class="w">    </span><span class="nx">respBody</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Message</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Read body exception, err: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Latency</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">startTime</span><span class="p">)</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Error</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span>
<span class="w">        </span><span class="nx">result</span><span class="p">.</span><span class="nx">Resp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">resp</span>
<span class="w">        </span><span class="nx">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">result</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;resp.Body:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">respBody</span><span class="p">))</span>

<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">Message</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Fetch API Success, Url: %s, Status: %v, Content: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">,</span><span class="w"> </span><span class="nx">respBody</span><span class="p">)</span>
<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">Latency</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">startTime</span><span class="p">)</span>
<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">Error</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">Size</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">respBody</span><span class="p">))</span>
<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span>
<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">Resp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">resp</span>
<span class="w">    </span><span class="nx">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">result</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="22-context">2.2 超时context相关内置方法<a class="headerlink" href="#22-context" title="Permanent link">&para;</a></h4>
<p>超时context有四个方法：</p>
<ul>
<li>Deadline()：返回超时截止时间（当父子派生时，且父子都有一个截止时间；则此时返回其中较小的那个截止时间）</li>
<li>Done()：context取消后会调用</li>
<li>Err()：Done返回后，使用Err()可以获取结束原因</li>
<li>Value()：获取键值</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;log&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">timeOutNumber</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="c1">// 设置超时</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">rootCtx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">rootCtx</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">(</span><span class="nx">timeOutNumber</span><span class="p">)</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span>

<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="c1">// 循环执行任务时每次检查是否超时</span>
<span class="w">    </span><span class="c1">// processNew(ctx) // 监听多个通道方式</span>

<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Main Goroutine is Done&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 实际工作放在这里</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Process: Canceled during work&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="k">default</span><span class="p">:</span>
<span class="w">            </span><span class="c1">// 执行工作单元</span>
<span class="w">            </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">500</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Process: Doing work&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Process: All work completed&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">processNew</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. 创建一个无缓冲channel用于通知工作完成</span>
<span class="w">    </span><span class="nx">done</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kd">struct</span><span class="p">{})</span>

<span class="w">    </span><span class="c1">// 2. 启动goroutine执行实际工作</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span><span class="w"> </span><span class="c1">// 模拟耗时操作</span>
<span class="w">        </span><span class="nb">close</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span><span class="w">                 </span><span class="c1">// 工作完成后关闭channel，触发done通道初始化完成有零值</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="c1">// 3. 同时监听两个channel</span>
<span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span><span class="w"> </span><span class="c1">// 上下文被取消/超时</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Process: Timeout or canceled&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">done</span><span class="p">:</span><span class="w"> </span><span class="c1">// 工作正常完成</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Process: Work completed successfully&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="23-withtimeoutcause">2.3 WithTimeoutCause()<a class="headerlink" href="#23-withtimeoutcause" title="Permanent link">&para;</a></h4>
<p><strong>WithTimeoutCause()</strong>是Go 1.21新增特性；与<strong>WithTimeout()</strong>不同的是，<strong>WithTimeoutCause()</strong>创建的context，可以自定义错误，增强查看日志时的实用性；</p>
<p>使用：<strong>context.Cause(ctx)</strong> 获取自定义错误信息</p>
<div class="highlight"><pre><span></span><code><span class="nx">rootCtx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<span class="c1">// ctx, cancel := context.WithTimeout(rootCtx, time.Duration(timeOutNumber)*time.Second)</span>
<span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithTimeoutCause</span><span class="p">(</span><span class="nx">rootCtx</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">(</span><span class="nx">timeOutNumber</span><span class="p">)</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;协程任务已超时！&quot;</span><span class="p">))</span>
<span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span>

<span class="c1">// ...</span>
<span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Process: Canceled during work; Error: %s; Cause: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Err</span><span class="p">(),</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Cause</span><span class="p">(</span><span class="nx">ctx</span><span class="p">))</span>
<span class="w">    </span><span class="k">return</span>
<span class="c1">// ...</span>
</code></pre></div>
<h3 id="3-context">3 值传递context<a class="headerlink" href="#3-context" title="Permanent link">&para;</a></h3>
<p><strong>WithValue</strong>: 用于在 Context 中存储键值对。<strong>应谨慎使用不要滥用，仅用于传递请求域的数据（如请求ID、用户认证令牌），而不应传递函数可选参数或程序运行时的变量</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/google/uuid&quot;</span>
<span class="w">    </span><span class="s">&quot;sync&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

<span class="w">    </span><span class="nx">requestID</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">uuid</span><span class="p">.</span><span class="nx">NewRandom</span><span class="p">()</span>

<span class="w">    </span><span class="nx">rootCtx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<span class="w">    </span><span class="nx">ctx1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithValue</span><span class="p">(</span><span class="nx">rootCtx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;requestID&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">requestID</span><span class="p">)</span><span class="w"> </span><span class="c1">// 根派生</span>
<span class="w">    </span><span class="nx">ctx2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithValue</span><span class="p">(</span><span class="nx">ctx1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;userID&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w">               </span><span class="c1">// ctx1派生</span>

<span class="w">    </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<span class="w">       </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">       </span><span class="k">go</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="p">}(</span><span class="nx">ctx1</span><span class="p">)</span>

<span class="w">    </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<span class="w">       </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">       </span><span class="k">go</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="p">}(</span><span class="nx">ctx2</span><span class="p">)</span>

<span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Processing request ID: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Value</span><span class="p">(</span><span class="s">&quot;requestID&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Processing user ID: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Value</span><span class="p">(</span><span class="s">&quot;userID&quot;</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// Processing request ID: 9648a146-4020-4add-b9f0-c37f3b006a4c</span>
<span class="c1">// Processing user ID: %!d(&lt;nil&gt;)</span>
<span class="c1">// Processing request ID: 9648a146-4020-4add-b9f0-c37f3b006a4c</span>
<span class="c1">// Processing user ID: 5</span>
</code></pre></div>
<h3 id="4-context">4 可取消context<a class="headerlink" href="#4-context" title="Permanent link">&para;</a></h3>
<h4 id="41-withcancelwithcancelcause">4.1 WithCancel()/WithCancelCause()<a class="headerlink" href="#41-withcancelwithcancelcause" title="Permanent link">&para;</a></h4>
<p><strong>WithCancel</strong>: 返回一个可取消的 Context 和一个取消函数 (<code>cancelFunc</code>)</p>
<p>通过WithCancel创建的context可以发出取消信号，达到终止相关的Goroutine，从而避免资源泄露</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;errors&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">rootCtx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// parentCtx, cancel := context.WithCancel(rootCtx)</span>
<span class="w">    </span><span class="nx">parentCtx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithCancelCause</span><span class="p">(</span><span class="nx">rootCtx</span><span class="p">)</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;正常取消&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="nx">childCtx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithoutCancel</span><span class="p">(</span><span class="nx">parentCtx</span><span class="p">)</span><span class="w"> </span><span class="c1">// 不受父context取消影响，会一直执行直到主协程退出</span>
<span class="w">    </span><span class="c1">// childCtx, childCancel := context.WithCancel(parentCtx) // 父context取消会一起取消</span>
<span class="w">    </span><span class="c1">// defer childCancel()</span>

<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">parentCtx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;parent&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">childCtx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;child&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="w">    </span><span class="nx">cancel</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;强制取消&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span><span class="w"> </span><span class="c1">// 接收到取消信号触发</span>
<span class="w">            </span><span class="c1">// 这里主要编写：任务关闭资源释放逻辑</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[%s] process canceled during work; Cause: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Cause</span><span class="p">(</span><span class="nx">ctx</span><span class="p">))</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="k">default</span><span class="p">:</span>
<span class="w">            </span><span class="c1">// 这里主要编写：任务正常需要处理逻辑</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[%s] processing...\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="p">)</span>
<span class="w">            </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">500</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="41-withoutcancel">4.1 WithoutCancel()<a class="headerlink" href="#41-withoutcancel" title="Permanent link">&para;</a></h4>
<p><strong>WithoutCancel()</strong>是Go 1.21新增特性；与<strong>WithCancel()</strong>不同的是，<strong>WithoutCancel()</strong>创建的context，不会因为父context取消而取消；</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">rootCtx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<span class="w">    </span><span class="nx">parentCtx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithCancel</span><span class="p">(</span><span class="nx">rootCtx</span><span class="p">)</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span>
<span class="w">    </span><span class="nx">childCtx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithoutCancel</span><span class="p">(</span><span class="nx">parentCtx</span><span class="p">)</span><span class="w"> </span><span class="c1">// 不受父context取消影响，会一直执行直到主协程退出</span>
<span class="w">    </span><span class="c1">// childCtx, childCancel := context.WithCancel(parentCtx) // 父context取消会一起取消</span>
<span class="w">    </span><span class="c1">// defer childCancel()</span>

<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">parentCtx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;parent&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">childCtx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;child&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="w">    </span><span class="nx">cancel</span><span class="p">()</span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span><span class="w"> </span><span class="c1">// 接收到取消信号触发</span>
<span class="w">            </span><span class="c1">// 这里主要编写：任务关闭资源释放逻辑</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[%s] process done\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="k">default</span><span class="p">:</span>
<span class="w">            </span><span class="c1">// 这里主要编写：任务正常需要处理逻辑</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[%s] processing...\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="p">)</span>
<span class="w">            </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">500</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="5-context">5 指定时间取消context<a class="headerlink" href="#5-context" title="Permanent link">&para;</a></h3>
<p><strong>WithDeadline()</strong>用法与超时控制context基本一致；只是入参改为时间点格式：</p>
<p>其实超时控制就是调用：<strong>WithDeadline()</strong> 实现的；当我们有一个时间点需要取消任务，可以直接使用WithDeadline 创建context更合适</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">parent</span><span class="w"> </span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">timeout</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">CancelFunc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">WithDeadline</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Add</span><span class="p">(</span><span class="nx">timeout</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nx">callTime</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">DateTime</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2025-08-23 00:00:00&quot;</span><span class="p">)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">callTime</span><span class="p">)</span>
<span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithDeadline</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">callTime</span><span class="p">)</span>
<span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span><span class="w"> </span><span class="c1">// 保证最终任务都要结束</span>

<span class="k">go</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="c1">// ...</span>
</code></pre></div>
<h3 id="6-contextafterfunc">6 声明式响应取消事件context.AfterFunc()<a class="headerlink" href="#6-contextafterfunc" title="Permanent link">&para;</a></h3>
<p><strong>基本概念</strong>：<code>context.AfterFunc</code> 允许你注册一个函数，这个函数会在 Context <strong>被取消后</strong>自动在<strong>一个新的 Goroutine 中</strong>运行。</p>
<p><strong>通俗介绍</strong>：<strong>context.AfterFunc()</strong> 是在parent contenxt完成或者取消后，执行一个函数，会返回一个stop函数，用于停止parent contenxt和func的关联；返回true代表成功取消，false代表context已经完成或者取消。</p>
<h4 id="61-contextafterfunc">6.1 适合使用 context.AfterFunc 的场景<a class="headerlink" href="#61-contextafterfunc" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>资源清理</strong>：这是最典型的用法。当 Context 取消时，自动关闭文件、数据库连接、网络连接等资源。</li>
<li><strong>状态重置</strong>：取消时重置某些状态或标志。</li>
<li><strong>日志记录</strong>：记录操作被取消的事实和相关信息。</li>
<li><strong>监控和指标</strong>：发送取消事件的监控指标。</li>
<li><strong>异步通知</strong>：通知其他系统组件该操作已被取消。</li>
</ol>
<h4 id="62">6.2 对比传统的清理资源做法<a class="headerlink" href="#62" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>传统方式（使用 select）</strong>：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">doWork</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 启动工作goroutine</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 模拟工作</span>
<span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>

<span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span>
<span class="w">            </span><span class="c1">// Context被取消了，执行清理</span>
<span class="w">            </span><span class="nx">cleanup</span><span class="p">()</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="k">default</span><span class="p">:</span>
<span class="w">            </span><span class="c1">// 正常工作</span>
<span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;工作完成&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}()</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>使用 AfterFunc 的方式</strong>：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">doWork</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 注册清理函数，会在ctx取消后自动执行</span>
<span class="w">    </span><span class="nx">context</span><span class="p">.</span><span class="nx">AfterFunc</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cleanup</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 启动工作goroutine（不需要在内部处理取消了）</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;工作完成&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}()</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="63">6.3 实际场景<a class="headerlink" href="#63" title="Permanent link">&para;</a></h4>
<h5 id="631">6.3.1 基本的资源清理<a class="headerlink" href="#631" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithTimeoutCause</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;任务超时！&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// 模拟打开一个资源</span>
<span class="w">    </span><span class="nx">resource</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;数据库连接&quot;</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;打开资源: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 注册清理函数：当ctx取消时自动清理资源</span>
<span class="w">    </span><span class="nx">stop</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">AfterFunc</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;任务发生异常 Cause: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Cause</span><span class="p">(</span><span class="nx">ctx</span><span class="p">))</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;正在自动清理资源: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// 这里可以执行真正清理逻辑，如关闭文件、数据库连接等</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="c1">// 通常不需要调用stop，除非有特殊需求</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">stop</span><span class="p">()</span><span class="w"> </span><span class="c1">// 为了完整性，这里也defer stop</span>

<span class="w">    </span><span class="c1">// 模拟一些工作</span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span><span class="w"> </span><span class="c1">// 这会超过2秒超时时间</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;主函数结束&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="632-stop">6.3.2 使用 stop 函数取消注册<a class="headerlink" href="#632-stop" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithCancel</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">())</span>

<span class="w">    </span><span class="c1">// 注册一个函数</span>
<span class="w">    </span><span class="nx">stop</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">AfterFunc</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;这个函数不会执行，因为会被stop取消&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="c1">// 立即取消注册</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">stopped</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">stop</span><span class="p">();</span><span class="w"> </span><span class="nx">stopped</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;成功取消了AfterFunc的执行&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">cancel</span><span class="p">()</span><span class="w"> </span><span class="c1">// 取消Context，但注册的函数不会执行</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="633-contextafterfunc">6.3.3 多个 context.AfterFunc<a class="headerlink" href="#633-contextafterfunc" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithCancel</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">())</span>

<span class="w">    </span><span class="c1">// 注册多个清理函数</span>
<span class="w">    </span><span class="nx">context</span><span class="p">.</span><span class="nx">AfterFunc</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;清理函数1: 关闭数据库连接&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">context</span><span class="p">.</span><span class="nx">AfterFunc</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;清理函数2: 释放内存缓存&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">context</span><span class="p">.</span><span class="nx">AfterFunc</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;清理函数3: 发送监控指标&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span>
<span class="w">    </span><span class="nx">cancel</span><span class="p">()</span><span class="w"> </span><span class="c1">// 触发所有注册的函数执行</span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span><span class="w"> </span><span class="c1">// 给goroutine时间执行</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="7-context">7 context学习总结<a class="headerlink" href="#7-context" title="Permanent link">&para;</a></h3>
<p><strong>最佳实践提醒</strong>：</p>
<ul>
<li>对于 <code>WithCancel</code>, <code>WithTimeout</code>, <code>WithDeadline</code>, <code>WithCancelCause</code>，<strong>一定要立即使用 <code>defer cancel()</code></strong> 来确保资源被正确释放。</li>
<li>将 Context 作为函数的<strong>第一个参数</strong>传递。</li>
<li>使用 <code>WithValue</code> 时，<strong>为键使用自定义类型</strong>，避免包间冲突。</li>
</ul>
<p><strong>注意开发中的一些问题</strong>：</p>
<ul>
<li><strong>不传递上下文：</strong>如果一个函数创建了上下文，但并<strong>没有传递给其他函数或协程，这些函数和协程无法响应上下文相关的处理操作</strong>。</li>
<li><strong>忘记调用取消函数：</strong>使用有取消函数的上下文时，记得取消</li>
<li><strong>协程泄露：</strong>有上下文的协程需要检查Done channel，当接收到到信号时及时清理资源和退出</li>
<li><strong>过度使用context.Background：</strong>没有取消和超时功能，很可能引起问题</li>
<li><strong>传递nil的上下文：</strong>不要传递nil的上下文，会导致panic</li>
<li><strong>阻塞调用：</strong>应该将阻塞操作（比如IO）包装成使用上下文检查的调用，可以避免被挂起</li>
<li><strong>过度使用上下文：</strong>上下文也并不是所有场景都使用，比如<strong>处理全局资源或者共享状态等，可能更使用使用锁或者channel</strong></li>
<li><strong>上下文存储在结构体中：</strong>应该将context<strong>显式的传递给需要的函数</strong>，否则可能会引起数据竞态，生命周期管理等问题</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../static/javascripts/collapsible.js"></script>
      
    
  </body>
</html>