
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="个人知识笔记与技术文档">
      
      
        <meta name="author" content="HC">
      
      
        <link rel="canonical" href="https://chcnew.github.io/ccDocs/%E6%95%B0%E6%8D%AE%E5%BA%93-Note/redisStdudy/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>redisStudy - CC学习文档库</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#redisstudy" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="CC学习文档库" class="md-header__button md-logo" aria-label="CC学习文档库" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CC学习文档库
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              redisStudy
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Python-Note/FastAPI-Note/" class="md-tabs__link">
          
  
  
  Python

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../GoLang-Note/GoLang-%E5%85%A5%E9%97%A8/" class="md-tabs__link">
          
  
  
  Golang

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../LinuxEnv-Note/Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" class="md-tabs__link">
          
  
  
  Linux环境配置

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CC学习文档库" class="md-nav__button md-logo" aria-label="CC学习文档库" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CC学习文档库
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    首页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/FastAPI-Note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FastAPI-入门
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/celery%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    celery-入门
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/Python-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    并发编程1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/Python-%E5%8D%8F%E7%A8%8B%26asyncio%26%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    异步编程2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/DRF-Note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DRF框架
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/uwsgi%2Bnginx%2Bdjango%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/uwsgi%2Bnginx%2Bdjango%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uwsgi+nginx+django环境部署文档
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/uwsgi%2Bnginx%2Bdjango%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/uwsgi%2Bnginx%E4%B8%A4%E7%A7%8D%E5%8D%8F%E8%AE%AE%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uwsgi+nginx两种协议代理配置
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Golang
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Golang
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../GoLang-Note/GoLang-%E5%85%A5%E9%97%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GoLang-入门
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Linux环境配置
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Linux环境配置
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LinuxEnv-Note/Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LinuxEnv-Note
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="redisstudy">redisStudy</h1>
<p><strong>学习链接:</strong> </p>
<p>http://www.yuan316.com/post/redis/</p>
<h1 id="redis">一、Redis是什么？</h1>
<p>● Redis 是完全开源的、C语言实现的，遵守 BSD 协议，是一个高性能的 非关系型 key-value 数据库；</p>
<p>● Redis支持多种语言（c、c++、python、java、php）；</p>
<p>● 单线程单进程；</p>
<p>● Redis 与其他 key - value 缓存产品有以下三个特点：</p>
<pre><code class="language-reStructuredText">1. Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。
2. Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。
3. Redis支持数据的备份，即master-slave模式的数据备份。
</code></pre>
<h1 id="redis_1">二、Redis亮点功能</h1>
<p>● 持久化</p>
<p>支持将内存中的数据保存到磁盘中，保证数据安全，方便进行备份和恢复。</p>
<p>● 过期键功能</p>
<p>为键设置一个时间，到期自动删除 &lt;节省内存开销&gt;</p>
<p>● 事务功能</p>
<p>弱事务型数据库，只具备简单的事务功能。</p>
<p>● 主从复制</p>
<p>如何让Redis保持高可用的状态，官方推荐提供主从方案</p>
<p>● 哨兵</p>
<p>搭配基础的主从结构后，哨兵可做到自动故障转移</p>
<p><span style="color:red">测试命令：</span></p>
<pre><code class="language-shell">redis-benchmark -q -n 10000  -- -q表示快速输出结果，-n表示10000个请求，还有个参数模拟客户端同时发请求默认50个
</code></pre>
<p>对比其他数据库区别：</p>
<ol>
<li>mysql：关系型数据库，表格，基于磁盘，慢；</li>
<li>mangoDB：非关系型数据库，键值对文档型数据库，类似JSON文档，数据结构单一；</li>
<li>Redis诞生是为解决什么问题？ 答： 为解决硬盘IO性能的瓶颈；</li>
</ol>
<p>● Redis应用场景</p>
<pre><code class="language-shell">1. 缓存：做为缓存存储介质，此业务场景最为常见;查询优先走redis,没有则走mysql;可有效的降低mysql查询压力；
2. 并发计数：由于redis是单进程单线程的，可以有效解决并发请求计数场景，例如微博点赞；
3. 排行榜：各大实时排行榜，例如游戏排名、电商排名；
4. 生产者消费者模型：充当生产者消费者模型的中间层;生产者可将任务分发给redis,消费者从redis中获取任务。
</code></pre>
<h1 id="redislinux">三、Redis安装（linux）</h1>
<h2 id="_1">● 下载安装</h2>
<pre><code class="language-shell">cd /usr/local/
wget http://download.redis.io/releases/redis-7.2.5.tar.gz
tar xzf redis-7.2.5.tar.gz
cd redis-7.2.5

# centos安装命令
yum install gcc 
yum -y install centos-release-scl
yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils 
scl enable devtoolset-9 bash

# 注意：scl命令启用只是临时的，退出xshell或者重启虚拟机就会恢复到原来的gcc版本。
# 如果要长期生效的话，执行如下：
echo &quot;source /opt/rh/devtoolset-9/enable&quot; &gt;&gt;/etc/profile
# 假设报错：... .../deps/lua/src/liblua.
# 解决方法：进入源码包目录下的deps目录中执行
make lua hiredis linenoise

# ubuntu安装命令
apt update
apt upgrade
apt install make gcc pkg-config
make PREFIX=/usr/local/redis install
cd /usr/local/
cp -r ./redis-7.2.5/src ./redis/
mkdir -p ./redis/conf
cp ./redis-7.2.5/redis.conf ./redis/conf/
echo -n 'export PATH=$PATH:/usr/local/redis/src' &gt;&gt; /etc/profile
echo -n 'export PATH=$PATH:/usr/local/redis/bin' &gt;&gt; /etc/profile
source /etc/profile

# 配置文件修改-远程连接配置
protected-mode no  # 关闭保护模式，允许外部访问
daemonize yes  # 后台启动
port 6379  # 设置使用端口 -- 需要放行
bind 0.0.0.0 -::1  # 注释掉bind 127.0.0.1 改为局域网内可连接 bind 0.0.0.0
requirepass cc123456  # requirepass foobared改为requirepass cc123456，cc123456为设置的密码，这个密码尽量设置复杂些。
</code></pre>
<p><img alt="image-20231015112213147" src="../redisStudy/image-20231015112213147.png" /> </p>
<p>安装完毕的配置：<a href="https://blog.csdn.net/M_y_y/article/details/106211042">https://blog.csdn.net/M_y_y/article/details/106211042</a></p>
<h2 id="_2">● 测试启动服务（使用配置文件）</h2>
<pre><code>redis-server /usr/local/redis/conf/redis.conf
</code></pre>
<h2 id="_3">● 测试客户端连接</h2>
<pre><code class="language-shell"># 无密码连接
redis-cli
</code></pre>
<p><img alt="image-20240526212703198" src="../redisStudy/image-20240526212703198.png" /> </p>
<h2 id="_4">● 安装完成之后，软件模块介绍</h2>
<table>
<thead>
<tr>
<th><span style="color:red">模块名称</span></th>
<th><span style="color:red">模块功能介绍</span></th>
</tr>
</thead>
<tbody>
<tr>
<td>redis-server</td>
<td>Redis服务器</td>
</tr>
<tr>
<td>redis-cli</td>
<td>Redis命令行客户端</td>
</tr>
<tr>
<td>redis-benchmark</td>
<td>Redis性能测试</td>
</tr>
<tr>
<td>redis-check-aof</td>
<td>AOF文件修复工具</td>
</tr>
<tr>
<td>redis-check-rdb</td>
<td>RDB文件修复工具</td>
</tr>
<tr>
<td>redis-sentinel</td>
<td>Sentinel服务器(2.8以后)，Redis集群使用</td>
</tr>
</tbody>
</table>
<h2 id="_5">● 本地客户端连接测试</h2>
<pre><code class="language-shell"># 默认端口6379，无密码：
redis-cli

# 有端口，无密码：
redis-cli -h 127.0.0.1 -p 6379

# 有端口，有密码：
redis-cli -h 127.0.0.1 -p 6379 -a cc123456

# 使用有端口有密码的方式才能正常连接

# 连接成功使用ping命令进行测试，返回PONG则成功
ping
</code></pre>
<p>有密码且密码输入错误：</p>
<p><img alt="image-20240526213112547" src="../redisStudy/image-20240526213112547.png" /> </p>
<p>正确连接：</p>
<p><img alt="image-20240526213137039" src="../redisStudy/image-20240526213137039.png" /> </p>
<h2 id="_6">● 源码安装设置开机启动</h2>
<h3 id="systemd">方式一：配置Systemd</h3>
<p>开机自启动redis（其他服务类似） </p>
<p>CentOS7以上是用Systemd进行系统初始化的，Systemd 是 Linux 系统中最新的初始化系统（init），它主要的设计目标是克服 sysvinit 固有的缺点，提高系统的启动速度。</p>
<p>Systemd服务文件以.service结尾，比如现在要建立redis为开机启动，如果用yum install命令安装的，yum命令会自动创建redis.service文件，直接用命令systemcel enable redis.service设置开机启动即可。</p>
<p>下面为源码安装的redis-server设置开机自动启动步骤；</p>
<h4 id="1">1、配置文件路径</h4>
<p>我编译安装的目录是：/usr/local/redis/bin ，所以配置⽂件⽬录为：/usr/local/redis/bin/redis.conf</p>
<h4 id="2redisservice">2、在系统服务目录里创建redis.service文件</h4>
<pre><code class="language-shell">vim /etc/systemd/system/redis.service

# 或（一般上面为centos的配置）

vim /lib/systemd/system/redis.service
</code></pre>
<h4 id="3-execstart">3、写入以下内容 (ExecStart路径为自己安装路径)</h4>
<pre><code class="language-ini">[Unit]
Description=redis-server
After=network.target

[Service]
Type=forking
ExecStart=/usr/local/redis/src/redis-server /usr/local/redis/redis.conf
PrivateTmp=true

[Install]
wantedBy=multi-user.target
</code></pre>
<h4 id="4">4、配置描述：</h4>
<pre><code class="language-reStructuredText">Description:描述服务
After:描述服务类别
[Service]服务运行参数的设置
Type=forking是后台运行的形式
ExecStart为服务的具体运行命令
ExecReload为重启命令
ExecStop为停止命令
PrivateTmp=True表示给服务分配独立的临时空间
注意：[Service]的启动、重启、停止命令全部要求使用绝对路径
[Install]运行级别下服务安装的相关设置，可设置为多用户，即系统运行级别为3
</code></pre>
<h4 id="5systemctl">5、systemctl相关命令</h4>
<pre><code class="language-shell"># 加载配置
systemctl daemon-reload
#  启动
systemctl start redis 
#  开机启动（未生效）
systemctl enable redis
# 启动redis服务
systemctl start redis.service
# 设置开机自启动
systemctl enable redis.service
# 停止开机自启动
systemctl disable redis.service
# 查看服务当前状态
systemctl status redis.service
# 重新启动服务
systemctl restart redis.service
# 查看所有已启动的服务
systemctl list-units --type=service
</code></pre>
<h4 id="6">6、重启服务器验证是否开机自动启动</h4>
<pre><code class="language-shell">shutdown -r now 
# 或
reboot
</code></pre>
<h3 id="etcinitd-">方式二：/etc/init.d/）-&gt; 推荐</h3>
<pre><code class="language-shell">#  在/etc目录下新建redis目录
mkdir /etc/redis

#  复制配置文件

#  将redis.conf文件复制到/etc/redis目录
cp /usr/local/redis/redis.conf /etc/redis/

#  复制启动脚本
cp /usr/local/redis/utils/redis_init_script /etc/init.d/redis
cat /etc/init.d/redis

#  通过查看启动脚本，确定各个路径是否正确
REDISPORT=6379
EXEC=/usr/local/bin/redis-server
CLIEXEC=/usr/local/bin/redis-cli
#  改为：
REDISPORT=6399
EXEC=/usr/local/redis/src/redis-server
CLIEXEC=/usr/local/soft/redis/bin/redis-cli


# 执行自启命令
cd /etc/init.d/
chkconfig redis on

# 如果运行结果提示：service redisd does not support chkconfig，
# 解决方法： 使用vim编辑redisd文件，在第一行加入如下两行注释，保存退出，再次执行自启命令即可
# chkconfig: 2345 90 10
# description: Redis is a persistent key-value database
# 注释的意思是，redis服务必须在运行级2，3，4，5下被启动或关闭，启动的优先级是90，关闭的优先级是10。


# 启动Redis命令
service redis start


# 关闭redis命令
service redis stop
</code></pre>
<h1 id="pythonredis">四、Python连接redis</h1>
<h2 id="1pythonredis">1.安装python操作redis模块</h2>
<pre><code class="language-shell">pip3 install redis
</code></pre>
<h2 id="2pythonredis">2.通过python操作redis数据</h2>
<pre><code class="language-python">#!/usr/bin/env python
# -*- coding:utf-8 -*-

import redis

# 直接连接redis
conn = redis.Redis(host='10.211.55.28', port=6379, password='foobared', encoding='utf-8')

# 设置键值：15131255089=&quot;9999&quot; 且超时时间为10秒（值写入到redis时会自动转字符串）
conn.set('15131255089', 9999, ex=10)

# 根据键获取值：如果存在获取值（获取到的是字节类型）；不存在则返回None
value = conn.get('15131255089')
print(value)
</code></pre>
<h2 id="3redis">3.Redis连接池提升操作效率</h2>
<p>上面python操作redis的示例是以直接创建连接的方式实现，每次操作redis如果都重新连接一次效率会比较低，建议使用redis连接池来替换，例如：</p>
<pre><code class="language-python">import redis

# 创建redis连接池（默认连接池最大连接数）
pool = redis.ConnectionPool(host='10.211.55.28', port=6379, password='foobared', encoding='utf-8', max_connections=1000)

# 去连接池中获取一个连接
conn = redis.Redis(connection_pool=pool)

# 设置键值：15131255089=&quot;9999&quot; 且超时时间为10秒（值写入到redis时会自动转字符串）
conn.set('name', &quot;诸葛亮&quot;, ex=10)

# 根据键获取值：如果存在获取值（获取到的是字节类型）；不存在则返回None
value = conn.get('name')

print(value)
</code></pre>
<p>按理说搞定上一步python代码操作redis之后，在django中应用只需要把上面的代码写到django就可以。例如：django的视图函数中操作redis:</p>
<pre><code class="language-shell">import redis
from django.shortcuts import HttpResponse

# 创建redis连接池
POOL = redis.ConnectionPool(host='10.211.55.28', port=6379, password='foobared', encoding='utf-8', max_connections=1000)

def index(request):

    # 去连接池中获取一个连接
    conn = redis.Redis(connection_pool=POOL)

    conn.set('name', &quot;诸葛亮&quot;, ex=10)
    value = conn.get('name')
    print(value)
    return HttpResponse(&quot;ok&quot;)

</code></pre>
<h1 id="djangoredis">五、Django依赖模块连接redis</h1>
<p>上述可以实现在django中操作redis。</p>
<p>但是，这种形式有点非主流，因为在django中一般不这么干，而是用另一种更加简便的的方式。</p>
<h2 id="1django-redisredis">1.安装django-redis模块（内部依赖redis模块）</h2>
<pre><code class="language-shell">pip3 install django-redis
</code></pre>
<h2 id="2djangosettingspy">2.在django项目的settings.py中添加相关配置</h2>
<pre><code class="language-python">... ...

CACHES = {
    &quot;default&quot;: {
        &quot;BACKEND&quot;: &quot;django_redis.cache.RedisCache&quot;,
        &quot;LOCATION&quot;: &quot;redis://10.211.55.28:6379&quot;, # 安装redis的主机的 IP 和 端口
        &quot;OPTIONS&quot;: {
            &quot;CLIENT_CLASS&quot;: &quot;django_redis.client.DefaultClient&quot;,
            &quot;CONNECTION_POOL_KWARGS&quot;: {
                &quot;max_connections&quot;: 1000,
                &quot;encoding&quot;: 'utf-8'
            },
            &quot;PASSWORD&quot;: &quot;foobared&quot; # redis密码
        }
    }
}

... ...

</code></pre>
<h2 id="3djangoredis">3.在django的视图中操作redis</h2>
<pre><code class="language-python">from django.shortcuts import HttpResponse
from django_redis import get_redis_connection
def index(request):
    # 去连接池中获取一个连接
    conn = get_redis_connection(&quot;default&quot;)
    conn.set('nickname', &quot;诸葛亮&quot;, ex=10)
    value = conn.get('nickname')
    print(value)
    return HttpResponse(&quot;OK&quot;)
</code></pre>
<h1 id="redis_2">六、Redis其他高级用法</h1>
<p>● http://www.yuan316.com/post/redis/</p>
<p>● https://www.cnblogs.com/wupeiqi/articles/5132791.html</p>
<p>● http://www.redis.cn/</p>
<h1 id="redis_3">七、Redis基础命令</h1>
<h2 id="1_1">1.逻辑数据库使用</h2>
<p>默认情况，redis内置16个逻辑库（0-15），选择哪个数据库：</p>
<pre><code class="language-shell">127.0.0.1:6379&gt; select 0
OK
127.0.0.1:6379&gt; set city dongguan
OK
127.0.0.1:6379&gt; get city
&quot;dongguan&quot;
127.0.0.1:6379&gt;
</code></pre>
<h2 id="2redisubuntu">2.Redis服务加入开机启动脚本（ubuntu）</h2>
<pre><code class="language-shell"># 复制文件
if ! [ -f &quot;/etc/systemd/system/rc-local.service&quot; ];then
    cat /lib/systemd/system/rc-local.service
    cp /lib/systemd/system/rc-local.service /etc/systemd/system/rc-local.service
fi

vim /etc/systemd/system/rc-local.service

cat &lt;&lt; EOF &gt;&gt; /etc/systemd/system/rc-local.service

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload

# 写入要运行的脚本路径
cat &lt;&lt; EOF &gt;&gt; /etc/rc.local
#!/bin/bash
sh /root/RedisLen/env_start.sh
EOF
# 写入要运行的脚本内容
cat &lt;&lt; EOF &gt; /root/RedisLen/env_start.sh
#!/bin/bash
pgrep -f redis | xargs kill -9 &gt;/dev/nul 2&gt;&amp;1
/usr/local/redis/bin/redis-server /usr/local/redis/conf/redis.conf
EOF

chmod 755 /etc/rc.local
chmod 755 /root/RedisLen/env_start.sh

systemctl start rc-local.service
# 假设报错
# Job for rc-local.service failed because the control process exited with error code.
# See &quot;systemctl status rc-local.service&quot; and &quot;journalctl -xeu rc-local.service&quot; for details.
# 解决参考文档：https://blog.csdn.net/djstavav/article/details/88166805

systemctl status rc-local.service
systemctl enable rc-local.service
</code></pre>
<h1 id="rdbaof">八、支持数据持久化方案（RDB/AOF）</h1>
<p><img alt="image-20240602105621289" src="../redisStudy/image-20240602105621289.png" /> </p>
<h2 id="rdb">● RDB</h2>
<p>RDB是一种快照存储持久化方式，具体就是将Redis某一时刻的内存数据保存到硬盘的文件当中，默认保存的文件名为dump.rdb，而在Redis服务器启动时，会重新加载dump.rdb文件的数据到内存当中恢复数据。</p>
<p><strong>开启RDB持久化方式：</strong>开启RDB持久化方式很简单，客户端可以<strong>通过向Redis服务器发送save或bgsave命令让服务器生成rdb文件</strong>，或者<strong>通过服务器配置文件指定触发RDB条件</strong>。</p>
<h3 id="1save">1.save命令</h3>
<pre><code class="language-shell"># 同步数据到磁盘上
&gt; save
</code></pre>
<p><strong>当客户端向服务器发送save命令请求进行持久化时，服务器会阻塞save命令之后的其他客户端的请求，直到数据同步完成。</strong></p>
<p>如果数据量太大，同步数据会执行很久，而这期间Redis服务器也无法接收其他请求，所以，最好不要在生产环境使用save命令。</p>
<h3 id="2bgsave">2.bgsave命令</h3>
<pre><code>与save命令不同，bgsave命令是一个异步操作。
# 异步保存数据集到磁盘
&gt; bgsave
</code></pre>
<p>当客户端发服务发出bgsave命令时，Redis服务器主进程会forks一个子进程来数据同步问题，在将数据保存到rdb文件之后，子进程会退出。</p>
<p>所以，与save命令相比，Redis服务器在处理bgsave采用子线程进行IO写入，而主进程仍然可以接收其他请求，但forks子进程是同步的，所以forks子进程时，一样不能接收其他请求，这意味着，如果forks一个子进程花费的时间太久(一般是很快的)，bgsave命令仍然有阻塞其他客户的请求的情况发生。</p>
<h3 id="3">3. 服务器配置自动触发</h3>
<p>除了通过客户端发送命令外，还有一种方式，就是在Redis配置文件中的save指定到达触发RDB持久化的条件，比如【多少秒内至少达到多少写操作】就开启RDB数据同步。</p>
<p>配置文件redis.conf指定如下的选项：</p>
<pre><code># 启动服务器加载配置文件 
vim /usr/local/redis/conf/redis.conf
</code></pre>
<pre><code class="language-ini"># 900s内至少达到一条写命令
save 900 1
# 300s内至少达至10条写命令
save 300 10
# 60s内至少达到10000条写命令
save 60 10000
</code></pre>
<pre><code># 启动服务器加载配置文件 
redis-server /usr/local/redis/conf/redis.conf
</code></pre>
<p>这种通过服务器配置文件触发RDB的方式，与bgsave命令类似，达到触发条件时，会forks一个子进程进行数据同步，不过最好不要通过这方式来触发RDB持久化，因为设置触发的时间太短，则容易频繁写入rdb文件，影响服务器性能，时间设置太长则会造成数据丢失。</p>
<h3 id="4rdb">4.rdb文件</h3>
<p>前面介绍了三种让服务器生成rdb文件的方式，无论是由主进程生成还是子进程来生成，其过程如下：</p>
<ul>
<li>生成临时rdb文件，并写入数据。</li>
<li>完成数据写入，用临时文代替代正式rdb文件。</li>
<li>删除原来的db文件。</li>
</ul>
<p>RDB默认生成的文件名为dump.rdb，当然，我可以通过配置文件进行更加详细配置，比如在单机下启动多个redis服务器进程时，可以通过端口号配置不同的rdb名称，如下所示：</p>
<pre><code class="language-bash"># 是否压缩rdb文件
rdbcompression yes

# rdb文件的名称
dbfilename redis-6379.rdb

# rdb文件保存目录
dir ~/redis/
</code></pre>
<p><strong>RDB的几个优点</strong></p>
<ul>
<li>与AOF方式相比，通过rdb文件恢复数据比较快。</li>
<li>rdb文件非常紧凑，适合于数据备份。</li>
<li>通过RDB进行数据备，由于使用子进程生成，所以对Redis服务器性能影响较小。</li>
</ul>
<p><strong>RDB的几个缺点</strong></p>
<ul>
<li>如果服务器宕机的话，采用RDB的方式会造成某个时段内数据的丢失，比如我们设置10分钟同步一次或5分钟达到1000次写入就同步一次，那么如果还没达到触发条件服务器就死机了，那么这个时间段的数据会丢失。</li>
<li>使用save命令会造成服务器阻塞，直接数据同步完成才能接收后续请求。</li>
<li>使用bgsave命令在forks子进程时，如果数据量太大，forks的过程也会发生阻塞，另外，forks子进程会耗费内存。</li>
</ul>
<h2 id="aof">● AOF</h2>
<p>与RDB存储某个时刻的快照不同，AOF持久化方式会记录客户端对服务器的每一次写操作命令，并将这些写操作以Redis协议追加保存到以后缀为aof文件末尾，在Redis服务器重启时，会加载并运行aof文件的命令，以达到恢复数据的目的。</p>
<p><strong>开启AOF持久化方式</strong></p>
<p>Redis默认不开启AOF持久化方式，我们可以在配置文件中开启并进行更加详细的配置，如下面的redis.conf文件：</p>
<pre><code class="language-bash"># 开启aof机制
appendonly yes

# aof文件名
appendfilename &quot;appendonly.aof&quot;

# 写入策略,always表示每个写操作都保存到aof文件中,也可以是everysec或no
appendfsync always

# 默认不重写aof文件
no-appendfsync-on-rewrite no

# 保存目录
dir ~/redis/
</code></pre>
<h3 id="1_2">1.三种写入策略</h3>
<p>在上面的配置文件中，我们可以通过appendfsync选项指定写入策略,有三个选项</p>
<pre><code class="language-bash">appendfsync always
# appendfsync everysec
# appendfsync no
</code></pre>
<h4 id="11-always">1.1 always</h4>
<p>客户端的每一个写操作都保存到aof文件当，这种策略很安全，但是每个写请注都有IO操作，所以也很慢。</p>
<h4 id="12-everysec">1.2 everysec</h4>
<p>appendfsync的默认写入策略，每秒写入一次aof文件，因此，最多可能会丢失1s的数据。</p>
<h4 id="13-no">1.3 no</h4>
<p>Redis服务器不负责写入aof，而是交由操作系统来处理什么时候写入aof文件。更快，但也是最不安全的选择，不推荐使用。</p>
<h3 id="2aof">2.AOF文件重写</h3>
<p>AOF将客户端的每一个写操作都追加到aof文件末尾，比如对一个key多次执行incr命令，这时候，aof保存每一次命令到aof文件中，aof文件会变得非常大。</p>
<pre><code class="language-dart">incr num 1
incr num 2
incr num 3
incr num 4
incr num 5
incr num 6
...
incr num 100000
</code></pre>
<p>aof文件太大，加载aof文件恢复数据时，就会非常慢，为了解决这个问题，Redis支持aof文件重写，通过重写aof，可以生成一个恢复当前数据的最少命令集，比如上面的例子中那么多条命令，可以重写为：</p>
<pre><code class="language-sql">set num 100000
</code></pre>
<p>aof文件是一个二进制文件，并不是像上面的例子一样，直接保存每个命令，而使用Redis自己的格式，上面只是方便演示。</p>
<h3 id="3_1">3.两种重写方式</h3>
<p>通过在redis.conf配置文件中的选项no-appendfsync-on-rewrite可以设置是否开启重写，这种方式会在每次fsync时都重写，影响服务器性以，因此默认值为no，不推荐使用。</p>
<pre><code class="language-perl"># 默认不重写aof文件
no-appendfsync-on-rewrite no
</code></pre>
<p>客户端向服务器发送bgrewriteaof命令，也可以让服务器进行AOF重写。</p>
<pre><code class="language-bash"># 让服务器异步重写追加aof文件命令
&gt; bgrewriteaof
</code></pre>
<p>AOF重写方式也是异步操作，即如果要写入aof文件，则Redis主进程会forks一个子进程来处理。</p>
<p>重写aof文件的好处</p>
<ul>
<li>压缩aof文件，减少磁盘占用量。</li>
<li>将aof的命令压缩为最小命令集，加快了数据恢复的速度。</li>
</ul>
<h3 id="4aof">4.AOF文件损坏</h3>
<p>在写入aof日志文件时，如果Redis服务器宕机，则aof日志文件文件会出格式错误，在重启Redis服务器时，Redis服务器会拒绝载入这个aof文件，可以通过以下步骤修复aof并恢复数据。</p>
<p>1、备份现在aof文件，以防万一。</p>
<p>2、使用redis-check-aof命令修复aof文件，该命令格式如下：</p>
<pre><code class="language-php"># 修复aof日志文件
$ redis-check-aof -fix file.aof
</code></pre>
<p>3、重启Redis服务器，加载已经修复的aof文件，恢复数据。</p>
<h3 id="5aof">5.AOF的优点</h3>
<ul>
<li>AOF只是追加日志文件，因此对服务器性能影响较小，速度比RDB要快，消耗的内存较少。</li>
</ul>
<h3 id="6aof">6.AOF的缺点</h3>
<ul>
<li>AOF方式生成的日志文件太大，即使通过AFO重写，文件体积仍然很大。</li>
<li>恢复数据的速度比RDB慢</li>
</ul>
<h2 id="rdbaof_1">● 选择RDB还是AOF呢？</h2>
<p>通过上面的介绍，我们了解了RDB与AOF各自的优点与缺点，到底要如何选择呢？</p>
<p>通过下面的表示，我们可以从几个方面对比一下RDB与AOF：</p>
<p>​       在应用时，要根本自己的实际需求，选择RDB或者AOF，其实，如果想要数据足够安全，<strong>可以两种方式都开启，但两种持久化方式同时进行IO操作，会严重影响服务器性能</strong>，因此有时候不得不做出选择。</p>
<p><strong>当RDB与AOF两种方式都开启时，Redis会优先使用AOF日志来恢复数据，因为AOF保存的文件比RDB文件更完整。</strong></p>
<h2 id="rdbaof_2">● RDB/AOF小结</h2>
<p>Redis的持久化机制的知识，其实，如果你只是单纯把Redis作为缓存服务器，那么可以完全不用考虑持久化；</p>
<p>但是，在如今的大多数服务器架构中，Redis只是扮演一个缓存服务器的角色，还可以作为数据库，保存我们的业务数据，此时，我们则需要好好了解有关Redis持久化策略的区别与选择。</p>
<h1 id="redis_4">九、Redis配置参数</h1>
<p>参考链接：https://blog.csdn.net/admans/article/details/101981770</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>配置项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>daemonize no</td>
<td>Redis  默认不是以守护进程的方式运行，可以通过该配置项修改，使用 yes 启用守护进程（Windows 不支持守护线程的配置为 no ）</td>
</tr>
<tr>
<td>2</td>
<td>pidfile  /var/run/redis.pid</td>
<td>当 Redis  以守护进程方式运行时，Redis 默认会把 pid 写入 /var/run/redis.pid 文件，可以通过 pidfile 指定</td>
</tr>
<tr>
<td>3</td>
<td>port 6379</td>
<td>指定 Redis 监听端口，默认端口为  6379，作者在自己的一篇博文中解释了为什么选用 6379 作为默认端口，因为 6379 在手机按键上 MERZ 对应的号码，而 MERZ 取自意大利歌女  Alessia Merz 的名字</td>
</tr>
<tr>
<td>4</td>
<td>bind 127.0.0.1</td>
<td>绑定的主机地址</td>
</tr>
<tr>
<td>5</td>
<td>timeout 300</td>
<td>当客户端闲置多长时间后关闭连接，如果指定为  0，表示关闭该功能</td>
</tr>
<tr>
<td>6</td>
<td>loglevel notice</td>
<td>指定日志记录级别，Redis  总共支持四个级别：debug、verbose、notice、warning，默认为 notice</td>
</tr>
<tr>
<td>7</td>
<td>logfile stdout</td>
<td>日志记录方式，默认为标准输出，如果配置  Redis 为守护进程方式运行，而这里又配置为日志记录方式为标准输出，则日志将会发送给 /dev/null</td>
</tr>
<tr>
<td>8</td>
<td>databases 16</td>
<td>设置数据库的数量，默认数据库为0，可以使用SELECT  命令在连接上指定数据库id</td>
</tr>
<tr>
<td>9</td>
<td>save <seconds>  <changes></td>
<td>指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</td>
</tr>
<tr>
<td>Redis  默认配置文件中提供了三个条件：</td>
<td></td>
<td></td>
</tr>
<tr>
<td>save 900 1</td>
<td></td>
<td></td>
</tr>
<tr>
<td>save 300 10</td>
<td></td>
<td></td>
</tr>
<tr>
<td>save 60 10000</td>
<td></td>
<td></td>
</tr>
<tr>
<td>分别表示 900 秒（15  分钟）内有 1 个更改，300 秒（5 分钟）内有 10 个更改以及 60 秒内有 10000 个更改。</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10</td>
<td>rdbcompression yes</td>
<td>指定存储至本地数据库时是否压缩数据，默认为  yes，Redis 采用 LZF 压缩，如果为了节省 CPU 时间，可以关闭该选项，但会导致数据库文件变的巨大</td>
</tr>
<tr>
<td>11</td>
<td>dbfilename dump.rdb</td>
<td>指定本地数据库文件名，默认值为  dump.rdb</td>
</tr>
<tr>
<td>12</td>
<td>dir ./</td>
<td>指定本地数据库存放目录</td>
</tr>
<tr>
<td>13</td>
<td>slaveof  <masterip> <masterport></td>
<td>设置当本机为 slav 服务时，设置  master 服务的 IP 地址及端口，在 Redis 启动时，它会自动从 master 进行数据同步</td>
</tr>
<tr>
<td>14</td>
<td>masterauth  <master-password></td>
<td>当 master  服务设置了密码保护时，slav 服务连接 master 的密码</td>
</tr>
<tr>
<td>15</td>
<td>requirepass foobared</td>
<td>设置 Redis  连接密码，如果配置了连接密码，客户端在连接 Redis 时需要通过 AUTH <password> 命令提供密码，默认关闭</td>
</tr>
<tr>
<td>16</td>
<td>maxclients 128</td>
<td>设置同一时间最大客户端连接数，默认无限制，Redis  可以同时打开的客户端连接数为 Redis 进程可以打开的最大文件描述符数，如果设置 maxclients  0，表示不作限制。当客户端连接数到达限制时，Redis 会关闭新的连接并向客户端返回 max number of clients reached 错误信息</td>
</tr>
<tr>
<td>17</td>
<td>maxmemory  <bytes></td>
<td>指定 Redis 最大内存限制，Redis  在启动时会把数据加载到内存中，达到最大内存后，Redis 会先尝试清除已到期或即将到期的 Key，当此方法处理  后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis 新的 vm 机制，会把 Key 存放内存，Value 会存放在  swap 区</td>
</tr>
<tr>
<td>18</td>
<td>appendonly no</td>
<td>指定是否在每次更新操作后进行日志记录，Redis  在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为 redis 本身同步数据文件是按上面 save  条件来同步的，所以有的数据会在一段时间内只存在于内存中。默认为 no</td>
</tr>
<tr>
<td>19</td>
<td>appendfilename  appendonly.aof</td>
<td>指定更新日志文件名，默认为  appendonly.aof</td>
</tr>
<tr>
<td>20</td>
<td>appendfsync everysec</td>
<td>指定更新日志条件，共有 3 个可选值：</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>no：表示等操作系统进行数据缓存同步到磁盘（快）</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>always：表示每次更新操作后手动调用  fsync() 将数据写到磁盘（慢，安全）</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>everysec：表示每秒同步一次（折中，默认值）</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>21</td>
<td>vm-enabled no</td>
<td>指定是否启用虚拟内存机制，默认值为  no，简单的介绍一下，VM 机制将数据分页存放，由 Redis 将访问量较少的页即冷数据 swap  到磁盘上，访问多的页面由磁盘自动换出到内存中（在后面的文章我会仔细分析 Redis 的 VM 机制）</td>
</tr>
<tr>
<td>22</td>
<td>vm-swap-file  /tmp/redis.swap</td>
<td>虚拟内存文件路径，默认值为  /tmp/redis.swap，不可多个 Redis 实例共享</td>
</tr>
<tr>
<td>23</td>
<td>vm-max-memory 0</td>
<td>将所有大于 vm-max-memory  的数据存入虚拟内存，无论 vm-max-memory 设置多小，所有索引数据都是内存存储的(Redis 的索引数据 就是 keys)，也就是说，当  vm-max-memory 设置为 0 的时候，其实是所有 value 都存在于磁盘。默认值为 0</td>
</tr>
<tr>
<td>24</td>
<td>vm-page-size 32</td>
<td>Redis swap 文件分成了很多的  page，一个对象可以保存在多个 page 上面，但一个 page 上不能被多个对象共享，vm-page-size 是要根据存储的  数据大小来设定的，作者建议如果存储很多小对象，page 大小最好设置为 32 或者 64bytes；如果存储很大大对象，则可以使用更大的  page，如果不确定，就使用默认值</td>
</tr>
<tr>
<td>25</td>
<td>vm-pages 134217728</td>
<td>设置 swap 文件中的 page  数量，由于页表（一种表示页面空闲或使用的 bitmap）是在放在内存中的，，在磁盘上每 8 个 pages 将消耗 1byte 的内存。</td>
</tr>
<tr>
<td>26</td>
<td>vm-max-threads 4</td>
<td>设置访问swap文件的线程数,最好不要超过机器的核数,如果设置为0,那么所有对swap文件的操作都是串行的，可能会造成比较长时间的延迟。默认值为4</td>
</tr>
<tr>
<td>27</td>
<td>glueoutputbuf yes</td>
<td>设置在向客户端应答时，是否把较小的包合并为一个包发送，默认为开启</td>
</tr>
<tr>
<td>28</td>
<td>hash-max-zipmap-entries  64</td>
<td>指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法</td>
</tr>
<tr>
<td>hash-max-zipmap-value  512</td>
<td></td>
<td></td>
</tr>
<tr>
<td>29</td>
<td>activerehashing yes</td>
<td>指定是否激活重置哈希，默认为开启（后面在介绍  Redis 的哈希算法时具体介绍）</td>
</tr>
<tr>
<td>30</td>
<td>include  /path/to/local.conf</td>
<td>指定包含其它的配置文件，可以在同一主机上多个Redis实例之间使用同一份配置文件，而同时各个实例又拥有各自独立的配置</td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "search.highlight", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>