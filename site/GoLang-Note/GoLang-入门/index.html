
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="ä¸ªäººçŸ¥è¯†ç¬”è®°ä¸æŠ€æœ¯æ–‡æ¡£">
      
      
        <meta name="author" content="HC">
      
      
        <link rel="canonical" href="https://chcnew.github.io/mydocs/GoLang-Note/GoLang-%E5%85%A5%E9%97%A8/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>01BasicSciencesæ ¸å¿ƒç¬”è®° - CCå­¦ä¹ æ–‡æ¡£åº“</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#01basicsciences" class="md-skip">
          è·³è½¬è‡³
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰">
    <a href="../.." title="CCå­¦ä¹ æ–‡æ¡£åº“" class="md-header__button md-logo" aria-label="CCå­¦ä¹ æ–‡æ¡£åº“" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CCå­¦ä¹ æ–‡æ¡£åº“
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              01BasicSciencesæ ¸å¿ƒç¬”è®°
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="æŸ¥æ‰¾">
        
        <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="æ ‡ç­¾" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  é¦–é¡µ

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Python-Note/Python-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="md-tabs__link">
          
  
  
  Python å­¦ä¹ ç¬”è®°

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Python-Note/FastAPI-Note/" class="md-tabs__link">
          
  
  
  FastAPI ç³»åˆ—

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="å¯¼èˆªæ " data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CCå­¦ä¹ æ–‡æ¡£åº“" class="md-nav__button md-logo" aria-label="CCå­¦ä¹ æ–‡æ¡£åº“" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CCå­¦ä¹ æ–‡æ¡£åº“
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    é¦–é¡µ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Python å­¦ä¹ ç¬”è®°
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Python å­¦ä¹ ç¬”è®°
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/Python-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    é«˜çº§
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/DRF-Note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    é«˜çº§
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    FastAPI ç³»åˆ—
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            FastAPI ç³»åˆ—
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python-Note/FastAPI-Note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    å…¥é—¨->é«˜çº§
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="01basicsciences">01BasicSciencesæ ¸å¿ƒç¬”è®°</h1>
<h1 id="_1">ğŸ“š å¼€å‘ç¯å¢ƒé…ç½®</h1>
<h2 id="1">1 ç¼–è¯‘å™¨ä¸‹è½½</h2>
<p>https://golang.google.cn/doc/install</p>
<h2 id="2-window">2 windowå¼€å‘ç¯å¢ƒé…ç½®</h2>
<p>å‚ç…§linuxé…ç½®</p>
<h2 id="3-linux">3 Linuxå¼€å‘ç¯å¢ƒé…ç½®</h2>
<pre><code class="language-shell"># å®‰è£…ä½ç½®
/opt/go

# å¯æ‰§è¡Œæ–‡ä»¶
/opt/go/bin/go

# ç¯å¢ƒå˜é‡é…ç½® ~/.bashrc æˆ– /etc/profile
export PATH=/opt/go/bin:$PATH

export GOROOT=/opt/go
export GOPATH=/home/ccplayer/goProjects
export GOBIN=/home/ccplayer/goProjects/bin
</code></pre>
<h2 id="4">4 ç›®å½•ç»“æ„</h2>
<pre><code class="language-shell">/home/ccplayer/goProjects/
    -bin
    -pkg
    -src
        -crm
            -app.go
        -autoclick
            -ac.go
</code></pre>
<h2 id="5">5 ç›¸å…³ç¼–è¯‘ã€æ‰§è¡Œå‘½ä»¤</h2>
<pre><code class="language-shell"># ç¼–è¯‘ä¸è¿è¡Œ
go run app.go

# ç¼–è¯‘å‡ºäºŒè¿›åˆ¶æ–‡ä»¶
go build
go build -o myapp app.go
go install  # é»˜è®¤ç¼–è¯‘ç”Ÿæˆä½ç½®ï¼š$GOPATH/bin
</code></pre>
<h2 id="6">6 æ‰©å±•ï¼šç¼–è¯‘ç»“æœç±»å‹</h2>
<p>go install å¯ä»¥äº§ç”Ÿç»“æœæ–‡ä»¶å­˜åœ¨ $GOPATH/bin ä¸ $GOPATH/pkg ä¸‹é¢ï¼Œbinä¸‹æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œpkgä¸‹é¢æ˜¯åŒ…æ–‡ä»¶ï¼ˆä¾›å…¶ä»–ç¨‹åºå‘˜å¼•ç”¨ï¼‰</p>
<p><code>GO111MODULE</code> æ˜¯ Go è¯­è¨€çš„ä¸€ä¸ª<strong>ç¯å¢ƒå˜é‡</strong>ï¼Œç”¨äºæ§åˆ¶ Go çš„ä¾èµ–ç®¡ç†æ¨¡å¼ï¼ˆ<strong>GOPATH</strong> æ¨¡å¼ vs <strong>Go Modules</strong> æ¨¡å¼ï¼‰ã€‚å®ƒçš„åå­—æ¥æºäº Go 1.11 ç‰ˆæœ¬é¦–æ¬¡å¼•å…¥ Modules åŠŸèƒ½</p>
<p>æ‰€ä»¥å¦‚æœæ˜¯ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ï¼š<strong>GOPATH</strong> æ¨¡å¼ or <strong>Go Modules</strong> æ¨¡å¼éƒ½å¯ä»¥ï¼ˆset GO111MODULE=auto + ç”Ÿæˆæ ¹ç›®å½•ä¸‹go.modæ–‡ä»¶ï¼‰ï¼›</p>
<p>å¦‚æœæ˜¯ç¼–è¯‘åŒ…æ–‡ä»¶ï¼š<strong>GOPATH</strong> æ¨¡å¼æ‰ä¼šç”Ÿæˆï¼ˆset GO111MODULE=auto + åˆ é™¤æ ¹ç›®å½•ä¸‹go.modæ–‡ä»¶ï¼‰</p>
<pre><code>go install
</code></pre>
<ul>
<li>äº§å‡ºå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</li>
</ul>
<pre><code class="language-shell"># å«æœ‰mainå‡½æ•°çš„goæ–‡ä»¶
go build æˆ– go install
</code></pre>
<ul>
<li>äº§å‡ºä¾›å…¶ä»–å¼€å‘è€…ä½¿ç”¨çš„åŒ…æ–‡ä»¶ï¼ˆ.aæ–‡ä»¶ï¼‰</li>
</ul>
<p><img alt="image-20250614180604868" src="image-20250614180604868.png" /> </p>
<p>IDE - golandå¯ä»¥æ”¯æŒé…ç½®å•ä¸ªé¡¹ç›®å¯¹åº”çš„GOPATHç›®å½•ï¼Œè¿™æ ·å°±æ–¹ä¾¿æ¯ä¸ªé¡¹ç›®å•ç‹¬çš„å¼€å‘ç¯å¢ƒå˜é‡ï¼Œäº§ç‰©ç”Ÿæˆåœ¨å½“å‰é¡¹ç›®è·¯å¾„ã€‚</p>
<p>.a æ–‡ä»¶ä½œä¸ºä¸­é—´äº§ç‰©ï¼Œä¸æ”¯æŒç›´æ¥åœ¨ä»£ç ä¸­å¯¼å…¥ä½¿ç”¨ã€‚</p>
<h1 id="_2">ğŸ“š åŒ…ç®¡ç†å™¨</h1>
<h2 id="1-go-mod">1 go mod</h2>
<p>---------- go modåŒ…ç®¡ç†å™¨æ¨¡å¼è®¾ç½® ----------</p>
<p>æŸ¥çœ‹å½“å‰é…ç½®ï¼šgo env</p>
<p>å¼€å‘æ¨èä½¿ç”¨åŒ…çš„æ–¹å¼ï¼Œå°±éœ€è¦é…ç½®go.modæ–‡ä»¶</p>
<p>GO111MODULE=offï¼Œæ— æ¨¡å—æ”¯æŒï¼Œgoå‘½ä»¤è¡Œå°†ä¸ä¼šæ”¯æŒmoduleåŠŸèƒ½ï¼Œå¯»æ‰¾ä¾èµ–åŒ…çš„æ–¹å¼å°†ä¼šæ²¿ç”¨æ—§ç‰ˆæœ¬é‚£ç§é€šè¿‡vendorç›®å½•æˆ–è€…GOPATHæ¨¡å¼æ¥æŸ¥æ‰¾ã€‚</p>
<p>GO111MODULE=onï¼Œæ¨¡å—æ”¯æŒï¼Œgoå‘½ä»¤è¡Œä¼šä½¿ç”¨modulesï¼Œè€Œä¸€ç‚¹ä¹Ÿä¸ä¼šå»GOPATHç›®å½•ä¸‹æŸ¥æ‰¾ã€‚</p>
<p><strong>GO111MODULE=autoï¼Œé»˜è®¤å€¼ï¼Œgoå‘½ä»¤è¡Œå°†ä¼šæ ¹æ®å½“å‰ç›®å½•æ¥å†³å®šæ˜¯å¦å¯ç”¨moduleåŠŸèƒ½ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å½¢ï¼š</strong></p>
<ol>
<li><strong>å½“å‰ç›®å½•åœ¨GOPATH/srcä¹‹å¤–ä¸”è¯¥ç›®å½•åŒ…å«go.modæ–‡ä»¶ï¼Œå¼€å¯æ¨¡å—æ”¯æŒï¼›</strong></li>
<li><strong>å½“å‰æ–‡ä»¶åœ¨åŒ…å«go.modæ–‡ä»¶çš„ç›®å½•ä¸‹é¢ã€‚</strong></li>
</ol>
<p><strong>è®¾ç½®ï¼š</strong>GO111MODULE=onï¼ˆ1.11ä¹‹åç‰ˆæœ¬æ”¯æŒåŒ…ç®¡ç†ï¼‰</p>
<pre><code class="language-shell">go env -w GO111MODULE=on
</code></pre>
<p>å›½å†…ä»£ç†è®¾ç½®ï¼š</p>
<pre><code class="language-shell">go env -w GOPROXY=https://goproxy.cn,direct
</code></pre>
<p>linuxï¼š</p>
<pre><code class="language-shell">echo -n &quot;export GO111MODULE=on&quot; &gt;&gt; ~/.profile
echo -n &quot;export GOPROXY=https://goproxy.cn&quot; &gt;&gt; ~/.profile
source ~/.profile
</code></pre>
<p>----------ç†è§£goè¯­è¨€ä¸­åŒ…ç®¡ç†æ–¹å¼----------</p>
<p>mainåŒ…ï¼ˆpackage mainï¼‰ï¼šé»˜è®¤é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œä¸”å¿…é¡»å†™ä¸€ä¸ªmainå‡½æ•°ï¼ˆç¨‹åºå…¥å£ï¼‰ï¼Œç¼–è¯‘æ—¶ï¼Œä¼šç”Ÿæˆå¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<h2 id="2-go">2 Goè¯­è¨€å¸¸ç”¨å‘½ä»¤</h2>
<pre><code class="language-shell">go mod tidy # æ•´ç†å’Œä¼˜åŒ–é¡¹ç›®çš„ go.mod å’Œ go.sum æ–‡ä»¶ï¼ˆè‡ªåŠ¨ä¸‹è½½åŠåˆ é™¤ä¾èµ–ï¼‰
go mod download # ä¸‹è½½ä¾èµ–åŒ…
go mod edit # ç¼–è¾‘go.modæ–‡ä»¶
go mod graph
go mod init # åœ¨å½“å‰ç›®å½•åˆå§‹åŒ–mod
go mod vendor # å°†ä¾èµ–å¤åˆ¶åˆ°vendorä¸‹
go mod verify # éªŒè¯ä¾èµ–æ˜¯å¦æ­£ç¡®
go mod why # è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–

go get åŒ… # ä¸‹è½½ä¾èµ–
go get -u åŒ… # -uï¼šæ›´æ–°æˆ–ä¸‹è½½æœ€æ–°ç‰ˆæœ¬
go get -u &lt;[åŒ…]@[ç‰ˆæœ¬å·]&gt;  # ä¸‹è½½æŒ‡å®šç‰ˆæœ¬
</code></pre>
<h1 id="_3">ğŸ“š å˜é‡</h1>
<h2 id="1_1">1 å˜é‡å£°æ˜</h2>
<pre><code class="language-go">var name string = &quot;chc&quot;
var name = &quot;chc&quot;
name := &quot;chc&quot;  // æ¨è
</code></pre>
<h2 id="2">2 å˜é‡èµ‹å€¼</h2>
<pre><code class="language-go">name1 := &quot;tom&quot;
name2 := name1  // é‡æ–°å¼€è¾Ÿä¸€å—å†…å­˜ç©ºé—´å­˜æ”¾ - ä¸éƒ½æŒ‡å‘åŒä¸€å—å†…å­˜åœ°å€çš„pythonä¸åŒ
</code></pre>
<p>å¯¹åº”å†…å­˜å›¾å¦‚ä¸‹ï¼š</p>
<h1 id="_4">ğŸ“š å¸¸é‡</h1>
<h2 id="1_2">1 å¸¸é‡å£°æ˜</h2>
<pre><code class="language-go">const (
    NAME   = &quot;chc&quot;
    AGE    = 18
    GENDER = &quot;ç”·&quot;
)
</code></pre>
<h2 id="2_1">2 å¸¸é‡å»ºè®®</h2>
<ul>
<li><strong>å…¬å…±å¸¸é‡</strong>ï¼šé¦–å­—æ¯å¤§å†™é©¼å³°å¼ï¼ˆå¦‚ <code>Name</code>ï¼‰ã€‚</li>
<li><strong>ç§æœ‰å¸¸é‡</strong>ï¼šå…¨å°å†™æˆ–å°é©¼å³°ï¼ˆå¦‚ <code>defaultName</code>ï¼‰ã€‚</li>
<li><strong>å…¨å¤§å†™</strong>ï¼šä»…åœ¨éœ€è¦å¼ºè°ƒå¸¸é‡å±æ€§ï¼ˆç±»ä¼¼å…¶ä»–è¯­è¨€çš„ <code>CONST</code>ï¼‰æ—¶ä½¿ç”¨ï¼Œä½†éå¿…é¡»ã€‚</li>
</ul>
<h1 id="_5">ğŸ“š æµç¨‹æ§åˆ¶è¯­å¥</h1>
<p>åœ¨Goè¯­è¨€ä¸­ï¼Œswitchè¯­å¥å¯ä»¥ç”¨æ¥åˆ¤æ–­èŒƒå›´å€¼ï¼Œè¿™ä¸å…¶ä»–ä¸€äº›è¯­è¨€çš„switchè¯­å¥æœ‰æ‰€ä¸åŒã€‚ä»¥ä¸‹æ˜¯å‡ ç§ä½¿ç”¨switchåˆ¤æ–­èŒƒå›´å€¼çš„æ–¹æ³•ï¼š</p>
<h2 id="1-switch">1. ä½¿ç”¨è¡¨è¾¾å¼switchåˆ¤æ–­èŒƒå›´</h2>
<pre><code class="language-go">score := 85

switch {
case score &gt;= 90:
    fmt.Println(&quot;ä¼˜ç§€&quot;)
case score &gt;= 80:
    fmt.Println(&quot;è‰¯å¥½&quot;)
case score &gt;= 60:
    fmt.Println(&quot;åŠæ ¼&quot;)
default:
    fmt.Println(&quot;ä¸åŠæ ¼&quot;)
}
</code></pre>
<h2 id="2-fallthrough">2. ä½¿ç”¨fallthroughå®ç°èŒƒå›´ç©¿é€</h2>
<pre><code class="language-go">temperature := 25

switch {
case temperature &lt; 0:
    fmt.Println(&quot;å†°å†»&quot;)
    fallthrough
case temperature &lt; 10:
    fmt.Println(&quot;å¯’å†·&quot;)
case temperature &lt; 20:
    fmt.Println(&quot;å‡‰çˆ½&quot;)
case temperature &lt; 30:
    fmt.Println(&quot;æ¸©æš–&quot;)
default:
    fmt.Println(&quot;ç‚çƒ­&quot;)
}
</code></pre>
<h2 id="3">3. å¤šä¸ªæ¡ä»¶ç»„åˆåˆ¤æ–­èŒƒå›´</h2>
<pre><code class="language-go">age := 25

switch age {
case 1, 2, 3:
    fmt.Println(&quot;å©´å¹¼å„¿&quot;)
case 4, 5, 6:
    fmt.Println(&quot;å¹¼å„¿&quot;)
case 7, 8, 9, 10, 11, 12:
    fmt.Println(&quot;å„¿ç«¥&quot;)
default:
    if age &gt;= 13 &amp;&amp; age &lt; 20 {
        fmt.Println(&quot;é’å°‘å¹´&quot;)
    } else if age &gt;= 20 &amp;&amp; age &lt; 60 {
        fmt.Println(&quot;æˆå¹´äºº&quot;)
    } else {
        fmt.Println(&quot;è€å¹´äºº&quot;)
    }
}
</code></pre>
<h2 id="4-switch">4. ç±»å‹switchç»“åˆèŒƒå›´åˆ¤æ–­</h2>
<pre><code class="language-go">func checkType(v interface{}) {
    switch v := v.(type) {
    case int:
        if v &gt; 100 {
            fmt.Println(&quot;å¤§æ•´æ•°&quot;)
        } else {
            fmt.Println(&quot;å°æ•´æ•°&quot;)
        }
    case float64:
        if v &gt; 0 {
            fmt.Println(&quot;æ­£æµ®ç‚¹æ•°&quot;)
        } else {
            fmt.Println(&quot;è´Ÿæµ®ç‚¹æ•°æˆ–é›¶&quot;)
        }
    default:
        fmt.Println(&quot;æœªçŸ¥ç±»å‹&quot;)
    }
}
</code></pre>
<p>Goè¯­è¨€çš„switchè¯­å¥éå¸¸çµæ´»ï¼Œä¸éœ€è¦åƒå…¶ä»–è¯­è¨€é‚£æ ·åœ¨æ¯ä¸ªcaseååŠ breakï¼Œé»˜è®¤ä¸ä¼šç©¿é€åˆ°ä¸‹ä¸€ä¸ªcaseã€‚</p>
<p>å¦‚æœéœ€è¦ç©¿é€ï¼Œå¯ä»¥æ˜¾å¼ä½¿ç”¨<code>fallthrough</code>å…³é”®å­—ã€‚</p>
<h1 id="_6">ğŸ“šç¼–ç </h1>
<h2 id="1-ascii">1 ASCIIç¼–ç </h2>
<pre><code>00000000 00000000
... ...
11111111 11111111
</code></pre>
<p>æœ€å¤§èƒ½è¡¨ç¤ºå­—ç¬¦æ•°é‡ï¼š2**16 = 65536 - 1</p>
<h2 id="2-unicode">2 unicodeä¸‡å›½ç æ ‡å‡†</h2>
<p>unicodeæ˜¯ä¸€ç§è®¾è®¡æ ‡å‡†ï¼Œä¸æ˜¯å…·ä½“çš„ç¼–ç å®ç°</p>
<pre><code>00000000 00000000 00000000 00000000
... ...
11111111 11111111 11111111 11111111
</code></pre>
<p>æœ€å¤§èƒ½è¡¨ç¤ºå­—ç¬¦æ•°é‡ï¼š2**32 = 4294967296 - 1</p>
<h2 id="3-utf-8">3 utf-8ç¼–ç </h2>
<p>å¯¹äºå«æœ‰ä¸­æ–‡è¡¨ç¤ºçš„å¼€å‘è€…æ¥è¯´ï¼Œæœ€å¸¸ç”¨çš„ç¼–ç ï¼ˆå…¼å®¹ASCIIç¼–ç ï¼‰ï¼šèŒƒå›´å†³å®šä¸€ä¸ªæ±‰å­—ä¸€èˆ¬éƒ½æ˜¯3ä¸ªå­—èŠ‚ï¼ˆ24ä½ï¼‰</p>
<pre><code>00000000 00000000 00000000
... ...
11111111 11111111 11111111
</code></pre>
<h1 id="_7">ğŸ“š æ•°æ®ç±»å‹</h1>
<h2 id="1_3">1 æ•´å‹ä¹‹é—´è½¬æ¢</h2>
<p>int ç±»å‹æ•°æ®è½¬æ¢æ—¶ï¼Œéœ€è¦æ³¨æ„å„ä¸ªä½æ•°è¡¨ç¤ºå€¼èŒƒå›´ï¼›ä»èŒƒå›´å¤§çš„å‘å°çš„è½¬æ¢ï¼Œå°¤å…¶è¦æ³¨æ„ï¼š</p>
<pre><code class="language-go">func main() {
    var a int16 = 128
    b := int8(a)
    fmt.Println(b)
}

// ç»“æœä¸º -128  -&gt; æ•°æ®æº¢å‡ºï¼Œåˆ™ä¼šæŒ‰è¶…è¿‡çš„æ•°å­—è½®è¯¢å¯¹åº”ï¼Œä¸ä¼šæŠ¥é”™
</code></pre>
<h2 id="2_2">2 ä¸åŒç±»å‹è½¬æ¢</h2>
<pre><code class="language-go">func main() {
    // æ•´å‹è½¬ä¸ºå­—ç¬¦ä¸²
    var a int16 = 128
    b := strconv.Itoa(int(a)) // ä¼ å‚åªèƒ½æ˜¯intç±»å‹ï¼›æœ‰ä¸€ä¸ªå€¼è¿”å›
    fmt.Println(b, reflect.TypeOf(b))

    // å­—ç¬¦ä¸²è½¬ä¸ºæ•´å‹
    var c string = &quot;100&quot;
    result, err := strconv.Atoi(c) // æœ‰ä¸¤ä¸ªå€¼è¿”å›
    if err != nil {
        fmt.Println(&quot;è½¬æ¢å¤±è´¥ï¼š&quot;, result, reflect.TypeOf(result), err)
    } else {
        fmt.Println(&quot;è½¬æ¢æˆåŠŸï¼š&quot;, result, reflect.TypeOf(result), err)
    }
}
</code></pre>
<h2 id="3_1">3 å­—ç¬¦ä¸²çš„æœ¬è´¨</h2>
<pre><code class="language-go">func main() {
    name1 := &quot;chæ˜Œ&quot;
    name2 := &quot;å²‘é¸¿æ˜Œ&quot;
    fmt.Println(len(name1), len(name2))                                       // å­—èŠ‚é•¿åº¦
    fmt.Println(utf8.RuneCountInString(name1), utf8.RuneCountInString(name2)) // å­—ç¬¦é•¿åº¦
    fmt.Println([]byte(name1), []byte(name2))

    rs1 := []rune(name1)
    rs2 := []rune(name2)
    fmt.Println(rs1, rs2) // unicodeç ç‚¹åˆ‡ç‰‡ï¼ˆåè¿›åˆ¶ï¼‰

    var ru1 []string
    var ru2 []string

    myList1 := [2][]rune{rs1, rs2}
    myList2 := [2][]string{ru1, ru2}

    fmt.Println(myList2)

    for i := 0; i &lt; len(myList1); i++ {
        for _, v := range myList1[i] {
            myList2[i] = append(myList2[i], strconv.FormatInt(int64(v), 16))
        }
    }
    fmt.Println(myList2) // unicodeç ç‚¹åˆ‡ç‰‡ï¼ˆåå…­è¿›åˆ¶ï¼‰
}
</code></pre>
<h2 id="4_1">4 å­—ç¬¦ä¸²å¸¸ç”¨æ–¹æ³•</h2>
<pre><code class="language-go">len(text) // å­—èŠ‚é•¿åº¦
utf8.RuneCountInString(text) // å­—ç¬¦é•¿åº¦
strings.HasPrefix(text, &quot;xxx&quot;) // æ˜¯å¦ä»¥xxxå¼€å¤´
strings.HasSuffix(text, &quot;xxx&quot;) // æ˜¯å¦ä»¥xxxç»“å°¾
strings.Contains(text, &quot;xxx&quot;) // æ˜¯å¦åŒ…å«xxx
strings.ToLower(text) // è‹±æ–‡å˜å°å†™
strings.ToUpper(text) // è‹±æ–‡å˜å¤§å†™
strings.ToTitle(text) // è‹±æ–‡å˜å¤§å†™ - é’ˆå¯¹æŸäº›æ‹‰ä¸æ–‡å­—ï¼Œä¸åŒäºToUpper
strings.Title(text) // æ¯ä¸ªç©ºæ ¼ä¹‹åçš„ç¬¬ä¸€ä¸ªå­—æ¯å˜å¤§å†™ -- Go 1.18+ å·²å¼ƒç”¨
strings.Trim(text, &quot;xxx&quot;) // å»é™¤ä¸¤è¾¹å­ä¸²xxx
strings.TrimLeft(text, &quot;xxx&quot;) // å»é™¤å·¦è¾¹å­ä¸²xxx
strings.TrimRight(text, &quot;xxx&quot;) // å»é™¤å³è¾¹å­ä¸²xxx
strings.Replace(text, &quot;xv&quot;, &quot;YY&quot;, 1) // ä»å·¦åˆ°å³æŸ¥æ‰¾åˆ°ç¬¬1ä¸ªåŒ¹é…æ›¿æ¢
strings.Replace(text, &quot;xv&quot;, &quot;YY&quot;, 2) // ä»å·¦åˆ°å³æŸ¥æ‰¾åˆ°å‰2ä¸ªåŒ¹é…æ›¿æ¢
strings.Replace(text, &quot;xv&quot;, &quot;YY&quot;, -1) // å…¨éƒ¨åŒ¹é…æ›¿æ¢
strings.ReplaceAll(text, &quot;x&quot;, &quot;Y&quot;) // å…¨éƒ¨åŒ¹é…æ›¿æ¢
strings.Split(text, &quot; &quot;) // åˆ†å‰²å­—ç¬¦ä¸² -&gt; []string ç±»å‹çš„åˆ‡ç‰‡
strings.Join([]string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;}, &quot;-&quot;) // æ‹¼æ¥ -&gt; å°†[]string ç±»å‹çš„åˆ‡ç‰‡æ‹¼æ¥

// æ‹¼æ¥å­—ç¬¦ä¸²go 1.10+ ç‰ˆæœ¬é«˜æ•ˆç‡å†™æ³•ï¼š
var builder strings.Builder
builder.WriteString(&quot;a&quot;)
builder.WriteString(&quot;b&quot;)
builder.WriteString(&quot;c&quot;)
fmt.Println(builder.String())
</code></pre>
<h2 id="5_1">5 å­—ç¬¦ä¸²ä¸å¯¹åº”ç ç‚¹æ•°äº’ç›¸è½¬æ¢</h2>
<pre><code class="language-go">fmt.Println(string(65))                   // A -&gt; ç ç‚¹è½¬å­—ç¬¦
num, size := utf8.DecodeRuneInString(&quot;A&quot;) // 65 1 -&gt; å­—ç¬¦è½¬ç ç‚¹ï¼Œå¤šä¸ªå­—ç¬¦åˆ™åªå¤„ç†ç¬¬ä¸€ä¸ªå­—ç¬¦
fmt.Println(num, size)
</code></pre>
<h1 id="_8">ğŸ“š è¿›åˆ¶è½¬æ¢å‡½æ•°</h1>
<h2 id="1_4">1 åè¿›åˆ¶è½¬å…¶ä»–è¿›åˆ¶ï¼ˆæ•°å­—è½¬å­—ç¬¦ä¸²ï¼‰</h2>
<pre><code class="language-go">func main() {
    a := 2025
    b := strconv.FormatInt(int64(a), 10)
    fmt.Println(b, reflect.TypeOf(b)) // è·å–æ•°æ®ç±»å‹ä¸ºstring
}
</code></pre>
<h2 id="2_3">2 å…¶ä»–è¿›åˆ¶è½¬åè¿›åˆ¶ï¼ˆå­—ç¬¦ä¸²è½¬æ•°å­—ï¼‰</h2>
<pre><code class="language-go">func main() {
    // strconv.ParseIntå‡½æ•°å‚æ•°è§£é‡Šï¼š
    // ç¬¬1ä¸ªå‚æ•°ï¼šéœ€è¦è½¬æ¢çš„å­—ç¬¦
    // ç¬¬2ä¸ªå‚æ•°ï¼šæŠŠæ–‡æœ¬æŒ‰å¡«å†™å¯¹åº”è¿›åˆ¶å»è½¬æ¢
    // ç¬¬3ä¸ªå‚æ•°ï¼šé™å®šè½¬æ¢æ—¶ä½¿ç”¨çš„æ•°å­—èŒƒå›´(ä¸ç»“æœæ— å…³)
    // æ³¨æ„ï¼šè¿”å›ç»“æœæ°¸è¿œæ˜¯int64ç±»å‹çš„æ•°å­—
    a := &quot;1010000101&quot;
    jz := 2
    b, err := strconv.ParseInt(a, jz, 64)
    if err != nil {
        fmt.Println(&quot;è½¬æ¢å¤±è´¥ï¼š&quot;, b, reflect.TypeOf(b)) // è·å–æ•°æ®ç±»å‹ä¸ºint64
    } else {
        fmt.Println(&quot;è½¬æ¢æˆåŠŸï¼š&quot;, b, reflect.TypeOf(b)) // è·å–æ•°æ®ç±»å‹ä¸ºint64

        c := strconv.FormatInt(b, 16)
        fmt.Println(c) // åè¿›åˆ¶è½¬ä¸ºå…¶ä»–è¿›åˆ¶ï¼Œè·å–æ•°æ®ç±»å‹ä¸ºstring
    }
}
</code></pre>
<h1 id="_9">ğŸ“š æ•°ç»„(é•¿åº¦å›ºå®š)</h1>
<h2 id="1_5">1 åŸºæœ¬åŸç†</h2>
<p><img alt="image-20240803142127637" src="image-20240803142127637.png" /></p>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong>æ•°ç»„æ˜¯å€¼ç±»å‹ï¼Œæ‰€ä»¥é’ˆå¯¹ä¼ å…¥ä¸€ä¸ªæ•°ç»„åˆ°å‡½æ•°å†…ä¿®æ”¹ï¼Œå½“å‡½æ•°æ‰§è¡Œä¹‹åï¼Œå¹¶ä¸ä¼šå½±å“å‡½æ•°å¤–çš„æ•°ç»„å€¼ï¼Œç›¸å½“äºåœ¨å„è‡ªçš„æ ˆå†…æœ‰æ•ˆã€‚</p>
<p><img alt="image-20240803161751451" src="image-20240803161751451.png" /></p>
<h2 id="2_4">2 æ•°ç»„å¯å˜ä¸æ‹·è´</h2>
<p>å¯å˜ï¼šæ•°ç»„é•¿åº¦ã€ç±»å‹ä¸èƒ½ä¿®æ”¹ï¼Œå…ƒç´ å¯ä»¥ä¿®æ”¹ï¼›</p>
<p>æ‹·è´ï¼šæ•°ç»„å˜é‡åœ¨èµ‹å€¼æ—¶ä¼šé‡æ–°æ‹·è´</p>
<pre><code class="language-go">func main() {
    name1 := [2]string{&quot;å²‘é¸¿æ˜Œ&quot;, &quot;cenhongchang&quot;}
    name2 := name1
    name2[0] = &quot;chc&quot;
    fmt.Println(name1, name2)
    // æ‰§è¡Œç»“æœï¼š[å²‘é¸¿æ˜Œ cenhongchang] [chc cenhongchang]
    // ç»“æœè¡¨æ˜ï¼š1.æ•°ç»„å…ƒç´ å¯ä»¥è¢«ä¿®æ”¹ï¼›2.æ•°ç»„å˜é‡èµ‹å€¼æ—¶ï¼Œä¼šé‡æ–°æ‹·è´ä¸€ä»½ï¼ˆè¿™ä¸pythonä¸åŒï¼‰
}
</code></pre>
<h1 id="_10">ğŸ“š åˆ‡ç‰‡(é•¿åº¦å¯å˜)</h1>
<h2 id="1_6">1 åˆ‡ç‰‡æ¦‚å¿µ</h2>
<p>åˆ‡ç‰‡(slice)æ˜¯ Golang ä¸­ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œè¿™ç§æ•°æ®ç»“æ„æ›´ä¾¿äºä½¿ç”¨å’Œç®¡ç†æ•°æ®é›†åˆã€‚</p>
<p>åˆ‡ç‰‡æ˜¯å›´ç»•åŠ¨æ€æ•°ç»„çš„æ¦‚å¿µæ„å»ºçš„ï¼Œå¯ä»¥æŒ‰éœ€è‡ªåŠ¨å¢é•¿å’Œç¼©å°ã€‚</p>
<p>åˆ‡ç‰‡çš„åŠ¨æ€å¢é•¿æ˜¯é€šè¿‡å†…ç½®å‡½æ•° append() æ¥å®ç°çš„ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥å¿«é€Ÿä¸”é«˜æ•ˆåœ°å¢é•¿åˆ‡ç‰‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¯¹åˆ‡ç‰‡å†æ¬¡åˆ‡å‰²ï¼Œç¼©å°ä¸€ä¸ªåˆ‡ç‰‡çš„å¤§å°ã€‚å› ä¸ºåˆ‡ç‰‡çš„åº•å±‚ä¹Ÿæ˜¯åœ¨è¿ç»­çš„å†…å­˜å—ä¸­åˆ†é…çš„ï¼Œæ‰€ä»¥åˆ‡ç‰‡è¿˜èƒ½è·å¾—ç´¢å¼•ã€è¿­ä»£ä»¥åŠä¸ºåƒåœ¾å›æ”¶ä¼˜åŒ–çš„å¥½å¤„ã€‚</p>
<p><img alt="image-20240803202443993" src="image-20240803202443993.png" /></p>
<h2 id="2_5">2 åˆ‡ç‰‡åˆ›å»º</h2>
<pre><code class="language-go">æ–¹å¼ä¸€ï¼šï¼›
var numbers []int
var numbers = []int{11, 22, 33}
numbers := []int{11, 22, 33}

æ–¹å¼äºŒï¼šmake(type, len, cap)  //ç±»å‹ã€é•¿åº¦ã€å®¹é‡
numbers := make([]int, 3, 3}

ä¸¤ç§æ–¹å¼åˆ›å»ºçš„åŒºåˆ«ï¼š
æ–¹å¼ä¸€åˆ›å»ºçš„åˆ‡ç‰‡äº‹å…ˆå­˜åœ¨ï¼Œç¨‹åºå‘˜å¯è§ï¼›
æ–¹å¼äºŒåˆ›å»ºçš„åˆ‡ç‰‡ä¼šåˆ›å»ºæ–°çš„æ•°ç»„ï¼Œæ˜¯ç”±åˆ‡ç‰‡è‡ªèº«åœ¨åº•å±‚ç»´æŠ¤ï¼Œç¨‹åºå‘˜ä¸å¯è§ã€‚

æ˜“æ··æ·†ç‚¹ï¼š
slicePointer := new([]int)  // newå°±æ˜¯ç”¨æ¥åˆ›å»ºæŒ‡é’ˆç±»å‹å˜é‡çš„ï¼Œä¼šè‡ªåŠ¨åˆå§‹åŒ–ï¼›slicePointeræŒ‡å‘é•¿åº¦ä¸º0ã€å®¹é‡ä¸º0çš„åˆ‡ç‰‡
var slicePointer *[]int  // slicePointerä¸ºnilï¼Œç±»å‹åˆæ˜¯æŒ‡é’ˆç±»å‹ï¼Œæ‰€ä»¥ä¹Ÿç§°ç©ºæŒ‡é’ˆï¼›ç©ºæŒ‡é’ˆæ— æ³•è§£å¼•ç”¨è·å–å€¼ï¼Œä¼šæŠ¥é”™
</code></pre>
<h2 id="3_2">3 åˆ‡ç‰‡ä¸æ•°ç»„åŒºåˆ«</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">ç‰¹æ€§</th>
<th style="text-align: left;">æ•°ç»„ï¼ˆArrayï¼‰</th>
<th style="text-align: left;">åˆ‡ç‰‡ï¼ˆSliceï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>é•¿åº¦</strong></td>
<td style="text-align: left;">å›ºå®š</td>
<td style="text-align: left;">åŠ¨æ€å¯å˜</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ç±»å‹</strong></td>
<td style="text-align: left;">å€¼ç±»å‹ï¼ˆå¤åˆ¶æ•´ä¸ªæ•°æ®ï¼‰</td>
<td style="text-align: left;">å¼•ç”¨ç±»å‹ï¼ˆå…±äº«åº•å±‚æ•°ç»„ï¼‰</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å†…å­˜åˆ†é…</strong></td>
<td style="text-align: left;">é€šå¸¸åœ¨æ ˆä¸Š</td>
<td style="text-align: left;">é€šå¸¸åœ¨å †ä¸Š</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å£°æ˜é•¿åº¦</strong></td>
<td style="text-align: left;">å¿…é¡»æ˜¾å¼æˆ–é€šè¿‡<code>[...]</code>æ¨æ–­</td>
<td style="text-align: left;">å¯åŠ¨æ€æ‰©å±•</td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ€§èƒ½</strong></td>
<td style="text-align: left;">æ— GCå‹åŠ›ï¼Œä½†å¤åˆ¶æˆæœ¬é«˜</td>
<td style="text-align: left;">æœ‰GCå‹åŠ›ï¼Œä½†æ“ä½œçµæ´»</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>æ•°ç»„</strong>ï¼š</li>
<li>éœ€è¦å›ºå®šå¤§å°ä¸”å¯¹å†…å­˜æ•æ„Ÿçš„åœºæ™¯ï¼ˆå¦‚åŠ å¯†ç®—æ³•ä¸­çš„å—å¤„ç†ï¼‰ã€‚</li>
<li>æ˜ç¡®çŸ¥é“å…ƒç´ æ•°é‡ä¸”æ— éœ€ä¿®æ”¹é•¿åº¦æ—¶ï¼ˆå¦‚æœˆä»½åç§°ï¼‰ã€‚</li>
<li><strong>åˆ‡ç‰‡</strong>ï¼š</li>
<li>ç»å¤§å¤šæ•°åœºæ™¯ï¼ˆåŠ¨æ€æ•°æ®é›†åˆã€å‡½æ•°ä¼ å‚ç­‰ï¼‰ã€‚</li>
<li>éœ€è¦åŠ¨æ€å¢åˆ å…ƒç´ æ—¶ï¼ˆå¦‚è¯»å–æ–‡ä»¶ã€HTTPè¯·æ±‚ä½“ï¼‰ã€‚</li>
</ul>
<pre><code class="language-go">// æ•°ç»„ï¼ˆå€¼ä¼ é€’ï¼‰
a := [3]int{1, 2, 3}
b := a         // å¤åˆ¶æ•´ä¸ªæ•°ç»„
b[0] = 100     // ä¿®æ”¹bä¸ä¼šå½±å“a
fmt.Println(a) // [1 2 3]

// åˆ‡ç‰‡ï¼ˆå¼•ç”¨ä¼ é€’ï¼‰
x := []int{1, 2, 3}
y := x         // å…±äº«åº•å±‚æ•°ç»„
y[0] = 100     // ä¿®æ”¹yä¼šå½±å“x
fmt.Println(x) // [100 2 3]
</code></pre>
<h2 id="4_2">4 åˆ‡ç‰‡è‡ªåŠ¨æ‰©å®¹</h2>
<p>åœ¨ Go è¯­è¨€çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆå¦‚ Go 1.19 åŠä»¥ä¸Šï¼‰ï¼Œåˆ‡ç‰‡çš„è‡ªåŠ¨æ‰©å®¹è§„åˆ™ç›¸è¾ƒäºæ—§ç‰ˆæœ¬ï¼ˆå¦‚ Go 1.17 åŠä¹‹å‰ï¼‰æœ‰æ‰€è°ƒæ•´ï¼Œé‡‡ç”¨äº†æ›´å¹³æ»‘çš„å¢é•¿ç­–ç•¥ï¼Œè€Œéç®€å•çš„â€œå°äº 1024 æ—¶ 2 å€æ‰©å®¹ï¼Œå¤§äºç­‰äº 1024 æ—¶ 1.25 å€æ‰©å®¹â€çš„å›ºå®šè§„åˆ™ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ‰©å®¹æœºåˆ¶ï¼š</p>
<ul>
<li><strong>å®¹é‡è¾ƒå°ï¼ˆ&lt; 256ï¼‰æ—¶</strong>ï¼šä»ç„¶é‡‡ç”¨ <strong>2 å€æ‰©å®¹</strong>ï¼Œä»¥å‡å°‘é¢‘ç¹æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—18ã€‚</li>
<li><strong>å®¹é‡è¾ƒå¤§ï¼ˆâ‰¥ 256ï¼‰æ—¶</strong>ï¼šæ‰©å®¹å› å­ä¼šé€æ­¥é™ä½ï¼Œä» 2.0 é€æ¸è¿‡æ¸¡åˆ° 1.25 å€å·¦å³ï¼Œä»¥å‡å°‘å†…å­˜æµªè´¹110ã€‚</li>
</ul>
<h3 id="41">4.1 å…·ä½“æ‰©å®¹å› å­å˜åŒ–</h3>
<p>ä¸åŒåˆå§‹å®¹é‡ä¸‹çš„æ‰©å®¹å› å­å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>åˆå§‹å®¹é‡ï¼ˆStarting Capï¼‰</strong></th>
<th style="text-align: left;"><strong>æ‰©å®¹å› å­ï¼ˆGrowth Factorï¼‰</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">256</td>
<td style="text-align: left;">2.0</td>
</tr>
<tr>
<td style="text-align: left;">512</td>
<td style="text-align: left;">1.63</td>
</tr>
<tr>
<td style="text-align: left;">1024</td>
<td style="text-align: left;">1.44</td>
</tr>
<tr>
<td style="text-align: left;">2048</td>
<td style="text-align: left;">1.35</td>
</tr>
<tr>
<td style="text-align: left;">4096</td>
<td style="text-align: left;">1.30</td>
</tr>
</tbody>
</table>
<p>è¿™ä¸ªå˜åŒ–ä½¿å¾—æ‰©å®¹ç­–ç•¥æ›´åŠ å¹³æ»‘ï¼Œé¿å…äº†å¤§å®¹é‡åˆ‡ç‰‡æ—¶å†…å­˜çš„è¿‡åº¦å¢é•¿ã€‚</p>
<h3 id="42">4.2 ç‰¹æ®Šæƒ…å†µ</h3>
<ul>
<li><strong>è¿½åŠ å…ƒç´ è¶…å‡ºå½“å‰å®¹é‡ 2 å€</strong>ï¼šå¦‚æœ <code>append</code> æ“ä½œåçš„æ–°é•¿åº¦è¶…è¿‡å½“å‰å®¹é‡çš„ 2 å€ï¼Œåˆ™ç›´æ¥æŒ‰æ–°é•¿åº¦åˆ†é…å®¹é‡ï¼Œè€Œä¸æ˜¯æŒ‰å¢é•¿å› å­è®¡ç®—46ã€‚</li>
<li><strong>å†…å­˜å¯¹é½ä¼˜åŒ–</strong>ï¼šGo åœ¨è®¡ç®—æ–°å®¹é‡æ—¶è¿˜ä¼šè€ƒè™‘å†…å­˜å¯¹é½ï¼Œæœ€ç»ˆåˆ†é…çš„å®¹é‡å¯èƒ½ä¼šæ¯”è®¡ç®—å€¼ç¨å¤§ï¼Œä»¥å‡å°‘å†…å­˜ç¢ç‰‡</li>
</ul>
<pre><code class="language-go">s := make([]int, 0, 2)
s = append(s, 1, 2) // å®¹é‡è¶³å¤Ÿï¼Œä¸æ‰©å®¹
s = append(s, 3)    // å®¹é‡ä¸è¶³ï¼Œæ‰©å®¹è‡³ 4ï¼ˆ2 â†’ 4ï¼‰
s = append(s, 4, 5) // å®¹é‡ä¸è¶³ï¼Œæ‰©å®¹è‡³ 8ï¼ˆ4 â†’ 8ï¼‰
</code></pre>
<h3 id="43">4.3 æœ€ä½³å®è·µ</h3>
<p>æƒ…æ™¯1ï¼šæ²¡æœ‰è§¦å‘è‡ªåŠ¨æ‰©å®¹ï¼Œåˆ‡ç‰‡å˜é‡å…±äº«åº•å±‚æ•°ç»„</p>
<pre><code class="language-go">func main() {
    v1 := make([]int, 1, 3) // [0]
    v2 := append(v1, 99)    // [0 99]
    fmt.Println(v1, v2)     // [0] [0 99]
    v1[0] = -1
    fmt.Println(v1, v2) // [-1] [-1 99]
} 
</code></pre>
<p>æƒ…æ™¯2ï¼šè§¦å‘è‡ªåŠ¨æ‰©å®¹ï¼Œæ–°çš„åˆ‡ç‰‡ä¼šæ–°å¯¹åº”ä¸€ä¸ªæ–°çš„åº•å±‚æ•°ç»„</p>
<pre><code class="language-go">func main() {
    v1 := make([]int, 1, 3)      // [0]
    v2 := append(v1, 99, 88, 77) // [0 99 88 77] -&gt; æ·»åŠ å…ƒç´ å·²ç»è¶…è¿‡å®¹é‡ï¼Œä¼šè‡ªåŠ¨æ‰©å®¹
    fmt.Println(v1, v2)          // [0] [0 99 88 77]
    v1[0] = -1
    fmt.Println(v1, v2) // [-1] [0 99 88 77]
}
</code></pre>
<ul>
<li><strong>é¢„åˆ†é…å®¹é‡</strong>ï¼šå¦‚æœå·²çŸ¥åˆ‡ç‰‡æœ€ç»ˆå¤§å°ï¼Œå»ºè®®ä½¿ç”¨ <code>make([]T, 0, cap)</code> é¢„åˆ†é…è¶³å¤Ÿå®¹é‡ï¼Œé¿å…é¢‘ç¹æ‰©å®¹</li>
<li><strong>é¿å…å…±äº«åº•å±‚æ•°ç»„</strong>ï¼šæ‰©å®¹åæ–°åˆ‡ç‰‡å¯èƒ½æŒ‡å‘æ–°å†…å­˜ï¼Œè€Œæ—§åˆ‡ç‰‡ä»æŒ‡å‘åŸæ•°ç»„ï¼Œéœ€æ³¨æ„æ•°æ®ä¸€è‡´æ€§</li>
</ul>
<p><img alt="image-20250801105720600" src="README.assets/image-20250801105720600.png" /> </p>
<h2 id="5_2">5 åˆ‡ç‰‡ç›¸å…³æ“ä½œ</h2>
<h3 id="51">5.1 åŸºæœ¬æ“ä½œ</h3>
<pre><code class="language-go">val := make(int[], 4, 5)

len(val) // é•¿åº¦
cap(val) // å®¹é‡

val[0] // ç´¢å¼•å–å€¼ï¼›ç´¢å¼•æœ€å¤§å€¼ï¼šlen(val) - 1

val[1:3]  // åˆ‡ç‰‡ç»§ç»­åˆ‡ç‰‡ï¼Œè·å–ç¬¬2ä¸ª-ç¬¬3ä¸ªå…ƒç´ ï¼ˆå–å‰ä¸å–åï¼‰
val[1:]
val[:3]  // æ³¨æ„ï¼šåˆ‡ç‰‡é€šè¿‡å†åˆ‡ç‰‡åå¾—åˆ°çš„æ•°æ®å¯¹åº”å†…å­˜åœ°å€ä¸åŸåˆ‡ç‰‡çš„å¯¹åº”ï¼Œæ‰€ä»¥æ–°åˆ‡ç‰‡æˆ–åŸåˆ‡ç‰‡ä¿®æ”¹æŸä¸ªå…ƒç´ å€¼ï¼Œéƒ½ä¼šäº’ç›¸å½±å“è¢«ä¿®æ”¹
</code></pre>
<h3 id="52">5.2 è¿½åŠ å…ƒç´ </h3>
<pre><code class="language-go">v1 := []int{11, 22, 33}
vx := []int{88, 99}

v2 := append(v1, 44, 55, 66)
v3 := append(v1, vx...)
</code></pre>
<h3 id="52_1">5.2 â€œ åˆ é™¤â€å…ƒç´ </h3>
<pre><code class="language-go">// goè¯­è¨€åˆ é™¤å…ƒç´ ä½¿ç”¨é“¾è¡¨ï¼Œè¿™é‡Œç”¨æˆªå–æ‹¼æ¥æ–¹å¼ï¼ˆä¸€èˆ¬ç”¨çš„å°‘ï¼‰
func main() {
    v1 := []int{1, 2, 3, 4, 5, 6}
    fmt.Println(v1)

    deleteIndex := 2
    v2 := append(v1[:deleteIndex], v1[deleteIndex+1:]...)
    fmt.Println(v2) // [1 2 4 5 6]
    fmt.Println(v1) // [1 2 4 5 6 6]
}
// è¿™ç§æ–¹å¼æ³¨æ„ï¼šåŸåˆ‡ç‰‡v1ä¼šè¢«ä¿®æ”¹
</code></pre>
<h3 id="53">5.3 æ’å…¥å…ƒç´ </h3>
<pre><code class="language-go">func main() {
    v1 := []int{11, 22, 33, 44, 55, 66}
    insertIndex := 3 // åœ¨ç´¢å¼•3çš„ä½ç½®æ’å…¥99
    result := make([]int, 0, len(v1)+1)
    result = append(result, v1[:insertIndex]...)
    result = append(result, 99)
    result = append(result, v1[insertIndex:]...)
    fmt.Println(result)
}
// æ•ˆç‡ä½ä¸‹ - ä¸æ¨èï¼›ä¸è¦ç›´æ¥ç”¨v1å–åˆ‡ç‰‡å»è¿½åŠ ï¼Œé‚£æ ·ä¹Ÿä¼šå¯¼è‡´å…ƒç´ è¦†ç›–é—®é¢˜
</code></pre>
<h1 id="-map">ğŸ“š å“ˆå¸Œè¡¨-map</h1>
<h2 id="1_7">1 åŸºæœ¬ä»‹ç»</h2>
<p>map æ˜¯ä¸€ç§æ— åºçš„é›†åˆç±»å‹ï¼Œå®ƒå°†å”¯ä¸€é”®(key)æ˜ å°„åˆ°å€¼(value)ï¼š</p>
<ul>
<li><strong>é”®(key)</strong>ï¼šå¿…é¡»æ˜¯å¯æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰çš„ç±»å‹</li>
<li>
<p>å¯æ¯”è¾ƒç±»å‹å½’ç±»åç§°ï¼šbooleansã€numbersã€stringsã€pointersã€å…ƒç´ ç±»å‹ä¸ºå¯æ¯”è¾ƒçš„channelå’Œarraysã€å…¨éƒ¨å­—æ®µä¸ºå¯æ¯”è¾ƒçš„structs</p>
</li>
<li>
<p>å…·ä½“ç±»å‹ï¼š<code>int</code>, <code>string</code>ï¼Œ<code>bool</code>, <code>float</code>, <code>array</code>, æŒ‡é’ˆç­‰ï¼Œä½†ä¸èƒ½æ˜¯ <code>slice</code>, <code>map</code>, <code>function</code>ï¼‰</p>
</li>
<li>
<p><strong>å€¼(value)</strong>ï¼šå¯ä»¥æ˜¯ä»»æ„ç±»å‹</p>
</li>
<li>
<p><strong>æ— åºæ€§</strong>ï¼šå…ƒç´ å­˜å‚¨å’Œéå†é¡ºåºä¸å›ºå®š</p>
</li>
</ul>
<pre><code class="language-go">// å£°æ˜
var m map[keyType]valueType

// åˆå§‹åŒ–
m = make(map[keyType]valueType)

// å£°æ˜å¹¶åˆå§‹åŒ–ç®€å†™
m := make(map[string]int)
m := map[string]int{&quot;a&quot;: 1, &quot;b&quot;: 2}
</code></pre>
<h3 id="11">1.1 é‡è¦ç‰¹æ€§</h3>
<ol>
<li><strong>å¼•ç”¨ç±»å‹</strong>ï¼šmapæ˜¯å¼•ç”¨ç±»å‹ï¼Œä¼ é€’mapä¸ä¼šæ‹·è´åº•å±‚æ•°æ®</li>
<li><strong>åŠ¨æ€å¢é•¿</strong>ï¼šmapä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†å®¹é‡</li>
<li><strong>éçº¿ç¨‹å®‰å…¨</strong>ï¼šå¹¶å‘è¯»å†™éœ€è¦åŠ é”ï¼ˆæˆ–ä½¿ç”¨ <code>sync.Map</code>ï¼‰</li>
<li><strong>é›¶å€¼</strong>ï¼šæœªåˆå§‹åŒ–çš„mapé›¶å€¼æ˜¯ <code>nil</code>ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨</li>
</ol>
<h3 id="12">1.2 æ€§èƒ½ç‰¹ç‚¹</h3>
<ol>
<li>å¹³å‡æ—¶é—´å¤æ‚åº¦ï¼š</li>
<li>æ’å…¥ï¼šO(1)</li>
<li>æŸ¥æ‰¾ï¼šO(1)</li>
<li>åˆ é™¤ï¼šO(1)</li>
<li>å†…å­˜å¼€é”€æ¯”sliceå¤§</li>
<li>ä¸é€‚åˆå°æ•°æ®é‡ï¼ˆå°‘é‡å…ƒç´ æ—¶slice+çº¿æ€§æœç´¢å¯èƒ½æ›´å¿«ï¼‰</li>
</ol>
<h3 id="13">1.3 ä½¿ç”¨åœºæ™¯</h3>
<ul>
<li>å¿«é€ŸæŸ¥æ‰¾è¡¨</li>
<li>å»é‡æ“ä½œ</li>
<li>ç¼“å­˜å®ç°</li>
<li>å¯¹è±¡å±æ€§å­˜å‚¨</li>
</ul>
<h3 id="14">1.4 éå†ç‰¹æ€§</h3>
<p>Go è¯­è¨€ä¸­ï¼Œ<strong>åœ¨ <code>range</code> éå† map æ—¶ç›´æ¥åˆ é™¤å½“å‰æ­£åœ¨éå†çš„å…ƒç´ </strong>æ˜¯å®‰å…¨çš„</p>
<p>ç»å…¸é¢è¯•é¢˜ï¼šcounterçš„å€¼æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>ç­”æ¡ˆï¼š2æˆ–è€…3 ï¼ˆmapæ˜¯æ— åºçš„ï¼Œrangeéå†æ˜¯éå†å¿«ç…§ï¼Œä¿®æ”¹åŸmapä¸å½±å“æ­£åœ¨éå†çš„å¿«ç…§ï¼Œä½†æ˜¯åŸmapä¼šæ”¹å˜ï¼‰</p>
<pre><code class="language-go">package main

import &quot;fmt&quot;

func main() {
    var m = map[string]int{
        &quot;A&quot;: 21,
        &quot;B&quot;: 22,
        &quot;C&quot;: 23,
    }
    counter := 0
    for k, v := range m {
        if counter == 0 {
            delete(m, &quot;A&quot;)
        }
        counter++
        fmt.Println(k, v)
    }
    fmt.Println(&quot;counter is &quot;, counter)
}
</code></pre>
<p>Go çš„ <code>range</code> éå† map å®ç°æ–¹å¼ï¼š</p>
<ol>
<li>å†…éƒ¨ä¼šå…ˆå¯¹ map çš„çŠ¶æ€åšä¸€ä¸ªå¿«ç…§</li>
<li>éå†æ˜¯åŸºäºè¿™ä¸ªå¿«ç…§è¿›è¡Œçš„</li>
<li>ä¿®æ”¹ï¼ˆåŒ…æ‹¬åˆ é™¤ï¼‰æ“ä½œä¼šå½±å“åŸå§‹ mapï¼Œä½†ä¸ä¼šå½±å“æ­£åœ¨è¿›è¡Œçš„éå†</li>
</ol>
<h2 id="2_6">2 å£°æ˜ &amp; åˆå§‹åŒ–</h2>
<pre><code class="language-go">userInfo := map[string]string{}
userInfo := map[string]string{&quot;name&quot;:cenhongchang, &quot;age&quot;: 18}

fmt.Println(userInfo[&quot;name&quot;])  // æ‰“å°nameçš„å€¼
userInfo[&quot;name&quot;] = &quot;chc&quot;  // ä¿®æ”¹nameçš„å€¼
</code></pre>
<pre><code class="language-go">userInfo := make(map[int]int)
userInfo := make(map[int]intï¼Œ 10)  // æŒ‡å®šé•¿åº¦
</code></pre>
<pre><code class="language-go">var row map[int]int
// row[&quot;name&quot;] = &quot;chc&quot; -&gt; ä¼šæŠ¥é”™ï¼Œä¸€èˆ¬åªç”¨äºæ•´ä½“èµ‹å€¼æƒ…å†µ

pointer := new(map[int]int) // æŒ‡é’ˆå˜é‡ï¼Œä¹Ÿæ˜¯ç”¨äºæ•´ä½“èµ‹å€¼ï¼Œç›¸å½“äºå£°æ˜è¿™æ˜¯ä¸€ä¸ªmapçš„æŒ‡é’ˆå˜é‡
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-go">func main() {
    userInfo := map[string]string{}
    userInfo[&quot;name&quot;] = &quot;chc&quot;
    fmt.Println(userInfo)

    pointer := new(map[string]string)
    pointer = &amp;userInfo

    newData := *pointer
    newData[&quot;age&quot;] = &quot;18&quot;

    fmt.Println(userInfo)  // è¿™æ—¶å€™éƒ½æŒ‡å‘åŒä¸€åœ°å€
    fmt.Println(newData)
}

</code></pre>
<h2 id="3_3">3 é•¿åº¦ã€å®¹é‡åŠæ“ä½œ</h2>
<pre><code class="language-go">func main() {
    userInfo := make(map[string]string, 10) // å®¹é‡ä¸æ˜¯é•¿åº¦ï¼Œä¹Ÿæ²¡æœ‰åƒåˆ‡ç‰‡æ±‚å®¹é‡çš„capå‡½æ•° -- åˆ‡è®°
    userInfo[&quot;å§“å&quot;] = &quot;cenhongchang&quot;
    userInfo[&quot;å¹´é¾„&quot;] = &quot;18&quot;
    userInfo[&quot;èº«é«˜&quot;] = &quot;172&quot;
    fmt.Println(len(userInfo))
    fmt.Println(userInfo)
    userInfo[&quot;ä½“é‡&quot;] = &quot;135&quot; // å¢åŠ 
    delete(userInfo, &quot;ä½“é‡&quot;) // åˆ é™¤
    userInfo[&quot;èº«é«˜&quot;] = &quot;180&quot; // ä¿®æ”¹
    fmt.Println(userInfo)
    fmt.Println(userInfo[&quot;å§“å&quot;]) // æŸ¥çœ‹
}
</code></pre>
<h2 id="4-key">4 åµŒå¥—key</h2>
<pre><code class="language-go">make(map[ [5]int ]string) // æ•°ç»„
// make(map[ []int ]string) // åˆ‡ç‰‡ key -&gt; æŠ¥é”™ä¸å¯å“ˆå¸Œ
// make(map[ map[int]string ]string)  // map key -&gt; æŠ¥é”™ä¸å¯å“ˆå¸Œ
</code></pre>
<h2 id="5_3">5 åº•å±‚å­˜å‚¨åŸç†</h2>
<p>åˆ›å»ºmap -&gt; hmap -&gt; æ¡¶ -&gt; bmap</p>
<p>åˆ›å»º -&gt; <code>make(map[string]string, 10)</code></p>
<p>hmap -&gt; æ ¹æ®ç®—æ³•è§„åˆ™è‡ªåŠ¨è®¡ç®—å‡ºåˆé€‚çš„Bå€¼</p>
<p>æ¡¶çš„æ•°é‡ -&gt; 2á´®ï¼ˆ2çš„Bæ¬¡æ–¹ä¸ªï¼‰</p>
<p>bmap -&gt; æ¯ä¸ªæ¡¶æ­£å¸¸æœ€å¤šå­˜å‚¨8ä¸ªé”®å€¼å¯¹ï¼›å½“ç„¶å¯ä»¥ä½¿ç”¨æŒ‡é’ˆæ‰©å±•æº¢å‡ºæ¡¶</p>
<p><img alt="image-20250806171533884" src="README.assets/image-20250806171533884.png" /> </p>
<h3 id="51_1">5.1 åˆå§‹åŒ–</h3>
<h3 id="52_2">5.2 å†™å…¥æ•°æ®</h3>
<h3 id="53_1">5.3 è¯»å–æ•°æ®</h3>
<h3 id="54">5.4 æ‰©å®¹</h3>
<h3 id="55">5.5 è¿ç§»</h3>
<h1 id="newmake">ğŸ“š æŒ‡é’ˆä¸newä»¥åŠmake</h1>
<p>Go è¯­è¨€ä¸­ï¼Œ<strong>æŒ‡é’ˆ</strong>æ˜¯ä¸€ç§å­˜å‚¨<strong>å˜é‡å†…å­˜åœ°å€</strong>çš„ç‰¹æ®Šå˜é‡ã€‚å®ƒ<strong>å…è®¸ä½ ç›´æ¥è®¿é—®å’Œä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æ“ä½œæ•°æ®çš„å‰¯æœ¬</strong>ã€‚è¿™æ˜¯é«˜æ•ˆæ“ä½œå¤§å‹æ•°æ®ç»“æ„å’Œå®ç°æŸäº›é«˜çº§ç‰¹æ€§çš„å…³é”®æœºåˆ¶ã€‚</p>
<h2 id="1_8">1 å†…å­˜åœ°å€ä¸å€¼</h2>
<ul>
<li>æ¯ä¸ªå˜é‡éƒ½å­˜å‚¨åœ¨å†…å­˜çš„æŸä¸ªä½ç½®ï¼ˆåœ°å€ï¼‰ã€‚</li>
<li>æŒ‡é’ˆä¿å­˜çš„æ˜¯è¿™ä¸ªåœ°å€ï¼Œè€Œä¸æ˜¯å€¼æœ¬èº«ã€‚</li>
</ul>
<pre><code class="language-go">var a int = 42  // å£°æ˜ä¸€ä¸ªæ•´å‹å˜é‡ a
var p *int = &amp;a // p æ˜¯æŒ‡å‘ a çš„æŒ‡é’ˆï¼ˆä¿å­˜ a çš„å†…å­˜åœ°å€ï¼‰
</code></pre>
<h2 id="2_7">2 æ“ä½œç¬¦</h2>
<ul>
<li><code>&amp;</code>ï¼ˆå–åœ°å€ç¬¦ï¼‰ï¼šè·å–å˜é‡çš„å†…å­˜åœ°å€</li>
</ul>
<p><code>go
  fmt.Println(&amp;a) // è¾“å‡ºï¼š0xc00000a0c8ï¼ˆç¤ºä¾‹åœ°å€ï¼‰</code></p>
<ul>
<li><code>*</code>ï¼ˆè§£å¼•ç”¨ç¬¦ï¼‰ï¼šé€šè¿‡æŒ‡é’ˆè®¿é—®æˆ–ä¿®æ”¹è¯¥åœ°å€çš„å€¼</li>
</ul>
<p><code>go
  fmt.Println(*p) // è¾“å‡ºï¼š42ï¼ˆè¯»å– p æŒ‡å‘çš„å€¼ï¼‰
  *p = 100       // é€šè¿‡ p ä¿®æ”¹ a çš„å€¼
  fmt.Println(a)  // è¾“å‡ºï¼š100</code></p>
<h2 id="3_4">3 æŒ‡é’ˆçš„å…¸å‹ç”¨é€”</h2>
<h3 id="31">3.1 é¿å…å¤§æ•°æ®çš„æ‹·è´</h3>
<pre><code class="language-go">type BigStruct struct { data [10000]int }

func ModifyByValue(s BigStruct) { /* æ“ä½œå‰¯æœ¬ï¼Œæ•ˆç‡ä½ */ }
func ModifyByPointer(s *BigStruct) { /* ç›´æ¥æ“ä½œåŸæ•°æ® */ }

func main() {
    big := BigStruct{}
    ModifyByPointer(&amp;big) // åªä¼ é€’æŒ‡é’ˆï¼ˆ8å­—èŠ‚ï¼‰ï¼Œé¿å…æ‹·è´æ•´ä¸ªç»“æ„ä½“
}
</code></pre>
<h3 id="32">3.2 ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡</h3>
<pre><code class="language-go">func ResetToZero(n *int) {
    *n = 0 // ä¿®æ”¹å¤–éƒ¨å˜é‡
}

func main() {
    x := 99
    ResetToZero(&amp;x)
    fmt.Println(x) // è¾“å‡ºï¼š0
}
</code></pre>
<h3 id="33">3.3  å®ç°å¼•ç”¨è¯­ä¹‰ï¼ˆå¦‚ä¿®æ”¹ç»“æ„ä½“å­—æ®µï¼‰</h3>
<pre><code class="language-go">type User struct{ Name string }

func (u *User) Rename(newName string) {
    u.Name = newName // ä¿®æ”¹åŸç»“æ„ä½“
}

func main() {
    user := User{&quot;Alice&quot;}
    user.Rename(&quot;Bob&quot;) // Go è‡ªåŠ¨è½¬æ¢ä¸ºæŒ‡é’ˆè°ƒç”¨
    fmt.Println(user.Name) // è¾“å‡ºï¼š&quot;Bob&quot;
}
</code></pre>
<h2 id="4_3">4 æŒ‡é’ˆçš„æ³¨æ„äº‹é¡¹</h2>
<h3 id="41-nil-new">4.1 ç©ºæŒ‡é’ˆï¼ˆ<code>nil</code>ï¼‰ä¸ newå…³é”®å­—</h3>
<ul>
<li>æœªåˆå§‹åŒ–çš„æŒ‡é’ˆå€¼ä¸º <code>nil</code>ï¼Œè§£å¼•ç”¨ä¼šå¼•å‘ panicï¼š</li>
</ul>
<p><code>go
  //æ— åˆå§‹åŒ–çš„æŒ‡é’ˆ
  var p *int
  fmt.Println(*p) // panic: runtime error: invalid memory address</code></p>
<ul>
<li>æœ‰åˆå§‹åŒ–çš„æŒ‡é’ˆ</li>
</ul>
<p><code>go
  //æœ‰åˆå§‹åŒ–çš„æŒ‡é’ˆ
  tpointerb := new(int)
  fmt.Println("tpointerb:", tpointerb)
  *tpointerb = 10000000
  fmt.Println("tpointerb:", tpointerb)</code></p>
<ul>
<li>ä½¿ç”¨å‰åŠ¡å¿…æ£€æŸ¥ï¼š</li>
</ul>
<p><code>go
  if p != nil {
      *p = 42
  }</code></p>
<h3 id="42_1">4.2 ä¸è¦å¯¹æ ˆä¸Šé€ƒé€¸çš„æŒ‡é’ˆè¿‡åº¦ä¼˜åŒ–</h3>
<ul>
<li>Go ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å†³å®šå˜é‡åˆ†é…åœ¨æ ˆè¿˜æ˜¯å †ä¸Šï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†å†…å­˜ã€‚</li>
</ul>
<h3 id="43_1">4.3 æŒ‡é’ˆä¸å¹¶å‘å®‰å…¨</h3>
<ul>
<li>å¤šä¸ª goroutine åŒæ—¶é€šè¿‡æŒ‡é’ˆä¿®æ”¹åŒä¸€æ•°æ®æ—¶ï¼Œéœ€ç”¨ <code>sync.Mutex</code> ç­‰æœºåˆ¶ä¿æŠ¤ã€‚</li>
</ul>
<h2 id="5-make">5 makeå‡½æ•°</h2>
<p><strong>makeä¹Ÿæ˜¯ç”¨äºå†…å­˜åˆ†é…çš„ï¼ŒåŒºåˆ«äºnewï¼Œå®ƒåªç”¨äºsliceã€mapä»¥åŠchançš„å†…å­˜åˆ›å»ºï¼Œè€Œä¸”å®ƒè¿”å›çš„ç±»å‹å°±æ˜¯è¿™ä¸‰ä¸ªç±»å‹æœ¬èº«ï¼Œè€Œä¸æ˜¯ä»–ä»¬çš„æŒ‡é’ˆç±»å‹ï¼Œå› ä¸ºè¿™ä¸‰ç§ç±»å‹å°±æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¿…è¦è¿”å›ä»–ä»¬çš„æŒ‡é’ˆäº†ã€‚</strong>makeå‡½æ•°çš„å‡½æ•°ç­¾åå¦‚ä¸‹:</p>
<pre><code class="language-go">func make(t Type, size ...IntegerType) Type
</code></pre>
<p><strong>makeå‡½æ•°æ˜¯æ— å¯æ›¿ä»£çš„</strong>ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨sliceã€mapä»¥åŠchannelçš„æ—¶å€™,éƒ½éœ€è¦ä½¿ç”¨makeè¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åæ‰å¯ä»¥å¯¹å®ƒä»¬è¿›è¡Œæ“ä½œã€‚</p>
<p>æ€»ä¹‹ï¼šåœ¨ Go è¯­è¨€ä¸­ï¼Œ<code>make</code> æ˜¯ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œä¸“é—¨ç”¨äº<strong>åˆå§‹åŒ–å¹¶åˆ†é…å†…å­˜</strong>ç»™ä¸‰ç§å¼•ç”¨ç±»å‹ï¼š<strong>åˆ‡ç‰‡ï¼ˆsliceï¼‰</strong>ã€<strong>æ˜ å°„ï¼ˆmapï¼‰</strong> å’Œ<strong>é€šé“ï¼ˆchannelï¼‰</strong>ã€‚</p>
<p>å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯åˆ›å»ºè¿™äº›å¤æ‚ç±»å‹çš„å®ä¾‹ï¼Œå¹¶è®¾ç½®å¥½åº•å±‚æ•°æ®ç»“æ„å’Œåˆå§‹å±æ€§ã€‚</p>
<h3 id="51_2">5.1 æ ¸å¿ƒä½œç”¨æ€»ç»“ï¼š</h3>
<ol>
<li><strong>åˆ†é…å†…å­˜</strong>ï¼šä¸ºåº•å±‚æ•°æ®ç»“æ„åˆ†é…å†…å­˜ç©ºé—´</li>
<li><strong>åˆå§‹åŒ–æ•°æ®ç»“æ„</strong>ï¼šè®¾ç½®å†…éƒ¨å±æ€§ï¼ˆå¦‚é•¿åº¦ã€å®¹é‡ã€ç¼“å†²åŒºç­‰ï¼‰</li>
<li><strong>è¿”å›å¯ç›´æ¥ä½¿ç”¨çš„å®ä¾‹</strong>ï¼šè¿”å›åˆå§‹åŒ–åçš„å¼•ç”¨ç±»å‹ï¼ˆéæŒ‡é’ˆï¼‰</li>
</ol>
<h3 id="52-make-new">5.2 ä¸ºä»€ä¹ˆéœ€è¦ <code>make</code>ï¼Ÿï¼ˆä¸ <code>new</code> çš„å¯¹æ¯”ï¼‰</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">ç‰¹æ€§</th>
<th style="text-align: left;"><code>make</code></th>
<th style="text-align: left;"><code>new</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>é€‚ç”¨ç±»å‹</strong></td>
<td style="text-align: left;">slice, map, channel</td>
<td style="text-align: left;">ä»»æ„ç±»å‹</td>
</tr>
<tr>
<td style="text-align: left;"><strong>è¿”å›å€¼</strong></td>
<td style="text-align: left;">åˆå§‹åŒ–åçš„<strong>å¼•ç”¨ç±»å‹</strong></td>
<td style="text-align: left;">æŒ‡å‘é›¶å€¼å†…å­˜çš„<strong>æŒ‡é’ˆ</strong> (<code>*T</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>åˆå§‹åŒ–ç¨‹åº¦</strong></td>
<td style="text-align: left;">å®Œå…¨åˆå§‹åŒ–ï¼Œå¯ç›´æ¥ä½¿ç”¨</td>
<td style="text-align: left;">ä»…åˆ†é…é›¶å€¼å†…å­˜ï¼Œæœªåˆå§‹åŒ–æ•°æ®ç»“æ„</td>
</tr>
<tr>
<td style="text-align: left;"><strong>å†…å­˜åˆ†é…</strong></td>
<td style="text-align: left;">åˆ†é…+åˆå§‹åŒ–æ•°æ®ç»“æ„</td>
<td style="text-align: left;">ä»…åˆ†é…å†…å­˜</td>
</tr>
</tbody>
</table>
<pre><code class="language-go">// é”™è¯¯ç¤ºä¾‹ï¼šç”¨ new åˆ›å»ºåˆ‡ç‰‡
sp := new([]int)   // è¿”å› *[]int æŒ‡é’ˆ
*sp = append(*sp, 1) // éœ€è¦é¢å¤–æ“ä½œæ‰èƒ½ä½¿ç”¨

// æ­£ç¡®ç¤ºä¾‹ï¼šç”¨ make åˆ›å»ºåˆ‡ç‰‡
s := make([]int, 0, 10) // ç›´æ¥å¯ç”¨çš„åˆ‡ç‰‡
s = append(s, 1)        // ç›´æ¥æ“ä½œ
</code></pre>
<h2 id="6_1">6 ä½•æ—¶ä½¿ç”¨æŒ‡é’ˆï¼Ÿ</h2>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>åœºæ™¯</strong></th>
<th style="text-align: left;"><strong>æ¨èæ–¹å¼</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">éœ€è¦ä¿®æ”¹å‡½æ•°å¤–éƒ¨å˜é‡</td>
<td style="text-align: left;">æŒ‡é’ˆ</td>
</tr>
<tr>
<td style="text-align: left;">æ“ä½œå¤§å‹ç»“æ„ä½“/æ•°ç»„</td>
<td style="text-align: left;">æŒ‡é’ˆï¼ˆé¿å…æ‹·è´ï¼‰</td>
</tr>
<tr>
<td style="text-align: left;">æ–¹æ³•éœ€ä¿®æ”¹æ¥æ”¶è€…</td>
<td style="text-align: left;">æŒ‡é’ˆæ¥æ”¶è€…</td>
</tr>
<tr>
<td style="text-align: left;">åŸºæœ¬ç±»å‹ï¼ˆintç­‰ï¼‰å°æ•°æ®</td>
<td style="text-align: left;">å€¼ä¼ é€’</td>
</tr>
</tbody>
</table>
<p>Go ä¸­åˆ‡ç‰‡ï¼ˆsliceï¼‰ã€æ˜ å°„ï¼ˆmapï¼‰ã€é€šé“ï¼ˆchannelï¼‰æœ¬èº«æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¼ é€’æ—¶æ— éœ€æ˜¾å¼ä½¿ç”¨æŒ‡é’ˆã€‚</p>
<h2 id="7">7 æŒ‡é’ˆä¸¤ä¸ªé«˜çº§æ“ä½œ</h2>
<h3 id="71">7.1 æ•°ç»„åœ°å€</h3>
<pre><code class="language-go">func main() {
    arr := [3]int{1, 2, 3}

    p1 := &amp;arr
    p2 := &amp;arr[0]

    fmt.Println(p1, p2)
    fmt.Println(reflect.TypeOf(p1), reflect.TypeOf(p2))
}

/*
&amp;[1 2 3] 0xc000012108
*[3]int *int
*/
</code></pre>
<h3 id="72">7.2 æŒ‡é’ˆåŠ å‡</h3>
<pre><code class="language-go">func main() {
    dataList := [3]int{11, 22, 33}
    p1 := &amp;dataList[0]
    p2 := &amp;dataList[1]
    p3 := &amp;dataList[2]

    fmt.Println(p1, p2, p3)

    ptr := unsafe.Pointer(&amp;dataList[0])  // æŒ‡é’ˆ -&gt; unsafe.Pointer
    targetAddr := uintptr(ptr) + 8*1       // ç»§ç»­ unsafe.Pointer -&gt; uintptr + åç§»é‡ï¼ˆå¯¹åº”ç±»å‹æ‰€éœ€å­—èŠ‚æ•°/int64æ¯ä¸ªå…ƒç´ ç›¸å·®8ä¸ªå­—èŠ‚ï¼‰
    newPtr := unsafe.Pointer(targetAddr) // uintptr -&gt; unsafe.Pointer ï¼ˆé€†å›ï¼‰
    value := (*int)(newPtr)              // unsafe.Pointer -&gt; æŒ‡é’ˆï¼ˆé€†å›ï¼‰
    fmt.Println(value, *value)           // æ‰“å°æŒ‡é’ˆåœ°å€ã€å¯¹åº”çš„å€¼
}

/*
0xc000012108 0xc000012110 0xc000012118
0xc000012110 22
*/
</code></pre>
<h1 id="_11">ğŸ“š å‡½æ•°</h1>
<p>Goè¯­è¨€ä¸­çš„å‡½æ•°æ˜¯åŸºæœ¬çš„ä»£ç å—ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯Goå‡½æ•°çš„ä¸»è¦ç‰¹æ€§ï¼š</p>
<pre><code class="language-go">func å‡½æ•°å(å‚æ•°åˆ—è¡¨) (è¿”å›å€¼åˆ—è¡¨) {
    // å‡½æ•°ä½“
}
</code></pre>
<pre><code class="language-go">// æ— å‚æ•°æ— è¿”å›å€¼
func sayHello() {
    fmt.Println(&quot;Hello!&quot;)
}

// æœ‰å‚æ•°æ— è¿”å›å€¼
func greet(name string) {
    fmt.Printf(&quot;Hello, %s!\n&quot;, name)
}

// æœ‰å‚æ•°æœ‰è¿”å›å€¼
func add(a, b int) int {
    return a + b
}

// å¤šè¿”å›å€¼
func swap(x, y string) (string, string) {
    return y, x
}

// å‘½åè¿”å›å€¼
func divide(a, b float64) (result float64, err error) {
    if b == 0.0 {
        err = errors.New(&quot;division by zero&quot;)
        return
    }
    result = a / b
    return
}
</code></pre>
<h2 id="1_9">1 ä¸€ç­‰å…¬æ°‘ï¼šå‡½æ•°å¯ä»¥ä½œä¸ºå€¼ä¼ é€’ã€ä½œä¸ºå‚æ•°å’Œè¿”å›å€¼</h2>
<pre><code class="language-go">func apply(op func(int, int) int, a, b int) int {
    return op(a, b)
}
</code></pre>
<h2 id="2_8">2 åŒ¿åå‡½æ•°ï¼ˆé—­åŒ…ï¼‰</h2>
<pre><code class="language-go">add := func(a, b int) int {
    return a + b
}
</code></pre>
<h2 id="3_5">3 å¯å˜å‚æ•°</h2>
<pre><code class="language-go">func sum(nums ...int) int {
   total := 0
   for _, num := range nums {
       total += num
   }
   return total
}
</code></pre>
<h2 id="4-defer">4 å»¶è¿Ÿæ‰§è¡Œï¼ˆdeferï¼‰</h2>
<pre><code class="language-go">func readFile() {
   file, err := os.Open(&quot;file.txt&quot;)
   if err != nil {
       return
   }
   defer file.Close() // ç¡®ä¿å‡½æ•°è¿”å›å‰å…³é—­æ–‡ä»¶
   // å¤„ç†æ–‡ä»¶
   // ... ...
}
</code></pre>
<h2 id="5_4">5 æ–¹æ³•ï¼ˆä¸ç±»å‹å…³è”çš„å‡½æ•°ï¼‰</h2>
<pre><code class="language-go">type Circle struct {
   Radius float64
}

func (c Circle) Area() float64 {
   return math.Pi * c.Radius * c.Radius
}
</code></pre>
<p>Goè¯­è¨€çš„å‡½æ•°è®¾è®¡ç®€æ´è€Œå¼ºå¤§ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹èŒƒå¼ï¼Œæ˜¯æ„å»ºGoç¨‹åºçš„åŸºç¡€æ¨¡å—ã€‚</p>
<h2 id="6_2">6 é‡ç‚¹è°ˆé—­åŒ…</h2>
<p>é—­åŒ…(closure)æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°å€¼å¼•ç”¨äº†å…¶å‡½æ•°ä½“ä¹‹å¤–çš„å˜é‡ã€‚</p>
<p>ç¤ºä¾‹ï¼š<strong>è¯¥ç¤ºä¾‹åœ¨æ—©æœŸgoç‰ˆæœ¬ï¼Œåˆ‡ç‰‡å…ƒç´ æ¯ä¸ªå‡½æ•°æ‰“å°ç»“æœéƒ½ä¼šæ˜¯5ï¼ˆå¾ªç¯å·²æ‰§è¡Œå®Œæ¯•ï¼Œæ­¤æ—¶ï¼ši=5ï¼‰ï¼Œä½†æœ€æ–°ç‰ˆæœ¬å·²ä¿®å¤ï¼Œç»“æœå¦‚ä¸‹</strong></p>
<pre><code class="language-go">package main

import &quot;fmt&quot;

func main() {
    var funcList []func()

    for i := 0; i &lt; 5; i++ {
        f := func() {
            fmt.Println(i)
        }
        funcList = append(funcList, f)
    }

    for _, f := range funcList {
        f()
    }
}

// 0
// 1
// 2
// 3
// 4
</code></pre>
<pre><code class="language-go">package main

import &quot;fmt&quot;

func main() {
    var funcList []func()

    for i := 0; i &lt; 5; i++ {
        f := func(arg int) func() {
            return func() {
                fmt.Println(arg)
            }
        }(i)
        funcList = append(funcList, f)
    }

    for _, f := range funcList {
        f()
    }
}

// 0
// 1
// 2
// 3
// 4

</code></pre>
<h2 id="7_1">7 å‡½æ•°é€’å½’å‰–æ</h2>
<p><img alt="image-20240723001259815" src="image-20240723001259815.png" /> </p>
<p>é€’å½’å‡½æ•°å°±æ˜¯æ¯æ¬¡å‹å…¥æ–°çš„æ ˆï¼Œä»æœ€é‡Œå±‚çš„æ ˆè¿˜æ˜¯ç”±å†…å‘å¤–è¿è¡Œï¼Œé€çº§é‡Šæ”¾ã€‚</p>
<h2 id="8">8 å‘½åè¿”å›å€¼</h2>
<ul>
<li>åœ¨å‡½æ•°å£°æ˜æ—¶ç›´æ¥ä¸ºè¿”å›å€¼æŒ‡å®šåç§°</li>
<li>è¿™äº›åç§°åœ¨å‡½æ•°ä½“å†…ä½œä¸ºæ™®é€šå˜é‡ä½¿ç”¨</li>
<li>å‡½æ•°ç»“æŸæ—¶å¯ä»¥ç›´æ¥<code>return</code>è€Œä¸éœ€è¦æ˜¾å¼æŒ‡å®šè¿”å›å€¼</li>
</ul>
<pre><code class="language-go">func myTest(a, b int) (result int, args []int) {
    result = a / b
    args = []int{a, b}
    return // ç­‰ä»·äº return result, args
}

func main() {
    result, args := myTest(10, 3)
    fmt.Println(&quot;è®¡ç®—ç»“æœ:&quot;, result)
    fmt.Println(&quot;ä¼ å…¥å‚æ•°:&quot;, args)
}

// è®¡ç®—ç»“æœ: 3
// ä¼ å…¥å‚æ•°: [10 3]

</code></pre>
<h2 id="9-deferrecover">9 å¼‚å¸¸å¤„ç†ï¼ˆdefer...recover...ï¼‰</h2>
<pre><code class="language-go">func myTest(a, b int) (result int, err error) {  // æå‰æŒ‡å®šè¿”å›å˜é‡çš„åˆå§‹åŒ–ï¼›errorç±»å‹é›¶å€¼ä¸ºnil
    defer func() {
        if r := recover(); r != nil {
            fmt.Println(&quot;æ•è·å¼‚å¸¸ï¼š&quot;, r)
            err = errors.New(&quot;é™¤æ•°ä¸èƒ½ä¸ºé›¶&quot;)  // ä¿®æ”¹è¿”å›å˜é‡
        }
    }()

    result = a / b
    return result, err
}

func main() {
    result, err := myTest(10, 0)
    if err != nil {
        fmt.Println(&quot;å‘ç”Ÿé”™è¯¯:&quot;, err)
        return
    }
    fmt.Println(&quot;è®¡ç®—ç»“æœ:&quot;, result)
}

// æ•è·å¼‚å¸¸ï¼š runtime error: integer divide by zero
// å‘ç”Ÿé”™è¯¯: é™¤æ•°ä¸èƒ½ä¸ºé›¶
</code></pre>
<h1 id="_12">ğŸ“š ç»“æ„ä½“</h1>
<pre><code class="language-go">type ç»“æ„ä½“åç§° struct {
    å­—æ®µ   ç±»å‹
    ...
}
</code></pre>
<pre><code class="language-go">package main

import &quot;fmt&quot;

type Person struct {
    name   string
    age    int
    gender bool
    height float64
    weight float64
}

func main() {
    cenhongchang := Person{name: &quot;cenhongchang&quot;, age: 20, gender: true, height: 1.75, weight: 60}
    fmt.Println(cenhongchang) // {cenhongchang 20 true 1.75 60}
}
</code></pre>
<h2 id="1_10">1 ç»“æ„ä½“å®šä¹‰</h2>
<pre><code class="language-go">// å­—æ®µå•ç‹¬å†™
type Person struct {
    name   string
    age    int
    gender bool
    height float64
    weight float64
}

// åŒç±»å‹å­—æ®µä¸€èµ·å†™
type Person struct {
    name           string
    age            int
    gender         bool
    height, weight float64
}

// ä½œä¸ºå…¶ä¸­ä¸€ä¸ªå­—æ®µåµŒå¥—
type Animal struct {
    dog    string
    cat    string
    person Person
}

//  åŒ¿åå­—æ®µ -&gt; çœç•¥å­—æ®µåï¼Œé»˜è®¤å°±ä¸åµŒå¥—è¿›æ¥çš„ç»“æ„ä½“åä¸€è‡´
type NewPerson struct {
    Person
    hobby  []string
}
</code></pre>
<h2 id="2_9">2 ç»“æ„ä½“æŒ‡é’ˆ</h2>
<pre><code class="language-go">func main() {
    // ç»“æ„ä½“æŒ‡é’ˆ -&gt; åŒæ ·å¯ä»¥ç›´æ¥è·å–å±æ€§å€¼
    p1 := &amp;Person{name: &quot;cenhongchang&quot;, age: 20, gender: true, height: 1.75, weight: 60}
    fmt.Println(p1.name)

    p2 := Person{name: &quot;cenhongchang&quot;, age: 20, gender: true, height: 1.75, weight: 60}
    fmt.Println(&amp;p2.name)   // å…ˆè®¡ç®—å±æ€§å†è®¡ç®—æŒ‡é’ˆ 0xc000024750
    fmt.Println((&amp;p2).name) // å…ˆè®¡ç®—æŒ‡é’ˆå†è®¡ç®—å±æ€§ cenhongchang
}
</code></pre>
<h2 id="3_6">3 ç»“æ„ä½“èµ‹å€¼ï¼ˆæ‹·è´ï¼‰</h2>
<pre><code class="language-go">func main() {
    // ç»“æ„ä½“æŒ‡é’ˆ -&gt; åŒæ ·å¯ä»¥ç›´æ¥è·å–å±æ€§å€¼
    p1 := Person{name: &quot;cenhongchang&quot;, age: 20, gender: true, height: 1.75, weight: 60}
    p2 := p1
    p1.name = &quot;chc&quot;
    fmt.Println(p1.name) // chc
    fmt.Println(p2.name) // cenhongchang
}
</code></pre>
<h2 id="4_4">4 ç»“æ„ä½“æŒ‡é’ˆèµ‹å€¼ï¼ˆå¼•ç”¨ï¼‰</h2>
<pre><code class="language-go">func main() {
    // ç»“æ„ä½“æŒ‡é’ˆ -&gt; åŒæ ·å¯ä»¥ç›´æ¥è·å–å±æ€§å€¼
    p1 := &amp;Person{name: &quot;cenhongchang&quot;, age: 20, gender: true, height: 1.75, weight: 60}
    p2 := p1
    p1.name = &quot;chc&quot;
    fmt.Println(p1.name) // chc
    fmt.Println(p2.name) // chc
}
</code></pre>
<h2 id="5_5">5 ç»“æ„ä½“åµŒå¥—æ•°ç»„ã€åˆ‡ç‰‡ç­‰èµ‹å€¼æ‹·è´</h2>
<pre><code class="language-go">func main() {
    type Address struct {
        city, state string
    }

    type Person struct {
        name    string
        age     int
        hobby   [2]string
        num     []int
        parent  map[string]string
        address Address
    }

    p1 := Person{
        name:   &quot;äºŒç‹—å­&quot;,
        age:    19,
        hobby:  [2]string{&quot;è£¸å¥”&quot;, &quot;å¤§ä¿å¥&quot;},
        num:    []int{69, 19, 99, 38},
        parent: map[string]string{&quot;father&quot;: &quot;Alex&quot;, &quot;mother&quot;: &quot;Monika&quot;},
    }
    fmt.Println(p1)
}

</code></pre>
<p>å…¶å®æœ¬è´¨ä¸Šéƒ½æ‹·è´äº†ï¼Œåªä¸è¿‡ç”±äºæ•°æ®å­˜å‚¨æ–¹å¼çš„ä¸åŒï¼Œå¯¼è‡´æ‹·è´çš„æœ‰äº›æ˜¯æ•°æ®ï¼Œæœ‰äº›æ˜¯å†…å­˜åœ°å€ï¼ˆæŒ‡é’ˆï¼‰ã€‚</p>
<p>æ„Ÿè§‰æ‹·è´ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ã€æ•´å‹ç­‰</p>
<p>æ„Ÿè§‰ä¸æ‹·è´ï¼šmapã€åˆ‡ç‰‡</p>
<p>æ³¨æ„ï¼šå¯¹äºé‚£äº›é»˜è®¤æ‹·è´çš„æƒ…å†µï¼Œå¯ä»¥æ”¹å˜ä¸ºæŒ‡é’ˆç±»å‹ï¼Œè®©æ•°æ®å®ç°åŒæ­¥ä¿®æ”¹ã€‚</p>
<pre><code class="language-go">p1 := Person{
    ...
    hobby:  *[2]string{&quot;è£¸å¥”&quot;, &quot;å¤§ä¿å¥&quot;},
    ...
}
</code></pre>
<h2 id="6_3">6 è·å–ç»“æ„ä½“å­—æ®µåä¸æ ‡ç­¾</h2>
<pre><code class="language-go">func main() {
    type Address struct {
        city, state string
    }

    type Person struct {
        name    string            &quot;å§“å&quot;
        age     int               &quot;å¹´é¾„&quot;
        hobby   [2]string         &quot;çˆ±å¥½&quot;
        num     []int             &quot;ç”µè¯&quot;
        parent  map[string]string &quot;çˆ¶æ¯&quot;
        address Address           &quot;åœ°å€&quot;
    }

    p1 := Person{
        name:   &quot;äºŒç‹—å­&quot;,
        age:    19,
        hobby:  [2]string{&quot;è£¸å¥”&quot;, &quot;å¤§ä¿å¥&quot;},
        num:    []int{69, 19, 99, 38},
        parent: map[string]string{&quot;father&quot;: &quot;Alex&quot;, &quot;mother&quot;: &quot;Monika&quot;},
    }
    fmt.Println(p1)

    p1Type := reflect.TypeOf(p1)
    for i := 0; i &lt; p1Type.NumField(); i++ {
        fmt.Println(p1Type.Field(i).Name)
        fmt.Println(p1Type.Field(i).Tag)
    }
}

</code></pre>
<h2 id="7_2">7 ç»“æ„ä½“æœ¬èº«ä¸æŒ‡é’ˆç”¨æ³•</h2>
<pre><code class="language-go">type Person struct {
    name string
    age  int
}

var p = Person{&quot;Tom&quot;, 30}

// ä½¿ç”¨ç»“æ„ä½“æœ¬èº«ï¼Œä¼šæ‹·è´ï¼Œç”¨çš„æ˜¯ä¸åŒçš„ä¸¤ä»½æ•°æ®
func doSomething() Person {
    return p
}

func main() {
    data := doSomething()
    data.name = &quot;Jerry&quot;
    fmt.Println(p.name)  // æœªæ”¹å˜ Tom
    fmt.Println(data.name) // å·²æ”¹å˜ Jerry
}
</code></pre>
<pre><code class="language-go">// ä½¿ç”¨æŒ‡é’ˆï¼Œä¸ä¼šæ‹·è´ï¼Œéƒ½ä½¿ç”¨ä¸€ä»½æ•°æ®
func doSomething() *Person {
    return &amp;p
}

func main() {
    data := doSomething()
    data.name = &quot;Jerry&quot;
    fmt.Println(p.name)  // æœªæ”¹å˜ Tom
    fmt.Println(data.name) // å·²æ”¹å˜ Jerry
}
</code></pre>
<h2 id="8_1">8 ç±»å‹æ–¹æ³•ä¸ç»“æ„ä½“æ–¹æ³•å®šä¹‰</h2>
<h3 id="81-type">8.1 é¡¹ç›®å¼€å‘ä¸­ä¼šä¸ºtypeå£°æ˜ç±»å‹ç¼–å†™ä¸€äº›æ–¹æ³•ï¼Œä»è€Œå®ç°<code>å¯¹è±¡.æ–¹æ³•</code>æ“ä½œ</h3>
<pre><code class="language-go">type MyInt int

// Incr å®šä¹‰ç±»å‹æ–¹æ³• -&gt; iç›¸å½“äºå¯¹è±¡æœ¬èº«(ç±»æ¯”self)
func (i MyInt) Incr(num1, num2 int) int {
    return num1 + num2 + int(i)
}

func main() {
    v1 := MyInt(10)
    v2 := v1
    fmt.Println(v1, v2)

    v3 := v1.Incr(1, 2) // 10+1+2=13
    fmt.Println(v3)
}
</code></pre>
<p>ä¹Ÿå¯ä»¥å†™ä¸ºï¼š</p>
<pre><code class="language-go">type MyInt int

// Incr å®šä¹‰ç±»å‹æ–¹æ³• -&gt; iç›¸å½“äºå¯¹è±¡æœ¬èº«(ç±»æ¯”self)
func (i *MyInt) Incr(num1, num2 int) int {
    return num1 + num2 + int(*i)
}

func main() {
    v1 := MyInt(10)
    v2 := v1
    fmt.Println(v1, v2)

    v3 := v1.Incr(1, 2) // 10+1+2=13
    fmt.Println(v3)
}
</code></pre>
<pre><code class="language-go">// ç”¨ä¸åˆ°içš„å†™æ³•
func (_ *MyInt) Incr(num1, num2 int) int {
    return num1 + num2
}
</code></pre>
<ul>
<li>
<p>func (i MyInt) Incr(num1, num2 int) int</p>
</li>
<li>
<p>è¿™æ˜¯ä¸€ä¸ªå€¼æ¥æ”¶è€…æ–¹æ³•</p>
</li>
<li>
<p>æ“ä½œçš„æ˜¯ MyInt çš„å‰¯æœ¬</p>
</li>
<li>
<p>å¯¹ i çš„ä¿®æ”¹ä¸ä¼šå½±å“åŸå§‹å€¼</p>
</li>
<li>
<p>func (i *MyInt) Incr(num1, num2 int) int</p>
</li>
<li>
<p>è¿™æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ¥æ”¶è€…æ–¹æ³•</p>
</li>
<li>
<p>æ“ä½œçš„æ˜¯ MyInt çš„å®é™…åœ°å€</p>
</li>
<li>
<p>å¯ä»¥é€šè¿‡ *i ä¿®æ”¹åŸå§‹å€¼</p>
</li>
</ul>
<p><strong>æ€»ç»“ï¼š</strong><strong>ä¸éœ€è¦ä¿®æ”¹æ¥æ”¶è€…çš„å€¼ï¼ˆåªè¯»æ“ä½œï¼‰å°±ä¸ç”¨æŒ‡é’ˆï¼›ä½†å¯¹äº</strong>æ¥æ”¶è€…æ˜¯è¾ƒå¤§çš„ç»“æ„ä½“ï¼Œéœ€è¦é¿å…å¤åˆ¶å¼€é”€**ï¼Œå°±ç”¨æŒ‡é’ˆï¼›å…·ä½“çœ‹åœºæ™¯é€‰æ‹©ç”¨å“ªä¸€ç§ã€‚</p>
<h3 id="82">8.2 ç»“æ„ä½“æ–¹æ³•</h3>
<p>å¤šæ•°æƒ…å†µéƒ½æ˜¯ä½¿ç”¨æŒ‡é’ˆï¼ˆç¡®ä¿ä½¿ç”¨ä¸€ä»½æ•°æ®ï¼‰;</p>
<p>ä¸ä½¿ç”¨æŒ‡é’ˆçš„æƒ…å†µ--å‡½æ•°å†…ä¼šæ‹·è´æ–°æ•°æ®ï¼Œæœ‰ä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<pre><code class="language-go">type Person struct {
    name   string
    age    int
    gender bool
}

// å®šä¹‰ä¸¤ä¸ªç»“æ„ä½“å‡½æ•°ï¼Œåˆ†åˆ«ä½¿ç”¨éæŒ‡é’ˆã€æŒ‡é’ˆå‚æ•°

func (p Person) getRealAge(a, b int) {
    p.age += a + b
}

func (p *Person) getRealAgeWithPointer(a, b int) {
    p.age += a + b
}

func main() {
    p := new(Person)
    p.name = &quot;John&quot;
    p.age = 18
    p.gender = true

    fmt.Println(reflect.TypeOf(p))
    fmt.Println(reflect.TypeOf(p.age))

    fmt.Println(p.age) // 18 - åŸå§‹å€¼
    p.getRealAge(1, 1)
    fmt.Println(p.age)            // 18 - æ²¡æ”¹å˜--å‡½æ•°å†…å€¼æ‹·è´å¤„ç†
    p.getRealAgeWithPointer(1, 1) // 20 - å·²æ”¹å˜--å‡½æ•°å†…æ“ä½œåŸå§‹å€¼å¤„ç†
    fmt.Println(p.age)
}
</code></pre>
<p><strong>æ€»ç»“ï¼š</strong></p>
<pre><code>1. åœ¨ç»“æ„ä½“ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³æ³¨è°ƒç”¨ç»“æ„ä½“æ–¹æ³•æ˜¯`æŒ‡é’ˆç±»å‹.æ–¹æ³•`è¿˜æ˜¯`å€¼ç±»å‹.æ–¹æ³•`ï¼Œå®ƒå†…éƒ¨ä¼šæ ¹æ®ä½ å‡½æ•°å®šä¹‰æ¥æ”¶è€…ï¼ˆfuncå…³é”®å­—ä¹‹åæ‹¬å·é‡Œçš„å†…å®¹ï¼‰æ˜¯æŒ‡é’ˆç±»å‹è¿˜æ˜¯å€¼ç±»å‹æ¥æ”¶è€…å†³å®šã€‚ï¼ˆå› ä¸ºæˆ‘ä»¬æ€»æ˜¯ä¼šè€ƒè™‘ï¼š`æŒ‡é’ˆ.æ–¹æ³•`ä¸ºå•¥æ²¡æœ‰å¼‚å¸¸ï¼Ÿ -&gt; ç»“æ„ä½“å†…éƒ¨ä¼šè‡ªåŠ¨åˆ¤æ–­å¤„ç†ï¼‰ï¼›
1. ç¤ºä¾‹æ²¡æœ‰è¿”å›å€¼çš„æ—¶å€™ï¼Œç”¨å‡½æ•°ä¼ å…¥æŒ‡é’ˆå°±æ”¹å˜äº†åŸå§‹å€¼ã€‚
</code></pre>
<h2 id="9">9 ç»“æ„ä½“æ–¹æ³•ç»§æ‰¿</h2>
<pre><code class="language-go">type Father struct {
    name string
    age  int
}

type Son struct {
    name   string
    age    int
    Father // -&gt; ç»§æ‰¿çˆ¶æ–¹æ³•ï¼Œéœ€è¦åŒ¿åï¼Œå¦åˆ™ä¸ä¼šç»§æ‰¿çˆ¶ç»“æ„ä½“æ–¹æ³•
}

func (s *Son) PlayGame(gameName string) int {
    fmt.Println(&quot;son's skill play game is: &quot; + gameName)
    return 666
}

func (f *Father) MakeMoney(workName string) int {
    fmt.Println(&quot;father's skill work is: &quot; + workName)
    return 999
}

func main() {
    s := Son{name: &quot;son&quot;, age: 18}
    f := Father{name: &quot;father&quot;, age: 40}
    s.PlayGame(&quot;lol&quot;)     // son's skill play game is: lol
    f.MakeMoney(&quot;coding&quot;) // father's skill work is: coding
    s.MakeMoney(&quot;teach&quot;)  // father's skill work is: teach -&gt; ç»§æ‰¿çˆ¶æ–¹æ³•
}
</code></pre>
<h2 id="10">10 ç»“æ„ä½“å·¥å‚å‡½æ•°</h2>
<pre><code class="language-go">// å®šä¹‰ä¸ºç§æœ‰ç»“æ„ä½“
type file struct {
    fd   int
    name string
}

// NewFile åˆ›å»ºç»“æ„ä½“å·¥å‚å‡½æ•° -- å®šä¹‰ä¸ºå…¬æœ‰å·¥å‚å‡½æ•°
func NewFile(fd int, name string) *File {
    // å…¶ä»–å°è£…ä»£ç 
    return &amp;File{fd, name}
}

func main() {
    f1 := NewFile(10, &quot;./test1.txt&quot;)
    f2 := NewFile(80, &quot;./test2.txt&quot;)
    fmt.Println(f1)
    fmt.Println(f2)
}
</code></pre>
<p>å¦‚ä½•ä¿è¯ä»£ç ä¸€è‡´æ€§ï¼Ÿ</p>
<p><strong>å¼ºåˆ¶ä½¿ç”¨å·¥å‚å‡½æ•°åˆ›å»º</strong>ï¼šç»“æ„ä½“æœ¬èº«å®šä¹‰æ˜¯ç§æœ‰ï¼Œå·¥å‚å‡½æ•°å®šä¹‰æ˜¯å…¬æœ‰å³å¯è§£å†³ã€‚</p>
<h1 id="_13">ğŸ“š æ¥å£</h1>
<h2 id="1_11">1 æ¥å£å®šä¹‰</h2>
<pre><code class="language-go">// çº¦æŸå‡½æ•°
type æ¥å£åç§° interface {
    æ–¹æ³•å(å‚æ•°åˆ—è¡¨) (è¿”å›å€¼åˆ—è¡¨) {
    }
}

// çº¦æŸç±»å‹
type æ¥å£åç§° interface {
    ç±»å‹1 | ç±»å‹2 | ç±»å‹3
}
</code></pre>
<pre><code class="language-go">// ç¤ºä¾‹
type Base interface {
    f1()
    f2() int
    f3(a, b int) int
    f4(a,b string) (string, error)
}


type baseType interface {
    int | string
}
</code></pre>
<p><strong>æ¥å£ä¸­çš„æ–¹æ³•åªå†™è¾“å…¥è¾“å‡ºè§„èŒƒæ ¼å¼ï¼Œä¸å†™å…·ä½“å®ç°ã€‚</strong></p>
<h2 id="2_10">2 æ¥å£ä½œç”¨</h2>
<p>goç¨‹åºå¼€å‘ä¸­ï¼Œæ¥å£æœ‰ä¸¤å¤§ä½œç”¨ï¼šä»£æŒ‡ç±»å‹ ä¸ çº¦æŸè¾“å…¥è¾“å‡º</p>
<h3 id="21-">2.1 ç©ºæ¥å£-ä»£æŒ‡ä»»æ„ç±»å‹</h3>
<p>goè¯­è¨€æºç ä¸­ï¼Œç©ºæ¥å£å°±åŒ…å«ä¸¤ä¸ªä¿¡æ¯ï¼š</p>
<pre><code class="language-go">// æºç è·¯å¾„ .../runtime/runtime2.go
type eface struct {
    _type *_type  // ç±»å‹ä¿¡æ¯
    data  unsafe.Pointer  // æ•°æ®ä¿¡æ¯ - æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆ
}
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-go">type Base interface{}  // ç©ºæ¥å£ï¼Œä»€ä¹ˆéƒ½æ»¡è¶³

func main() {
    slice := make([]Base, 0)
    //slice := make([]interface{}, 0) // ç®€å†™å½¢å¼
    slice = append(slice, nil)
    slice = append(slice, [3]int{1, 2, 3})
    slice = append(slice, []int{11, 22, 33})
    slice = append(slice, &quot;ä½ å¥½&quot;)
    fmt.Println(slice)
}

// [&lt;nil&gt; [1 2 3] [11 22 33] ä½ å¥½]
</code></pre>
<p><strong>go1.18+æ”¯æŒä½¿ç”¨anyä»£æŒ‡ç©ºæ¥å£</strong>: <code>type any = interface{}</code></p>
<p><strong>æ³¨æ„ï¼š</strong>æœ‰ä¸€ç§ç©ºé›†æ¥å£ï¼ˆè¿™ç§æ˜¯å†™æ³•é”™è¯¯ï¼Œä½†åˆå¯ä»¥é€šè¿‡ç¼–è¯‘ï¼‰</p>
<pre><code class="language-go">type Empty interface{ // åˆ†è¡Œå†™å¯¼è‡´ç©ºé›†æ¥å£ï¼Œä»€ä¹ˆéƒ½ä¸æ»¡è¶³
    string
    int 
}
</code></pre>
<h3 id="22">2.2 æ¥å£è½¬åŒ–æŒ‡å®šç±»å‹çš„æ•°æ®</h3>
<pre><code class="language-go">type Person struct {
    name string
    age  int
}

func doSomething(arg interface{}) Person {
    tp, ok := arg.(Person)
    if ok {
        fmt.Println(&quot;è½¬æ¢æˆåŠŸï¼š&quot;, tp, reflect.TypeOf(tp))
    } else {
        fmt.Println(&quot;è½¬æ¢å¤±è´¥!&quot;)
    }

    return tp
}

func main() {
    p := Person{name: &quot;å¼ ä¸‰&quot;, age: 18}
    doSomething(100) // è½¬æ¢å¤±è´¥!
    doSomething(p)   // è½¬æ¢æˆåŠŸï¼š {å¼ ä¸‰ 18} main.Person
}
</code></pre>
<h3 id="23">2.3 æ¥å£ç±»å‹æ–­è¨€</h3>
<pre><code class="language-go">type Person struct {
    name string
    age  int
}

func doSomething(arg interface{}) {
    switch tp := arg.(type) {  // switch ä¸ ç±»å‹åˆ¤æ–­çš„å›ºå®šç”¨æ³•
    case Person:
        fmt.Println(&quot;struct&quot;, tp.name)
    case string:
        fmt.Println(&quot;string&quot;, tp)
    case int:
        fmt.Println(&quot;int&quot;, tp)
    default:
        fmt.Printf(&quot;%T %v\n&quot;, tp, tp)
    }
}

func main() {
    doSomething(100)
    doSomething(&quot;cenhc&quot;)
    doSomething(Person{&quot;cenhh&quot;, 23})
    doSomething([]int{1, 2, 3})
}

//int 100
//string cenhc
//struct cenhh
//[]int [1 2 3]

</code></pre>
<h3 id="24">2.4 æ¥å£çº¦æŸä¸è§„èŒƒ</h3>
<p>ä¼ å…¥çš„å®ä¾‹ä¸€èˆ¬æ˜¯ç»“æ„ä½“æŒ‡é’ˆ</p>
<p><img alt="image-20250808114837368" src="README.assets/image-20250808114837368.png" /> </p>
<pre><code class="language-go">// å®šä¹‰æ¥å£çº¦æŸ
type IBase interface {
    f1() int
}

// ç»“æ„ä½“ Person
type Person struct {
    name string
    age  int
}
// ç»“æ„ä½“ Person ç±»å‹æ–¹æ³•
func (p *Person) f1() int {
    return p.age
}

// ç»“æ„ä½“ User
type User struct {
    username string
    password string
}
// ç»“æ„ä½“ User ç±»å‹æ–¹æ³•
func (u *User) f1() int {
    return len(u.username)
}

// æ‰§è¡Œå‡½æ•° - è‡ªåŠ¨åˆ¤æ–­ä¼ å…¥å¯¹è±¡ç±»å‹è°ƒç”¨å¯¹åº”æ–¹æ³•
func doSomething(ibase IBase) {
    result := ibase.f1()  // åŸºäºæ¥å£ä¼ å…¥å¤šç§ç±»å‹ï¼ˆå¤šæ€ï¼‰è‡ªåŠ¨è°ƒç”¨å¯¹åº”æ–¹æ³•
    fmt.Println(&quot;æ‰§è¡Œç»“æœï¼š&quot;, result)
}

func main() {
    p := &amp;Person{name: &quot;John&quot;, age: 30}
    u := &amp;User{username: &quot;john_doe&quot;, password: &quot;secret&quot;}
    doSomething(p)
    doSomething(u)
}

//æ‰§è¡Œç»“æœï¼š 30
//æ‰§è¡Œç»“æœï¼š 8

</code></pre>
<p>å®é™…æ¡ˆä¾‹ï¼šåŒæ—¶å‘å¾®ä¿¡ã€é‚®ç®±å‘é€æ³¨å†ŒæˆåŠŸæ¶ˆæ¯</p>
<pre><code class="language-go">/*
æ¥å£å®ç°åœºæ™¯ï¼šåŒæ—¶å‘å¾®ä¿¡ã€é‚®ç®±å‘é€æ³¨å†ŒæˆåŠŸæ¶ˆæ¯
*/

package main

import &quot;fmt&quot;

type IBase interface {
    send() bool
}

type Email struct {
    email   string
    content string
}

func (e *Email) send() bool {
    fmt.Println(e.content)
    return true
}

type Wechat struct {
    wid     string
    content string
}

func (e *Wechat) send() bool {
    fmt.Println(e.content)
    return true
}

// ä½¿ç”¨æ¥å£åˆ‡ç‰‡å¤„ç†
func runSend(ibaseList []IBase) {
    for _, obj := range ibaseList {
        obj.send()
    }
}

func main() {
    e := &amp;Email{
        email:   &quot;123@qq.com&quot;,
        content: &quot;é‚®ç®±ç«¯é€šçŸ¥ï¼šæ³¨å†ŒæˆåŠŸï¼&quot;,
    }

    w := &amp;Wechat{
        wid:     &quot;ccplayer&quot;,
        content: &quot;å¾®ä¿¡ç«¯é€šçŸ¥ï¼šæ³¨å†ŒæˆåŠŸï¼&quot;,
    }

    runSend([]IBase{e, w})
}

//é‚®ç®±ç«¯é€šçŸ¥ï¼šæ³¨å†ŒæˆåŠŸï¼
//å¾®ä¿¡ç«¯é€šçŸ¥ï¼šæ³¨å†ŒæˆåŠŸï¼

</code></pre>
<h1 id="go118">ğŸ“š æ³›å‹ï¼ˆgo1.18+ï¼‰</h1>
<h2 id="1_12">1 åŸºæœ¬è¯­æ³•</h2>
<p>æ³›å‹é€‚åˆè§£å†³çš„é—®é¢˜åœºæ™¯ï¼šå‡å°‘é‡å¤ä»£ç ï¼šé¿å…ä¸ºä¸åŒç±»å‹ç¼–å†™å‡ ä¹ç›¸åŒçš„å‡½æ•°</p>
<ol>
<li><strong>è¯­æ³•</strong>ï¼šGoä½¿ç”¨æ–¹æ‹¬å·<code>[]</code>è€Œéå°–æ‹¬å·<code>&lt;&gt;</code></li>
<li><strong>å®ç°æ–¹å¼</strong>ï¼šGoåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆå…·ä½“ç±»å‹çš„ä»£ç ï¼Œè€Œéè¿è¡Œæ—¶æ“¦é™¤ç±»å‹</li>
<li><strong>é™åˆ¶</strong>ï¼šGoæ³›å‹ç›¸å¯¹ä¿å®ˆï¼Œä¸æ”¯æŒæŸäº›é«˜çº§ç‰¹æ€§å¦‚è¿ç®—ç¬¦é‡è½½</li>
<li><strong>æ³¨æ„</strong>ï¼šæ³›å‹ä¸æ˜¯è¯´å¯ä»¥çš„å¤šç§æ•°æ®ç±»å‹æ··æ‚åœ¨ä¸€èµ·ï¼Œä»–åªæ˜¯å…¶ä¸­ä¸€ç§ï¼›å¯ä»¥æ··æ‚åœ¨ä¸€èµ·çš„æ•°æ®ç±»å‹æ˜¯ç©ºæ¥å£</li>
</ol>
<pre><code class="language-go">// ç‰¹åˆ«æ³¨æ„ï¼šæ³›å‹çº¦æŸåŸºç¡€æ•°æ®ç±»å‹å˜é‡--ä½¿ç”¨æ¥å£
type MyVar interface {
    int | string | float32 | float64
}

// MySlice æ³›å‹åˆ‡ç‰‡å®šä¹‰
type MySlice[T int | string] []T

// MyMap æ³›å‹Mapå®šä¹‰
type MyMap[K int | string, V float64 | float32] map[K]V

// MyStruct æ³›å‹ç»“æ„ä½“å®šä¹‰
type MyStruct[T int | string] struct {
    data          []T
    length        int
    max, min, avg T
}
</code></pre>
<pre><code class="language-go">// å®šä¹‰ä¸€ä¸ªç±»å‹çº¦æŸ
type Numeric interface {
    int | float64
}

// æ³›å‹å‡½æ•°ï¼šè®¡ç®—åˆ‡ç‰‡ä¸­æ‰€æœ‰å…ƒç´ çš„å’Œ
func Sum[T Numeric](numbers []T) T {
    var total T
    for _, num := range numbers {
        total += num
    }
    return total
}

func main() {
    // æ³›å‹ç±»å‹--å®ä¾‹åŒ–
    ints := []int{1, 2, 3, 4}
    floats := []float64{1.1, 2.2, 3.3}

    fmt.Println(Sum(ints))    // è¾“å‡º: 10
    fmt.Println(Sum(floats))  // è¾“å‡º: 6.6
}
</code></pre>
<h2 id="2_11">2 åŸºäºåŸºç¡€ç±»å‹çš„è‡ªå®šä¹‰ç±»å‹æ³›å‹</h2>
<pre><code class="language-go">// åŸºäºåŸºç¡€ç±»å‹çš„è‡ªå®šä¹‰ç±»å‹
type MyInt int
type YourInt MyInt

// å…ƒç´ å¯ä»¥æ˜¯åŸºç¡€ç±»å‹ä¸ºintçš„ç±»å‹ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹
type IntSlice[T ~int] []T  // ~ç¬¦å·è¡¨ç¤ºåº•å±‚ç±»å‹çº¦æŸ

func main() {
    a := IntSlice[MyInt]{1, 2, 3}
    b := IntSlice[YourInt]{1, 2, 3}
    fmt.Println(a)
    fmt.Println(b)

    // å¦‚æœéœ€è¦ç›¸åŠ ï¼Œåˆ™å°†bè½¬æ¢ä¸ºIntSlice[MyInt]ç±»å‹
    var convertedB IntSlice[MyInt]
    for _, v := range b {
        convertedB = append(convertedB, MyInt(v))
    }
    result := append(a, convertedB...)
    fmt.Println(result) // è¾“å‡º: [1 2 3 1 2 3]
}

</code></pre>
<h2 id="3_7">3 åŸºäºæ³›å‹ç»§ç»­å®šä¹‰æ³›å‹</h2>
<pre><code class="language-go">type MySlice[T int | string | float32 | float64] []T

type FloatSlice[T float32 | float64] MySlice[T] // è¡¨ç¤ºå…ƒç´ ç±»å‹å¿…é¡»å±äºMySliceå®šä¹‰ç±»å‹ï¼Œå«å…¶ä»–ç±»å‹ä¼šæŠ¥é”™

type MyStruct[T float32 | float64] struct {
    FiledsA        MySlice[T]
    FiledsB        FloatSlice[T]
    Height, Weight T
}

type MyMap[K int | string, V float32 | float64] map[K]MySlice[V]

func main() {
    var a = MyStruct[float32]{
        FiledsA: []float32{1, 2, 3},
        FiledsB: []float32{4, 5, 6},
        Height:  1.75,
        Weight:  80.0,
    }
    fmt.Println(a)

    var b = MyMap[int, float32]{ // æ³¨æ„æ ¼å¼å˜åŒ–
        1: {1, 2, 3},
        2: {4, 5, 6},
    }
    fmt.Println(b)
}
</code></pre>
<p>åŸºäºæ³›å‹å®šä¹‰ï¼Œæˆ‘ä»¬é€æ­¥æ¸…æ™°ï¼šTè¡¨ç¤ºçš„å°±æ˜¯åŸºç¡€æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ï¼šint/float32/float64/string/boolç­‰</p>
<h2 id="4_5">4 è§„é¿æŒ‡é’ˆç±»å‹å†™æ³•</h2>
<pre><code class="language-go">// type myList1[T *int] []T  -&gt; é”™è¯¯å†™æ³•ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ä¹˜æ³•è¿ç®—ï¼Œéœ€è¦æœ«å°¾åŠ â€œ,â€ï¼›æˆ–è€…ä½¿ç”¨æ¥å£å®šä¹‰
type myList1[T *int,] []T
type myList2[T interface{ *int }] []T
</code></pre>
<h2 id="5_6">5 æ³›å‹æ¥æ”¶å™¨</h2>
<p><strong>ä¸€èˆ¬åº”ç”¨åœºæ™¯ï¼š</strong>å®šä¹‰æ³›å‹ç»“æ„ä½“ -&gt; å®šä¹‰ç»“æ„ä½“æ–¹æ³• -&gt; å®šä¹‰æ–¹æ³•æ¥æ”¶å™¨ï¼ˆå®ä¾‹åŒ–å¯¹è±¡è°ƒç”¨å…·ä½“æ–¹æ³•ï¼‰</p>
<p><strong>æ³›å‹æ¥æ”¶å™¨çš„ä½œç”¨ï¼š</strong>  è®©ä¸€ç»„å…·æœ‰å…±åŒå¤„ç†æ–¹æ³•çš„æ•°æ®ï¼Œå¯ä»¥å®ç°ç»Ÿä¸€æ–¹æ³•è°ƒç”¨ï¼›è¿™é‡Œä¸åŒäºæ¥å£å¯¹æ¯ä¸ªå®ç°å†å»è°ƒç”¨æ–¹å¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-go">/*
å®šä¹‰æ³›å‹æ•°å€¼å‹çš„æ•°æ®ï¼ˆint/float32/float64...ï¼‰ï¼Œå¯è°ƒç”¨å…¶æ–°å¢å…ƒç´ Addæ–¹æ³•ï¼Œå®æ—¶æ›´æ–°æœ€å¤§å€¼/æœ€å°å€¼
*/

package main

import (
    &quot;fmt&quot;
    &quot;sync&quot;
)

// å®šä¹‰ç»“æ„ä½“
type myStruct[T int | float32 | float64] struct {
    data []T
    max  T
    min  T
    sm   sync.Mutex // è€ƒè™‘å¹¶å‘å†™å…¥å…ƒç´ ï¼Œä½¿ç”¨äº’æ–¥é”
}

// å®šä¹‰ç»“æ„ä½“æ–¹æ³• - æŒ‡é’ˆè¡¨ç¤ºæ“ä½œåŸå§‹æ•°æ®
func (m *myStruct[T]) Add(ele T) *myStruct[T] {
    m.sm.Lock()
    defer m.sm.Unlock()

    m.data = append(m.data, ele)

    if len(m.data) == 1 {
        m.max = ele
        m.min = ele
        return m
    }

    if m.max &lt; ele {
        m.max = ele
    }

    if m.min &gt; ele {
        m.min = ele
    }

    return m
}

func (m *myStruct[T]) GetMax() T {
    return m.max
}

// æ³›å‹å‡½æ•°
func myInitStruct[T int | float32 | float64](value T) *myStruct[T] {
    p := new(myStruct[T])
    p.Add(value)
    return p
}

func main() {
    // intç±»å‹å¯¹è±¡
    p1 := new(myStruct[int])
    p1.Add(1).Add(2).Add(3).Add(5).Add(-10)
    fmt.Println(p1.data, p1.max, p1.min, p1.GetMax())
    // float64ç±»å‹å¯¹è±¡ä½¿ç”¨åŒæ ·æ–¹æ³•å¤„ç†
    p2 := new(myStruct[float64])
    p2.Add(1.1).Add(2.2).Add(3.3).Add(5.5).Add(-10.1)
    fmt.Println(p2.data, p2.max, p2.min, p2.GetMax())

    p3 := myInitStruct(1) // æ³›å‹å‡½æ•°åˆ›å»ºç»“æ„ä½“-è¿”å›æŒ‡é’ˆ
    fmt.Println(p3.data, p3.max, p3.min, p3.GetMax())
}

</code></pre>
<h2 id="6_4">6 æ³›å‹å‡½æ•°</h2>
<pre><code class="language-go">func Sum[T int | string | float32 | float64](args ...T) (result T) {
    for _, v := range args {
        result += v
    }
    return
}

func main() {
    result := Sum(&quot;ä½ å¥½ï¼&quot;, &quot;ä¸­å›½&quot;, &quot;--HELLO&quot;)
    fmt.Println(result)
}

</code></pre>
<h2 id="7_3">7 æ³›å‹æ¥å£</h2>
<pre><code class="language-go">// å®šä¹‰æ³›å‹æ¥å£
type Data[T int | string] interface {
    Process(T) (T, error)
    Save() error
}

// å®šä¹‰ç»“æ„ä½“
type JsonData struct {
    name string
    age  int
}

// å®šä¹‰ç»“æ„ä½“æ–¹æ³•-intç±»å‹
func (j *JsonData) Process(data int) (int, error) {
    return data + 10, nil
}
func (j *JsonData) Save() error {
    return nil
}

// å®ä¾‹å…·ä½“ä½¿ç”¨
func doSomething(d Data[int], v int) {
    result, _ := d.Process(v)
    fmt.Println(&quot;result:&quot;, result)
}

func doSomethingNew(d Data[string], v string) {
    result, _ := d.Process(v)
    fmt.Println(&quot;result:&quot;, result)
}

func main() {
    var person = &amp;JsonData{name: &quot;John&quot;, age: 30}
    doSomething(person, 100)

    // var personNew = &amp;JsonData{name: &quot;tom&quot;, age: 50}
    // doSomethingNew(personNew, 200) // ä¼šæŠ¥é”™ -- ç»“æ„ä½“æ²¡æœ‰å®ç°stringç±»çš„å…·ä½“æ–¹æ³•
}

</code></pre>
<h2 id="8_2">8 æ³›å‹å¸¦æ¥çš„æ¥å£è¯­æ³•å˜åŒ–</h2>
<pre><code class="language-go">/**/

package main

import &quot;fmt&quot;

// å®šä¹‰æ¥å£ï¼ˆæ··åˆç±»å‹ä¸å‡½æ•°çº¦æŸï¼‰
type Data interface {
    ~int | ~float64
    Process(p int) (int, error)
    Save() error
}

// å®šä¹‰è‡ªå®šä¹‰ç±»å‹ï¼ˆåº•å±‚ç±»å‹å¿…é¡»æ˜¯æ¥å£çº¦æŸçš„ç±»å‹ä¹‹ä¸€ï¼‰
type myType int

// å®šä¹‰ç»“æ„ä½“æ–¹æ³•-intç±»å‹
func (j myType) Process(data int) (int, error) {
    return data + 10, nil
}
func (j myType) Save() error {
    return nil
}

// å…·ä½“å®ç°--éœ€è¦ä½¿ç”¨æ³›å‹å‡½æ•°
func doSomething[T Data](d T, v int) {
    result, _ := d.Process(v)
    fmt.Println(&quot;result:&quot;, result)
}

func main() {
    var i myType = 10
    doSomething(i, 10)
}

</code></pre>
<h2 id="9_1">9 é¢„å®šä¹‰æ¥å£çš„ä½¿ç”¨</h2>
<h3 id="91">9.1 æ”¯æŒå¯æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰çš„ç±»å‹</h3>
<p>å®šä¹‰æ³›å‹Mapæ—¶ï¼Œé”®å¿…é¡»æ˜¯å¯æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰çš„ï¼Œä½¿ç”¨çš„å…³é”®å­—ï¼šcomparableï¼›å€¼ç”¨ç©ºæ¥å£å³å¯ï¼ˆanyï¼‰</p>
<pre><code class="language-go">type myMap[K comparable, V any] map[K]V
</code></pre>
<h3 id="92">9.2 æ”¯æŒå¯æ¯”è¾ƒå¤§å°çš„ç±»å‹</h3>
<p>ç±»å‹é›†åˆåˆ†ç±»ï¼ˆçº¦å®šä¿—æˆçš„ä»£ç ï¼‰ï¼š</p>
<pre><code class="language-go">// æµ®ç‚¹å‹
type Float interface {
    ~float32 | ~float64
}

// æœ‰ç¬¦å·æ•°
type Singed interface {
    ~int8 | ~int16 | ~int32 | ~int64
}

// æ— ç¬¦å·æ•°
type Unsigned interface {
    ~uint8 | ~uint16 | ~uint32 | ~uint64
}

// æ•´å‹
type Integer interface {
    Singed | Unsigned
}

// å¯æ¯”è¾ƒæ’åºå‹
type Ordered interface {
    Integer | Float | ~string
}

// æ•°å€¼å‹
type Number interface {
    Integer | Float
}
</code></pre>
<h1 id="_14">ğŸ“š åå°„</h1>
<p>åå°„æ˜¯Goè¯­è¨€ä¸­ä¸€ä¸ªå¼ºå¤§ä½†éœ€è¦è°¨æ…ä½¿ç”¨çš„ç‰¹æ€§ï¼Œå®ƒå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶æ£€æŸ¥ç±»å‹ä¿¡æ¯ã€æ“ä½œå¯¹è±¡å’Œè°ƒç”¨æ–¹æ³•ã€‚ä¸‹é¢æ˜¯å¯¹Goè¯­è¨€åå°„çš„è¯¦ç»†ä»‹ç»ï¼š</p>
<h2 id="1_13">1 åŸºæœ¬æ¦‚å¿µ</h2>
<p>åå°„ä¸»è¦é€šè¿‡<code>reflect</code>åŒ…å®ç°ï¼Œæ ¸å¿ƒæ˜¯ä¸¤ä¸ªç±»å‹ï¼š</p>
<ol>
<li><code>reflect.TypeOf</code> - è¡¨ç¤ºGoè¯­è¨€çš„ç±»å‹ä¿¡æ¯</li>
<li><code>reflect.ValueOf</code> - è¡¨ç¤ºä¸€ä¸ªå€¼çš„è¿è¡Œæ—¶è¡¨ç¤º</li>
</ol>
<h2 id="2_12">2 åå°„çš„ä¸‰å¤§å®šå¾‹</h2>
<ul>
<li>æºç ä¸­çš„å®šä¹‰ï¼šåå°„å®é™…ä¸Šå°±æ˜¯interfaceä¸Typeã€Valueä¹‹é—´è½¬æ¢è¿‡ç¨‹</li>
</ul>
<p><code>go
  func typeOf(i any) Type   {} // interface -&gt; Type
  func valueOf(i any) Value {} // interface -&gt; Value</code></p>
<ol>
<li><strong>åå°„å¯ä»¥å°†interfaceç±»å‹å˜é‡è½¬æ¢ä¸ºåå°„å¯¹è±¡</strong></li>
</ol>
<p><code>r := reflect.ValueOf(å˜é‡)</code></p>
<ol>
<li><strong>åå°„å¯ä»¥å°†åå°„å¯¹è±¡è¿˜åŸä¸ºinterfaceç±»å‹å˜é‡</strong></li>
</ol>
<p><code>i := r.Interface()</code></p>
<ol>
<li><strong>è¦ä¿®æ”¹åå°„å¯¹è±¡ï¼Œå…¶å€¼å¿…é¡»æ˜¯å¯è®¾ç½®çš„ï¼ˆaddressableï¼‰</strong></li>
</ol>
<p><code>r := reflect.ValueOf(&amp;å˜é‡).Elem()</code></p>
<ul>
<li><strong>ä¸‰å¤§å®šå¾‹ç¤ºä¾‹ï¼š</strong></li>
</ul>
<p>```go
  func main() {
    // åå°„ä¸‰å¤§å®šå¾‹</p>
<pre><code>var x float64 = 3.14

// 1 - åå°„å¯ä»¥å°†interfaceç±»å‹å˜é‡è½¬æ¢ä¸ºåå°„å¯¹è±¡
r := reflect.ValueOf(x)
fmt.Printf("ç±»å‹ï¼š%T å€¼ï¼š%v\n", r, r)

// 2 - åå°„å¯ä»¥å°†åå°„å¯¹è±¡è¿˜åŸä¸ºinterfaceç±»å‹å˜é‡
i := r.Interface().(float64)
fmt.Printf("ç±»å‹ï¼š%T å€¼ï¼š%v\n", i, i)

// 3 - è¦ä¿®æ”¹åå°„å¯¹è±¡ï¼Œå…¶å€¼å¿…é¡»æ˜¯å¯è®¾ç½®çš„ï¼ˆaddressableï¼‰
rpe := reflect.ValueOf(&amp;x).Elem()
rpe.SetFloat(7.1)             // SetFloatæ–¹æ³•é’ˆå¯¹çš„æ˜¯interfaceç±»å‹æ•°æ®
rpe.Set(reflect.ValueOf(8.0)) // Setæ–¹æ³•é’ˆå¯¹çš„æ˜¯åå°„å¯¹è±¡ï¼ˆreflect.Valueï¼‰æ•°æ®
fmt.Printf("ç±»å‹ï¼š%T å€¼ï¼š%v\n", x, x)
</code></pre>
<p>}</p>
<p>```</p>
<h2 id="4_6">4 å®ä¾‹è®¤è¯†åå°„</h2>
<pre><code class="language-go">/*
ä»ä»£ç å®ä¾‹å­¦ä¹ åå°„

ç»™å®šä¸€ä¸ªæ³›å‹Userç»“æ„ä½“ï¼Œå®ç°å…¥å‚ç±»å‹åˆ¤æ–­ä¿®æ”¹å€¼
*/

package main

import (
    &quot;fmt&quot;
    &quot;reflect&quot;
)

type MyInt int

// å®šä¹‰ç»“æ„ä½“
type User struct {
    IdOrName any
    Age      MyInt
}

func main() {
    u := User{
        IdOrName: &quot;chc&quot;,
        Age:      20,
    }
    fmt.Println(&quot;ä¿®æ”¹å‰ï¼š&quot;, u, reflect.TypeOf(u.IdOrName))

    uType := reflect.TypeOf(u.IdOrName) // è·å–å¯¹è±¡å­—æ®µçš„å…·ä½“ç±»å‹ -- è¿™ä¸æ˜¯æˆ‘è¦çš„
    fmt.Println(uType)                  // string

    uValueType := reflect.ValueOf(&amp;u).Elem() // è·å–å®šä¹‰ç»“æ„ä½“å­—æ®µç±»å‹ -- è¿™æ˜¯æˆ‘æƒ³è¦çš„

    rvIdOrName := uValueType.FieldByName(&quot;IdOrName&quot;) // ç±»å‹ï¼šreflect.Value
    rvAge := uValueType.FieldByName(&quot;Age&quot;)           // ç±»å‹ï¼šreflect.Value

    fmt.Printf(&quot;IdOrNameç±»å‹ï¼š%T\n&quot;, rvIdOrName)
    fmt.Printf(&quot;IdOrName: type=%s, kind=%s\n&quot;, rvIdOrName.Type(), rvIdOrName.Kind()) // IdOrName: type=interface {}, kind=interface
    fmt.Printf(&quot;Age: type=%s, kind=%s\n&quot;, rvAge.Type(), rvAge.Kind())                // Age: type=main.MyInt, kind=int

    // æ ¹æ®æ‰“å°ç»“æœï¼š.Type()è·å–è‡ªå®šä¹‰çš„ç±»å‹ï¼›.Kind()è·å–åŸºç¡€æ•°æ®ç±»å‹

    // ç°åœ¨æ ¹æ®ä¼ å…¥å€¼ç±»å‹åˆ¤æ–­ä¿®æ”¹å€¼
    x := []int{1, 2, 3, 4, 5}
    y := 10

    // ç©ºæ¥å£ç±»å‹å¯ä»¥è®¾ç½®ä»»ä½•ç±»å‹å€¼
    if rvIdOrName.Kind() == reflect.Interface {
        r := reflect.ValueOf(x) // è½¬æ¢ä¸ºåå°„å¯¹è±¡
        rvIdOrName.Set(r)
    }

    if rvAge.Kind() == reflect.Int {
        rvAge.SetInt(int64(y))
    }

    fmt.Println(&quot;ä¿®æ”¹åï¼š&quot;, u, reflect.TypeOf(u.IdOrName))
}

</code></pre>
<h2 id="5_7">5 åå°„è·å–ç±»å‹ä¿¡æ¯</h2>
<pre><code class="language-go">/**/

package main

import (
    &quot;fmt&quot;
    &quot;reflect&quot;
    &quot;strings&quot;
)

type Person struct {
    hobbys []string
}

type User struct {
    Name   string `json:&quot;name&quot;`
    Age    int    `json:&quot;age&quot;`
    Gender bool   `json:&quot;gender&quot;`
    Person `json:&quot;person&quot;`
}

func main() {
    ashes := strings.Repeat(&quot;-&quot;, 40) // å®šä¹‰20ä¸ª-çš„å­—ç¬¦ä¸²
    fmt.Println(ashes)

    u := User{Name: &quot;Tom&quot;, Age: 18, Gender: true}
    uType := reflect.TypeOf(u)
    for i := 0; i &lt; uType.NumField(); i++ {
        field := uType.Field(i)
        if i == 0 {
            fmt.Println(&quot;ç¬¬ä¸€ä¸ªå­—æ®µçš„åå°„ä¿¡æ¯ä¸­ç»§ç»­åå°„ï¼Œè·å–åŒ…å«æœ‰å“ªäº›å­—æ®µï¼š&quot;)

            // å¯¹ç¬¬ä¸€ä¸ªå…ƒç´ è·å–çš„ä¿¡æ¯ä¹Ÿåšåå°„è·å–å­—æ®µï¼ˆè·å–çš„ä¿¡æ¯æœ¬è´¨ä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼‰
            fType := reflect.TypeOf(field)
            for j := 0; j &lt; fType.NumField(); j++ {
                fmt.Println(fType.Field(j).Name)
            }
            fmt.Println(ashes)
            fmt.Println(&quot;åå°„ä¿¡æ¯ä¸­åŒ…å«æœ‰å“ªäº›æ–¹æ³•ï¼ˆä¼ å…¥æŒ‡é’ˆï¼‰ï¼š&quot;)
            fpType := reflect.TypeOf(&amp;field)
            for j := 0; j &lt; fpType.NumMethod(); j++ {
                fmt.Println(fpType.Method(j).Name)
            }
            fmt.Println(ashes)
        }

        fmt.Printf(&quot;åå°„ä¸­å½“å‰å­—æ®µç±»å‹ï¼š%T\n&quot;, field)
        fmt.Println(ashes)

        fmt.Printf(&quot;åå°„è·å–ä¿¡æ¯å¦‚ä¸‹ï¼š&quot;+
            &quot;\n\tå­—æ®µåï¼š%v&quot;+
            &quot;\n\tåŒ…è·¯å¾„ï¼š%v&quot;+
            &quot;\n\tç±»å‹ï¼š%v&quot;+
            &quot;\n\tæ ‡ç­¾ï¼š%v&quot;+
            &quot;\n\tåç§»é‡ï¼š%v&quot;+
            &quot;\n\tç´¢å¼•ï¼š%v&quot;+
            &quot;\n\tæ˜¯å¦åŒ¿åå­—æ®µï¼š%v&quot;+
            &quot;\n\tæ˜¯å¦å¯è§ï¼š%v\n&quot;, field.Name, field.PkgPath, field.Type, field.Tag, field.Offset, field.Index, field.Anonymous, field.IsExported())
        fmt.Println(ashes + &quot;\n&quot;)
    }

}

</code></pre>
<h3 id="51_3">5.1 è·å–å¯¹å˜é‡åå°„åç»§ç»­åå°„ä¿¡æ¯</h3>
<p>å¯¹å˜é‡åå°„ä¹‹åï¼Œç»§ç»­åå°„å¯ä»¥è§‚å¯Ÿå˜é‡åå°„ä¹‹åæœ‰å“ªäº›ä¿¡æ¯å’Œæ–¹æ³•ï¼š</p>
<pre><code class="language-go">uType := reflect.TypeOf(u)
fType := reflect.TypeOf(field)

// æœ‰å“ªäº›å­—æ®µï¼Ÿ
for j := 0; j &lt; fType.NumField(); j++ {}
// ä¸»è¦åŒ…å«ä»¥ä¸‹å­—æ®µï¼ˆç›¸å½“äºpythonå®šä¹‰ç±»çš„å±æ€§ï¼‰ï¼š
// Name
// PkgPath
// Type
// Tag
// Offset
// Index
// Anonymous

// æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ
for j := 0; j &lt; fType.NumMethod(); j++ {}
// IsExported æ˜¯å¦å¯è§ -&gt; ä¸æ˜¯æŒ‡é’ˆå‚æ•°æ–¹æ³•ï¼ˆfTypeè·å–æ—¶ï¼Œfieldä¸æ˜¯æŒ‡é’ˆï¼‰ -- æŒ‡é’ˆå‚æ•°å¯ä»¥è·å–å…¨éƒ¨æ–¹æ³•ï¼›éæŒ‡é’ˆå‚æ•°åªèƒ½è·å–éæŒ‡é’ˆå‚æ•°æ–¹æ³•

// fpType := reflect.TypeOf(&amp;field)  // ä¼ å…¥çš„æ˜¯æŒ‡é’ˆå‚æ•°
</code></pre>
<h3 id="52_3">5.2 åå°„è·å–æ–¹æ³•æ³¨æ„äº‹é¡¹</h3>
<pre><code class="language-go">uType := reflect.TypeOf(u)
fType := reflect.TypeOf(field)   // éæŒ‡é’ˆå‚æ•°  -- åªèƒ½è·å–éæŒ‡é’ˆå‚æ•°æ–¹æ³•
fpType := reflect.TypeOf(&amp;field) // æŒ‡é’ˆå‚æ•°  -- å¯ä»¥è·å–å…¨éƒ¨æ–¹æ³•
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-go">type Person struct {
    hobbys []string
}

type User struct {
    Name   string `json:&quot;name&quot;`
    Age    int    `json:&quot;age&quot;`
    Gender bool   `json:&quot;gender&quot;`
    Person `json:&quot;person&quot;`
}

// éæŒ‡é’ˆå‚æ•°æ–¹æ³•
func (p User) SetName(name string) User {
    p.Name = name
    return p
}

// æŒ‡é’ˆå‚æ•°æ–¹æ³•
func (p *User) StringInfo() string {
    return fmt.Sprintf(&quot;Name:%s, Age:%d, Gender:%t&quot;, p.Name, p.Age, p.Gender)
}


func main() {
    ashes := strings.Repeat(&quot;-&quot;, 40) // å®šä¹‰20ä¸ª-çš„å­—ç¬¦ä¸²
    fmt.Println(ashes)

    u := User{Name: &quot;Tom&quot;, Age: 18, Gender: true}
    // uType := reflect.TypeOf(u)  // è¿™ç§æ‰“å°ç»“æœï¼šSetName
    uType := reflect.TypeOf(&amp;u)  // è¿™ç§æ‰“å°ç»“æœï¼šSetName StringInfo
    for i := 0; i &lt; uType.NumMethod(); i++ {
        field := uType.Method(i)
        fmt.Println(field.Name)
    }
}
</code></pre>
<h2 id="6_5">6 åå°„åˆ¤æ–­ç±»å‹æ˜¯å¦å®ç°äº†æ¥å£</h2>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-go">/**/

package main

import (
    &quot;fmt&quot;
    &quot;reflect&quot;
    &quot;strings&quot;
)

// å®šä¹‰æ¥å£
type People interface {
    StringInfo() string
}

type Person struct {
    hobbys []string
}

type User struct {
    Name   string `json:&quot;name&quot;`
    Age    int    `json:&quot;age&quot;`
    Gender bool   `json:&quot;gender&quot;`
    Person `json:&quot;person&quot;`
}

func (p *Person) StringInfo() string {
    return fmt.Sprintf(&quot;Hobbys:%v&quot;, p.hobbys)
}

// é‡å†™çˆ¶ç»“æ„ä½“æ–¹æ³• - åŒæ—¶ä¹Ÿæ˜¯æ¥å£
// func (p *User) StringInfo() string {
//  return fmt.Sprintf(&quot;Name:%s, Age:%d, Gender:%t&quot;, p.Name, p.Age, p.Gender)
// }

func main() {
    ashes := strings.Repeat(&quot;-&quot;, 40) // å®šä¹‰20ä¸ª-çš„å­—ç¬¦ä¸²
    fmt.Println(ashes)

    // åˆ¤æ–­ç»“æ„ä½“Useræ˜¯å¦å®ç°äº†Peopleæ¥å£ï¼Ÿ
    ipeople := (*People)(nil) // ç©ºæŒ‡é’ˆç±»å‹-ç±»å‹å…ƒä¿¡æ¯-ç±»æ¯”åˆ›å»ºä¸€ä¸ªæ¥å£å®ä¾‹
    iType := reflect.TypeOf(ipeople).Elem()
    fmt.Println(&quot;iTypeåº•å±‚ç±»å‹ï¼ˆkindï¼‰æ˜¯å¦æ˜¯ä¸€ä¸ªæ¥å£ï¼Ÿ &quot;, iType.Kind() == reflect.Interface)

    // åˆ¤æ–­Personå’ŒUseræ˜¯å¦å®ç°äº†Peopleæ¥å£ï¼Ÿ
    uType := reflect.TypeOf(User{})
    upType := reflect.TypeOf(&amp;User{})

    fmt.Println(&quot;useræ˜¯å¦å®ç°äº†Peopleæ¥å£ï¼Ÿ&quot;, uType, uType.Implements(iType))
    fmt.Println(&quot;puseræ˜¯å¦å®ç°äº†Peopleæ¥å£ï¼Ÿ&quot;, upType, upType.Implements(iType))

    pType := reflect.TypeOf(Person{})
    ppType := reflect.TypeOf(&amp;Person{})

    fmt.Println(&quot;personæ˜¯å¦å®ç°äº†Peopleæ¥å£ï¼Ÿ&quot;, pType, pType.Implements(iType))
    fmt.Println(&quot;ppersonæ˜¯å¦å®ç°äº†Peopleæ¥å£ï¼Ÿ&quot;, ppType, ppType.Implements(iType))

}


// iTypeåº•å±‚ç±»å‹ï¼ˆkindï¼‰æ˜¯å¦æ˜¯ä¸€ä¸ªæ¥å£ï¼Ÿ  true
// useræ˜¯å¦å®ç°äº†Peopleæ¥å£ï¼Ÿ main.User false
// puseræ˜¯å¦å®ç°äº†Peopleæ¥å£ï¼Ÿ *main.User true
// personæ˜¯å¦å®ç°äº†Peopleæ¥å£ï¼Ÿ main.Person false
// ppersonæ˜¯å¦å®ç°äº†Peopleæ¥å£ï¼Ÿ *main.Person true
</code></pre>
<p><strong>ç»“è®ºæ€»ç»“ï¼š</strong></p>
<ul>
<li>
<p>åˆ¤æ–­æ˜¯å¦å®ç°æ¥å£ï¼Œä½¿ç”¨ï¼š<code>å˜é‡åå°„.Implements(reflect.TypeOf((*æ¥å£åç§°)(nil)).Elem())</code></p>
</li>
<li>
<p>å˜é‡åå°„æ—¶ï¼Œä¾ç„¶éµå¾ªæŒ‡é’ˆç±»å‹ä¼šåˆ¤æ–­æ˜¯å¦å®ç°å¯¹åº”çš„æŒ‡é’ˆç±»å‹æ¥å£æˆ–å€¼ç±»å‹æ¥å£ï¼ˆå…¶ä¸€å³å¯ï¼‰ï¼›å€¼ç±»å‹åªä¼šåˆ¤æ–­å€¼ç±»å‹æ¥å£æ˜¯å¦å®ç°</p>
</li>
<li>æ¥å£åˆ¤æ–­æ˜¯å¦å®ç°éµå¾ªç»§æ‰¿ï¼Œçˆ¶ç±»å‹å®ç°äº†æ¥å£ï¼›å­ç±»å‹åˆ¤æ–­ä¹Ÿæ˜¯å·²å®ç°</li>
<li>æ¥å£åˆ¤æ–­è‹¥æœ‰å¤šä¸ªæ–¹æ³•ï¼Œåˆ™ä¼šåˆ¤æ–­æ˜¯å¦å…¨éƒ¨å®ç°ï¼›æ‰ä¼šè¿”å›trueï¼›å¦åˆ™false</li>
</ul>
<h2 id="7-valueof">7 å…³äºValueOfå¸¸ç”¨æ“ä½œ</h2>
<h3 id="71-typeofelemvalueofelem">7.1 æ˜ç¡®TypeOf().Elem()ä¸ValueOf().Elem()ä¹‹é—´çš„åŒºåˆ«</h3>
<pre><code class="language-go">u := User{}
t1 := reflect.TypeOf(u)          // User çš„ç±»å‹
t2 := reflect.TypeOf(&amp;u).Elem()  // è§£å¼•ç”¨åä»ç„¶æ˜¯ User çš„ç±»å‹
fmt.Println(t1 == t2)            // trueï¼ˆç±»å‹ç›¸åŒï¼‰

v1 := reflect.ValueOf(u)          // User çš„å€¼ï¼ˆå‰¯æœ¬ï¼‰; v1 æ˜¯ u çš„ä¸€ä¸ªå‰¯æœ¬çš„åå°„å€¼ï¼ˆæ–°å†…å­˜åœ°å€ï¼‰ï¼ˆå‰¯æœ¬çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½ä»…é™äºå½“å‰ä½œç”¨åŸŸï¼‰
v2 := reflect.ValueOf(&amp;u).Elem()  // è§£å¼•ç”¨åæŒ‡å‘åŸå§‹ u çš„åå°„å€¼ ; v2 æ˜¯ &amp;u è§£å¼•ç”¨åå¾—åˆ°çš„åŸå§‹ u çš„åå°„å€¼ï¼ˆåŸå§‹å†…å­˜åœ°å€ï¼‰
fmt.Println(v1 == v2)             // false ; ä¸¤è€…çš„åº•å±‚å­˜å‚¨ä¸åŒï¼ˆä¸€ä¸ªæ˜¯å‰¯æœ¬ï¼Œä¸€ä¸ªæ˜¯åŸå§‹å€¼ï¼‰
</code></pre>
<h3 id="72_1">7.2 åå°„è·å–ä¸ä¿®æ”¹å€¼</h3>
<p>æ³¨æ„ï¼šä¿®æ”¹ç»“æ„ä½“å¯¹è±¡é‡Œé¢çš„å€¼ï¼Œå¿…é¡»ä¸ºå…¬æœ‰çš„ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰ï¼›ç§æœ‰çš„ä¸å…è®¸ä¿®æ”¹ï¼›ä¸€èˆ¬ä¸€å®šè¦ä¿®æ”¹ç§æœ‰å˜é‡ï¼›å°±éœ€è¦å†™å¯¹åº”çš„å‡½æ•°å»ä¿®æ”¹ï¼›</p>
<pre><code class="language-go">type User struct {
    Name   string `json:&quot;name&quot;`
}

func main() {
    u := User{Name: &quot;chc&quot;}
    fmt.Println(u)

    // åå°„è·å–Nameçš„å€¼
    uValueElem := reflect.ValueOf(&amp;u).Elem()
    uFieldByName := uValueElem.FieldByName(&quot;Name&quot;)
    fmt.Println(uFieldByName)
    // åå°„ä¿®æ”¹Nameçš„å€¼ -- æ³¨æ„ä½¿ç”¨æŒ‡é’ˆå‚æ•°è·å–åå°„
    uFieldByName.SetString(&quot;xxx&quot;)

    fmt.Println(u)
}
</code></pre>
<h3 id="74-type">7.4 è½¬Type</h3>
<pre><code class="language-go">// è½¬Type
uTypeElem := reflect.ValueOf(&amp;u).Elem()
uType := uTypeElem.Type() // ç­‰ä»·äºï¼šreflect.TypeOf(u)
fmt.Println(uType)
</code></pre>
<h3 id="75-value">7.5 æŒ‡é’ˆ/Value(å…·ä½“å€¼ç±»å‹)äº’è½¬</h3>
<pre><code class="language-go">func main() {
    u := User{Name: &quot;chc&quot;}
    // åå°„è·å–Nameçš„å€¼
    uValue := reflect.ValueOf(&amp;u)
    uValueElem := uValue.Elem()                           // æŒ‡é’ˆè½¬Value
    fmt.Println(uValueElem.Type(), uValueElem.Kind())     // main.User struct
    uPointerAddr := uValueElem.Addr()                     // Valueè½¬æŒ‡é’ˆ
    fmt.Println(uPointerAddr.Type(), uPointerAddr.Kind()) // *main.User ptr
}
</code></pre>
<h3 id="76-reflectvalue">7.6 reflect.Valueä¸å…·ä½“ç±»å‹äº’è½¬</h3>
<pre><code class="language-go">func main() {
    u := User{Name: &quot;chc&quot;}

    // æƒ…å†µä¸€ï¼šå¯¹å€¼æ“ä½œ
    // User è½¬ä¸º reflect.Value
    uValue := reflect.ValueOf(u) // reflect.TypeOf(uValue) = reflect.Value -&gt; åå°„åŒ…è£…å™¨æœ¬èº«ç±»å‹
    // reflect.Value è½¬ä¸º User
    uNew := uValue.Interface().(User)
    // æ¯”è¾ƒ
    fmt.Println(reflect.DeepEqual(u, uNew)) // trueï¼ˆå†…å®¹ç›¸åŒï¼‰
    fmt.Println(&amp;u == &amp;uNew)                // falseï¼ˆå†…å­˜åœ°å€ä¸åŒï¼‰

    // æƒ…å†µ2ï¼šå¯¹æŒ‡é’ˆæ“ä½œ
    // *User è½¬ä¸º reflect.Value
    ptrValue := reflect.ValueOf(&amp;u) // reflect.TypeOf(uValue) = reflect.Value -&gt; åå°„åŒ…è£…å™¨æœ¬èº«ç±»å‹
    // reflect.Value è½¬ä¸º *User
    ptrNew := ptrValue.Interface().(*User)
    fmt.Println(reflect.DeepEqual(u, *ptrNew)) // trueï¼ˆå†…å®¹ç›¸åŒï¼‰
    fmt.Println(&amp;u == ptrNew)                  // trueï¼ˆæŒ‡é’ˆåœ°å€ç›¸åŒï¼‰
}
</code></pre>
<h3 id="77">7.7 ç©ºç±»å‹ç©ºæŒ‡é’ˆä¸æœ‰ç±»å‹ç©ºæŒ‡é’ˆ</h3>
<pre><code class="language-go">func main() {
    var i interface{} // ç©ºæ¥å£æ²¡æœ‰æŒ‡å‘å…·ä½“çš„ç±»å‹ -- å¯ä»¥è®¤ä¸ºï¼šç©ºç±»å‹ç©ºæŒ‡é’ˆ
    iType := reflect.ValueOf(i)
    fmt.Println(iType)                         // &lt;invalid reflect.Value&gt;
    fmt.Println(iType.IsValid(), iType.Kind()) // æ˜¯å¦æœ‰æ•ˆçš„ï¼šfaseï¼›åŸºç¡€æ•°æ®ç±»å‹ï¼šinvalid
    fmt.Println(strings.Repeat(&quot;-&quot;, 40))

    var u *User = nil                 // æœ‰ç±»å‹çš„ç©ºæŒ‡é’ˆ
    fmt.Println(u, reflect.TypeOf(u)) // &lt;nil&gt; *main.User
    uValue := reflect.ValueOf(u)
    fmt.Println(uValue)                                          // &lt;nil&gt;
    fmt.Println(uValue.IsValid(), uValue.Kind(), uValue.IsNil()) // æ˜¯å¦æœ‰æ•ˆçš„ï¼štrueï¼›åŸºç¡€æ•°æ®ç±»å‹ï¼šptrï¼›å€¼æ˜¯ä¸æ˜¯nilï¼štrue
    // ä¸ºnilï¼›æ¯”å¦‚åšæ“ä½œä¼šæŠ¥é”™ï¼ˆnil.Callï¼‰ -&gt; ç©ºæŒ‡é’ˆå¼‚å¸¸
}
</code></pre>
<h3 id="78">7.8 åˆ¤æ–­æ˜¯å¦é›¶å€¼å¯¹è±¡</h3>
<p>åˆ¤æ–­æ˜¯å¦é›¶å€¼å¯¹è±¡ä¹‹å‰ï¼Œå°½é‡å…ˆåˆ¤æ–­æ˜¯å¦æœ‰æ•ˆï¼ˆIsValidï¼‰ï¼›é¿å…å¼‚å¸¸</p>
<pre><code class="language-go">func main() {
    var i interface{}
    vi := reflect.ValueOf(i)
    if vi.IsValid() {
        fmt.Println(vi.IsZero())
    } else {
        fmt.Println(&quot;viå˜é‡æ˜¯æ— æ•ˆçš„ï¼æ— æ³•åˆ¤æ–­æ˜¯å¦é›¶å€¼å¯¹è±¡~&quot;)
    }

    var u = User{}
    vu := reflect.ValueOf(u)
    if vu.IsValid() {
        fmt.Println(vu.IsZero())
    } else {
        fmt.Println(&quot;viå˜é‡æ˜¯æ— æ•ˆçš„ï¼æ— æ³•åˆ¤æ–­æ˜¯å¦é›¶å€¼å¯¹è±¡~&quot;)
    }
}
</code></pre>
<h3 id="79">7.9 å€ŸåŠ©åå°„æ‰¹é‡æˆ–å•ä¸ªè°ƒç”¨å‡½æ•°</h3>
<pre><code class="language-go">/**/

package main

import (
    &quot;fmt&quot;
    &quot;reflect&quot;
)

type Person struct {
    hobbys []string
}

type User struct {
    Name   string `json:&quot;name&quot;`
    Age    int    `json:&quot;age&quot;`
    Gender bool   `json:&quot;gender&quot;`
    Person `json:&quot;person&quot;`
}

func (p *Person) StringInfo(end string) string {
    return fmt.Sprintf(&quot;Hobbys:%v%v&quot;, p.hobbys, end)
}

func (p *User) ShowInfo(x string) string {
    return fmt.Sprintf(&quot;ShowInfo:%v&quot;, x)
}

func main() {
    var u User
    // ä½¿ç”¨åå°„è·å–ä¸”è°ƒç”¨Useré‡Œé¢å…¨éƒ¨æ–¹æ³•
    uValue := reflect.ValueOf(&amp;u)
    for i := 0; i &lt; uValue.NumMethod(); i++ {
        method := uValue.Method(i)
        prams := []reflect.Value{reflect.ValueOf(&quot;_XXX&quot;)}
        fmt.Println(method.Call(prams)) // [ShowInfo:_XXX] \n [Hobbys:[]_XXX]  -- å¾ªç¯è°ƒç”¨å…¨éƒ¨å‡½æ•°
    }

    // åªè·å–ä¸”è°ƒç”¨æŸä¸ªæ–¹æ³•
    results := uValue.MethodByName(&quot;StringInfo&quot;).Call([]reflect.Value{reflect.ValueOf(&quot;_ZZZZZZZ&quot;)})
    // è¿”å›ç»“æœresultsé‡Œé¢çš„å…ƒç´ æ¯ä¸ªéƒ½æ˜¯reflect.Valueç±»å‹ï¼›éœ€è¦è½¬å›åŸæ¥ç»“æ„ä½“å…·ä½“éœ€è¦çš„ç±»å‹
    srcValue := results[0].Interface().(string)
    fmt.Println(results, reflect.TypeOf(results[0]), reflect.TypeOf(srcValue)) // [Hobbys:[]_ZZZZZZZ] reflect.Value string
}

</code></pre>
<p>æ³¨æ„ï¼šè¿è¡Œæ—¶è·å–å‡½æ•°åï¼Œä½¿ç”¨çš„æ˜¯Type()/TypeOf()</p>
<pre><code class="language-go">func main() {
    var u User
    // ä½¿ç”¨åå°„è·å–ä¸”è°ƒç”¨Useré‡Œé¢å…¨éƒ¨æ–¹æ³•
    uValue := reflect.ValueOf(&amp;u)
    uType := uValue.Type()
    for i := 0; i &lt; uValue.NumMethod(); i++ {
        method := uValue.Method(i)
        methodName := uType.Method(i).Name
        fmt.Printf(&quot;å‡½æ•°å¯¹è±¡: %s\n&quot;, method)
        fmt.Printf(&quot;æ–¹æ³•å: %s\n&quot;, methodName)
    }
}
</code></pre>
<h1 id="_15">ğŸ“š æµ‹è¯•ç›¸å…³</h1>
<p>Goè¯­è¨€å†…ç½®äº†å¼ºå¤§çš„æµ‹è¯•æ¡†æ¶ï¼Œä½¿å¾—ç¼–å†™å•å…ƒæµ‹è¯•å˜å¾—ç®€å•é«˜æ•ˆã€‚</p>
<h2 id="1_14">1 åŸºæœ¬ç»“æ„</h2>
<ul>
<li>
<p><strong>æµ‹è¯•æ–‡ä»¶å¿…é¡»ä»¥<code>_test.go</code>ç»“å°¾</strong></p>
</li>
<li>
<p>æµ‹è¯•æ–‡ä»¶ä¼šè¢«<code>go text</code>è¯†åˆ«ï¼Œä¸ä¼šè¢«<code>go build</code>è¯†åˆ«</p>
</li>
<li>
<p>æµ‹è¯•æ–‡ä»¶ä¸è¢«æµ‹è¯•æ–‡ä»¶å¿…é¡»åœ¨ä¸€ä¸ªåŒ…å½“ä¸­</p>
</li>
<li>
<p><strong>æµ‹è¯•å‡½æ•°ç­¾å</strong></p>
</li>
<li>
<p>å•å…ƒæµ‹è¯•ï¼št *testing.T</p>
</li>
<li>åŸºå‡†æµ‹è¯•ï¼šb *testing.B</li>
<li>æ¨¡ç³Šæµ‹è¯•ï¼šf *testing.F</li>
</ul>
<p>```go
  func TestXxx(t *testing.T)</p>
<p>// å‡½æ•°åä»¥<code>Test</code>å¼€å¤´
  // <code>Xxx</code>éƒ¨åˆ†é¦–å­—æ¯å¿…é¡»å¤§å†™
  // æ¥æ”¶<code>*testing.T</code>å‚æ•°
  ```</p>
<ul>
<li><strong>è¿è¡Œæµ‹è¯•å‘½ä»¤</strong></li>
</ul>
<p>```shell
  # è¿è¡Œå½“å‰åŒ…çš„æ‰€æœ‰æµ‹è¯•
  go test</p>
<p># æ˜¾ç¤ºè¯¦ç»†æµ‹è¯•ä¿¡æ¯
  go test -v</p>
<p># è®¾ç½®è¶…æ—¶
  go test -v -timeout 5s</p>
<p># è®¾ç½®ç”¨ä¾‹æµ‹è¯•æ¬¡æ•°
  go test -v -count 3</p>
<p># è¿è¡Œç‰¹å®šæµ‹è¯•å‡½æ•°
  go test -v -run TestAdd</p>
<p># è¿è¡ŒåŒ…å«"Add"çš„æµ‹è¯•å‡½æ•°
  go test -v -run Add</p>
<p># æ˜¾ç¤ºæµ‹è¯•è¦†ç›–ç‡
  go test -cover</p>
<p># ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
  go test -coverprofile=coverage.out
  go tool cover -html=coverage.out</p>
<p># åŸºå‡†æµ‹è¯•
  go test -bench
  ```</p>
<h2 id="2_13">2 å•å…ƒæµ‹è¯•</h2>
<p>ç›®å½•ç»“æ„ï¼š</p>
<pre><code class="language-shell">project/
â”œâ”€â”€ testcases/
â”‚   â””â”€â”€ generics_test.go # æµ‹è¯•ä»£ç 
â”œâ”€â”€ generics/
â”‚   â”œâ”€â”€ generics.go      # æ³›å‹å®ç°ä»£ç 
â””â”€â”€ go.mod               # æ¨¡å—æ–‡ä»¶
</code></pre>
<p>ç”¨ä¾‹ç¼–å†™ç¤ºä¾‹ï¼ˆè¡¨é©±åŠ¨æ³•ï¼‰ï¼š</p>
<pre><code class="language-go">package main

import &quot;testing&quot;

func TestRun(t *testing.T) {
    tests := []struct {
        name string
    }{
        // TODO: Add test cases.
        {
            &quot;æ³›å‹ç›¸å…³åŠŸèƒ½å‡½æ•°æµ‹è¯•&quot;,
        },
    }
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            Run()
        })
    }
}
</code></pre>
<h2 id="3-table-driven">3 è¡¨é©±åŠ¨æ³•ï¼ˆTable Drivenï¼‰</h2>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­å·²ç»ç”¨åˆ°äº†è¡¨é©±åŠ¨æ³•åˆ›å»ºç”¨ä¾‹ï¼Œä¸€èˆ¬ç‚¹å‡»å‡½æ•°ï¼Œå³é”®é€‰æ‹©ç”Ÿæˆå³å¯æœ‰æ­¤æ ¼å¼ä»£ç æ–‡ä»¶ç”Ÿæˆï¼›</p>
<p><strong>Table Driven</strong>ä¸»è¦åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†å†…å®¹ï¼š</p>
<ul>
<li><strong>æµ‹è¯•ç”¨ä¾‹å®šä¹‰</strong>ï¼šå³æ¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹éœ€è¦æœ‰ä»€ä¹ˆ</li>
<li><strong>å…·ä½“çš„æµ‹è¯•ç”¨ä¾‹</strong>ï¼šè®¾è®¡çš„æ¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½åœ¨è¿™é‡Œ</li>
<li><strong>æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹</strong>ï¼šåŒ…æ‹¬æµ‹è¯•ç”¨ä¾‹çš„æ–­è¨€</li>
</ul>
<h2 id="4_7">4 æµ‹è¯•è¾…åŠ©å‡½æ•°</h2>
<p>ä½¿ç”¨<code>t.Helper()</code>æ ‡è®°è¾…åŠ©å‡½æ•°ï¼Œè¿™æ ·åœ¨é”™è¯¯æŠ¥å‘Šä¸­ä¼šè·³è¿‡è¿™äº›å‡½æ•°ï¼›</p>
<pre><code class="language-go">func assertEqual(t *testing.T, result, expected int) {
    t.Helper()
    if result != expected {
        t.Errorf(&quot;expected %d, got %d&quot;, expected, result)
    }
}

func TestWithHelper(t *testing.T) {
    assertEqual(t, Add(2, 2), 4)
    assertEqual(t, Multiply(3, 3), 9)
}
</code></pre>
<p>å¦‚ä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹ï¼šæµ‹è¯•å‘ç”Ÿé”™è¯¯åï¼Œå¹¶ä¸ä¼šè¾“å‡º assertEqualha å‡½æ•°çš„è°ƒç”¨ä¿¡æ¯ï¼Œè€Œæ˜¯æ˜¾ç¤ºé”™è¯¯ä½ç½®åœ¨ TestWithHelper ä¸­ï¼Œè¿™ä¹Ÿæœ‰ä¸ªå¥½å¤„ï¼Œå½“æœ‰å¤šä¸ªæµ‹è¯•å‡½æ•°è°ƒç”¨helperå‡½æ•°æ—¶ï¼Œå¯ä»¥å‡†ç¡®çš„çŸ¥é“å‘ç”Ÿé”™è¯¯çš„æ˜¯å“ªä¸ªæµ‹è¯•å‡½æ•°ï¼›ä½†ä¹Ÿè¦æ³¨æ„ï¼Œå½“åœ¨è¾…åŠ©å‡½æ•°å†…éƒ¨å‘ç”Ÿé”™è¯¯ï¼Œå¯ä»¥å°†t.Helper()å»æ‰ï¼Œå†å»æ’æŸ¥é—®é¢˜ã€‚</p>
<h2 id="5-benchmark">5 åŸºå‡†æµ‹è¯• (Benchmark)</h2>
<p>ä»¥<strong>Benchmark</strong> å¼€å¤´çš„æµ‹è¯•å‡½æ•°ä¸ºåŸºå‡†æµ‹è¯•å‡½æ•°ï¼Œç”¨äºæµ‹è¯•ä¸€æ®µç¨‹åºè¿è¡Œæ—¶çš„æ€§èƒ½ã€‚</p>
<p><strong>å‚æ•°ï¼š(b *testing.B)</strong></p>
<p>é»˜è®¤ä¸ä¼šå¼€å¯åŸºå‡†æµ‹è¯•ï¼Œéœ€è¦å¼€å¯åŸºå‡†æµ‹è¯•ï¼Œå„ä¸ªåœºæ™¯è¿è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell"># å‚æ•°éœ€è¦è·Ÿä¸€ä¸ªç›®å½•
go test -v -bench=.

# ---å…¶ä»–å‚æ•°----
-cpu=10  # æŒ‡å®šä½¿ç”¨cupæ ¸å¿ƒæ•°
-benchtime=1000x  # æŒ‡å®šæ‰§è¡Œæ¬¡æ•°1000æ¬¡
-benchmem  # æ˜¾ç¤ºå†…å­˜å ç”¨ä¿¡æ¯ B/opï¼šæ¯æ¬¡æ“ä½œåˆ†é…å†…å­˜å­—èŠ‚æ•°ï¼›allocs/opï¼šæ¯æ¬¡æ“ä½œåˆ†é…å†…å­˜çš„æ¬¡æ•°
</code></pre>
<p>ç¤ºä¾‹ï¼šæµ‹è¯•Sprintfå‡½æ•°ä¸strconv.Formatintå‡½æ•°å°†intæ•°å­—è½¬ä¸ºå­—ç¬¦ä¸²æ€§èƒ½å¯¹æ¯”</p>
<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;strconv&quot;
    &quot;testing&quot;
)

func BenchmarkSprintf(b *testing.B) {
    num := 10
    b.ResetTimer() // é‡ç½®è®¡æ—¶å™¨ï¼Œä¿è¯åªè®°å½•åˆ°ä¸»è¦æµ‹è¯•éƒ¨åˆ†çš„æ€§èƒ½æ•°æ®

    for i := 0; i &lt; b.N; i++ {
        _ = fmt.Sprintf(&quot;%d&quot;, num)
    }
}

func BenchmarkItoa(b *testing.B) {
    num := 10
    b.ResetTimer() // é‡ç½®è®¡æ—¶å™¨ï¼Œä¿è¯åªè®°å½•åˆ°ä¸»è¦æµ‹è¯•éƒ¨åˆ†çš„æ€§èƒ½æ•°æ®

    for i := 0; i &lt; b.N; i++ {
        _ = strconv.Itoa(num)
    }
}

func BenchmarkFormatInt(b *testing.B) {
    num := 10
    b.ResetTimer() // é‡ç½®è®¡æ—¶å™¨ï¼Œä¿è¯åªè®°å½•åˆ°ä¸»è¦æµ‹è¯•éƒ¨åˆ†çš„æ€§èƒ½æ•°æ®

    // b.StopTimer() // åœæ­¢è®¡æ—¶å™¨
    // time.Sleep(5 * time.Second)  // è¿™é‡Œè€—æ—¶ä¸ä¼šåŠ å…¥è®¡æ—¶
    // b.StartTimer() // é‡æ–°å¼€å¯è®¡æ—¶å™¨

    for i := 0; i &lt; b.N; i++ {
        _ = strconv.FormatInt(int64(num), 10)
    }
}


/*
æµ‹è¯•ç»“æœï¼š

...\goteststdy&gt;go test -v -bench .
goos: windows
goarch: amd64
pkg: goteststdy
cpu: 12th Gen Intel(R) Core(TM) i5-12500
BenchmarkSprintf
BenchmarkSprintf-12             29605725                38.11 ns/op
BenchmarkItoa
BenchmarkItoa-12                942932173                1.273 ns/op
BenchmarkFormatInt
BenchmarkFormatInt-12           952647087                1.278 ns/op
PASS
ok      goteststdy      4.439s
*/
</code></pre>
<p>å…³äºåŸºå‡†æµ‹è¯•çš„è®¡æ—¶å™¨æœ‰ä¸‰ç§æ“ä½œï¼ˆæ³¨æ„åœæ­¢/é‡æ–°å¼€å¯ä¸€èˆ¬åœ¨å¾ªç¯ä¸­ä½¿ç”¨ï¼Œä¸”ä¸<strong>b.N</strong>å¾ªç¯ä½¿ç”¨ï¼‰ï¼š</p>
<ul>
<li><strong>b.ResetTimer()</strong> - é‡ç½®è®¡æ—¶</li>
<li><strong>b.StopTimer()</strong> - åœæ­¢è®¡æ—¶ï¼ˆå¯ä»¥é‡æ–°å¼€å¯ï¼‰</li>
<li><strong>b.StartTimer()</strong> - é‡æ–°å¼€å§‹è®¡æ—¶</li>
</ul>
<h2 id="6-go118">6 æ¨¡ç³Šæµ‹è¯•ï¼ˆGo1.18+ï¼‰</h2>
<p><strong>æ¨¡ç³Šæµ‹è¯•</strong>ï¼šå°±æ˜¯å°†ä¸€äº›éé¢„æœŸçš„è¾“å…¥å¹¶ç›‘æµ‹å¼‚å¸¸ç»“æœæ¥å‘ç°é—®é¢˜ï¼ŒGo1.18+ç‰ˆæœ¬å·²ç»å°†æ¨¡ç³Šæµ‹è¯•åŠ å…¥äº†æ ‡å‡†åº“ã€‚</p>
<p><strong>å‚æ•°ï¼š(f *testing.F)</strong></p>
<p>é»˜è®¤ä¸ä¼šå¼€å¯æ¨¡ç³Šæµ‹è¯•ï¼Œéœ€è¦å¼€å¯æ¨¡ç³Šæµ‹è¯•å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="language-shell"># å‚æ•°éœ€è¦è·Ÿä¸€ä¸ªç›®å½•
go test -v -fuzz=.
</code></pre>
<p>ç¤ºä¾‹ï¼šé™¤æ•°ä¸èƒ½ä¸º0</p>
<pre><code class="language-go">// åŠŸèƒ½å‡½æ•°
func Div(a, b int) int {
    return a / b
}
</code></pre>
<pre><code class="language-go">package main

import &quot;testing&quot;

// æ¨¡ç³Šæµ‹è¯•
func FuzzRun(f *testing.F) {
    targetFunc := func(t *testing.T, a, b int) {
        Div(a, b)
    }
    f.Fuzz(targetFunc) // æ¨¡ç³Šæµ‹è¯•åµŒå…¥å•å…ƒæµ‹è¯• - è‡ªåŠ¨ç”Ÿæˆå¤šç»„æµ‹è¯•æ•°æ®
}

</code></pre>
<h1 id="fmtstrconvstringsjsonbytes">ğŸ“š å†…ç½®åŒ…ï¼šfmt/strconv/strings/json/bytes</h1>
<h2 id="1-fmt-io">1 fmt åŒ… - æ ¼å¼åŒ–I/O</h2>
<h3 id="11_1">1.1 æ ¼å¼åŒ–è¾“å‡º</h3>
<pre><code class="language-go">fmt.Print(a ...interface{})                 // æ ‡å‡†è¾“å‡ºï¼Œä¸æ¢è¡Œ
fmt.Println(a ...interface{})               // æ ‡å‡†è¾“å‡ºï¼Œè‡ªåŠ¨æ¢è¡Œ
fmt.Printf(format string, a ...interface{})  // æ ¼å¼åŒ–è¾“å‡º
fmt.Sprintf(format string, a ...interface{}) // è¿”å›æ ¼å¼åŒ–å­—ç¬¦ä¸²
</code></pre>
<h3 id="12_1">1.2 æ ¼å¼åŒ–è¾“å…¥</h3>
<pre><code class="language-go">fmt.Scan(a ...interface{})                  // ä»æ ‡å‡†è¾“å…¥è¯»å–
fmt.Scanf(format string, a ...interface{})  // æ ¼å¼åŒ–è¯»å–
fmt.Scanln(a ...interface{})                // è¯»å–ä¸€è¡Œ
</code></pre>
<h3 id="13_1">1.3 å…¶ä»–</h3>
<pre><code class="language-go">fmt.Errorf(format string, a ...interface{})  // è¿”å›errorç±»å‹
</code></pre>
<h2 id="2-strconv-">2 strconv åŒ… - å­—ç¬¦ä¸²è½¬æ¢</h2>
<h3 id="21">2.1 å­—ç¬¦ä¸²ä¸åŸºæœ¬ç±»å‹è½¬æ¢</h3>
<pre><code class="language-go">strconv.Atoi(s string) (int, error)         // å­—ç¬¦ä¸²è½¬int
strconv.Itoa(i int) string                  // intè½¬å­—ç¬¦ä¸²

strconv.ParseBool(str string) (bool, error) // å­—ç¬¦ä¸²è½¬bool
strconv.FormatBool(b bool) string           // boolè½¬å­—ç¬¦ä¸²

strconv.ParseFloat(s string, bitSize int) (float64, error) // å­—ç¬¦ä¸²è½¬float
strconv.FormatFloat(f float64, fmt byte, prec, bitSize int) string // floatè½¬å­—ç¬¦ä¸²

strconv.ParseInt(s string, base int, bitSize int) (i int64, err error) // å­—ç¬¦ä¸²è½¬int
strconv.FormatInt(i int64, base int) string // intè½¬å­—ç¬¦ä¸²
</code></pre>
<h3 id="22_1">2.2 å…¶ä»–è½¬æ¢</h3>
<pre><code class="language-go">strconv.Quote(s string) string              // æ·»åŠ åŒå¼•å·
strconv.Unquote(s string) (string, error)   // å»é™¤å¼•å·
</code></pre>
<h2 id="3-strings-">3 strings åŒ… - å­—ç¬¦ä¸²æ“ä½œ</h2>
<h3 id="31_1">3.1 å­—ç¬¦ä¸²æŸ¥è¯¢</h3>
<pre><code class="language-go">strings.Contains(s, substr string) bool     // æ˜¯å¦åŒ…å«å­ä¸²
strings.HasPrefix(s, prefix string) bool     // æ˜¯å¦æœ‰å‰ç¼€
strings.HasSuffix(s, suffix string) bool     // æ˜¯å¦æœ‰åç¼€
strings.Index(s, substr string) int         // å­ä¸²é¦–æ¬¡å‡ºç°ä½ç½®
strings.LastIndex(s, substr string) int     // å­ä¸²æœ€åå‡ºç°ä½ç½®
</code></pre>
<h3 id="32_1">3.2 å­—ç¬¦ä¸²æ“ä½œ</h3>
<pre><code class="language-go">strings.ToLower(s string) string            // è½¬å°å†™
strings.ToUpper(s string) string            // è½¬å¤§å†™
strings.Trim(s, cutset string) string       // å»é™¤ä¸¤ç«¯å­—ç¬¦
strings.TrimSpace(s string) string          // å»é™¤ä¸¤ç«¯ç©ºç™½
strings.Replace(s, old, new string, n int) string // æ›¿æ¢
strings.Split(s, sep string) []string       // åˆ†å‰²å­—ç¬¦ä¸²
strings.Join(elems []string, sep string) string // è¿æ¥å­—ç¬¦ä¸²
</code></pre>
<h3 id="33_1">3.3 å…¶ä»–</h3>
<pre><code class="language-go">strings.Repeat(s string, count int) string  // é‡å¤å­—ç¬¦ä¸²
strings.Count(s, substr string) int         // å­ä¸²å‡ºç°æ¬¡æ•°
strings.EqualFold(s, t string) bool         // ä¸åŒºåˆ†å¤§å°å†™æ¯”è¾ƒ
</code></pre>
<h2 id="4-encodingjson-json">4 encoding/json åŒ… - JSONå¤„ç†</h2>
<h3 id="41_1">4.1 ç¼–ç (åºåˆ—åŒ–)</h3>
<pre><code class="language-go">json.Marshal(v interface{}) ([]byte, error) // ç»“æ„ä½“è½¬JSON
json.MarshalIndent(v interface{}, prefix, indent string) ([]byte, error) // å¸¦ç¼©è¿›çš„JSON
</code></pre>
<h3 id="42_2">4.2 è§£ç (ååºåˆ—åŒ–)</h3>
<pre><code class="language-go">json.Unmarshal(data []byte, v interface{}) error // JSONè½¬ç»“æ„ä½“
</code></pre>
<h3 id="43_2">4.3 æµå¼å¤„ç†</h3>
<pre><code class="language-go">json.NewEncoder(w io.Writer) *json.Encoder  // åˆ›å»ºç¼–ç å™¨
json.NewDecoder(r io.Reader) *json.Decoder  // åˆ›å»ºè§£ç å™¨
</code></pre>
<h3 id="44">4.4 å…¶ä»–</h3>
<pre><code class="language-go">json.Valid(data []byte) bool                // æ£€æŸ¥JSONæ˜¯å¦æœ‰æ•ˆ
</code></pre>
<h3 id="45">4.5 å®é™…åº”ç”¨æµ‹è¯•</h3>
<pre><code class="language-go">/*
encoding/json åŒ…åºåˆ—åŒ–ä¸ååºåˆ—åŒ–
*/

package main

import (
    &quot;encoding/json&quot;
    &quot;fmt&quot;
)

type Person struct {
    Name   string `json:&quot;name&quot;` // é¦–å­—æ¯å¿…é¡»å¤§å†™ï¼Œåºåˆ—åŒ–æ‰ä¼šè¯»å–åˆ°ï¼Œè‹¥éœ€è¦åºåˆ—åŒ–åæ”¹ä¸ºå°å†™æˆ–å…¶ä»–ï¼Œå°±æŒ‰æ ¼å¼å†™æ ‡ç­¾
    Age    int    `json:&quot;age&quot;`
    Gender bool   `json:&quot;gender&quot;`
}

func (p *Person) show() {
    fmt.Println(&quot;æˆ‘æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæ­£åœ¨æ‰§è¡Œå†…éƒ¨æ–¹æ³•...&quot;)
}

func main() {
    slice := []interface{}{
        &quot;å‹åŠ›å±±å¤§&quot;,
        5,
        true,
        3.14,
        []string{&quot;a&quot;, &quot;b&quot;},
        map[int]string{1: &quot;a&quot;, 2: &quot;b&quot;},
        Person{Name: &quot;chc&quot;, Age: 18, Gender: true},
    }
    // åºåˆ—åŒ–ï¼šå­—èŠ‚åˆ‡ç‰‡ç±»å‹-&gt;å­—ç¬¦ä¸²ç±»å‹
    marshal, _ := json.Marshal(slice)
    marshalStr := string(marshal)
    fmt.Println(marshalStr) // `[&quot;å‹åŠ›å±±å¤§&quot;,5,true,3.14,[&quot;a&quot;,&quot;b&quot;],{&quot;1&quot;:&quot;a&quot;,&quot;2&quot;:&quot;b&quot;},{&quot;name&quot;:&quot;chc&quot;,&quot;age&quot;:18,&quot;gender&quot;:true}]`

    // ååºåˆ—åŒ– -&gt; åˆ‡ç‰‡
    newSlice := make([]interface{}, 0)
    _ = json.Unmarshal([]byte(marshalStr), &amp;newSlice)
    // æ³¨æ„ï¼šè½¬æ¢é»˜è®¤é”®å€¼å¯¹ç±»å‹å¯¹åº”æ˜¯mapï¼Œä¸æ˜¯ç»“æ„ä½“ï¼Œå¦‚éœ€è¦ï¼Œåˆ™è¿›ä¸€æ­¥å¤„ç†
    fmt.Println(newSlice) // [å‹åŠ›å±±å¤§ 5 true 3.14 [a b] map[1:a 2:b] map[age:18 gender:true name:chc]]

    // è·å–ååºåˆ—åŒ–çš„æœ€æœ‰ä¸€ä¸ªmapå…ƒç´ 
    dataMap := newSlice[6].(map[string]interface{}) // .() -&gt; è¡¨ç¤ºç±»å‹æ–­è¨€ï¼Œè¿™é‡Œè¿˜æ˜¯mapç±»å‹
    dm, _ := json.Marshal(dataMap)                  // å­—èŠ‚åˆ‡ç‰‡

    // map è½¬ ç»“æ„ä½“ï¼Œ éœ€è¦å€ŸåŠ©jsonåºåˆ—åŒ–ä¸ºå­—èŠ‚åˆ‡ç‰‡å†è¾…åŠ©è½¬ä¸ºå¯¹åº”ç»“æ„ä½“å¯¹è±¡
    var person Person
    _ = json.Unmarshal(dm, &amp;person)
    fmt.Printf(&quot;%+v\n&quot;, person)
    person.show()
}
</code></pre>
<h2 id="5-bytes">5 bytes åŒ…</h2>
<p>Go è¯­è¨€ä¸­çš„ <code>bytes</code> åŒ…ã€‚è¿™æ˜¯ä¸€ä¸ªæå…¶é‡è¦ä¸”å¸¸ç”¨çš„åŒ…ï¼Œä¸»è¦ç”¨äºæ“ä½œå­—èŠ‚åˆ‡ç‰‡ï¼ˆ<code>[]byte</code>ï¼‰ã€‚</p>
<h3 id="51-strings">5.1 å¸¸ç”¨å‡½æ•°ï¼ˆå¯¹æ ‡ strings åŒ…ï¼‰</h3>
<p>è¿™äº›å‡½æ•°å¤§å¤šç›´æ¥å¯¹ <code>[]byte</code> è¿›è¡Œæ“ä½œï¼Œå¹¶è¿”å›å¤„ç†åçš„æ–° <code>[]byte</code>ã€‚</p>
<h4 id="511">5.1.1 æ¯”è¾ƒä¸åˆ¤æ–­</h4>
<ul>
<li><code>func Compare(a, b []byte) int</code>ï¼š æ¯”è¾ƒä¸¤ä¸ªå­—èŠ‚åˆ‡ç‰‡ï¼Œè¿”å› <code>0</code>(a==b), <code>-1</code>(a &lt; b), <code>1</code>(a &gt; b)ã€‚</li>
<li><code>func Equal(a, b []byte) bool</code>ï¼š æ›´ç®€å•åœ°åˆ¤æ–­ä¸¤ä¸ªå­—èŠ‚åˆ‡ç‰‡æ˜¯å¦ç›¸ç­‰ã€‚</li>
<li><code>func HasPrefix(s, prefix []byte) bool</code>ï¼š åˆ¤æ–­å­—èŠ‚åˆ‡ç‰‡ <code>s</code> æ˜¯å¦ä»¥ <code>prefix</code> å¼€å¤´ã€‚</li>
<li><code>func Contains(b, subslice []byte) bool</code>ï¼š åˆ¤æ–­ <code>b</code> ä¸­æ˜¯å¦åŒ…å«å­åˆ‡ç‰‡ <code>subslice</code>ã€‚</li>
</ul>
<h4 id="512">5.1.2 æŸ¥æ‰¾ä¸å®šä½</h4>
<ul>
<li><code>func Index(b, sep []byte) int</code>ï¼š è¿”å› <code>sep</code> åœ¨ <code>b</code> ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œæœªæ‰¾åˆ°è¿”å› <code>-1</code>ã€‚</li>
<li><code>func LastIndex(b, sep []byte) int</code>ï¼š è¿”å›æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ã€‚</li>
<li><code>func IndexAny(b []byte, chars string) int</code>ï¼š è¿”å› <code>chars</code> ä¸­ä»»ä½•ä¸€ä¸ªå­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ã€‚</li>
</ul>
<h4 id="513">5.1.3 æ“ä½œä¸è½¬æ¢</h4>
<ul>
<li><code>func Split(s, sep []byte) [][]byte</code>ï¼š ç”¨ <code>sep</code> åˆ†å‰² <code>s</code>ï¼Œè¿”å›ä¸€ä¸ªåˆ‡ç‰‡ç»„æˆçš„åˆ‡ç‰‡ã€‚</li>
<li><code>func Join(s [][]byte, sep []byte) []byte</code>ï¼š ç”¨ <code>sep</code> è¿æ¥ <code>s</code> ä¸­çš„å¤šä¸ª <code>[]byte</code>ã€‚</li>
<li><code>func Repeat(b []byte, count int) []byte</code>ï¼š å°† <code>b</code> é‡å¤ <code>count</code> æ¬¡åè¿”å›ã€‚</li>
<li><code>func Replace(s, old, new []byte, n int) []byte</code>ï¼š å°† <code>s</code> ä¸­çš„å‰ <code>n</code> ä¸ª <code>old</code> æ›¿æ¢ä¸º <code>new</code>ã€‚<code>n</code> ä¸º <code>-1</code> æ—¶æ›¿æ¢æ‰€æœ‰ã€‚</li>
<li><code>func ToUpper(s []byte) []byte</code>ï¼š å°†æ‰€æœ‰å­—èŠ‚è½¬æ¢ä¸ºå¤§å†™ï¼ˆä»…å¯¹ ASCII æœ‰æ•ˆï¼‰ã€‚</li>
<li><code>func ToLower(s []byte) []byte</code>ï¼š å°†æ‰€æœ‰å­—èŠ‚è½¬æ¢ä¸ºå°å†™ã€‚</li>
<li><code>func Trim(s []byte, cutset string) []byte</code>ï¼š å»é™¤ <code>s</code> é¦–å°¾åŒ…å«åœ¨ <code>cutset</code> å­—ç¬¦é›†ä¸­çš„æ‰€æœ‰å­—ç¬¦ã€‚</li>
</ul>
<h3 id="52-bytesbuffer">5.2 bytes.Buffer</h3>
<p><code>bytes.Buffer</code> æ˜¯ <code>bytes</code> åŒ…çš„çµé­‚ï¼Œå®ƒæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œé›¶å€¼ (<code>var b bytes.Buffer</code>) å°±æ˜¯ä¸€ä¸ªç«‹å³å¯ç”¨çš„ç©ºç¼“å†²åŒºã€‚</p>
<pre><code class="language-go">type Buffer struct {
    buf      []byte // contents are the bytes buf[off : len(buf)]
    off      int    // read at &amp;buf[off], write at &amp;buf[len(buf)]
    lastRead readOp // last read operation, so that Unread* can work correctly.
}
</code></pre>
<ul>
<li><strong><code>[]byte</code> (å­—èŠ‚åˆ‡ç‰‡)</strong>ï¼š æœ¬è´¨æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œæ˜¯ Go è¯­è¨€ä¸­è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®ã€æ–‡æœ¬æ•°æ®ï¼ˆä¸ <code>string</code> å¯ç›¸äº’è½¬æ¢ï¼‰çš„å¸¸ç”¨å½¢å¼ã€‚</li>
<li><strong><code>bytes.Buffer</code></strong>ï¼š ä¸€ä¸ª<strong>å¯å˜å¤§å°</strong>çš„å­—èŠ‚ç¼“å†²åŒºã€‚å®ƒé›†è¯»ã€å†™åŠŸèƒ½äºä¸€èº«ï¼Œå†…éƒ¨å°è£…äº†ä¸€ä¸ª <code>[]byte</code>ï¼Œå¹¶æä¾›äº†éå¸¸é«˜æ•ˆçš„æ–¹æ³•æ¥æ“ä½œå®ƒã€‚å®ƒæ˜¯å¤„ç†å­—èŠ‚æ‹¼æ¥ã€ç¼“å­˜ç­‰ä»»åŠ¡çš„åˆ©å™¨ã€‚</li>
</ul>
<h4 id="521-buffer">5.2.1 åˆ›å»º Buffer</h4>
<ul>
<li><code>var b bytes.Buffer</code>ï¼š ç›´æ¥å£°æ˜ï¼Œåˆå§‹ä¸ºç©ºã€‚</li>
<li><code>b := bytes.NewBufferString("Hello")</code>ï¼š æ ¹æ®å­—ç¬¦ä¸²åˆ›å»ºã€‚</li>
<li><code>b := bytes.NewBuffer([]byte{0x01, 0x02})</code>ï¼š æ ¹æ®å·²æœ‰çš„ <code>[]byte</code> åˆ›å»ºã€‚</li>
</ul>
<h4 id="522-write">5.2.2 å†™å…¥æ•°æ® (Write)</h4>
<p><code>Buffer</code> å®ç°äº†å¤šä¸ª <code>Write</code> å¼€å¤´çš„æ¥å£ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<ul>
<li><code>func (b *Buffer) Write(p []byte) (n int, err error)</code>ï¼š å®ç°äº† <code>io.Writer</code> æ¥å£ï¼Œå†™å…¥å­—èŠ‚åˆ‡ç‰‡ã€‚</li>
<li><code>func (b *Buffer) WriteString(s string) (n int, err error)</code>ï¼š ç›´æ¥å†™å…¥å­—ç¬¦ä¸²ï¼Œ<strong>é¿å… <code>[]byte</code> è½¬æ¢ï¼Œæ•ˆç‡æ›´é«˜</strong>ã€‚</li>
<li><code>func (b *Buffer) WriteByte(c byte) error</code>ï¼š å†™å…¥å•ä¸ªå­—èŠ‚ã€‚</li>
<li><code>func (b *Buffer) WriteRune(r rune) (n int, err error)</code>ï¼š å†™å…¥ä¸€ä¸ª Unicode å­—ç¬¦ï¼ˆå¦‚ä¸­æ–‡ï¼‰ã€‚</li>
</ul>
<h4 id="523-read">5.2.3 è¯»å–æ•°æ® (Read)</h4>
<p><code>Buffer</code> ä¹Ÿå®ç°äº†å¤šä¸ª <code>Read</code> å¼€å¤´çš„æ¥å£ã€‚</p>
<ul>
<li><code>func (b *Buffer) Read(p []byte) (n int, err error)</code>ï¼š å®ç°äº† <code>io.Reader</code> æ¥å£ï¼Œå°†ç¼“å†²åŒºå†…å®¹è¯»å…¥ <code>p</code>ï¼Œè¯»å‡ºçš„æ•°æ®ä¼šä»ç¼“å†²åŒºç§»é™¤ã€‚</li>
<li><code>func (b *Buffer) ReadByte() (byte, error)</code>ï¼š è¯»å‡ºä¸€ä¸ªå­—èŠ‚ã€‚</li>
<li><code>func (b *Buffer) ReadBytes(delim byte) (line []byte, err error)</code>ï¼š ä¸€ç›´è¯»å–ç›´åˆ°é‡åˆ°åˆ†éš”ç¬¦ <code>delim</code>ï¼ˆå¸¸ç”¨ <code>\n</code> æ¥è¯»ä¸€è¡Œï¼‰ã€‚</li>
<li><code>func (b *Buffer) ReadString(delim byte) (line string, err error)</code>ï¼š åŒä¸Šï¼Œä½†ç›´æ¥è¿”å›å­—ç¬¦ä¸²ã€‚</li>
</ul>
<h4 id="524">5.2.4 å…¶å®ƒé‡è¦æ–¹æ³•</h4>
<ul>
<li><code>func (b *Buffer) String() string</code>ï¼š å°†ç¼“å†²åŒºçš„å†…å®¹ä»¥ <code>string</code> å½¢å¼è¿”å›ï¼Œéå¸¸å¸¸ç”¨ã€‚</li>
<li><code>func (b *Buffer) Bytes() []byte</code>ï¼š è¿”å›ç¼“å†²åŒºæœªè¯»éƒ¨åˆ†çš„å­—èŠ‚åˆ‡ç‰‡ã€‚</li>
<li><code>func (b *Buffer) Len() int</code>ï¼š è¿”å›æœªè¯»çš„å­—èŠ‚æ•°ã€‚</li>
<li><code>func (b *Buffer) Reset()</code>ï¼š æ¸…ç©ºç¼“å†²åŒºï¼Œé‡ç½®ä¸ºç©ºï¼Œä¾¿äºå¤ç”¨ã€‚</li>
<li><code>func (b *Buffer) Grow(n int)</code>ï¼š é¢„å…ˆåˆ†é… <code>n</code> å­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œé¿å…å¤šæ¬¡å†™å…¥æ—¶é‡å¤åˆ†é…ï¼Œ<strong>æ€§èƒ½ä¼˜åŒ–å…³é”®</strong>ã€‚</li>
</ul>
<h1 id="timeflagregexp">ğŸ“š å†…ç½®åŒ…ï¼štime/flag/regexp</h1>
<h2 id="1-time">1 time åŒ…</h2>
<h3 id="11_2">1.1 æ—¶é—´è·å–ä¸æ˜¾ç¤º</h3>
<pre><code class="language-go">now := time.Now()           // è·å–å½“å‰æ—¶é—´
year := now.Year()         // å¹´
month := now.Month()       // æœˆ
day := now.Day()           // æ—¥
hour := now.Hour()         // å°æ—¶
minute := now.Minute()     // åˆ†é’Ÿ
second := now.Second()     // ç§’
nanosecond := now.Nanosecond() // çº³ç§’
weekday := now.Weekday()   // æ˜ŸæœŸå‡ 
</code></pre>
<h3 id="12_2">1.2 æ—¶é—´ä¸å­—ç¬¦ä¸²ä¹‹é—´è½¬æ¢</h3>
<pre><code class="language-go">// æ ¼å¼åŒ–æ—¶é—´
now.Format(&quot;2006-01-02 15:04:05&quot;) // ```goçš„æ ¼å¼åŒ–æ—¶é—´å¿…é¡»ä½¿ç”¨2006-01-02 15:04:05è¿™ä¸ªæ—¶é—´ç‚¹ / è¿™ä¸ªå¸¸é‡ä¹Ÿå¯ä»¥ï¼štime.DateTime

// å­—ç¬¦ä¸²è½¬æ—¶é—´
targetTIme, _ := time.Parse(time.DateTime, &quot;2023-07-18 19:00:00&quot;)
</code></pre>
<h3 id="13_2">1.3 æ—¶é—´è®¡ç®—ä¸æ¯”è¾ƒ</h3>
<pre><code class="language-go">// æ—¶é—´åŠ å‡
later := now.Add(time.Hour * 2)      // 2å°æ—¶å
earlier := now.Add(-time.Minute * 30) // 30åˆ†é’Ÿå‰

// æ—¶é—´å·®
duration := later.Sub(now)  // è¿”å›Durationç±»å‹
hours := duration.Hours()   // ç›¸å·®å°æ—¶æ•°
minutes := duration.Minutes() // ç›¸å·®åˆ†é’Ÿæ•°

// æ—¶é—´æ¯”è¾ƒ
isAfter := now.After(earlier)  // true
isBefore := now.Before(later)  // true
isEqual := now.Equal(now)      // true
</code></pre>
<h3 id="14_1">1.4 å®šæ—¶å™¨ä¸ä¼‘çœ </h3>
<pre><code class="language-go">// ä¼‘çœ 
time.Sleep(time.Second * 2) // ä¼‘çœ 2ç§’

// å®šæ—¶å™¨
timer := time.NewTimer(time.Second * 3)
&lt;-timer.C // 3ç§’åè§¦å‘

// Ticker
ticker := time.NewTicker(time.Second)
for t := range ticker.C {
    fmt.Println(&quot;Tick at&quot;, t)
    // éœ€è¦æ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™ä¼šä¸€ç›´æ‰§è¡Œ
    ticker.Stop()
    break
}
</code></pre>
<h3 id="15">1.5 è·å–æ—¶é—´æˆ³</h3>
<pre><code class="language-go">// è·å–å„ç§ç²¾åº¦çš„æ—¶é—´æˆ³
sec := now.Unix()        // ç§’
milli := now.UnixMilli() // æ¯«ç§’
micro := now.UnixMicro() // å¾®ç§’
nano := now.UnixNano()   // çº³ç§’
</code></pre>
<h2 id="2-flag">2 flag åŒ…</h2>
<h3 id="21_1">2.1 åŸºæœ¬ä½¿ç”¨</h3>
<pre><code class="language-go">// å®šä¹‰flag
var (
    port = flag.Int(&quot;port&quot;, 8080, &quot;server port&quot;)
    name = flag.String(&quot;name&quot;, &quot;guest&quot;, &quot;user name&quot;)
    debug = flag.Bool(&quot;debug&quot;, false, &quot;enable debug mode&quot;)
)

func main() {
    // è§£æflag
    flag.Parse()

    fmt.Println(&quot;Port:&quot;, *port)
    fmt.Println(&quot;Name:&quot;, *name)
    fmt.Println(&quot;Debug:&quot;, *debug)

    // è·å–éflagå‚æ•°
    args := flag.Args()
    fmt.Println(&quot;Other args:&quot;, args)
}
</code></pre>
<h3 id="22-flag">2.2 è‡ªå®šä¹‰flagç±»å‹</h3>
<pre><code class="language-go">// è‡ªå®šä¹‰flagç±»å‹
var interval time.Duration

func init() {
    flag.DurationVar(&amp;interval, &quot;interval&quot;, time.Second, &quot;interval duration&quot;)
}

func main() {
    flag.Parse()
    fmt.Println(&quot;Interval:&quot;, interval)
}
</code></pre>
<h3 id="23_1">2.3 å…¶ä»–æ–¹æ³•</h3>
<pre><code class="language-go">flag.Usage() // æ˜¾ç¤ºç”¨æ³•ä¿¡æ¯
flag.NFlag() // è¿”å›å·²è®¾ç½®çš„flagæ•°é‡
flag.NArg()  // è¿”å›éflagå‚æ•°çš„æ•°é‡
flag.Arg(i)  // è·å–ç¬¬iä¸ªéflagå‚æ•°```
</code></pre>
<h2 id="3-regexp-">3 regexp åŒ… - æ­£åˆ™è¡¨è¾¾å¼</h2>
<h3 id="31_2">3.1 åŸºæœ¬åŒ¹é…</h3>
<pre><code class="language-go">// ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼
re := regexp.MustCompile(`\d+`) // åŒ¹é…æ•°å­—

// æ£€æŸ¥æ˜¯å¦åŒ¹é…
matched := re.MatchString(&quot;123abc&quot;) // true
matched = re.Match([]byte(&quot;abc&quot;))   // false

// æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…
first := re.FindString(&quot;abc123def456&quot;) // &quot;123&quot;

// æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…
all := re.FindAllString(&quot;abc123def456&quot;, -1) // [&quot;123&quot;, &quot;456&quot;]
</code></pre>
<h3 id="32_2">3.2 åˆ†ç»„æ•è·</h3>
<pre><code class="language-go">re := regexp.MustCompile(`(\d+)-(\d+)`)
str := &quot;123-456&quot;

// æå–åˆ†ç»„
matches := re.FindStringSubmatch(str)
// matches[0] = &quot;123-456&quot; (å®Œæ•´åŒ¹é…)
// matches[1] = &quot;123&quot; (ç¬¬ä¸€ä¸ªåˆ†ç»„)
// matches[2] = &quot;456&quot; (ç¬¬äºŒä¸ªåˆ†ç»„)

// å‘½ååˆ†ç»„
re = regexp.MustCompile(`(?P&lt;year&gt;\d{4})-(?P&lt;month&gt;\d{2})`)
match := re.FindStringSubmatch(&quot;2023-08&quot;)
for i, name := range re.SubexpNames() {
    if i != 0 &amp;&amp; name != &quot;&quot; {
        fmt.Printf(&quot;%s: %s\n&quot;, name, match[i])
    }
}
</code></pre>
<h3 id="33_2">3.3 æ›¿æ¢ä¸åˆ†å‰²</h3>
<pre><code class="language-go">re := regexp.MustCompile(`\d+`)

// æ›¿æ¢
result := re.ReplaceAllString(&quot;abc123def456&quot;, &quot;X&quot;) // &quot;abcXdefX&quot;

// ä½¿ç”¨å‡½æ•°æ›¿æ¢
result = re.ReplaceAllStringFunc(&quot;abc123def456&quot;, func(s string) string {
    return &quot;[&quot; + s + &quot;]&quot;
}) // &quot;abc[123]def[456]&quot;

// åˆ†å‰²
parts := re.Split(&quot;abc123def456ghi789&quot;, -1) // [&quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;, &quot;&quot;]
</code></pre>
<h3 id="34">3.4 å…¶ä»–æ–¹æ³•</h3>
<pre><code class="language-go">re.QuoteMeta(`.+?`) // è¿”å›è½¬ä¹‰åçš„æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸² `\.\+\?`
re.NumSubexp()      // è¿”å›æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„åˆ†ç»„æ•°é‡
re.String()         // è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²è¡¨ç¤º
</code></pre>
<h1 id="osiofilepath">ğŸ“š å†…ç½®åŒ…ï¼šæ–‡ä»¶ç›¸å…³ï¼ˆos/io/filepath...ï¼‰</h1>
<h2 id="1-os">1 os åŒ…</h2>
<h3 id="11_3">1.1 æ–‡ä»¶æ“ä½œ</h3>
<pre><code class="language-go">// æ‰“å¼€æ–‡ä»¶
func Open(name string) (*File, error)
func OpenFile(name string, flag int, perm FileMode) (*File, error)

// åˆ›å»ºæ–‡ä»¶
func Create(name string) (*File, error)

// æ–‡ä»¶ä¿¡æ¯
func Stat(name string) (FileInfo, error)
func Lstat(name string) (FileInfo, error) // ä¸è·Ÿéšç¬¦å·é“¾æ¥

// åˆ é™¤/é‡å‘½å
func Remove(name string) error  // åˆ é™¤æ–‡ä»¶å¤¹æ—¶ï¼Œå¦‚æœæ–‡ä»¶å¤¹ä¸‹ä¸ä¸ºç©ºï¼Œä¼šæŠ¥é”™
func RemoveAll(path string) error  // å¼ºåˆ¶åˆ é™¤ï¼Œåˆ é™¤æ–‡ä»¶å¤¹æ—¶ï¼Œç›´æ¥åˆ é™¤è¯¥æ–‡ä»¶å¤¹åŠå…¨éƒ¨å­æ–‡ä»¶
func Rename(oldpath, newpath string) error

// æƒé™
func Chmod(name string, mode FileMode) error
func Chown(name string, uid, gid int) error
func Chtimes(name string, atime time.Time, mtime time.Time) error

// åˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹
file, _ := os.stat(&quot;/temp/test&quot;)
tf := file.IsDir() // è¿”å›boolç±»å‹

// å…¶ä»–
func Truncate(name string, size int64) error
func Readlink(name string) (string, error) // è¯»å–ç¬¦å·é“¾æ¥
func Symlink(oldname, newname string) error
</code></pre>
<h3 id="12_3">1.2 ç›®å½•æ“ä½œ</h3>
<pre><code class="language-go">func Mkdir(name string, perm FileMode) error  // å•çº§ç›®å½•åˆ›å»º,å·²å­˜åœ¨ä¼šæŠ¥é”™
func MkdirAll(path string, perm FileMode) error // å¤šçº§ç›®å½•åˆ›å»ºï¼Œå·²å­˜åœ¨ä¸ä¼šæŠ¥é”™
func ReadDir(name string) ([]DirEntry, error) // æ›¿ä»£ioutil.ReadDir
</code></pre>
<h3 id="13_3">1.3 æ–‡ä»¶å¯¹è±¡æ–¹æ³•</h3>
<pre><code class="language-go">type File struct {
    // æœªå¯¼å‡ºå­—æ®µ
}

func (f *File) Close() error
func (f *File) Read(b []byte) (n int, err error)
func (f *File) ReadAt(b []byte, off int64) (n int, err error)
func (f *File) Write(b []byte) (n int, err error)
func (f *File) WriteAt(b []byte, off int64) (n int, err error)
func (f *File) Seek(offset int64, whence int) (ret int64, err error)
func (f *File) Sync() error
func (f *File) Stat() (FileInfo, error)
</code></pre>
<h2 id="2-pathfilepath">2 path/filepath åŒ…</h2>
<h3 id="21_2">2.1 å¤„ç†è·¨å¹³å°çš„æ–‡ä»¶è·¯å¾„</h3>
<pre><code class="language-go">// è·¯å¾„æ‹¼æ¥
func Join(elem ...string) string

// è·¯å¾„åˆ†å‰²
func Split(path string) (dir, file string)
func Dir(path string) string
func Base(path string) string
func Ext(path string) string

// è·¯å¾„æ¸…ç†
func Clean(path string) string
func ToSlash(path string) string
func FromSlash(path string) string

// ç»å¯¹è·¯å¾„
func Abs(path string) (string, error)
func Rel(basepath, targpath string) (string, error)
////ç»å¯¹è·¯å¾„ç¤ºä¾‹
absPath, _ := filepath.Abs(&quot;test/src&quot;)  // è¿”å›é¡¹ç›®ç›®å½•+å…¥å‚å­—ç¬¦

// è·¯å¾„åŒ¹é…
func Match(pattern, name string) (matched bool, err error)
func Glob(pattern string) (matches []string, err error)

// éå†ç›®å½•
func Walk(root string, fn WalkFunc) error
func WalkDir(root string, fn fs.WalkDirFunc) error // æ›´é«˜æ•ˆ
////éå†ç›®å½•ç¤ºä¾‹
_ = filepath.Walk(projectPath, func(path string, info os.FileInfo, err error) error {
        if !info.IsDir() {
            fmt.Println(path)
        }
        return nil
    })

_ = filepath.WalkDir(projectPath, func(path string, de fs.DirEntry, err error) error {
    if !de.IsDir() {
        fmt.Println(path)
    }
    return nil
})


// è·å–ä¸Šä¸€çº§ç›®å½•
filepath.Dir(&quot;/temp/test/src&quot;) // è¿”å›:/temp/test
</code></pre>
<h2 id="3-io">3 io åŒ…</h2>
<h3 id="31-io">3.1 åŸºç¡€IOæ¥å£å’Œå·¥å…·å‡½æ•°</h3>
<pre><code class="language-go">// åŸºç¡€æ¥å£
type Reader interface {
    Read(p []byte) (n int, err error)
}
type Writer interface {
    Write(p []byte) (n int, err error)
}
type Closer interface {
    Close() error
}
type Seeker interface {
    Seek(offset int64, whence int) (int64, error)
}

// ç»„åˆæ¥å£
type ReadWriter interface { Reader; Writer }
type ReadCloser interface { Reader; Closer }
type WriteCloser interface { Writer; Closer }
type ReadWriteCloser interface { Reader; Writer; Closer }
type ReadSeeker interface { Reader; Seeker }
type ReadSeekCloser interface { Reader; Seeker; Closer }

// å·¥å…·å‡½æ•°
func Copy(dst Writer, src Reader) (written int64, err error)
func CopyN(dst Writer, src Reader, n int64) (written int64, err error)
func ReadAll(r Reader) ([]byte, error)
func ReadAtLeast(r Reader, buf []byte, min int) (n int, err error)
func ReadFull(r Reader, buf []byte) (n int, err error)
func WriteString(w Writer, s string) (n int, err error)
</code></pre>
<h2 id="4-iofs">4 io/fs åŒ…</h2>
<h3 id="41-go-116">4.1 æ–‡ä»¶ç³»ç»ŸæŠ½è±¡æ¥å£(go 1.16+)</h3>
<pre><code class="language-go">type FS interface {
    Open(name string) (File, error)
}

type File interface {
    Stat() (FileInfo, error)
    Read([]byte) (int, error)
    Close() error
}

type FileInfo interface {
    Name() string       // æ–‡ä»¶å
    Size() int64        // æ–‡ä»¶å¤§å°
    Mode() FileMode     // æ–‡ä»¶æ¨¡å¼
    ModTime() time.Time // ä¿®æ”¹æ—¶é—´
    IsDir() bool        // æ˜¯å¦æ˜¯ç›®å½•
    Sys() interface{}   // åº•å±‚æ•°æ®æº
}

type DirEntry interface {
    Name() string
    IsDir() bool
    Type() FileMode
    Info() (FileInfo, error)
}
</code></pre>
<h1 id="_16">ğŸ“š æ–‡ä»¶è¯»å†™</h1>
<h2 id="1_15">1 æ™®é€šè¯»å†™æ–¹å¼</h2>
<pre><code class="language-go">func main() {
    words := &quot;ZHEæ˜¯ä¸€æ®µbeiä¼¤çš„æ•…äº‹~~å•Šï¼&quot;
    reader := strings.NewReader(words)
    totalBytes := make([]byte, 0)
    for {
        buf := make([]byte, 4)     // ç¼“å†²åŒºæ¯æ¬¡è¯»å–4ä¸ªå­—èŠ‚
        n, err := reader.Read(buf) // ä½¿ç”¨ç¼“å†²åŒºè¯»å–å†…å®¹ï¼›nä¸ºæ¯æ¬¡è¯»å–å­—èŠ‚æ•°
        if err != nil {
            if err == io.EOF {
                fmt.Printf(&quot;readerå¯¹è±¡å…¨éƒ¨å†…å®¹è¯»å–å®Œæ¯•ï¼Œn=%vï¼›è¯»å–å†…å®¹ï¼š%s\n&quot;, n, buf)
                break
            }
            panic(err)
        }

        fmt.Printf(&quot;æœ¬æ¬¡è¯»å–ï¼šn=%vï¼›å†…å®¹ï¼š%s\n&quot;, n, buf)
        totalBytes = append(totalBytes, buf...)
    }
    fmt.Printf(&quot;å…¨éƒ¨å†…å®¹ï¼š%s&quot;, totalBytes)
}
</code></pre>
<h3 id="12-read">1.2 è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆReadï¼‰</h3>
<pre><code class="language-go">/**/

package main

import (
    &quot;fmt&quot;
    &quot;io&quot;
    &quot;log&quot;
    &quot;os&quot;
)

func CusReadFile(filename string) []byte {
    file, err := os.Open(filename)
    if err != nil {
        log.Fatal(&quot;è¯»å–æ–‡ä»¶é”™è¯¯&quot;)
        return nil
    }

    defer file.Close()

    totalBytes := make([]byte, 0)

    for {
        buf := make([]byte, 1024)  // æ¯æ¬¡è¯»å–ç¼“å†²å¤§å°
        _, err = file.Read(buf)
        if err != nil {
            if err == io.EOF {
                fmt.Println(&quot;fileå¯¹è±¡è¯»å–å®Œæ¯•&quot;)
                break
            }
            log.Fatal(&quot;è¯»å–æ–‡ä»¶å¤±è´¥&quot;)
        }

        totalBytes = append(totalBytes, buf...)
    }

    return totalBytes
}

func main() {
    contentByte := CusReadFile(&quot;test.txt&quot;)
    fmt.Printf(&quot;%s&quot;, contentByte)
}

</code></pre>
<p>å½“ç„¶ï¼Œä¸€èˆ¬æˆ‘ä»¬çœŸæ­£è¯»å–æ–‡ä»¶ä¸éœ€è¦è‡ªå·±é‡æ–°å†™å¸¦ç¼“å†²åŒºçš„å‡½æ•°ï¼Œä½¿ç”¨ç°æœ‰çš„bufioåŒ…çš„æ–¹æ³•å³å¯ï¼š</p>
<p><strong>åˆ†è¡Œè¯»å–ï¼š</strong></p>
<pre><code class="language-go">/**/

package main

import (
    &quot;bufio&quot;
    &quot;fmt&quot;
    &quot;log&quot;
    &quot;os&quot;
)

func CusReadFile(filename string) {
    file, err := os.Open(filename)
    if err != nil {
        log.Fatal(&quot;è¯»å–æ–‡ä»¶é”™è¯¯&quot;)
    }

    defer file.Close()

    reader := bufio.NewReader(file)
    for {
        line, _, err := reader.ReadLine()
        if err != nil {
            break
        }
        fmt.Println(string(line))
    }
}

func main() {
    CusReadFile(&quot;djangoServer.log&quot;)
}

</code></pre>
<p><strong>ä¸€æ¬¡æ€§è¯»å–ï¼ˆä¸é€‚åˆå¤§æ–‡ä»¶ï¼‰</strong>ï¼š</p>
<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;os&quot;
)

func CusReadFile(filename string) {
    file, err := os.Open(filename)
    if err != nil {
        fmt.Println(&quot;æ‰“å¼€æ–‡ä»¶å¤±è´¥:&quot;, err)
        return
    }
    defer file.Close()

    stat, err := file.Stat()
    if err != nil {
        fmt.Println(&quot;è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥:&quot;, err)
        return
    }

    buf := make([]byte, stat.Size())
    _, err = file.Read(buf) // è®°å½•å®é™…è¯»å–çš„å­—èŠ‚æ•°
    if err != nil {
        fmt.Println(&quot;è¯»å–æ–‡ä»¶å¤±è´¥:&quot;, err)
        return
    }

    fmt.Println(string(buf))
}

func main() {
    CusReadFile(&quot;djangoServer.log&quot;)
}

</code></pre>
<pre><code class="language-go">func ReadFile(name string) ([]byte, error) {}
</code></pre>
<h3 id="13-write">1.3 å†™å…¥æ–‡ä»¶å†…å®¹ï¼ˆWriteï¼‰</h3>
<pre><code class="language-go">/**/

package main

import (
    &quot;log&quot;
    &quot;os&quot;
)

func CusWriteFile(content string, filename string) {
    file, err := os.Create(filename)
    if err != nil {
        log.Fatal(err)
    }
    defer file.Close()  // å…³é—­æ–‡ä»¶

    _, err = file.Write([]byte(content))
    if err != nil {
        log.Fatal(err)
    }
}

func main() {
    CusWriteFile(&quot;ä»Šæ™šæˆ‘è¦ç¡ä½ å®¶~&quot;, &quot;test.txt&quot;)
}

</code></pre>
<p>ç›´æ¥å†™å…¥å†…å®¹ä¾¿æ·å‡½æ•°ï¼šos.WriteFile()</p>
<pre><code class="language-go">func WriteFile(name string, data []byte, perm FileMode) error {}
</code></pre>
<h3 id="14-seeker">1.4 å†™å…¥æ–‡ä»¶ä½ç½®ï¼ˆSeekerï¼‰</h3>
<h4 id="141">1.4.1 æ–‡ä»¶æ‰“å¼€æ¨¡å¼</h4>
<pre><code class="language-go">const (
    O_RDONLY int = syscall.O_RDONLY // åªè¯»æ¨¡å¼
    O_WRONLY int = syscall.O_WRONLY // åªå†™æ¨¡å¼
    O_RDWR   int = syscall.O_RDWR   // è¯»å†™æ¨¡å¼
    O_APPEND int = syscall.O_APPEND // è¿½åŠ æ¨¡å¼
    O_CREATE int = syscall.O_CREAT  // å¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º
    O_EXCL   int = syscall.O_EXCL   // ä¸O_CREATEä¸€èµ·ä½¿ç”¨ï¼Œæ–‡ä»¶å¿…é¡»ä¸å­˜åœ¨
    O_SYNC   int = syscall.O_SYNC   // åŒæ­¥IO
    O_TRUNC  int = syscall.O_TRUNC  // æ‰“å¼€æ—¶æ¸…ç©ºæ–‡ä»¶
)
</code></pre>
<table>
<thead>
<tr>
<th style="text-align: left;">æ¨¡å¼ç»„åˆ</th>
<th style="text-align: left;">æè¿°</th>
<th style="text-align: left;">ç­‰æ•ˆäºå…¶ä»–è¯­è¨€</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>os.O_RDONLY</code></td>
<td style="text-align: left;">åªè¯»æ‰“å¼€</td>
<td style="text-align: left;">"r"</td>
</tr>
<tr>
<td style="text-align: left;"><code>os.O_WRONLYï½œos.O_CREATEï½œos.O_TRUNC</code></td>
<td style="text-align: left;">åªå†™ï¼Œåˆ›å»ºï¼Œæ¸…ç©º</td>
<td style="text-align: left;">"w"</td>
</tr>
<tr>
<td style="text-align: left;"><code>os.O_WRONLYï½œos.O_CREATEï½œos.O_APPEND</code></td>
<td style="text-align: left;">åªå†™ï¼Œåˆ›å»ºï¼Œè¿½åŠ </td>
<td style="text-align: left;">"a"</td>
</tr>
<tr>
<td style="text-align: left;"><code>os.O_RDWRï½œos.O_CREATE</code></td>
<td style="text-align: left;">è¯»å†™ï¼Œåˆ›å»º</td>
<td style="text-align: left;">"r+"</td>
</tr>
<tr>
<td style="text-align: left;"><code>os.O_RDWRï½œos.O_CREATEï½œos.O_TRUNC</code></td>
<td style="text-align: left;">è¯»å†™ï¼Œåˆ›å»ºï¼Œæ¸…ç©º</td>
<td style="text-align: left;">"w+"</td>
</tr>
<tr>
<td style="text-align: left;"><code>os.O_RDWRï½œos.O_CREATEï½œos.O_APPEND</code></td>
<td style="text-align: left;">è¯»å†™ï¼Œåˆ›å»ºï¼Œè¿½åŠ </td>
<td style="text-align: left;">"a+"</td>
</tr>
</tbody>
</table>
<h4 id="142">1.4.2 æ–‡ä»¶æƒé™æ¨¡å¼</h4>
<p><strong>Goä½¿ç”¨Unixé£æ ¼çš„æƒé™ä½</strong>ï¼š</p>
<pre><code class="language-go">const (
    // åŸºæœ¬æƒé™ä½
    ModeDir        = fs.ModeDir        // ç›®å½•
    ModeAppend     = fs.ModeAppend     // åªèƒ½è¿½åŠ 
    ModeExclusive  = fs.ModeExclusive  // ç‹¬å ä½¿ç”¨
    ModeTemporary  = fs.ModeTemporary  // ä¸´æ—¶æ–‡ä»¶
    ModeSymlink    = fs.ModeSymlink    // ç¬¦å·é“¾æ¥
    ModeDevice     = fs.ModeDevice     // è®¾å¤‡æ–‡ä»¶
    ModeNamedPipe  = fs.ModeNamedPipe  // å‘½åç®¡é“
    ModeSocket     = fs.ModeSocket     // UnixåŸŸsocket
    ModeSetuid     = fs.ModeSetuid     // set uid
    ModeSetgid     = fs.ModeSetgid     // set gid
    ModeCharDevice = fs.ModeCharDevice // å­—ç¬¦è®¾å¤‡
    ModeSticky     = fs.ModeSticky     // sticky bit
    ModeIrregular  = fs.ModeIrregular  // éå¸¸è§„æ–‡ä»¶

    // æƒé™ä½æ©ç 
    ModeType = fs.ModeType        // æ–‡ä»¶ç±»å‹ä½
    ModePerm = fs.ModePerm        // æƒé™ä½ (rwxrwxrwx)
)
</code></pre>
<p><strong>å¸¸ç”¨æƒé™å€¼</strong>ï¼š</p>
<ul>
<li><code>0644</code>ï¼šç”¨æˆ·è¯»å†™ï¼Œç»„å’Œå…¶ä»–åªè¯»</li>
<li><code>0755</code>ï¼šç”¨æˆ·è¯»å†™æ‰§è¡Œï¼Œç»„å’Œå…¶ä»–è¯»æ‰§è¡Œ</li>
<li><code>0600</code>ï¼šä»…ç”¨æˆ·è¯»å†™</li>
</ul>
<h4 id="143-seeker">1.4.3 Seeker</h4>
<p>æºç ä¸­çš„å®šä¹‰ï¼š</p>
<pre><code class="language-go">type Seeker interface {
    Seek(offset int64, whence int) (int64, error)
}

// whenceï¼šæ–°åç§»é‡èµ·å§‹å€¼
// offsetï¼šåŸºäºèµ·å§‹å€¼åç§»é‡

// Seek whence values.
const (
    SeekStart   = 0 // åŸºäºæ–‡ä»¶å¼€å§‹ä½ç½®
    SeekCurrent = 1 // åŸºäºå½“å‰åç§»é‡
    SeekEnd     = 2 // åŸºäºæ–‡ä»¶ç»“æŸä½ç½®
)
</code></pre>
<pre><code class="language-go">/**/

package main

import (
    &quot;fmt&quot;
    &quot;io&quot;
    &quot;log&quot;
    &quot;os&quot;
)

func CusSeekFile(content string, filename string) {
    file, err := os.OpenFile(filename, os.O_RDWR|os.O_CREATE, 655)
    if err != nil {
        log.Fatal(err)
    }
    defer file.Close()

    seek, err := file.Seek(2, io.SeekStart) // è®¾ç½®æ–‡ä»¶å†™å…¥ä½ç½®ç›¸å¯¹å¼€å§‹ä½ç½®åç§»é‡ï¼š2ä¸ªå­—èŠ‚
    if err != nil {
        log.Fatal(err)
    }
    fmt.Println(&quot;å½“å‰åç§»é‡seek:&quot;, seek)

    file.Write([]byte(content))

    seek, _ = file.Seek(0, io.SeekCurrent) // è¿”å›å½“å‰åç§»é‡ï¼š18=2+15+1ï¼ˆ2+len(byte[]('ä»Šæ™šæ‰“è€è™~'))ï¼‰
    fmt.Println(&quot;å½“å‰åç§»é‡seek:&quot;, seek)

    seek, _ = file.Seek(-16, io.SeekCurrent) // è¿”å›å½“å‰åç§»é‡-16=2 -&gt;æ±‰å­—å 3ä¸ªå­—èŠ‚ï¼Œå¦‚ä¸åŒ¹é…ä¼šä¹±ç 
    fmt.Println(&quot;å½“å‰åç§»é‡seek:&quot;, seek)

    file.Write([]byte(&quot;ä½ å¥½å•Šå•Š&quot;)) // æ­¤æ—¶å†™å…¥ä¼šè¦†ç›–å·²æœ‰ç›¸åŒé•¿åº¦çš„å­—ç¬¦å†…å®¹ï¼Œå¤šä½™éƒ¨åˆ†ä»ç„¶ä¸å˜

}

func main() {
    CusSeekFile(&quot;ä»Šæ™šæ‰“è€è™~&quot;,&quot;test.txt&quot;)
}

</code></pre>
<h2 id="2-bufio">2 é«˜æ•ˆç¼“å†²è¯»å†™åŒ…-bufio</h2>
<p><strong>bufio çš„ä¸»è¦ä¼˜åŠ¿ï¼š</strong></p>
<ol>
<li><strong>æ€§èƒ½æå‡</strong>ï¼šå‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œå¤§å¹…æé«˜ I/O æ€§èƒ½</li>
<li><strong>ä¾¿æ·çš„API</strong>ï¼šæä¾› <code>Scanner</code> ç­‰é«˜çº§æ¥å£ï¼Œç®€åŒ–å¸¸è§æ“ä½œ</li>
<li><strong>å†…å­˜æ•ˆç‡</strong>ï¼šé€šè¿‡ç¼“å†²å‡å°‘å†…å­˜åˆ†é…å’Œæ‹·è´</li>
<li><strong>çµæ´»æ€§</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰åˆ†å‰²å‡½æ•°å’Œè¯»å†™æ“ä½œ</li>
</ol>
<p><strong>ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ol>
<li><strong>è®°å¾—è°ƒç”¨ Flush()</strong>ï¼šå¯¹äºå†™å…¥æ“ä½œï¼Œç¡®ä¿åœ¨ç»“æŸæ—¶è°ƒç”¨ <code>Flush()</code></li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šæ€»æ˜¯æ£€æŸ¥ <code>Scanner.Err()</code> å’Œ <code>Writer</code> çš„é”™è¯¯</li>
<li><strong>ç¼“å†²åŒºå¤§å°</strong>ï¼šå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ç¼“å†²åŒºå¤§å°</li>
<li><strong>èµ„æºé‡Šæ”¾</strong>ï¼šåŠæ—¶å…³é—­åº•å±‚èµ„æº</li>
</ol>
<p><code>bufio</code> åŒ…æ˜¯ Go è¯­è¨€ä¸­å¤„ç† I/O æ“ä½œçš„é‡è¦å·¥å…·ï¼Œåœ¨éœ€è¦é«˜æ•ˆè¯»å†™æ•°æ®çš„åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ã€‚</p>
<h3 id="21_3">2.1 é«˜æ•ˆè¯»å–æ–‡ä»¶ï¼ˆé€è¡Œè¯»å–ï¼‰</h3>
<p>è¿™æ˜¯ <code>bufio</code> æœ€å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯å¤„ç†æ–‡æœ¬æ–‡ä»¶ï¼š</p>
<pre><code class="language-go">package main

import (
    &quot;bufio&quot;
    &quot;fmt&quot;
    &quot;os&quot;
    &quot;log&quot;
)

func readFileByLine(filename string) error {
    file, err := os.Open(filename)
    if err != nil {
        return err
    }
    defer file.Close()

    scanner := bufio.NewScanner(file)
    lineNumber := 1

    for scanner.Scan() {
        line := scanner.Text()
        fmt.Printf(&quot;%d: %s\n&quot;, lineNumber, line)
        lineNumber++
    }

    return scanner.Err()
}

func main() {
    err := readFileByLine(&quot;data.txt&quot;)
    if err != nil {
        log.Fatal(err)
    }
}
</code></pre>
<h3 id="22_2">2.2 å¤„ç†æ ‡å‡†è¾“å…¥</h3>
<p>ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®æ—¶ï¼Œä½¿ç”¨ç¼“å†²å¯ä»¥æé«˜æ•ˆç‡ï¼š</p>
<pre><code class="language-go">package main

import (
    &quot;bufio&quot;
    &quot;fmt&quot;
    &quot;os&quot;
    &quot;strings&quot;
)

func readStdin() {
    scanner := bufio.NewScanner(os.Stdin)
    fmt.Println(&quot;è¯·è¾“å…¥å†…å®¹ï¼ˆè¾“å…¥ 'exit' é€€å‡ºï¼‰:&quot;)

    for scanner.Scan() {
        input := scanner.Text()
        if strings.ToLower(input) == &quot;exit&quot; {
            break
        }
        fmt.Println(&quot;æ‚¨è¾“å…¥çš„æ˜¯:&quot;, input)
    }
}

func main() {
    readStdin()
}
</code></pre>
<h3 id="23_2">2.3 ç½‘ç»œç¼–ç¨‹ä¸­çš„ç¼“å†²è¯»å†™</h3>
<p>åœ¨å¤„ç†ç½‘ç»œè¿æ¥æ—¶ï¼Œç¼“å†²è¯»å†™éå¸¸é‡è¦ï¼š</p>
<pre><code class="language-go">package main

import (
    &quot;bufio&quot;
    &quot;fmt&quot;
    &quot;net&quot;
    &quot;strings&quot;
)

func handleConnection(conn net.Conn) {
    defer conn.Close()

    reader := bufio.NewReader(conn)
    writer := bufio.NewWriter(conn)

    for {
        // è¯»å–ç›´åˆ°æ¢è¡Œç¬¦
        message, err := reader.ReadString('\n')
        if err != nil {
            break
        }

        message = strings.TrimSpace(message)
        fmt.Printf(&quot;æ”¶åˆ°æ¶ˆæ¯: %s\n&quot;, message)

        // ç¼“å†²å†™å…¥
        response := fmt.Sprintf(&quot;æœåŠ¡å™¨å›å¤: %s\n&quot;, strings.ToUpper(message))
        writer.WriteString(response)
        writer.Flush() // é‡è¦ï¼šç¡®ä¿æ•°æ®è¢«å‘é€
    }
}
</code></pre>
<h3 id="24_1">2.4 é«˜æ€§èƒ½æ–‡ä»¶å†™å…¥</h3>
<p>å½“éœ€è¦é¢‘ç¹å†™å…¥å°é‡æ•°æ®æ—¶ï¼Œä½¿ç”¨ç¼“å†²å¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ï¼š</p>
<pre><code class="language-go">package main

import (
    &quot;bufio&quot;
    &quot;os&quot;
)

func writeWithBuffer(filename string, lines []string) error {
    file, err := os.Create(filename)
    if err != nil {
        return err
    }
    defer file.Close()

    writer := bufio.NewWriter(file)
    defer writer.Flush() // ç¡®ä¿æ‰€æœ‰æ•°æ®è¢«å†™å…¥

    for _, line := range lines {
        _, err := writer.WriteString(line + &quot;\n&quot;)
        if err != nil {
            return err
        }
    }

    return nil
}

func main() {
    lines := []string{&quot;ç¬¬ä¸€è¡Œ&quot;, &quot;ç¬¬äºŒè¡Œ&quot;, &quot;ç¬¬ä¸‰è¡Œ&quot;}
    err := writeWithBuffer(&quot;output.txt&quot;, lines)
    if err != nil {
        panic(err)
    }
}
</code></pre>
<h3 id="25">2.5 è¯»å–ç‰¹å®šåˆ†éš”ç¬¦çš„æ•°æ®</h3>
<p><code>bufio.Scanner</code> å¯ä»¥è‡ªå®šä¹‰åˆ†å‰²å‡½æ•°ï¼š</p>
<pre><code class="language-go">package main

import (
    &quot;bufio&quot;
    &quot;bytes&quot;
    &quot;fmt&quot;
    &quot;strings&quot;
)

func readCSVData(csvData string) {
    scanner := bufio.NewScanner(strings.NewReader(csvData))

    // è‡ªå®šä¹‰åˆ†å‰²å‡½æ•°ï¼ŒæŒ‰é€—å·åˆ†å‰²
    split := func(data []byte, atEOF bool) (advance int, token []byte, err error) {
        if atEOF &amp;&amp; len(data) == 0 {
            return 0, nil, nil
        }

        if i := bytes.IndexByte(data, ','); i &gt;= 0 {
            return i + 1, data[0:i], nil
        }

        if atEOF {
            return len(data), data, nil
        }

        return 0, nil, nil
    }

    scanner.Split(split)

    for scanner.Scan() {
        fmt.Printf(&quot;å­—æ®µ: %s\n&quot;, scanner.Text())
    }
}

func main() {
    csvData := &quot;å¼ ä¸‰,25,ç¨‹åºå‘˜,åŒ—äº¬\næå››,30,è®¾è®¡å¸ˆ,ä¸Šæµ·&quot;
    readCSVData(csvData)
}
</code></pre>
<h3 id="26">2.6 è¯»å–å›ºå®šå¤§å°çš„æ•°æ®å—</h3>
<p>ä½¿ç”¨ <code>bufio.Reader</code> è¯»å–ç‰¹å®šå¤§å°çš„æ•°æ®ï¼š</p>
<pre><code class="language-go">package main

import (
    &quot;bufio&quot;
    &quot;fmt&quot;
    &quot;os&quot;
)

func readInChunks(filename string, chunkSize int) error {
    file, err := os.Open(filename)
    if err != nil {
        return err
    }
    defer file.Close()

    reader := bufio.NewReader(file)
    chunk := make([]byte, chunkSize)
    chunkCount := 0

    for {
        n, err := reader.Read(chunk)
        if err != nil {
            break
        }
        chunkCount++
        fmt.Printf(&quot;å— %d: %d å­—èŠ‚\n&quot;, chunkCount, n)
        // å¤„ç† chunk[0:n] çš„æ•°æ®
    }

    return nil
}

func main() {
    err := readInChunks(&quot;largefile.bin&quot;, 4096)
    if err != nil {
        panic(err)
    }
}
</code></pre>
<h3 id="27">2.7 æ€§èƒ½æ•æ„Ÿçš„æ—¥å¿—å¤„ç†</h3>
<p>åœ¨é«˜æ€§èƒ½æ—¥å¿—å¤„ç†ä¸­ä½¿ç”¨ç¼“å†²ï¼š</p>
<pre><code class="language-go">package main

import (
    &quot;bufio&quot;
    &quot;os&quot;
    &quot;time&quot;
)

type Logger struct {
    writer *bufio.Writer
}

func NewLogger(filename string) (*Logger, error) {
    file, err := os.OpenFile(filename, os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)
    if err != nil {
        return nil, err
    }

    writer := bufio.NewWriter(file)

    return &amp;Logger{writer: writer}, nil
}

func (l *Logger) Log(message string) error {
    timestamp := time.Now().Format(&quot;2006-01-02 15:04:05&quot;)
    logEntry := fmt.Sprintf(&quot;[%s] %s\n&quot;, timestamp, message)

    _, err := l.writer.WriteString(logEntry)
    return err
}

func (l *Logger) Flush() error {
    return l.writer.Flush()
}

func (l *Logger) Close() error {
    l.Flush()
    // å®é™…é¡¹ç›®ä¸­åº”è¯¥å…³é—­åº•å±‚æ–‡ä»¶
    return nil
}
</code></pre>
<h1 id="_17">ğŸ“š æ—¥å¿—ç›¸å…³å†…å®¹</h1>
<h2 id="1-log">1 è‡ªå®šä¹‰Logè®°å½•å™¨</h2>
<pre><code class="language-go">/**/

package utils

import (
    &quot;fmt&quot;
    &quot;gopkg.in/natefinch/lumberjack.v2&quot;
    &quot;io&quot;
    &quot;log&quot;
    &quot;os&quot;
    &quot;path/filepath&quot;
    &quot;runtime&quot;
    &quot;time&quot;
)

// LogLevel å®šä¹‰æ—¥å¿—çº§åˆ«ç±»å‹
type LogLevel int

const (
    DEBUG LogLevel = iota
    INFO
    WARN
    ERROR
    FATAL
)

var levelStrings = [...]string{
    &quot;DEBUG&quot;,
    &quot;INFO&quot;,
    &quot;WARN&quot;,
    &quot;ERROR&quot;,
    &quot;FATAL&quot;,
}

type CustomLogger struct {
    *log.Logger
    fileWriter io.Writer
}

// NewCustomLogger åˆ›å»ºæ—¥å¿—å®ä¾‹
// console: æ˜¯å¦è¾“å‡ºåˆ°æ§åˆ¶å°
// filePath: æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œç©ºå­—ç¬¦ä¸²è¡¨ç¤ºä¸å†™å…¥æ–‡ä»¶
func NewCustomLogger(console bool, filePath string) *CustomLogger {
    var writers []io.Writer

    // 1. æ–‡ä»¶è¾“å‡ºé…ç½®
    if filePath != &quot;&quot; {
        fileWriter := &amp;lumberjack.Logger{
            Filename:   filePath,
            MaxSize:    20,    // æ¯ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§å°ºå¯¸(MB)
            MaxBackups: 7,     // ä¿ç•™æ—§æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§æ•°é‡
            MaxAge:     7,     // ä¿ç•™æ—§æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤©æ•°
            Compress:   false, // æ˜¯å¦å‹ç¼©æ—§æ—¥å¿—æ–‡ä»¶
            LocalTime:  true,  // ä½¿ç”¨æœ¬åœ°æ—¶é—´
        }
        writers = append(writers, fileWriter)
    }

    // 2. æ§åˆ¶å°è¾“å‡ºé…ç½®
    if console {
        writers = append(writers, os.Stdout)
    }

    // 3. åˆ›å»ºå¤šè¾“å‡ºwriter
    var output io.Writer
    if len(writers) == 0 {
        output = io.Discard // æ— è¾“å‡º
    } else if len(writers) == 1 {
        output = writers[0]
    } else {
        output = io.MultiWriter(writers...)
    }

    return &amp;CustomLogger{
        Logger:     log.New(output, &quot;&quot;, 0),
        fileWriter: writers[0], // ä¿å­˜æ–‡ä»¶writerå¼•ç”¨
    }
}

// åŸºç¡€æ—¥å¿—æ–¹æ³•
func (l *CustomLogger) log(level LogLevel, format string, v ...interface{}) {
    _, file, line, ok := runtime.Caller(3) // è°ƒæ•´è°ƒç”¨æ ˆå±‚çº§
    if !ok {
        file = &quot;???&quot;
        line = 0
    } else {
        file = filepath.Base(file)
    }

    timestamp := time.Now().Format(&quot;2006-01-02 15:04:05.000&quot;)
    prefix := fmt.Sprintf(&quot;%s %s:%d %s |&quot;, timestamp, file, line, levelStrings[level])

    var msg string
    if format == &quot;&quot; {
        msg = fmt.Sprint(v...)
    } else {
        msg = fmt.Sprintf(format, v...)
    }

    l.Logger.Printf(&quot;%s %s&quot;, prefix, msg)
}

// æ™®é€šæ—¥å¿—æ–¹æ³•
func (l *CustomLogger) Debug(v ...interface{}) { l.log(DEBUG, &quot;&quot;, v...) }
func (l *CustomLogger) Info(v ...interface{})  { l.log(INFO, &quot;&quot;, v...) }
func (l *CustomLogger) Warn(v ...interface{})  { l.log(WARN, &quot;&quot;, v...) }
func (l *CustomLogger) Error(v ...interface{}) { l.log(ERROR, &quot;&quot;, v...) }
func (l *CustomLogger) Fatal(v ...interface{}) { l.log(FATAL, &quot;&quot;, v...); os.Exit(1) }

// æ ¼å¼åŒ–æ—¥å¿—æ–¹æ³•
func (l *CustomLogger) Debugf(format string, v ...interface{}) { l.log(DEBUG, format, v...) }
func (l *CustomLogger) Infof(format string, v ...interface{})  { l.log(INFO, format, v...) }
func (l *CustomLogger) Warnf(format string, v ...interface{})  { l.log(WARN, format, v...) }
func (l *CustomLogger) Errorf(format string, v ...interface{}) { l.log(ERROR, format, v...) }
func (l *CustomLogger) Fatalf(format string, v ...interface{}) {
    l.log(FATAL, format, v...)
    os.Exit(1)
}

// å…³é—­æ–‡ä»¶å†™å…¥å™¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
func (l *CustomLogger) Close() error {
    if closer, ok := l.fileWriter.(io.Closer); ok {
        return closer.Close()
    }
    return nil
}

var (
    Log = NewCustomLogger(true, fmt.Sprintf(
        &quot;./logs/atsexec_%d_%s.log&quot;,
        os.Getpid(),
        time.Now().Format(&quot;20060102150405&quot;),
    ))
)

</code></pre>
<h2 id="2-go-zap2025">2 goæ€§èƒ½æœ€å¿«çš„æ—¥å¿—åº“-zapï¼ˆ2025ï¼‰</h2>
<p>å­¦ä¹ é“¾æ¥ï¼š<a href="https://www.fengfengzhidao.com/article/e8OCcZUB8lppN5cb7HmJ">zapç¬¬ä¸‰æ–¹æ—¥å¿—åº“</a></p>
<p>è¿™æ˜¯ç¬¬ä¸‰æ–¹æ—¥å¿—åº“(lumberjack.v2æ”¯æŒåˆ†ç‰‡)ï¼š</p>
<pre><code class="language-shell"># ä¸‹è½½å‘½ä»¤
go get -u go.uber.org/zap
go get -u gopkg.in/natefinch/lumberjack.v2
</code></pre>
<p>ç¤ºä¾‹ï¼šutils/logger.go</p>
<pre><code class="language-go">package utils

import &quot;go.uber.org/zap&quot;

func Dev() {
    logger, _ := zap.NewDevelopment()
    prefixStr := &quot;Dev this is &quot;
    logger.Info(prefixStr + &quot;info&quot;)
    logger.Warn(prefixStr + &quot;warn&quot;)
    logger.Error(prefixStr + &quot;error&quot;)
}

func Test() {
    logger := zap.NewExample()
    prefixStr := &quot;Test this is &quot;
    logger.Info(prefixStr + &quot;info&quot;)
    logger.Warn(prefixStr + &quot;warn&quot;)
    logger.Error(prefixStr + &quot;error&quot;)
}

func Prod() {
    logger, _ := zap.NewProduction()
    prefixStr := &quot;Prod this is &quot;
    logger.Info(prefixStr + &quot;info&quot;)
    logger.Warn(prefixStr + &quot;warn&quot;)
    logger.Error(prefixStr + &quot;error&quot;)
}
</code></pre>
<h3 id="21_4">2.1 åŸºæœ¬é…ç½®</h3>
<p>utils/logger.go</p>
<p>1.æ”¯æŒç›´æ¥è¾“å…¥ä¸¤ä¸ªå‚æ•°ï¼šlogger.info("%s ä½ å¥½", "cenhongchang")</p>
<pre><code class="language-go">// GetSLogger ç›´æ¥è·å–æ—¥å¿—æ‰“å°å™¨-æ”¯æŒæ ¼å¼åŒ–å…¥å‚
func GetSLogger() *zap.SugaredLogger {
    logger, _ := zap.NewDevelopment()
    slogger := logger.Sugar()
    return slogger
</code></pre>
<p>2.æ›´å¤šé…ç½®ä½¿ç”¨æ–¹å¼</p>
<pre><code class="language-go">/**/

package utils

import (
    &quot;go.uber.org/zap&quot;
    &quot;go.uber.org/zap/zapcore&quot;
)

// å®šä¹‰é¢œè‰²
const (
    colorRed    = &quot;\033[31m&quot;
    colorGreen  = &quot;\033[32m&quot;
    colorYellow = &quot;\033[33m&quot;
    colorBlue   = &quot;\033[34m&quot;
    colorReset  = &quot;\033[0m&quot;
)

// è‡ªå®šä¹‰ EncodeLevel-ç¾åŒ–é¢œè‰²
func coloredLevelEncoder(level zapcore.Level, enc zapcore.PrimitiveArrayEncoder) {
    switch level {
    case zapcore.DebugLevel:
        enc.AppendString(colorBlue + &quot;DEBUG&quot; + colorReset)
    case zapcore.InfoLevel:
        enc.AppendString(colorGreen + &quot;INFO&quot; + colorReset)
    case zapcore.WarnLevel:
        enc.AppendString(colorYellow + &quot;WARN&quot; + colorReset)
    case zapcore.ErrorLevel, zapcore.DPanicLevel, zapcore.PanicLevel, zapcore.FatalLevel:
        enc.AppendString(colorRed + &quot;ERROR&quot; + colorReset)
    default:
        enc.AppendString(level.String()) // é»˜è®¤è¡Œä¸º
    }
}

// GetLogger é€šè¿‡é…ç½®è·å–æ—¥å¿—æ‰“å°å™¨
func GetLogger() *zap.Logger {
    cfg := zap.NewDevelopmentConfig()
    cfg.Level = zap.NewAtomicLevelAt(zap.DebugLevel)                                  // è®¾ç½®æ—¥å¿—æ‰“å°æœ€å°çº§åˆ«ä¸ºinfo
    cfg.EncoderConfig.EncodeTime = zapcore.TimeEncoderOfLayout(&quot;2006-01-02 15:04:05&quot;) // æ—¶é—´æ ¼å¼åŒ–
    cfg.EncoderConfig.EncodeLevel = coloredLevelEncoder                               // è‡ªå®šä¹‰é¢œè‰²æ˜¾ç¤ºå‡½æ•°
    logger, _ := cfg.Build()
    return logger
}

/* 

// æµ‹è¯•ä»£ç 
func main() {
    logger := utils.GetLogger() // é»˜è®¤ä¸æ”¯æŒæ ¼å¼åŒ–å…¥å‚
    prefixStr := &quot;è¿™æ˜¯ä¸€æ¡æ—¥å¿—ï¼Œæ‰“å°æœºåˆ«ï¼š&quot;
    logger.Info(prefixStr + &quot;info&quot;)
    logger.Warn(prefixStr + &quot;warn&quot;)
    logger.Error(prefixStr + &quot;error&quot;)
}

*/
</code></pre>
<h3 id="22_3">2.2 è‡ªå®šä¹‰å†…å®¹ï¼ˆå®Œæ•´ï¼‰</h3>
<p>zapæ”¯æŒè‡ªå®šä¹‰æ—¥å¿—å‰ç¼€ï¼Œæ¯”å¦‚æƒ³å®šä¹‰ä¸ºï¼šæŸä¸ªé¡¹ç›®åæˆ–åº”ç”¨åç­‰...</p>
<pre><code class="language-shell">go get -u gopkg.in/natefinch/lumberjack.v2
</code></pre>
<h4 id="221">2.2.1 æŒ‰æ–‡ä»¶å¤§å°åˆ†ç‰‡</h4>
<pre><code class="language-go">package utils

import (
    &quot;go.uber.org/zap&quot;
    &quot;go.uber.org/zap/buffer&quot;
    &quot;go.uber.org/zap/zapcore&quot;
    &quot;gopkg.in/natefinch/lumberjack.v2&quot;
    &quot;os&quot;
    &quot;time&quot;
)

const (
    colorRed    = &quot;\033[31m&quot;
    colorGreen  = &quot;\033[32m&quot;
    colorYellow = &quot;\033[33m&quot;
    colorBlue   = &quot;\033[34m&quot;
    colorReset  = &quot;\033[0m&quot;
)

var enableColor = isTerminal(os.Stdout)

var levelColors = map[zapcore.Level]string{
    zapcore.DebugLevel:  colorBlue + &quot;DEBUG&quot; + colorReset,
    zapcore.InfoLevel:   colorGreen + &quot;INFO&quot; + colorReset,
    zapcore.WarnLevel:   colorYellow + &quot;WARN&quot; + colorReset,
    zapcore.ErrorLevel:  colorRed + &quot;ERROR&quot; + colorReset,
    zapcore.DPanicLevel: colorRed + &quot;DPANIC&quot; + colorReset,
    zapcore.PanicLevel:  colorRed + &quot;PANIC&quot; + colorReset,
    zapcore.FatalLevel:  colorRed + &quot;FATAL&quot; + colorReset,
}

// æ§åˆ¶å°é¢œè‰²ç¼–ç 
func coloredLevelEncoder(level zapcore.Level, enc zapcore.PrimitiveArrayEncoder) {
    if enableColor {
        if c, ok := levelColors[level]; ok {
            enc.AppendString(c)
            return
        }
    }
    enc.AppendString(level.String())
}

// æ–‡ä»¶ç”¨çš„çº¯æ–‡æœ¬ç¼–ç 
func plainLevelEncoder(level zapcore.Level, enc zapcore.PrimitiveArrayEncoder) {
    enc.AppendString(level.String())
}

// è‡ªå®šä¹‰ Encoderï¼ŒåŠ å‰ç¼€
type myEncoder struct {
    zapcore.Encoder
    Prefix string
}

func (m myEncoder) EncodeEntry(entry zapcore.Entry, fields []zapcore.Field) (*buffer.Buffer, error) {
    buf, err := m.Encoder.EncodeEntry(entry, fields)
    if err != nil {
        return nil, err
    }
    logLine := buf.String()
    buf.Reset()
    buf.AppendString(m.Prefix + logLine)
    return buf, nil
}

func isTerminal(f *os.File) bool {
    fi, err := f.Stat()
    if err != nil {
        return false
    }
    return (fi.Mode() &amp; os.ModeCharDevice) != 0
}

// InitLogger åˆå§‹åŒ–å…¨å±€ Logger
func InitLogger(prefix string, logFile string) *zap.Logger {
    // æ§åˆ¶å°ç¼–ç ï¼ˆå½©è‰²ï¼‰
    consoleCfg := zap.NewDevelopmentEncoderConfig()
    consoleCfg.EncodeTime = zapcore.TimeEncoderOfLayout(time.DateTime)
    consoleCfg.EncodeLevel = coloredLevelEncoder

    consoleEncoder := zapcore.NewConsoleEncoder(consoleCfg)

    consoleCore := zapcore.NewCore(
        myEncoder{Encoder: consoleEncoder, Prefix: prefix},
        zapcore.AddSync(os.Stdout),
        zapcore.DebugLevel,
    )

    // æ–‡ä»¶ç¼–ç ï¼ˆæ— é¢œè‰²ï¼‰
    fileCfg := zap.NewProductionEncoderConfig()
    fileCfg.EncodeTime = zapcore.TimeEncoderOfLayout(time.DateTime)
    fileCfg.EncodeLevel = plainLevelEncoder // ä¸åŠ é¢œè‰²

    fileEncoder := zapcore.NewConsoleEncoder(fileCfg)

    fileWriter := zapcore.AddSync(&amp;lumberjack.Logger{
        Filename:   logFile,
        MaxSize:    20, // MB
        MaxBackups: 5,
        MaxAge:     30, // days
        Compress:   true,
    })

    fileCore := zapcore.NewCore(
        myEncoder{Encoder: fileEncoder, Prefix: prefix},
        fileWriter,
        zapcore.InfoLevel,
    )

    // åˆå¹¶ -- ç±»ä¼¼pythonæ·»åŠ å¤šä¸ªhandler
    core := zapcore.NewTee(consoleCore, fileCore)

    logger := zap.New(core, zap.AddCaller(), zap.AddStacktrace(zapcore.ErrorLevel))
    zap.ReplaceGlobals(logger)
    return logger
}
</code></pre>
<h4 id="222">2.2.2 æŒ‰æ¯å¤©æ–‡ä»¶åˆ†ç‰‡</h4>
<pre><code class="language-go">package utils

import (
    &quot;fmt&quot;
    &quot;go.uber.org/zap&quot;
    &quot;go.uber.org/zap/buffer&quot;
    &quot;go.uber.org/zap/zapcore&quot;
    &quot;os&quot;
    &quot;path/filepath&quot;
    &quot;time&quot;
)

const (
    colorRed    = &quot;\033[31m&quot;
    colorGreen  = &quot;\033[32m&quot;
    colorYellow = &quot;\033[33m&quot;
    colorBlue   = &quot;\033[34m&quot;
    colorReset  = &quot;\033[0m&quot;
)

var enableColor = isTerminal(os.Stdout)

var levelColors = map[zapcore.Level]string{
    zapcore.DebugLevel:  colorBlue + &quot;DEBUG&quot; + colorReset,
    zapcore.InfoLevel:   colorGreen + &quot;INFO&quot; + colorReset,
    zapcore.WarnLevel:   colorYellow + &quot;WARN&quot; + colorReset,
    zapcore.ErrorLevel:  colorRed + &quot;ERROR&quot; + colorReset,
    zapcore.DPanicLevel: colorRed + &quot;DPANIC&quot; + colorReset,
    zapcore.PanicLevel:  colorRed + &quot;PANIC&quot; + colorReset,
    zapcore.FatalLevel:  colorRed + &quot;FATAL&quot; + colorReset,
}

// æ§åˆ¶å°é¢œè‰²ç¼–ç 
func coloredLevelEncoder(level zapcore.Level, enc zapcore.PrimitiveArrayEncoder) {
    if enableColor {
        if c, ok := levelColors[level]; ok {
            enc.AppendString(c)
            return
        }
    }
    enc.AppendString(level.String())
}

// æ–‡ä»¶çº¯æ–‡æœ¬ç¼–ç 
func plainLevelEncoder(level zapcore.Level, enc zapcore.PrimitiveArrayEncoder) {
    enc.AppendString(level.String())
}

// è‡ªå®šä¹‰ Encoderï¼ŒåŠ å‰ç¼€
type myEncoder struct {
    zapcore.Encoder
    Prefix string
}

func (m myEncoder) EncodeEntry(entry zapcore.Entry, fields []zapcore.Field) (*buffer.Buffer, error) {
    buf, err := m.Encoder.EncodeEntry(entry, fields)
    if err != nil {
        return nil, err
    }
    logLine := buf.String()
    buf.Reset()
    buf.AppendString(m.Prefix + logLine)
    return buf, nil
}

// åˆ¤æ–­è¾“å‡ºæ˜¯å¦æ˜¯ç»ˆç«¯
func isTerminal(f *os.File) bool {
    fi, err := f.Stat()
    if err != nil {
        return false
    }
    return (fi.Mode() &amp; os.ModeCharDevice) != 0
}

// è·å–å½“å¤©çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„
func getDailyLogFile(baseDir, baseName string) string {
    date := time.Now().Format(time.DateOnly)
    return filepath.Join(baseDir, fmt.Sprintf(&quot;%s_%s.log&quot;, baseName, date))
}

// InitLogger æŒ‰å¤©åˆ†å‰²æ—¥å¿—
func InitLogger(prefix, baseDir, baseName string) *zap.Logger {
    // ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨
    _ = os.MkdirAll(baseDir, 0755)

    // æ§åˆ¶å°ç¼–ç ï¼ˆå½©è‰²ï¼‰
    consoleCfg := zap.NewDevelopmentEncoderConfig()
    consoleCfg.EncodeTime = zapcore.TimeEncoderOfLayout(time.DateTime)
    consoleCfg.EncodeLevel = coloredLevelEncoder
    consoleEncoder := zapcore.NewConsoleEncoder(consoleCfg)

    consoleCore := zapcore.NewCore(
        myEncoder{Encoder: consoleEncoder, Prefix: prefix},
        zapcore.AddSync(os.Stdout),
        zapcore.DebugLevel,
    )

    // æ–‡ä»¶ç¼–ç ï¼ˆæ— é¢œè‰²ï¼‰
    fileCfg := zap.NewProductionEncoderConfig()
    fileCfg.EncodeTime = zapcore.TimeEncoderOfLayout(time.DateTime)
    fileCfg.EncodeLevel = plainLevelEncoder
    fileEncoder := zapcore.NewConsoleEncoder(fileCfg)

    logFile := getDailyLogFile(baseDir, baseName)
    fileWriter, err := os.OpenFile(logFile, os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)
    if err != nil {
        panic(fmt.Sprintf(&quot;æ— æ³•åˆ›å»ºæ—¥å¿—æ–‡ä»¶: %v&quot;, err))
    }

    fileCore := zapcore.NewCore(
        myEncoder{Encoder: fileEncoder, Prefix: prefix},
        zapcore.AddSync(fileWriter),
        zapcore.InfoLevel,
    )

    core := zapcore.NewTee(consoleCore, fileCore)

    logger := zap.New(core, zap.AddCaller(), zap.AddStacktrace(zapcore.ErrorLevel))
    zap.ReplaceGlobals(logger)
    return logger
}

</code></pre>
<h4 id="223">2.2.3 æŒ‰æ¯å¤©æ–‡ä»¶+é”™è¯¯å•ç‹¬æ–‡ä»¶åˆ†ç‰‡</h4>
<pre><code class="language-go">package utils

import (
    &quot;fmt&quot;
    &quot;go.uber.org/zap&quot;
    &quot;go.uber.org/zap/buffer&quot;
    &quot;go.uber.org/zap/zapcore&quot;
    &quot;os&quot;
    &quot;path/filepath&quot;
    &quot;time&quot;
)

const (
    colorRed    = &quot;\033[31m&quot;
    colorGreen  = &quot;\033[32m&quot;
    colorYellow = &quot;\033[33m&quot;
    colorBlue   = &quot;\033[34m&quot;
    colorReset  = &quot;\033[0m&quot;
)

var enableColor = isTerminal(os.Stdout)

var levelColors = map[zapcore.Level]string{
    zapcore.DebugLevel:  colorBlue + &quot;DEBUG&quot; + colorReset,
    zapcore.InfoLevel:   colorGreen + &quot;INFO&quot; + colorReset,
    zapcore.WarnLevel:   colorYellow + &quot;WARN&quot; + colorReset,
    zapcore.ErrorLevel:  colorRed + &quot;ERROR&quot; + colorReset,
    zapcore.DPanicLevel: colorRed + &quot;DPANIC&quot; + colorReset,
    zapcore.PanicLevel:  colorRed + &quot;PANIC&quot; + colorReset,
    zapcore.FatalLevel:  colorRed + &quot;FATAL&quot; + colorReset,
}

// æ§åˆ¶å°é¢œè‰²ç¼–ç 
func coloredLevelEncoder(level zapcore.Level, enc zapcore.PrimitiveArrayEncoder) {
    if enableColor {
        if c, ok := levelColors[level]; ok {
            enc.AppendString(c)
            return
        }
    }
    enc.AppendString(level.String())
}

// æ–‡ä»¶æ— é¢œè‰²ç¼–ç 
func plainLevelEncoder(level zapcore.Level, enc zapcore.PrimitiveArrayEncoder) {
    enc.AppendString(level.String())
}

// è‡ªå®šä¹‰ Encoderï¼ŒåŠ å‰ç¼€
type myEncoder struct {
    zapcore.Encoder
    Prefix string
}

func (m myEncoder) EncodeEntry(entry zapcore.Entry, fields []zapcore.Field) (*buffer.Buffer, error) {
    buf, err := m.Encoder.EncodeEntry(entry, fields)
    if err != nil {
        return nil, err
    }
    logLine := buf.String()
    buf.Reset()
    buf.AppendString(m.Prefix + logLine)
    return buf, nil
}

// åˆ¤æ–­è¾“å‡ºæ˜¯å¦æ˜¯ç»ˆç«¯
func isTerminal(f *os.File) bool {
    fi, err := f.Stat()
    if err != nil {
        return false
    }
    return (fi.Mode() &amp; os.ModeCharDevice) != 0
}

// è·å–å½“å¤©æ—¥å¿—æ–‡ä»¶è·¯å¾„
func getDailyLogFile(baseDir, baseName string) string {
    date := time.Now().Format(&quot;2006-01-02&quot;)
    return filepath.Join(baseDir, fmt.Sprintf(&quot;%s_%s.log&quot;, baseName, date))
}

// InitLogger æŒ‰å¤©åˆ†å‰²å¹¶å°† error å•ç‹¬è¾“å‡º
func InitLogger(prefix, baseDir string) *zap.Logger {
    _ = os.MkdirAll(baseDir, 0755)

    // æ§åˆ¶å°ï¼ˆå½©è‰²ï¼‰
    consoleCfg := zap.NewDevelopmentEncoderConfig()
    consoleCfg.EncodeTime = zapcore.TimeEncoderOfLayout(time.DateTime)
    consoleCfg.EncodeLevel = coloredLevelEncoder
    consoleEncoder := zapcore.NewConsoleEncoder(consoleCfg)

    consoleCore := zapcore.NewCore(
        myEncoder{Encoder: consoleEncoder, Prefix: prefix},
        zapcore.AddSync(os.Stdout),
        zapcore.DebugLevel,
    )

    // æ–‡ä»¶ï¼ˆInfo åŠä»¥ä¸Šï¼Œä¸å« Errorï¼‰
    infoCfg := zap.NewProductionEncoderConfig()
    infoCfg.EncodeTime = zapcore.TimeEncoderOfLayout(time.DateTime)
    infoCfg.EncodeLevel = plainLevelEncoder
    infoEncoder := zapcore.NewConsoleEncoder(infoCfg)

    infoFile := getDailyLogFile(baseDir, &quot;info&quot;)
    infoWriter, err := os.OpenFile(infoFile, os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)
    if err != nil {
        panic(fmt.Sprintf(&quot;æ— æ³•åˆ›å»º info æ—¥å¿—æ–‡ä»¶: %v&quot;, err))
    }
    infoCore := zapcore.NewCore(
        myEncoder{Encoder: infoEncoder, Prefix: prefix},
        zapcore.AddSync(infoWriter),
        zap.LevelEnablerFunc(func(lvl zapcore.Level) bool {
            return lvl &lt; zapcore.ErrorLevel // åªè®°å½• Debug, Info, Warn
        }),
    )

    // æ–‡ä»¶ï¼ˆError åŠä»¥ä¸Šï¼‰
    errCfg := zap.NewProductionEncoderConfig()
    errCfg.EncodeTime = zapcore.TimeEncoderOfLayout(time.DateTime)
    errCfg.EncodeLevel = plainLevelEncoder
    errEncoder := zapcore.NewConsoleEncoder(errCfg)

    errorFile := getDailyLogFile(baseDir, &quot;error&quot;)
    errorWriter, err := os.OpenFile(errorFile, os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)
    if err != nil {
        panic(fmt.Sprintf(&quot;æ— æ³•åˆ›å»º error æ—¥å¿—æ–‡ä»¶: %v&quot;, err))
    }
    errorCore := zapcore.NewCore(
        myEncoder{Encoder: errEncoder, Prefix: prefix},
        zapcore.AddSync(errorWriter),
        zap.LevelEnablerFunc(func(lvl zapcore.Level) bool {
            return lvl &gt;= zapcore.ErrorLevel // åªè®°å½• Error åŠä»¥ä¸Š
        }),
    )

    // åˆå¹¶ä¸‰ä¸ªè¾“å‡º
    core := zapcore.NewTee(consoleCore, infoCore, errorCore)

    logger := zap.New(core, zap.AddCaller(), zap.AddStacktrace(zapcore.ErrorLevel))
    zap.ReplaceGlobals(logger)
    return logger
}

</code></pre>
<h4 id="224">2.2.4 å•ç‹¬/å…¨å±€æ—¥å¿—å¯¹è±¡ä½¿ç”¨</h4>
<pre><code class="language-go">// å•ç‹¬æ–°loggerå¯¹è±¡
func main() {
    logger := utils.InitLogger(&quot;&quot;, &quot;logs/app.log&quot;)
    logger1 := utils.InitLogger(&quot;&quot;, &quot;logs/app1.log&quot;)

    defer logger.Sync()
    defer logger1.Sync()

    prefixStr := &quot;è¿™æ˜¯ä¸€æ¡æ—¥å¿—ï¼Œæ‰“å°çº§åˆ«ï¼š&quot;
    logger.Debug(prefixStr + &quot;debug&quot;)
    logger.Info(prefixStr + &quot;info&quot;)
    logger.Warn(prefixStr + &quot;warn&quot;)
    logger.Error(prefixStr + &quot;error&quot;)

    logger1.Info(prefixStr + &quot;info&quot;)
    logger1.Warn(prefixStr + &quot;warn&quot;)
    logger1.Error(prefixStr + &quot;error&quot;)
}
</code></pre>
<pre><code class="language-go">// å…¨å±€æ—¥å¿—å¯¹è±¡
func main() {
    utils.InitLogger(&quot;&quot;, &quot;logs/global.log&quot;)
    zap.L().Info(&quot;hello world&quot;)
    zap.S().Infof(&quot;hello %s&quot;, &quot;world&quot;)
}
</code></pre>
<h1 id="gogoroutine">ğŸ“š Goå¹¶å‘ç¼–ç¨‹ï¼ˆGoroutineï¼‰</h1>
<p>ç¼–ç¨‹ä¸­ï¼Œå¦‚æœç»†åŒ–å¹¶è¡Œä¸å¹¶å‘ï¼Œé‚£ä¹ˆè§£é‡Šå¦‚ä¸‹ï¼š</p>
<p>å¹¶è¡Œï¼šå¤šä¸ªcpuä¸­ï¼Œåšåˆ°çœŸæ­£çš„åŒä¸€æ—¶åˆ»ï¼ŒåŒæ—¶è¿è¡Œï¼›</p>
<p>å¹¶å‘ï¼šå•ä¸ªcpuä¸­ï¼Œä¸€æ®µæ—¶é—´å†…ï¼Œé€šè¿‡ä¸åœçš„åˆ‡æ¢æ—¶é—´ç‰‡è¾¾åˆ°å¿«é€Ÿæ‰§è¡Œä»»åŠ¡ï¼›</p>
<p>ä¸€èˆ¬çš„è¯ï¼Œä¸¤è€…æˆ‘ä»¬éƒ½ç»Ÿç§°å¹¶å‘ã€‚</p>
<p>goè¯­è¨€æœ‰è‡ªå·±å®ç°åç¨‹çš„çº¿ç¨‹æ¨¡å‹-GMPï¼ˆæ··åˆå‹çº¿ç¨‹æ¨¡å‹ï¼‰</p>
<h2 id="1_16">1 åç¨‹åˆ›å»º</h2>
<pre><code class="language-go">func showMessage(i int) {
    fmt.Println(&quot;Hello Goroutine; i=&quot; + strconv.Itoa(i))
}

func main() {
    for i := 0; i &lt; 10; i++ {
        go showMessage(i)
    }
    // åç¨‹ä¸­ï¼Œå¦‚æœä¸åŠ ç­‰å¾…æ—¶é—´ï¼Œä¸»åç¨‹ä¸ä¼šç­‰å¾…åˆ›å»ºçš„å…¶ä»–å­åç¨‹ç»“æŸè€Œç›´æ¥ç»“æŸï¼Œå¯èƒ½ä»€ä¹ˆéƒ½ä¸æ‰“å°ï¼›ä¹Ÿå¯èƒ½æ‰“å°å°‘é‡ä¿¡æ¯
    // åŠ äº†æ—¶é—´åï¼Œåç¨‹æ—¶å¹¶å‘æ‰§è¡Œï¼Œæ‰€ä»¥æ‰“å°é¡ºåºæ˜¯ä¸ç¡®å®šçš„
    time.Sleep(time.Second * 2)
}
</code></pre>
<h2 id="2-channel">2 Channelç±»å‹ï¼ˆé€šé“ï¼‰</h2>
<p>goè¯­è¨€Channelæ˜¯ä¸ºGoroutineåšæ•°æ®é€šä¿¡çš„ç±»å‹ï¼Œæ˜¯ä¸€ç§é˜Ÿåˆ—ï¼Œéµå¾ªå…ˆå…¥å…ˆå‡ºï¼›</p>
<p>åˆ›å»ºchannelæ•°æ®è¯­æ³•ï¼š<code>make(chan ç±»å‹, &lt;ç¼“å†²å¤§å°&gt;)</code></p>
<p>channelæœ‰ä¸‰ç§æ“ä½œï¼šå‘é€(send)ã€æ¥æ”¶(receive)ä¸å…³é—­(close)ï¼›å‘é€æ¥æ”¶éƒ½ä½¿ç”¨ &lt;- ç¬¦å·</p>
<h3 id="21-channel">2.1 Channelæ­»é”</h3>
<pre><code class="language-go">func main() {
    ch := make(chan int)  // æ²¡æœ‰ç¼“å†²ï¼Œé˜Ÿåˆ—é•¿åº¦=0ï¼›ç›¸å½“äºå‘é€å€¼æ²¡æœ‰å­˜çš„åœ°æ–¹ï¼Œé€ æˆæ­»é”
    ch &lt;- 10
    receiver := &lt;-ch
    fmt.Println(receiver)
}
</code></pre>
<h3 id="22-channel">2.2 Channelå…³é—­ç‰¹æ€§</h3>
<pre><code class="language-go">func main() {
    ch := make(chan int, 2)
    ch &lt;- 10
    ch &lt;- 20

    receiver1 := &lt;-ch
    fmt.Println(receiver1) // 10
    close(ch)              // å…³é—­é€šé“ï¼Œé˜Ÿåˆ—å˜é‡å¯ä»¥ç»§ç»­å–å€¼ï¼›å‘é€çš„å€¼å–å®Œä¹‹åé»˜è®¤ä¼šå–é›¶å€¼

    receiver2 := &lt;-ch
    fmt.Println(receiver2) // 0

    receiver3 := &lt;-ch
    fmt.Println(receiver3) // 0
}


// 10
// 20
// 0
</code></pre>
<p><strong>Channelå…³é—­ä¹‹åæœ‰ä»¥ä¸‹ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å¯¹å…³é—­é€šé“å†å‘é€å€¼ä¼šå¯¼è‡´panic</li>
<li>å¯¹å…³é—­é€šé“å¯ä»¥ç»§ç»­å–å€¼ï¼Œå–å®Œå‘é€å€¼ä¹‹åï¼Œä¼šé»˜è®¤ç»§ç»­å¯ä»¥å–å¯¹åº”ç±»å‹é›¶å€¼</li>
<li>å¯¹å…³é—­é€šé“å†å…³é—­ä¼šå¯¼è‡´panic</li>
</ul>
<h3 id="23-channel">2.3 Channelæœ‰ç¼“å†²/æ— ç¼“å†²åˆ›å»ºåœºæ™¯</h3>
<h4 id="231">2.3.1 æœ‰ç¼“å†²åˆ›å»ºåœºæ™¯</h4>
<p>æœ‰ç¼“å†²åˆ›å»ºå°±ç›¸å½“äºå…ˆå­˜åœ¨é‡Œé¢ï¼Œå†å–å‡º</p>
<pre><code class="language-go">func main() {
    ch := make(chan int, 1)
    ch &lt;- 10
    receiver, ok := &lt;-ch  // okæ˜¯åˆ¤æ–­æ˜¯å¦é€šé“å·²å…³é—­ï¼ˆå‘é€å€¼å–å®Œåä¼šè‡ªåŠ¨å…³é—­ï¼‰ï¼Œå½“å–å®Œä¹‹åï¼Œokå€¼ä¸ºfalse
    fmt.Println(receiver, ok)
}
</code></pre>
<h4 id="232">2.3.2 æ— ç¼“å†²åˆ›å»ºåœºæ™¯</h4>
<p>ä¸€èˆ¬ä½¿ç”¨åœ¨åˆ›å»ºGoroutineï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-go">func main() {
    ch := make(chan int)
    go recv(ch) // å¿…é¡»å…ˆåˆ›å»ºåç¨‹ï¼Œå†å‘é€å€¼ï¼›ä¸ç„¶ç›¸å½“äºæ²¡æœ‰æ¥æ”¶è€…ï¼ŒåŒæ ·ä¼šæ­»é”
    ch &lt;- 10
}

func recv(ch chan int) {
    fmt.Println(&quot;æ¥æ”¶å€¼ï¼š&quot;, &lt;-ch)
}
</code></pre>
<h3 id="24-channel">2.4 Channelä¸‰ç§å–å€¼å†™æ³•</h3>
<p><strong>ç¬¬ä¸€ç§ï¼šåˆ¤æ–­æ˜¯å¦å·²ç»å–å®Œ</strong></p>
<pre><code class="language-go">func main() {
    ch := make(chan int, 100)
    fmt.Println(&quot;é•¿åº¦ï¼š&quot;, len(ch), &quot;å®¹é‡ï¼š&quot;, cap(ch))

    // åŒ¿åå‡½æ•°å¾ªç¯é€å…¥å€¼
    func() {
        for i := 0; i &lt; 50; i++ {
            ch &lt;- i
        }
        close(ch) // å…³é—­é€šé“
    }()

    // å¾ªç¯å–å€¼æ‰“å° -- å¦‚æœå‘é€å€¼æ—¶æ²¡æœ‰å¯¹åº”å…³é—­ï¼Œå–å€¼è¶…è¿‡é€šé“çš„é•¿åº¦å°±ä¼šæŠ¥é”™ï¼ˆå³ä½¿æ²¡æœ‰è¾¾åˆ°å®¹é‡ï¼‰
    for {
        i, ok := &lt;-ch
        if !ok {
            break
        }
        fmt.Println(&quot;i=&quot;, i, &quot;ok=&quot;, ok)
    }
}
</code></pre>
<p><strong>ç¬¬äºŒç§ï¼šfor...range...ç›´æ¥å–å€¼ï¼ˆä¾ç„¶éœ€è¦å…³é—­é€šé“ï¼Œå¦åˆ™ä¼šå‘ç”Ÿpanicï¼‰ï¼ˆæ¨èï¼‰</strong></p>
<p>for...range...ä½¿ç”¨åœ¨è¿™é‡Œåªèƒ½è·å–å€¼ï¼Œæ²¡æœ‰ç´¢å¼•ã€‚</p>
<pre><code class="language-go">func main() {
    ch := make(chan int, 100)
    fmt.Println(&quot;é•¿åº¦ï¼š&quot;, len(ch), &quot;å®¹é‡ï¼š&quot;, cap(ch))

    // åŒ¿åå‡½æ•°å¾ªç¯é€å…¥å€¼
    func() {
        for i := 0; i &lt; 50; i++ {
            ch &lt;- i
        }
        close(ch) // å…³é—­é€šé“
    }()

    // å¾ªç¯å–å€¼æ‰“å° -- ç›´æ¥å–å‡ºå¯¹åº”å€¼
    for v := range ch {
        fmt.Println(&quot;v=&quot;, v)
    }
}
</code></pre>
<p><strong>ç¬¬ä¸‰ç§ï¼šselectè¯­å¥ï¼Œä¸€ç§é«˜æ•ˆçš„å¤šè·¯å¤ç”¨é€šé“æœºåˆ¶è¯­æ³•ï¼Œå…è®¸å†å¤šä¸ªé€šé“ç­‰å¾…å¹¶å¤„ç†æ¶ˆæ¯</strong></p>
<p>selectè¯­å¥æ˜¯ Go è¯­è¨€å¹¶å‘ç¼–ç¨‹ä¸­éå¸¸é‡è¦çš„æ§åˆ¶ç»“æ„ï¼Œä¸“é—¨ä¸ºé€šé“è®¾è®¡ï¼Œä½¿ç”¨æ–¹å¼éå¸¸çµæ´»ã€‚</p>
<p>è¯­æ³•ä¼ªä»£ç ï¼š</p>
<pre><code class="language-go">select {
    case &lt;-channel1:
        // channel1å‡†å¤‡å®Œæ¯•
    case data := &lt;-channel2:
        // channel2å‡†å¤‡å®Œæ¯•,ä¸”å¯ä»¥è¯»å–åˆ°æ•°æ®data
    case channel3 &lt;- data:
        // channel2å‡†å¤‡å®Œæ¯•,ä¸”å¯ä»¥å†™å…¥æ•°æ®data
    default:
        // æ²¡æœ‰é€šé“å‡†å¤‡å®Œæ¯•...
}
</code></pre>
<p>ç¤ºä¾‹ï¼šä»»åŠ¡è¶…æ—¶åˆ¤æ–­</p>
<pre><code class="language-go">func main() {
    ch := make(chan int)

    // åç¨‹ä¸­åœç•™3ç§’ä¹‹åï¼Œå‘é€ä¸€ä¸ªå€¼ï¼š10
    go func() {
        time.Sleep(time.Second * 3)
        ch &lt;- 10
    }()

    select {
    case data, ok := &lt;-ch:
        if ok {
            fmt.Println(&quot;æ¥æ”¶å€¼ï¼š&quot;, data)
        } else {
            fmt.Println(&quot;é€šé“å·²å…³é—­&quot;)
        }
    case &lt;-time.After(time.Second * 2):  // time.Afterè¿”å›ä¸€ä¸ªåªè¯»çš„ Time ç±»å‹é€šé“ï¼›å¦‚æœæ—¶é—´æ—©äºå…¶ä»–é€šé“ï¼›é‚£å°±ä¼šèµ°è¶…æ—¶~
        fmt.Println(&quot;ä»»åŠ¡æ‰§è¡Œå·²è¶…æ—¶ï¼&quot;)
    }
}
</code></pre>
<h2 id="3_8">3 å¹¶å‘ä¸­é”åº”ç”¨</h2>
<h3 id="31-mutex">3.1 äº’æ–¥é”ï¼ˆMutexï¼‰</h3>
<p>äº’æ–¥é”ï¼ˆ<code>sync.Mutex</code>ï¼‰æ˜¯æœ€åŸºæœ¬çš„é”ç±»å‹ï¼Œå®ƒä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ª goroutine å¯ä»¥è®¿é—®å…±äº«èµ„æºã€‚</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li><strong>æ’ä»–æ€§</strong>ï¼šåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ª goroutine èƒ½æŒæœ‰é”</li>
<li><strong>é˜»å¡æ€§</strong>ï¼šå…¶ä»– goroutine å¿…é¡»ç­‰å¾…é”é‡Šæ”¾</li>
<li><strong>ä¸å¯é‡å…¥</strong>ï¼šåŒä¸€ä¸ª goroutine ä¸èƒ½é‡å¤é”å®šå·²æŒæœ‰çš„é”ï¼ˆä¼šå¯¼è‡´æ­»é”ï¼‰</li>
</ol>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å¯¹å…±äº«æ•°æ®çš„ç®€å•è¯»å†™æ“ä½œ</li>
<li>ä¸´ç•ŒåŒºä»£ç æ‰§è¡Œæ—¶é—´è¾ƒçŸ­çš„æƒ…å†µ</li>
</ul>
<pre><code class="language-go">var shareInt = 0    // å…±äº«å…¨å±€å˜é‡
var lock sync.Mutex // äº’æ–¥é”
var wg sync.WaitGroup

// å®šä¹‰åŠŸèƒ½å‡½æ•°
func AutoAdd() {
    defer wg.Done()  // ä»»åŠ¡å®Œæˆï¼Œè®¡æ•°å™¨å‡1

    for i := 0; i &lt; 5000; i++ {
        lock.Lock()  // åŠ é”
        shareInt = shareInt + 1
        lock.Unlock()  // è§£é”
    }
}

func main() {
    wg.Add(2)  // Goroutineä»»åŠ¡ä¸ªæ•°
    go AutoAdd()
    go AutoAdd()
    wg.Wait()
    fmt.Println(&quot;shareInt:&quot;, shareInt)
}
</code></pre>
<h3 id="32-rwmutex">3.2 è¯»å†™é”ï¼ˆRWMutexï¼‰</h3>
<p><strong>è¯»å†™é”ï¼ˆ<code>sync.RWMutex</code>ï¼‰æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼š</strong></p>
<ul>
<li>å¤šä¸ª goroutine å¯ä»¥åŒæ—¶æŒæœ‰è¯»é”</li>
<li>å†™é”æ˜¯æ’ä»–çš„ï¼ˆä¸äº’æ–¥é”ç›¸åŒï¼‰</li>
</ul>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li><strong>è¯»å…±äº«</strong>ï¼šå¤šä¸ªè¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œ</li>
<li><strong>å†™äº’æ–¥</strong>ï¼šå†™æ“ä½œæ˜¯æ’ä»–çš„</li>
<li><strong>è¯»å†™äº’æ–¥</strong>ï¼šæœ‰å†™æ“ä½œæ—¶ä¸èƒ½æœ‰è¯»æ“ä½œï¼Œåä¹‹äº¦ç„¶</li>
</ol>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>è¯»å¤šå†™å°‘çš„åœºæ™¯</li>
<li>å…±äº«æ•°æ®è¢«é¢‘ç¹è¯»å–ä½†å¾ˆå°‘ä¿®æ”¹çš„æƒ…å†µ</li>
</ul>
<pre><code class="language-go">/**/

package main

import (
    &quot;fmt&quot;
    &quot;sync&quot;
    &quot;time&quot;
)

var (
    shareInt int            // å…±äº«å…¨å±€å˜é‡
    wg       sync.WaitGroup // åŒæ­¥ç­‰å¾…ç»„
    lock     sync.Mutex     // äº’æ–¥é” -- æµ‹è¯•è€—æ—¶ï¼š2153ms
    rwLock   sync.RWMutex   // è¯»å†™é”-è¯»å¤šå†™å°‘åœºæ™¯åº”ç”¨ -- æµ‹è¯•è€—æ—¶ï¼š1008ms
)

// å®šä¹‰åŠŸèƒ½å‡½æ•°
func Read() {
    // defer wg.Done()
    // defer lock.Unlock()
    // lock.Lock()

    defer wg.Done()
    defer rwLock.RUnlock() // è§£è¯»é”
    rwLock.RLock()         // åŠ è¯»é”

    time.Sleep(time.Millisecond * 1) // è®¾è¯»æ“ä½œéœ€è¦1æ¯«ç§’
}

func Write() {
    // defer wg.Done()
    // defer lock.Unlock()
    // lock.Lock()

    defer wg.Done()
    defer rwLock.Unlock() // è§£å†™é”
    rwLock.Lock()         // åŠ å†™é”

    shareInt++
    time.Sleep(time.Millisecond * 100) // è®¾å†™æ“ä½œéœ€è¦10æ¯«ç§’
}

func Run() {
    defer wg.Wait()

    // è¯»æ“ä½œ-10000æ¬¡
    for i := 0; i &lt; 1000; i++ {
        wg.Add(1)
        go Read()
    }

    // å†™æ“ä½œ-100æ¬¡
    for i := 0; i &lt; 10; i++ {
        wg.Add(1)
        go Write()
    }
}

func main() {
    start := time.Now()
    Run()
    usedTime := time.Since(start).Milliseconds()
    fmt.Printf(&quot;usedTime: %dms\n&quot;, usedTime)
    fmt.Println(&quot;shareInt:&quot;, shareInt)
}

</code></pre>
<p>æ³¨æ„ï¼š</p>
<pre><code>sync.RWMutex.Lock() ä¸ sync.Mutex.Lock() æ˜¯æœ‰åŒºåˆ«çš„ï¼Œ**äº’æ–¥é”**ï¼šåªæœ‰ä¸€ä¸ªçŠ¶æ€â€”â€”åŠ é”/è§£é”ï¼›**è¯»å†™é”**ï¼šåˆ†ä¸ºè¯»é”ï¼ˆRLockï¼‰å’Œå†™é”ï¼ˆLockï¼‰ï¼›

è¯»å†™é”ä¹‹ä¸­çš„`Lock()`ï¼šå†™é”ï¼Œç‹¬å ï¼›å½“å†™é”è¢«æŒæœ‰æ—¶ï¼Œè¯»å†™éƒ½è¢«é˜»å¡ã€‚
</code></pre>
<h1 id="go">ğŸ“š Goè¯­è¨€çš„åŒ…</h1>
<h2 id="1_17">1 åŒ…å£°æ˜</h2>
<ul>
<li>æ¯ä¸ªGoæ–‡ä»¶å¿…é¡»ä»¥<code>package</code>å£°æ˜å¼€å¤´</li>
<li>ä¸»ç¨‹åºå¿…é¡»å£°æ˜ä¸º<code>package main</code></li>
<li>åŒä¸€ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¿…é¡»å±äºåŒä¸€ä¸ªåŒ…</li>
</ul>
<pre><code class="language-go">package main  // ä¸»ç¨‹åºåŒ…

import &quot;fmt&quot;

func main() {
    fmt.Println(&quot;Hello, World!&quot;)
}
</code></pre>
<h2 id="2_14">2 å¯¼å…¥è·¯å¾„</h2>
<ul>
<li>æ ‡å‡†åº“åŒ…ç›´æ¥ä½¿ç”¨çŸ­åç§°(å¦‚"fmt", "net/http")</li>
<li>ç¬¬ä¸‰æ–¹åŒ…ä½¿ç”¨å®Œæ•´è·¯å¾„(å¦‚"github.com/gin-gonic/gin")</li>
<li>æœ¬åœ°åŒ…ä½¿ç”¨ç›¸å¯¹äº<code>GOPATH</code>æˆ–æ¨¡å—æ ¹ç›®å½•çš„è·¯å¾„</li>
</ul>
<pre><code class="language-go">import (
    &quot;fmt&quot;                // æ ‡å‡†åº“
    &quot;math/rand&quot;          // æ ‡å‡†åº“å­åŒ…

    &quot;github.com/foo/bar&quot; // ç¬¬ä¸‰æ–¹åŒ…
    &quot;mymodule/mypkg&quot;     // æœ¬åœ°æ¨¡å—åŒ…
)
</code></pre>
<h2 id="3_9">3 å¯¼å…¥åˆ«å</h2>
<p>å¯ä»¥ä¸ºå¯¼å…¥çš„åŒ…æŒ‡å®šåˆ«åï¼Œè§£å†³å‘½åå†²çªæˆ–ç®€åŒ–é•¿åŒ…åï¼š</p>
<pre><code class="language-go">import (
    &quot;crypto/rand&quot;
    mrand &quot;math/rand&quot;  // åˆ«å
    f &quot;fmt&quot;            // ç®€çŸ­åˆ«å
)
</code></pre>
<h2 id="4_8">4 ç‚¹å¯¼å…¥</h2>
<p>ä½¿ç”¨ç‚¹(.)å¯¼å…¥åŒ…æ—¶ï¼Œå¯ä»¥çœç•¥åŒ…åå‰ç¼€(ä¸æ¨èå¸¸ç”¨)ï¼š</p>
<pre><code class="language-go">import . &quot;fmt&quot;

func main() {
    Println(&quot;ç›´æ¥ä½¿ç”¨Printlnè€Œä¸éœ€è¦fmtå‰ç¼€&quot;)
}
</code></pre>
<h2 id="5_8">5 ç©ºç™½å¯¼å…¥ï¼ˆåŒ¿åå¯¼å…¥ï¼‰</h2>
<p>ä½¿ç”¨ä¸‹åˆ’çº¿å¯¼å…¥åŒ…<strong>ä»…æ‰§è¡ŒåŒ…çš„initå‡½æ•°</strong>è€Œä¸ç›´æ¥ä½¿ç”¨å…¶åŠŸèƒ½ï¼š</p>
<pre><code class="language-go">import _ &quot;image/png&quot;  // æ³¨å†ŒPNGè§£ç å™¨
</code></pre>
<h2 id="6_6">6 å¯è§æ€§è§„åˆ™</h2>
<ul>
<li>å¤§å†™å­—æ¯å¼€å¤´çš„æ ‡è¯†ç¬¦(å˜é‡ã€å‡½æ•°ã€ç±»å‹ç­‰)æ˜¯å…¬å¼€çš„(exported)</li>
<li>å°å†™å­—æ¯å¼€å¤´çš„æ ‡è¯†ç¬¦æ˜¯åŒ…ç§æœ‰çš„</li>
</ul>
<pre><code class="language-go">package mypkg

var PublicVar int    // å¯è¢«å…¶ä»–åŒ…è®¿é—®
var privateVar int   // ä»…æœ¬åŒ…å†…å¯è®¿é—®

func PublicFunc() {}  // å¯è¢«å…¶ä»–åŒ…è°ƒç”¨
func privateFunc() {} // ä»…æœ¬åŒ…å†…å¯è°ƒç”¨
</code></pre>
<h2 id="7-init">7 initå‡½æ•°</h2>
<ul>
<li>æ¯ä¸ªåŒ…å¯ä»¥åŒ…å«å¤šä¸ªinitå‡½æ•°</li>
<li>initå‡½æ•°åœ¨ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨è°ƒç”¨</li>
<li>æ‰§è¡Œé¡ºåºï¼šå¯¼å…¥çš„åŒ…å…ˆåˆå§‹åŒ–ï¼ŒåŒä¸€åŒ…å†…æŒ‰æ–‡ä»¶åå­—æ¯é¡ºåº</li>
</ul>
<pre><code class="language-go">package mypkg

func init() {
    // åˆå§‹åŒ–ä»£ç 
}

func init() {
    // å¯ä»¥æœ‰å¤šä¸ªinitå‡½æ•°
}
</code></pre>
<h2 id="8_3">8 åŒ…æ–‡æ¡£</h2>
<ul>
<li>åŒ…æ³¨é‡Šåº”ç´§æ¥åœ¨packageå£°æ˜ä¹‹å‰</li>
<li>ä½¿ç”¨å®Œæ•´çš„å¥å­ï¼Œä»¥åŒ…åå¼€å¤´</li>
<li>å¯ä»¥ä½¿ç”¨godocå·¥å…·ç”Ÿæˆæ–‡æ¡£</li>
</ul>
<pre><code class="language-go">// Package mypkg provides some useful utilities.
// This is a sample package documentation.
package mypkg
</code></pre>
<h2 id="9-internal">9 å†…éƒ¨åŒ…(internal)</h2>
<ul>
<li>æ”¾ç½®åœ¨<code>internal</code>ç›®å½•ä¸‹çš„åŒ…åªèƒ½è¢«å…¶çˆ¶ç›®å½•åŠå…¶å­ç›®å½•ä¸­çš„ä»£ç å¯¼å…¥</li>
<li>Go 1.4å¼•å…¥çš„æœºåˆ¶ï¼Œç”¨äºé™åˆ¶åŒ…çš„ä½¿ç”¨èŒƒå›´</li>
</ul>
<pre><code class="language-text">mymodule/
â”œâ”€â”€ internal/
â”‚   â””â”€â”€ myinternal/  // åªèƒ½è¢«mymoduleåŠå…¶å­ç›®å½•å¯¼å…¥
â””â”€â”€ mypkg/
</code></pre>
<h2 id="10_1">10. æµ‹è¯•åŒ…</h2>
<ul>
<li>æµ‹è¯•æ–‡ä»¶ä»¥<code>_test.go</code>ç»“å°¾</li>
<li>æµ‹è¯•å‡½æ•°ä»¥<code>Test</code>å¼€å¤´</li>
<li>æµ‹è¯•åŒ…å¯ä»¥ä¸ä¸»åŒ…åŒåæˆ–åŠ <code>_test</code>åç¼€</li>
</ul>
<pre><code class="language-go">package mypkg_test  // å¤–éƒ¨æµ‹è¯•åŒ…

import (
    &quot;testing&quot;
    &quot;mymodule/mypkg&quot;
)
</code></pre>
<h2 id="11-go-111">11. æ¨¡å—æ”¯æŒ(Go 1.11+)</h2>
<ul>
<li>ä½¿ç”¨go.modæ–‡ä»¶å®šä¹‰æ¨¡å—</li>
<li>æ¨¡å—è·¯å¾„æˆä¸ºåŒ…çš„å¯¼å…¥è·¯å¾„</li>
<li>ç‰ˆæœ¬æ§åˆ¶æ›´åŠ æ˜ç¡®</li>
</ul>
<pre><code class="language-go">module github.com/username/mymodule

go 1.21

require (
    github.com/some/dependency v1.2.3
)
</code></pre>
<h2 id="12_4">12. åŒ…å‘½åæƒ¯ä¾‹</h2>
<ul>
<li>åŒ…ååº”ç®€çŸ­ã€å°å†™ã€æœ‰æ„ä¹‰</li>
<li>é¿å…ä½¿ç”¨ä¸‹åˆ’çº¿æˆ–æ··åˆå¤§å°å†™</li>
<li>å•æ•°å½¢å¼å‘½å(å¦‚<code>url</code>è€Œé<code>urls</code>)</li>
<li>é¿å…ä¸æ ‡å‡†åº“é‡å</li>
</ul>
<h2 id="13-go118">13 å·¥ä½œç©ºé—´ï¼ˆGo1.18+ï¼‰</h2>
<p>å¤šä¸ªæ¨¡å—æ–¹æ³•å¼•ç”¨ï¼šä½¿ç”¨workspaceå¤„ç†</p>
<pre><code class="language-text">WORKDEMO
â”œâ”€app
â”‚      go.mod
â”‚      main.go
â”‚
â””â”€common
        go.mod
        utils.go
</code></pre>
<p>main.goéœ€è¦ä½¿ç”¨commonæ¨¡å—é‡Œé¢çš„utilsåŒ…ä¸­çš„æ–¹æ³•ï¼Œå¦‚ä½•åšï¼ŸGo1.18ä¹‹å‰éœ€è¦ä½¿ç”¨replaceå¤„ç†ï¼Œè¿™é‡Œä¸åšç¤ºä¾‹ï¼›æ¨èä½¿ç”¨Go1.18+çš„æ–¹å¼ï¼Œä½¿ç”¨å·¥ä½œç©ºé—´å»ºç«‹è”ç³».</p>
<pre><code class="language-shell"># åˆå§‹åŒ–å·¥ä½œç©ºé—´-åˆ›å»ºworkæ–‡ä»¶
go work init

# æ·»åŠ éœ€è¦ä½¿ç”¨çš„æ¨¡å—ï¼ˆgo.workæ–‡ä»¶ä¼šè‡ªåŠ¨å†™å…¥å†…å®¹ï¼‰
go work use app common
</code></pre>
<p>æ‰§è¡Œå‘½ä»¤ä¹‹åï¼Œgo.workæ–‡ä»¶å†…å®¹å˜æ›´ä¸ºï¼š</p>
<pre><code class="language-go">go 1.24.5

use (
    ./app
    ./common
)
</code></pre>
<p>è¿™æ ·å†å»main.goä¸­å¯¼å…¥åŒ…ä½¿ç”¨å®Œå…¨æ²¡é—®é¢˜äº†~</p>
<h1 id="goerror">ğŸ“š Goé”™è¯¯å¤„ç†ï¼ˆerrorï¼‰</h1>
<h2 id="1_18">1 æ ‡å‡†é”™è¯¯</h2>
<p>Goè¯­è¨€é”™è¯¯æ¥å£å®šä¹‰ï¼šä»»ä½•å®ç°æ­¤æ¥å£çš„ç±»å‹ï¼Œéƒ½è¢«å½“æˆæ˜¯é”™è¯¯ã€‚</p>
<pre><code class="language-go">type error interface {
    Error() string
}
</code></pre>
<p>goè¯­è¨€æ˜¯ä¸€ç§é¢å‘å¤±è´¥çš„ç¼–ç¨‹ï¼Œç†è®ºä¸Šæ¯ä¸€ä¸ªå‡½æ•°éƒ½åº”è¯¥è¿”å›errorï¼›ä»¥ä¿è¯å¯¹é”™è¯¯çš„å¤„ç†ã€‚</p>
<pre><code class="language-go">/**/

package main

import (
    &quot;errors&quot;
    &quot;fmt&quot;
    &quot;reflect&quot;
)

type User struct {
    Name string
}

// åˆ¤æ–­æ˜¯å¦å­˜åœ¨å­—æ®µ
func HasField(obj interface{}, fieldName string) bool {
    // è·å–ç»“æ„ä½“çš„åå°„å€¼
    val := reflect.ValueOf(obj)

    // å¦‚æœæ˜¯æŒ‡é’ˆï¼Œéœ€è¦è§£å¼•ç”¨
    if val.Kind() == reflect.Ptr {
        val = val.Elem()
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯ç»“æ„ä½“
    if val.Kind() != reflect.Struct {
        return false
    }

    // è·å–å­—æ®µ
    field := val.FieldByName(fieldName)
    return field.IsValid() // å¦‚æœå­—æ®µå­˜åœ¨ï¼Œè¿”å› true
}

// è·å–å­—æ®µå€¼-æ³¨æ„è¿”å›æ¥å£ç±»å‹-éœ€è¦è½¬æ¢
func GetFieldValue(obj interface{}, fieldName string) (interface{}, error) {
    val := reflect.ValueOf(obj)
    if val.Kind() == reflect.Ptr {
        val = val.Elem()
    }

    if val.Kind() != reflect.Struct {
        return nil, errors.New(&quot;not a struct&quot;)
    }

    field := val.FieldByName(fieldName)
    if !field.IsValid() {
        return nil, errors.New(&quot;field does not exist&quot;)
    }

    return field.Interface(), nil
}

// è®¾ç½®å­—æ®µå€¼-è‡ªåŠ¨åˆ¤æ–­ç±»å‹æ˜¯å¦ä¸åŸæ¥åŒ¹é…
func SetFieldValue(obj interface{}, fieldName string, newValue interface{}) error {
    val := reflect.ValueOf(obj)
    if val.Kind() != reflect.Ptr || val.Elem().Kind() != reflect.Struct {
        return errors.New(&quot;must be a pointer to struct&quot;)
    }

    field := val.Elem().FieldByName(fieldName)
    if !field.IsValid() {
        return errors.New(&quot;field does not exist&quot;)
    }

    if !field.CanSet() {
        return errors.New(&quot;field cannot be set (unexported?)&quot;)
    }

    newVal := reflect.ValueOf(newValue)
    if field.Type() != newVal.Type() {
        return errors.New(&quot;type mismatch&quot;)
    }

    field.Set(newVal)
    return nil
}

func (u *User) GetFieldValue(field string) (value string, err error) {
    if !HasField(u, field) {
        return &quot;&quot;, fmt.Errorf(&quot;field '%s' not found&quot;, field)
    }

    setErr := SetFieldValue(u, field, 123) // è®¾ç½®å­—æ®µå€¼
    if setErr != nil {
        fmt.Println(&quot;Error setting value:&quot;, setErr)
    }

    val, _ := GetFieldValue(u, field) // è·å–å­—æ®µå€¼
    return val.(string), nil
}

func main() {
    user := &amp;User{Name: &quot;cenhongchang&quot;}
    name, err := user.GetFieldValue(&quot;Name&quot;)
    if err != nil {
        fmt.Println(err)
        return
    }
    fmt.Println(name, err)
}

</code></pre>
<h2 id="2_15">2 åˆ©ç”¨æ¥å£è‡ªå®šä¹‰é”™è¯¯</h2>
<p>ç¤ºä¾‹ï¼šå®ç°é”™è¯¯æ¥å£ / è‡ªå®šä¹‰é”™è¯¯ / åˆ¤æ–­è¿”å›çš„æ˜¯è‡ªå®šä¹‰å“ªç§é”™è¯¯ / å°†erroræ¥å£å¯¹è±¡è½¬ä¸ºstructå¯¹è±¡è·å–å…¶ä¸­é”™è¯¯ä¿¡æ¯</p>
<pre><code class="language-go">/**/

package main

import (
    &quot;errors&quot;
    &quot;fmt&quot;
)

// å®šä¹‰é”™è¯¯ç»“æ„ä½“
type MyError struct {
    Message string
}

// è‡ªå®šä¹‰é”™è¯¯myErrorç»“æ„ä½“å®ç°é”™è¯¯æ¥å£-Error()
func (e *MyError) Error() string {
    return e.Message
}

// åˆ©ç”¨ç»“æ„ä½“å®ä¾‹åŒ–è‡ªå®šä¹‰é”™è¯¯
var (
    MoneyNotEnough = &amp;MyError{Message: &quot;not enough money&quot;}
    MoneyTooMuch   = &amp;MyError{Message: &quot;pay too much&quot;}
)

type User struct {
    Name string
}

func (u *User) Pay(money int) error {
    if money &lt; 100 {
        return MoneyNotEnough // è¿”å›å…·ä½“è‡ªå®šä¹‰çš„é”™è¯¯
    } else if money &gt; 200 {
        return MoneyTooMuch
    }
    return nil
}

func main() {
    user := new(User)
    err := user.Pay(20) // å®šä¹‰å‡½æ•°æ—¶è¿”å›çš„æ˜¯erroræ¥å£/ä¸æ˜¯ç»“æ„ä½“ç±»å‹-éœ€è¦æ³¨æ„ï¼›å½“ç„¶ä¹Ÿå¯ä»¥æ”¹ä¸ºå¯¹åº”ç»“æ„ä½“æŒ‡é’ˆ
    if err != nil {
        if errors.Is(err, MoneyNotEnough) {
            fmt.Println(&quot;é”™è¯¯åŸå› æ˜¯MoneyNotEnough:&quot;, err)
            // æŠŠæ¥å£è½¬ä¸ºå…·ä½“çš„ç»“æ„ä½“ç±»å‹
            var myError *MyError
            if ok := errors.As(err, &amp;myError); ok {
                fmt.Println(&quot;å·²å°†è¿”å›çš„æ¥å£errå¯¹è±¡è½¬ä¸ºå…·ä½“ç»“æ„ä½“å¯¹è±¡æŒ‡é’ˆï¼Œé”™è¯¯ä¿¡æ¯ï¼š&quot;, myError.Message)
            }
        } else if errors.Is(err, MoneyTooMuch) {
            fmt.Println(&quot;é”™è¯¯åŸå› æ˜¯MoneyTooMuch:&quot;, err)
        } else {
            fmt.Println(&quot;é”™è¯¯åŸå› éè‡ªå®šä¹‰é”™è¯¯:&quot;, err)
        }
        return
    }

    fmt.Println(&quot;æ”¯ä»˜æˆåŠŸ&quot;)
}

</code></pre>
<h2 id="3_10">3 é”™è¯¯å°è£…</h2>
<h3 id="31-fmterrorf">3.1 fmt.Errorf()</h3>
<p>ä½¿ç”¨fmt.Errorf()ï¼Œå¯ä»¥å°†ä¸€ä¸ªé”™è¯¯è¿›è¡Œå°è£…ï¼Œå°è£…åçš„é”™è¯¯å’Œä¹‹å‰çš„ç›¸ç­‰</p>
<ul>
<li>ä½¿ç”¨%w åµŒå¥—ç”Ÿæˆä¸€ä¸ªæ–°çš„é”™è¯¯</li>
<li>errors.Unwrapç”¨äºå°†ä¸€ä¸ªé”™è¯¯å¯¹è±¡å±•å¼€ï¼Œå¾—åˆ°ä¸‹ä¸€å±‚é”™è¯¯å¯¹è±¡ï¼ˆæœªå°è£…å‰çš„ï¼‰</li>
</ul>
<pre><code class="language-go">func main() {
    originalErr := errors.New(&quot;åŸå§‹é”™è¯¯&quot;)

    // %w åµŒå¥—ç”Ÿæˆä¸€ä¸ªæ–°çš„é”™è¯¯
    newError := fmt.Errorf(&quot;error: %w&quot;, originalErr)
    fmt.Println(&quot;newError:&quot;, newError)

    if errors.Is(newError, originalErr) {
        fmt.Println(&quot;è¿™ä¸¤ä¸ªé”™è¯¯ç›¸ç­‰&quot;)
    }

    // errors.Unwrapç”¨äºå°†ä¸€ä¸ªé”™è¯¯å¯¹è±¡å±•å¼€ï¼Œå¾—åˆ°ä¸‹ä¸€å±‚é”™è¯¯å¯¹è±¡
    originalErr1 := errors.Unwrap(newError)
    fmt.Println(&quot;originalErr1:&quot;, originalErr1)

    if errors.Is(originalErr, originalErr1) {
        fmt.Println(&quot;è¿™ä¸¤ä¸ªé”™è¯¯ç›¸ç­‰&quot;)
    }
}
</code></pre>
<h3 id="31-errorsjoingo120">3.1 errors.Join()ï¼ˆGo1.20+ï¼‰</h3>
<p><code>errors.Join()</code> æ˜¯ Go 1.20 ç‰ˆæœ¬å¼•å…¥çš„ä¸€ä¸ªå®ç”¨å‡½æ•°ï¼Œç”¨äºå°†å¤šä¸ªé”™è¯¯åˆå¹¶ä¸ºä¸€ä¸ªå¤åˆé”™è¯¯ã€‚</p>
<pre><code class="language-go">package main

import (
    &quot;errors&quot;
    &quot;fmt&quot;
)

func main() {
    err1 := errors.New(&quot;error 1&quot;)
    err2 := errors.New(&quot;error 2&quot;)
    err3 := errors.New(&quot;error 3&quot;)

    combinedErr := errors.Join(err1, err2, err3)
    fmt.Println(combinedErr)
    // è¾“å‡º: error 1
    //       error 2
    //       error 3
}
</code></pre>
<p><strong>ä¸»è¦ç‰¹æ€§</strong>:</p>
<ol>
<li><strong>è‡ªåŠ¨è¿‡æ»¤nilé”™è¯¯</strong>ï¼š</li>
</ol>
<p><code>go
   err := errors.Join(nil, errors.New("real error"), nil)
   // åªåŒ…å«"real error"</code></p>
<ol>
<li>
<p><strong>å•é”™è¯¯ä¼˜åŒ–</strong>ï¼š</p>
</li>
<li>
<p>å¦‚æœåªä¼ å…¥ä¸€ä¸ªénilé”™è¯¯ï¼Œç›´æ¥è¿”å›è¯¥é”™è¯¯</p>
</li>
<li>
<p>å¦‚æœæ‰€æœ‰é”™è¯¯éƒ½æ˜¯nilï¼Œè¿”å›nil</p>
</li>
<li>
<p><strong>å¤šè¡Œé”™è¯¯ä¿¡æ¯</strong>ï¼š</p>
</li>
<li>
<p>å¤åˆé”™è¯¯çš„<code>Error()</code>æ–¹æ³•è¿”å›å¤šè¡Œå­—ç¬¦ä¸²</p>
</li>
<li>æ¯è¡Œå¯¹åº”ä¸€ä¸ªå­é”™è¯¯</li>
</ol>
<h2 id="4-panic-">4 panic - è¿è¡Œæ—¶é”™è¯¯</h2>
<p>ç›´æ¥å¤„ç†ï¼š</p>
<pre><code class="language-go">func main() {
    defer func() {
        if r := recover(); r != nil {
            fmt.Println(&quot;æ•è·åˆ°å¼‚å¸¸ï¼š&quot;, r)
        }
    }()

    panic(&quot;ç¨‹åºå¼‚å¸¸ï¼Œå°†è‡ªåŠ¨é€€å‡º...&quot;)
}
</code></pre>
<p>èµ‹å€¼ç»™å‡½æ•°é”™è¯¯å¯¹è±¡è¿”å›å€¼ï¼š</p>
<pre><code class="language-go">func myTest(a, b int) (result int, err error) {  // æå‰æŒ‡å®šè¿”å›å˜é‡çš„åˆå§‹åŒ–ï¼›errorç±»å‹é›¶å€¼ä¸ºnil
    defer func() {
        if r := recover(); r != nil {
            fmt.Println(&quot;æ•è·å¼‚å¸¸ï¼š&quot;, r)
            err = errors.New(&quot;é™¤æ•°ä¸èƒ½ä¸ºé›¶&quot;)  // ä¿®æ”¹è¿”å›å˜é‡
        }
    }()

    result = a / b
    return result, err
}

func main() {
    result, err := myTest(10, 0)
    if err != nil {
        fmt.Println(&quot;å‘ç”Ÿé”™è¯¯:&quot;, err)
        return
    }
    fmt.Println(&quot;è®¡ç®—ç»“æœ:&quot;, result)
}

// æ•è·å¼‚å¸¸ï¼š runtime error: integer divide by zero
// å‘ç”Ÿé”™è¯¯: é™¤æ•°ä¸èƒ½ä¸ºé›¶
</code></pre>
<h1 id="gonet">ğŸ“š Goç½‘ç»œç¼–ç¨‹ï¼ˆnetåŒ…ï¼‰</h1>
<h2 id="1-tcp">1 TCPç½‘ç»œç¼–ç¨‹</h2>
<p><strong>TCPåè®®ï¼šTCPï¼ˆTransmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼‰</strong> æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚</p>
<ol>
<li><strong>ä¼ è¾“å±‚åè®®</strong>ï¼šå®ƒå·¥ä½œåœ¨ OSI æ¨¡å‹çš„ç¬¬å››å±‚ï¼ˆæˆ– TCP/IP æ¨¡å‹çš„ç¬¬ä¸‰å±‚ï¼‰ï¼Œè´Ÿè´£ä¸ºä¸Šå±‚åº”ç”¨ï¼ˆå¦‚ HTTPã€FTPã€ç”µå­é‚®ä»¶ï¼‰æä¾›ç«¯åˆ°ç«¯çš„é€šä¿¡æœåŠ¡ã€‚</li>
<li><strong>é¢å‘è¿æ¥</strong>ï¼šåœ¨æ•°æ®ä¼ è¾“å¼€å§‹ä¹‹å‰ï¼Œé€šä¿¡åŒæ–¹å¿…é¡»é¦–å…ˆå»ºç«‹ä¸€ä¸ªå¯é çš„è¿æ¥ï¼ˆé€šè¿‡â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼‰ï¼Œä¼ è¾“ç»“æŸåå†æ–­å¼€è¿æ¥ï¼ˆé€šè¿‡â€œå››æ¬¡æŒ¥æ‰‹â€ï¼‰ã€‚è¿™å°±åƒæ‰“ç”µè¯ï¼Œéœ€è¦å…ˆæ‹¨é€šï¼Œé€šè¯ï¼Œå†æŒ‚æ–­ã€‚</li>
<li><strong>å¯é çš„</strong>ï¼šTCP ä½¿ç”¨å„ç§æœºåˆ¶ï¼ˆå¦‚ç¡®è®¤åº”ç­”ã€è¶…æ—¶é‡ä¼ ã€åºåˆ—å·ç­‰ï¼‰æ¥ç¡®ä¿æ•°æ®èƒ½å¤Ÿå‡†ç¡®ã€ä¸é‡å¤ã€ä¸å¤±åºåœ°åˆ°è¾¾å¯¹æ–¹ã€‚</li>
<li><strong>åŸºäºå­—èŠ‚æµ</strong>ï¼šTCP å°†åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æ•°æ®ä»…ä»…è§†ä¸ºä¸€è¿ä¸²æ— ç»“æ„çš„å­—èŠ‚æµã€‚å®ƒä¸å…³å¿ƒè¿™äº›å­—èŠ‚æµä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼ˆå¦‚å›¾ç‰‡ã€æ–‡å­—ï¼‰ï¼Œå®ƒåªè´Ÿè´£å°†è¿™äº›å­—èŠ‚æµå¯é åœ°ä¼ è¾“åˆ°å¯¹ç«¯ã€‚æ¥æ”¶æ–¹åº”ç”¨ç¨‹åºéœ€è¦è‡ªå·±è§£æè¿™äº›å­—èŠ‚æµã€‚</li>
</ol>
<h3 id="11-tcpserver-">1.1 tcpserver-æœåŠ¡ç«¯</h3>
<ul>
<li>é˜»å¡ç›‘å¬IP+ç«¯å£</li>
<li>å®¢æˆ·ç«¯è¯·æ±‚æ¥æ”¶ï¼Œå»ºç«‹è¿æ¥</li>
<li>åˆ›å»ºgoroutineå¤„ç†è¯·æ±‚</li>
<li>å…³é—­è¿æ¥</li>
<li>å…³é—­ç›‘å¬æœåŠ¡</li>
</ul>
<pre><code class="language-go">/**/

package main

import (
    &quot;bufio&quot;
    &quot;log&quot;
    &quot;net&quot;
)

func main() {
    // ç›‘å¬IP+ç«¯å£ -&gt; æ ‡è¯†æŸä¸€ä¸ªç¨‹åº
    listen, err := net.Listen(&quot;tcp&quot;, &quot;127.0.0.1:8080&quot;)
    if err != nil {
        log.Fatalln(err)
    }
    defer listen.Close()

    for {
        // é˜Ÿåˆ—æ¶ˆæ¯æ¥æ”¶ / å»ºç«‹è¿æ¥
        conn, err := listen.Accept()
        if err != nil {
            continue
        }
        // åç¨‹å¤„ç†
        go process(conn)

    }
}

func process(conn net.Conn) {
    defer conn.Close()

    for {
        buf := make([]byte, 1024)
        reader := bufio.NewReader(conn)
        n, err := reader.Read(buf) // è¯»å–æ•°æ® - æ¥æ”¶
        if err != nil {
            log.Println(err)
            break
        }
        log.Printf(&quot;[client] %s&quot;, string(buf[:n]))

        _, err = conn.Write(buf[:n]) // å†™å…¥æ•°æ® - è¿”å›
        if err != nil {
            log.Fatalln(err)
        }
    }
}

</code></pre>
<h3 id="12-tcpclient-">1.2 tcpclient-å®¢æˆ·ç«¯</h3>
<ul>
<li>å»ºç«‹äºæœåŠ¡ç«¯çš„è¿æ¥</li>
<li>è¿›è¡Œæ•°æ®æ”¶å‘</li>
<li>å…³é—­è¿æ¥</li>
</ul>
<pre><code class="language-go">/**/

package main

import (
    &quot;bufio&quot;
    &quot;log&quot;
    &quot;net&quot;
    &quot;os&quot;
    &quot;strings&quot;
    &quot;unicode/utf8&quot;
)

func main() {
    dial, err := net.Dial(&quot;tcp&quot;, &quot;127.0.0.1:8080&quot;)
    if err != nil {
        log.Fatalln(err)
    }
    defer dial.Close()

    reader := bufio.NewReader(os.Stdin) // æ¥æ”¶ç”¨æˆ·è¾“å…¥

    for {
        text, _ := reader.ReadString('\n') // è¯»å–ç”¨æˆ·è¾“å…¥
        trim := strings.Trim(text, &quot;\r\n&quot;)
        count := utf8.RuneCountInString(trim)
        if count &gt; 50 {
            log.Println(&quot;è¾“å…¥çš„å­—ç¬¦é•¿åº¦ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦&quot;)
            continue
        }
        if strings.ToUpper(trim) == &quot;Q&quot; {
            break // å¦‚æœè¯»å–è¾“å…¥çš„æ˜¯q/Qï¼Œåˆ™é€€å‡ºè¾“å…¥
        }

        // è¾“å…¥ä¸€æ¬¡å†™å…¥ä¸€æ¬¡æ•°æ® / æ•°æ®äº¤æ¢ - å‘èµ·è¯·æ±‚
        _, err = dial.Write([]byte(trim))
        if err != nil {
            log.Println(err)
        }

        // æ•°æ®è¯»å– - è¿”å›æ¥æ”¶
        buf := make([]byte, len(trim))
        _, err = dial.Read(buf)
        if err != nil {
            log.Fatalln(err)
        }
        log.Printf(&quot;[server] %s&quot;, string(buf))
    }
}

</code></pre>
<h2 id="2-udp">2 UDPç½‘ç»œç¼–ç¨‹</h2>
<p><strong>UDPåè®®ï¼šUDP</strong> æ˜¯ä¸€ç§<strong>æ— è¿æ¥çš„ã€ä¸å¯é çš„</strong>ä¼ è¾“å±‚åè®®ï¼›å®æ—¶æ€§å¥½ï¼Œé€šå¸¸ç”¨äºå¼€å‘ç½‘ç»œç›´æ’­åº”ç”¨åœºæ™¯ã€‚</p>
<ol>
<li><strong>ä¼ è¾“å±‚åè®®</strong>ï¼šå’Œ TCP ä¸€æ ·ï¼Œå·¥ä½œåœ¨ OSI æ¨¡å‹çš„ç¬¬å››å±‚ï¼Œä¸ºåº”ç”¨å±‚æä¾›æœåŠ¡ã€‚</li>
<li><strong>æ— è¿æ¥</strong>ï¼šåœ¨é€šä¿¡ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ã€‚æƒ³å‘é€æ•°æ®æ—¶ç›´æ¥å‘é€å³å¯ã€‚è¿™å°±åƒå¯„æ˜ä¿¡ç‰‡ï¼Œå†™ä¸Šåœ°å€å†…å®¹å°±ç›´æ¥æŠ•é€’ï¼Œä¸å…³å¿ƒå¯¹æ–¹æ˜¯å¦æ”¶åˆ°ã€‚</li>
<li><strong>ä¸å¯é </strong>ï¼šå®ƒä¸æä¾›æ•°æ®åŒ…çš„åˆ†ç»„ã€ç»„è£…ã€æ’åºï¼Œä¹Ÿä¸ä¿è¯æ•°æ®åŒ…ä¸€å®šä¼šåˆ°è¾¾ç›®çš„åœ°ã€‚å¦‚æœæŠ¥æ–‡åœ¨ä¸­é€”ä¸¢å¤±ï¼ŒUDP ä¸ä¼šé‡ä¼ ã€‚å®ƒçš„æ ¸å¿ƒä»»åŠ¡å°±æ˜¯â€œå‘é€â€ï¼Œè‡³äºç»“æœå¦‚ä½•ï¼Œå®ƒä¸ç®¡ã€‚</li>
<li><strong>åŸºäºæ•°æ®æŠ¥</strong>ï¼šä¸ TCP çš„â€œå­—èŠ‚æµâ€ä¸åŒï¼ŒUDP ä¼ è¾“çš„æ˜¯ä¸€ä¸ªä¸ªç‹¬ç«‹çš„æŠ¥æ–‡ï¼ˆç§°ä¸ºæ•°æ®æŠ¥ï¼‰ã€‚æ¯ä¸ªæŠ¥æ–‡éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å•å…ƒï¼Œå‘é€å’Œæ¥æ”¶éƒ½æœ‰æ˜ç¡®çš„è¾¹ç•Œã€‚åº”ç”¨ç¨‹åºå‘é€å¤šå°‘æ¬¡ï¼Œæ¥æ”¶æ–¹å°±ä¼šæ”¶åˆ°å¤šå°‘æ¬¡ï¼Œä¸ä¼šå‡ºç°ç²˜åŒ…é—®é¢˜ã€‚</li>
</ol>
<h3 id="21-udpserver-">2.1 udpserver-æœåŠ¡ç«¯</h3>
<pre><code class="language-go">/**/

package main

import (
    &quot;log&quot;
    &quot;net&quot;
)

func main() {
    listenUDP, err := net.ListenUDP(
        &quot;udp&quot;,
        &amp;net.UDPAddr{
            IP:   net.IPv4(0, 0, 0, 0),
            Port: 30030,
        })
    if err != nil {
        log.Fatalln(err)
    }
    defer listenUDP.Close()

    // /////////UDPåè®®ä¸éœ€è¦è¿æ¥/////////
    for {
        buf := make([]byte, 1024)
        n, addr, err := listenUDP.ReadFromUDP(buf) // è¯»å–æ•°æ®ä¼šè·å–åˆ°å‘é€çš„IPåœ°å€
        if err != nil {
            log.Fatalln(&quot;error reading UDP msg buf:&quot;, err)
        }
        log.Printf(&quot;[server] [%s] %s\n&quot;, addr, buf[:n])
        _, err = listenUDP.WriteToUDP(buf[:n], addr) // å‘å‘é€çš„IPåœ°å€è¿”å›æ•°æ®
    }
}

</code></pre>
<h3 id="22-udpclient-">2.2 udpclient-å®¢æˆ·ç«¯</h3>
<pre><code class="language-go">/**/

package main

import (
    &quot;bufio&quot;
    &quot;log&quot;
    &quot;net&quot;
    &quot;os&quot;
    &quot;strings&quot;
    &quot;unicode/utf8&quot;
)

func main() {
    dialUDP, err := net.DialUDP(&quot;udp&quot;, nil, &amp;net.UDPAddr{
        IP:   net.IPv4(127, 0, 0, 1),
        Port: 30030,
    })
    if err != nil {
        log.Fatalln(err)
    }
    defer dialUDP.Close()

    reader := bufio.NewReader(os.Stdin) // æ¥æ”¶ç”¨æˆ·è¾“å…¥

    for {
        text, _ := reader.ReadString('\n') // è¯»å–ç”¨æˆ·è¾“å…¥
        trim := strings.Trim(text, &quot;\r\n&quot;)
        count := utf8.RuneCountInString(trim)
        if count &gt; 50 {
            log.Println(&quot;è¾“å…¥çš„å­—ç¬¦é•¿åº¦ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦&quot;)
            continue
        }
        if strings.ToUpper(trim) == &quot;Q&quot; {
            break // å¦‚æœè¯»å–è¾“å…¥çš„æ˜¯q/Qï¼Œåˆ™é€€å‡ºè¾“å…¥
        }

        // è¾“å…¥ä¸€æ¬¡å†™å…¥ä¸€æ¬¡æ•°æ® / æ•°æ®äº¤æ¢ - å‘èµ·è¯·æ±‚
        _, err = dialUDP.Write([]byte(trim))
        if err != nil {
            log.Println(err)
        }

        // æ•°æ®è¯»å– - è¿”å›æ¥æ”¶
        buf := make([]byte, len(trim))
        _, err = dialUDP.Read(buf)
        if err != nil {
            log.Fatalln(err)
        }
        log.Printf(&quot;[client] %s&quot;, string(buf))
    }

}

</code></pre>
<h2 id="3-http">3 HTTPç½‘ç»œç¼–ç¨‹</h2>
<h3 id="31-httpserver">3.1 httpserver</h3>
<p>è¿™éƒ¨åˆ†å±äºwebåç«¯å¼€å‘å†…å®¹</p>
<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;log&quot;
    &quot;net/http&quot;
)

func main() {
    http.HandleFunc(&quot;/login&quot;, login)         // å•ç‹¬æ·»åŠ å›è°ƒå‡½æ•°
    err := http.ListenAndServe(&quot;:8000&quot;, nil) // IP:PORTã€å›è°ƒå‡½æ•°
    if err != nil {
        log.Fatalln(err)
    }
}
func login(w http.ResponseWriter, r *http.Request) {
    // è¯·æ±‚ä¿¡æ¯
    fmt.Println(&quot;è¯·æ±‚IP:&quot;, r.RemoteAddr)
    fmt.Println(&quot;è¯·æ±‚æ–¹å¼ï¼š&quot;, r.Method)
    fmt.Println(&quot;è¯·æ±‚è·¯å¾„ï¼š&quot;, r.URL.Path)
    fmt.Println(&quot;Headerï¼š&quot;, r.Header)
    fmt.Println(&quot;Bodyï¼š&quot;, r.Body)

    // è·å–GETè¯·æ±‚æ•°æ®
    username := r.URL.Query().Get(&quot;username&quot;)
    password := r.URL.Query().Get(&quot;password&quot;)
    log.Printf(&quot;[client] username:%s&quot;, username)
    log.Printf(&quot;[client] password:%s&quot;, password)

    if username == &quot;admin&quot; &amp;&amp; password == &quot;123456&quot; {
        w.Write([]byte(&quot;ç™»å½•æˆåŠŸ&quot;))
    } else {
        w.Write([]byte(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;))
    }
}

</code></pre>
<h3 id="32-httpclient">3.2 httpclient</h3>
<p>ä¸€èˆ¬æµè§ˆå™¨å°±æ˜¯ä¸€ç§httpå®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬åƒpostmanç­‰ç½‘ç»œæ¥å£æµ‹è¯•è½¯ä»¶</p>
<pre><code class="language-go">package main

import (
    &quot;io&quot;
    &quot;log&quot;
    &quot;net/http&quot;
)

func main() {
    // å‘é€GETè¯·æ±‚
    resp, err := http.Get(&quot;http://localhost:8000/login?username=admin&amp;password=123456&quot;)
    if err != nil {
        log.Fatalln(err)
    }
    defer resp.Body.Close()

    // body, err := io.ReadAll(resp.Body) // ä¸€æ¬¡æ€§è¯»å–å…¨éƒ¨å†…å®¹
    // log.Printf(&quot;[client] %s&quot;, string(body))

    var totalBytes []byte
    for {
        // è¯»å–å“åº”ä¿¡æ¯
        buf := make([]byte, 1024)
        n, err := resp.Body.Read(buf)
        if err != nil {
            if err == io.EOF {
                break
            }
            log.Fatalln(err)
        }
        totalBytes = append(totalBytes, buf[:n]...)
    }

    log.Printf(&quot;[client] %s&quot;, string(totalBytes))
}

</code></pre>
<h1 id="gocontext">ğŸ“š Goè¯­è¨€Context</h1>
<p>å¹¶å‘ç¼–ç¨‹æ˜¯Goè¯­è¨€çš„ç‰¹è‰²ï¼›æœ‰æ•ˆç®¡ç†å¹¶å‘å¯¹å°±è§ç¨³å®šå¥å£®çš„ç¨‹åºè‡³å…³é‡è¦ï¼</p>
<p><code>context</code> æ˜¯ç¼–å†™å¥å£®ã€å¯æ§åˆ¶çš„å¹¶å‘ Go ç¨‹åºçš„åŸºçŸ³ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œæœåŠ¡ä¸­ï¼Œå‡ ä¹æ˜¯å¿…ä¸å¯å°‘çš„å·¥å…·ã€‚</p>
<p>å®ƒçš„ä¸»è¦è®¾è®¡ç›®çš„æ˜¯<strong>åœ¨å¤šä¸ª Goroutine ä¹‹é—´ä¼ é€’è¯·æ±‚åŸŸçš„æˆªæ­¢æ—¶é—´ã€å–æ¶ˆä¿¡å·ä»¥åŠå…¶ä»–é”®å€¼å¯¹ä¿¡æ¯</strong>ã€‚</p>
<h2 id="1-context">1 æ ¹context</h2>
<p>contextçš„è®¾è®¡å°±åƒæ˜¯ä¸€æ£µæ ‘ï¼Œå±‚å±‚æ´¾ç”Ÿç»“æ„ã€‚</p>
<p>Go çš„ <code>context</code> åŒ…æä¾›äº†ä¸¤ä¸ªå‡½æ•°æ¥åˆ›å»ºæ ¹ Contextï¼š</p>
<h3 id="11-contextbackground">1.1 context.Background()</h3>
<ul>
<li><strong>è¿™æ˜¯æœ€å¸¸ç”¨çš„ã€æ ‡å‡†çš„æ ¹ Contextã€‚</strong></li>
<li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</li>
<li>ç”¨åœ¨ <code>main</code> å‡½æ•°çš„å¼€å¤´ã€‚</li>
<li>ç”¨åœ¨åˆå§‹åŒ–å‡½æ•°ï¼ˆ<code>init</code>ï¼‰ä¸­ã€‚</li>
<li>ç”¨ä½œæµ‹è¯•çš„èµ·ç‚¹ã€‚</li>
<li><strong>ç®€å•è¯´ï¼šå½“ä½ æ˜¯æ•´ä¸ªè°ƒç”¨é“¾çš„å‘èµ·è€…æ—¶ï¼Œå°±ç”¨å®ƒã€‚</strong></li>
</ul>
<h3 id="12-contexttodo">1.2 context.TODO()</h3>
<ul>
<li><strong>å®ƒå’Œ <code>Background()</code> åœ¨åŠŸèƒ½ä¸Šå®Œå…¨ä¸€æ ·</strong>ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç©ºçš„ã€æ°¸ä¸å–æ¶ˆçš„æ ¹ Contextã€‚</li>
<li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</li>
<li><strong>å ä½ç¬¦</strong>ï¼šå½“ä½ ä¸ç¡®å®šè¯¥ä½¿ç”¨å“ªä¸ª Context æ—¶ï¼Œå…ˆç”¨ <code>TODO()</code> å ä½ã€‚</li>
<li><strong>é‡æ„æœŸ</strong>ï¼šåœ¨é‡æ„ä»£ç ï¼Œå‡†å¤‡æ·»åŠ  Context å‚æ•°ä½†è¿˜æ²¡æƒ³å¥½å¦‚ä½•é›†æˆæ—¶ä½¿ç”¨ã€‚</li>
<li><strong>é™æ€åˆ†æ</strong>ï¼šå®ƒçš„åå­— <code>TODO</code> å°±åƒä¸€ä¸ªç»™å¼€å‘è€…å’Œä»£ç åˆ†æå·¥å…·çš„<strong>æ˜¾å¼æé†’</strong>â€”â€”â€œè¿™é‡Œå°†æ¥å¯èƒ½éœ€è¦ä¸€ä¸ªçœŸæ­£çš„ Contextï¼Œä½†ç›®å‰æš‚æ—¶è¿™æ ·â€ã€‚ä½ åº”è¯¥åœ¨æœ€ç»ˆä»£ç ä¸­å°†å®ƒæ›¿æ¢ä¸ºåˆé€‚çš„ Contextã€‚</li>
<li><strong>è®°å¿†æŠ€å·§</strong>ï¼šå°±åƒä½ åœ¨ä»£ç é‡Œå†™ <code>// TODO: Implement this later</code> ä¸€æ ·ï¼Œ<code>context.TODO()</code> æ˜¯ä¸€ä¸ªå¾…åŠäº‹é¡¹ã€‚</li>
</ul>
<h3 id="13-context">1.3 æ ¹contextæ´¾ç”Ÿ</h3>
<p><code>context</code> åŒ…æä¾›äº†å‡½æ•°æ¥åŸºäºçˆ¶ Context åˆ›å»ºå­ Contextï¼Œä»è€Œæ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align: left;">å‡½æ•°</th>
<th style="text-align: left;">å¼•å…¥ç‰ˆæœ¬</th>
<th style="text-align: left;">æ ¸å¿ƒåŠŸèƒ½</th>
<th style="text-align: left;">å¸¸ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong><code>WithCancel</code></strong></td>
<td style="text-align: left;">Go 1.7</td>
<td style="text-align: left;">åˆ›å»ºå¯<strong>æ‰‹åŠ¨å–æ¶ˆ</strong>çš„ Contextã€‚</td>
<td style="text-align: left;">æ‰‹åŠ¨æ§åˆ¶å–æ¶ˆï¼Œå¦‚ç”¨æˆ·ä¸­æ–­ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>WithTimeout</code></strong></td>
<td style="text-align: left;">Go 1.7</td>
<td style="text-align: left;">åˆ›å»º<strong>ç›¸å¯¹è¶…æ—¶</strong>åè‡ªåŠ¨å–æ¶ˆçš„ Contextã€‚</td>
<td style="text-align: left;"><strong>æœ€å¸¸ç”¨</strong>ï¼Œä¸ºæ“ä½œè®¾ç½®æœ€å¤§æ‰§è¡Œæ—¶é—´ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>WithDeadline</code></strong></td>
<td style="text-align: left;">Go 1.7</td>
<td style="text-align: left;">åˆ›å»º<strong>ç»å¯¹æˆªæ­¢æ—¶é—´</strong>åè‡ªåŠ¨å–æ¶ˆçš„ Contextã€‚</td>
<td style="text-align: left;">æ“ä½œå¿…é¡»åœ¨æŸä¸ªå…·ä½“æ—¶é—´ç‚¹å‰å®Œæˆã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>WithValue</code></strong></td>
<td style="text-align: left;">Go 1.7</td>
<td style="text-align: left;">åˆ›å»ºæºå¸¦<strong>è¯·æ±‚åŸŸé”®å€¼å¯¹</strong>çš„ Contextã€‚</td>
<td style="text-align: left;">ä¼ é€’è¯·æ±‚IDã€ç”¨æˆ·ä»¤ç‰Œç­‰ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>WithCancelCause</code></strong></td>
<td style="text-align: left;">Go 1.20/1.21</td>
<td style="text-align: left;">åˆ›å»ºå¯é™„å¸¦<strong>å…·ä½“åŸå› </strong>çš„å–æ¶ˆ Contextã€‚</td>
<td style="text-align: left;">éœ€è¦æ˜ç¡®åŒºåˆ†å’Œä¼ é€’å–æ¶ˆåŸå› çš„é«˜çº§åœºæ™¯ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>WithoutCancel</code></strong></td>
<td style="text-align: left;">Go 1.21</td>
<td style="text-align: left;">åˆ›å»º<strong>è„±ç¦»çˆ¶Contextå–æ¶ˆé“¾</strong>çš„ Contextã€‚</td>
<td style="text-align: left;">æ‰§è¡Œä¸å—ä¸»è¯·æ±‚å½±å“çš„ç‹¬ç«‹åå°ä»»åŠ¡ã€‚</td>
</tr>
</tbody>
</table>
<p>æ ¹ Context æœ¬èº«æ²¡ä»€ä¹ˆç”¨ï¼Œå®ƒçš„å¼ºå¤§ä¹‹å¤„åœ¨äºä½œä¸º<strong>æ´¾ç”Ÿ</strong>çš„èµ·ç‚¹ã€‚</p>
<p>æ•´ä¸ª Context çš„ä½¿ç”¨æµç¨‹å°±åƒä¸€æ£µæ ‘çš„ç”Ÿé•¿ï¼š<strong>æ ¹ Context -&gt; æ´¾ç”Ÿå…·æœ‰åŠŸèƒ½çš„å­ Context -&gt; ç»§ç»­æ´¾ç”Ÿ -&gt; ... -&gt; åœ¨ Goroutine ä¸­ä½¿ç”¨</strong></p>
<pre><code class="language-go">package main

import (
    &quot;context&quot;
    &quot;fmt&quot;
    &quot;time&quot;
)

func main() {
    // ç¬¬1æ­¥ï¼šåˆ›å»ºæ ¹Context
    // è¿™é‡Œæ˜¯æ•´ä¸ªç¨‹åºçš„èµ·ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ Background()
    rootCtx := context.Background()

    // ç¬¬2æ­¥ï¼šä»æ ¹Contextæ´¾ç”Ÿä¸€ä¸ªå­Context
    // è¿™ä¸ªå­Contextå…·å¤‡äº†è¶…æ—¶å–æ¶ˆçš„åŠŸèƒ½ï¼ˆ1ç§’åè‡ªåŠ¨å–æ¶ˆï¼‰
    // ctx æ˜¯æ–°çš„å­Context
    // cancelFunc æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè°ƒç”¨å®ƒå¯ä»¥æ‰‹åŠ¨æå‰å–æ¶ˆè¿™ä¸ªctx
    ctx, cancelFunc := context.WithTimeout(rootCtx, 3*time.Second)
    // éå¸¸é‡è¦ï¼šç¡®ä¿cancelå‡½æ•°è¢«è°ƒç”¨ï¼Œä»¥é‡Šæ”¾ç›¸å…³èµ„æºï¼Œé˜²æ­¢æ³„éœ²
    // å³ä½¿è¶…æ—¶è‡ªåŠ¨å‘ç”Ÿï¼Œè°ƒç”¨cancelä¹Ÿæ˜¯å®‰å…¨çš„ï¼ˆå¹‚ç­‰æ“ä½œï¼‰
    defer cancelFunc()

    // ç¬¬3æ­¥ï¼šå°†æ´¾ç”Ÿå‡ºçš„ã€æœ‰åŠŸèƒ½çš„ctxä¼ é€’ç»™éœ€è¦å®ƒçš„å‡½æ•°
    // è¿™ä¸ªå‡½æ•°ä¼šç›‘å¬ctxçš„å–æ¶ˆä¿¡å·
    doSomething(ctx)
}

func doSomething(ctx context.Context) {
    // åˆ›å»ºä¸€ä¸ªé€šé“ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªéœ€è¦é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼ˆ5ç§’ï¼‰
    done := make(chan struct{})

    go func() {
        time.Sleep(5 * time.Second) // æ¨¡æ‹Ÿè€—æ—¶å·¥ä½œ
        close(done)                 // å·¥ä½œå®Œæˆï¼Œå…³é—­é€šé“
    }()

    // ä½¿ç”¨selectåŒæ—¶ç­‰å¾…ä¸¤ä¸ªäº‹ä»¶ï¼šè¦ä¹ˆå·¥ä½œå®Œæˆï¼Œè¦ä¹ˆctxè¢«å–æ¶ˆ
    select {
    case &lt;-done:
        fmt.Println(&quot;å·¥ä½œå®Œæˆäº†ï¼&quot;)
    case &lt;-ctx.Done(): // ç›‘å¬ctxçš„å–æ¶ˆä¿¡å·ã€‚å¦‚æœçˆ¶contextè¶…æ—¶æˆ–è°ƒç”¨äº†cancelï¼Œè¿™é‡Œä¼šç«‹å³è§¦å‘
        // ctx.Err() ä¼šå‘Šè¯‰æˆ‘ä»¬å–æ¶ˆçš„åŸå› 
        err := ctx.Err()
        fmt.Printf(&quot;å·¥ä½œè¢«å–æ¶ˆäº†ï¼ŒåŸå› : %s\n&quot;, err)
    }
}
</code></pre>
<h2 id="2-context">2 è¶…æ—¶æ§åˆ¶context</h2>
<h3 id="21-withtimeout">2.1 åŸºæœ¬ç¤ºä¾‹-WithTimeout()</h3>
<p><strong>WithTimeout</strong>: è¿”å›ä¸€ä¸ªå…·æœ‰è¶…æ—¶æ—¶é—´çš„ Contextã€‚<strong>ä½¿ç”¨é¢‘ç‡å¾ˆé«˜</strong>ï¼Œä¾‹å¦‚ä¸ºæ•°æ®åº“æŸ¥è¯¢è®¾ç½®è¶…æ—¶</p>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦ä»å¤šä¸ªAPIå¹¶å‘è·å–æ•°æ®ï¼ŒæŸä¸ªæ¥å£è¶…æ—¶äº†ï¼Œå°±å°†å…¶è¯·æ±‚å–æ¶ˆæ‰ï¼›ä¸€èˆ¬è¿™ç§æƒ…æ™¯éƒ½æ˜¯å‘å¤–éƒ¨APIè·å–æ•°æ®ï¼Œè¿™é‡Œç”¨æœ¬åœ°æ¥å£åšå®éªŒã€‚</p>
<p><strong>å¤–éƒ¨çš„æœåŠ¡ï¼šå®é™…åœºæ™¯æœ¬åœ°æœåŠ¡éœ€è¦è°ƒç”¨å¤–éƒ¨æœåŠ¡æ¥å£ï¼ˆå®éªŒç”¨çš„æœ¬åœ°æ¥å£ï¼‰</strong></p>
<pre><code class="language-go">package main

import (
    &quot;context&quot;
    &quot;encoding/json&quot;
    &quot;fmt&quot;
    &quot;io&quot;
    &quot;log&quot;
    &quot;net/http&quot;
    &quot;sync&quot;
    &quot;time&quot;
)

type Result struct {
    Url     string         `json:&quot;url&quot;`             // è¯·æ±‚çš„ URL åœ°å€
    Message string         `json:&quot;message&quot;`         // è®¾ç½®ä¿¡æ¯
    Error   error          `json:&quot;error,omitempty&quot;` // è¯·æ±‚è¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯
    Latency time.Duration  `json:&quot;latency&quot;`         // è¯·æ±‚è€—æ—¶ï¼ˆä»å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´é—´éš”ï¼‰
    Size    int64          `json:&quot;size&quot;`            // å“åº”ä½“ï¼ˆResponse Bodyï¼‰çš„å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰
    Status  int            `json:&quot;status&quot;`          // HTTP çŠ¶æ€ç ï¼ˆå¦‚ 200, 404, 500ç­‰ï¼‰
    Resp    *http.Response `json:&quot;-&quot;`               // ä½¿ç”¨ - å¿½ç•¥è¯¥å­—æ®µ
}

func main() {
    // ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
    callTime, _ := time.Parse(time.DateTime, &quot;2025-08-23 00:00:00&quot;)
    // callTime := time.Now().Add(5 * time.Second)
    fmt.Println(callTime)
    ctx, cancel := context.WithDeadline(context.Background(), callTime)
    defer cancel() // ä¿è¯æœ€ç»ˆä»»åŠ¡éƒ½è¦ç»“æŸ

    urls := []string{
        &quot;http://localhost:8000/test1&quot;,
        &quot;http://localhost:8000/test2&quot;,
        &quot;http://localhost:8000/test3&quot;,
    }

    // æ‰§è¡Œç»“æœé€šé“æ•°æ®
    results := make(chan Result, len(urls))

    // ä½¿ç”¨WaitGroupç­‰å¾…æ‰€æœ‰goroutineå®Œæˆ
    var wg sync.WaitGroup

    for _, url := range urls {
        wg.Add(1)
        // åŒ¿åå‡½æ•°æ–¹ä¾¿è·å–æ‰§è¡Œæ˜¯å¦ç»“æŸ
        go func(u string) {
            defer wg.Done()
            fetchAPI(ctx, u, results)
        }(url)
    }

    wg.Wait()
    close(results)

    for result := range results {
        marshal, err := json.Marshal(result)
        if err != nil {
            panic(err)
        }
        log.Println(string(marshal))
    }

}

func fetchAPI(ctx context.Context, url string, results chan&lt;- Result) {
    startTime := time.Now()
    result := Result{Url: url}

    req, err := http.NewRequestWithContext(ctx, &quot;GET&quot;, url, nil)
    if err != nil {
        result.Message = fmt.Sprintf(&quot;Failed to create request object based on context, err: %v&quot;, err)
        result.Latency = time.Since(startTime)
        // result.Error = err
        results &lt;- result
        return
    }

    resp, err := http.DefaultClient.Do(req)
    if err != nil {
        result.Message = fmt.Sprintf(&quot;Fetch API exception, err: %v&quot;, err)
        result.Latency = time.Since(startTime)
        // result.Error = err
        results &lt;- result
        return
    }
    defer resp.Body.Close() // ç»“æŸæ—¶å…³é—­è¯·æ±‚æ•°æ®æµ

    respBody, err := io.ReadAll(resp.Body)
    if err != nil {
        result.Message = fmt.Sprintf(&quot;Read body exception, err: %v&quot;, err)
        result.Latency = time.Since(startTime)
        // result.Error = err
        result.Status = resp.StatusCode
        result.Resp = resp
        results &lt;- result
        return
    }
    log.Println(&quot;resp.Body:&quot;, string(respBody))

    result.Message = fmt.Sprintf(&quot;Fetch API Success, Url: %s, Status: %v, Content: %s&quot;, url, resp.StatusCode, respBody)
    result.Latency = time.Since(startTime)
    // result.Error = err
    result.Size = int64(len(respBody))
    result.Status = resp.StatusCode
    result.Resp = resp
    results &lt;- result
}

</code></pre>
<p><strong>æˆ‘ä»¬çš„æœåŠ¡ï¼šéœ€è¦è°ƒç”¨å¤–éƒ¨æœåŠ¡æ¥å£ï¼ˆå®éªŒç”¨çš„æœ¬åœ°æ¥å£ï¼‰</strong></p>
<ol>
<li>åˆ›å»ºç»“æœå­˜å‚¨çš„ç»“æ„ä½“ï¼›</li>
<li>åˆ›å»ºåç¨‹é€šé“å­˜å‚¨ç»“æœç»“æ„ä½“ï¼›</li>
<li>åˆ›å»ºåç¨‹ä¸Šä¸‹æ–‡è¶…æ—¶ç®¡ç†å™¨ï¼ˆcontext.WithTimeoutï¼‰ï¼›</li>
<li>åç¨‹æ‰§è¡Œå‡½æ•°ä¸­ï¼Œä½¿ç”¨åç¨‹ä¸Šä¸‹æ–‡è¶…æ—¶ç®¡ç†å™¨å»åˆ›å»ºè¯·æ±‚ï¼ˆreq,_  := http.NewRequestWithContext(ctx, "GET", url, nil)ï¼‰ï¼›</li>
<li>ä½¿ç”¨sync.WaitGroupç­‰å¾…æ‰€æœ‰goroutineæ‰§è¡Œå®Œæˆï¼›</li>
<li>ä½¿ç”¨httpé»˜è®¤å®¢æˆ·ç«¯å‡½æ•°å‘é€è¯·æ±‚ï¼ˆhttp.DefaultClient.Do(req)ï¼‰</li>
<li>å¯¹è¯·æ±‚å¤„ç†ï¼Œå°†é¢„æœŸç»“æœèµ‹å€¼åˆ°ç»“æœç»“æ„ä½“</li>
</ol>
<pre><code class="language-go">package main

import (
    &quot;context&quot;
    &quot;encoding/json&quot;
    &quot;fmt&quot;
    &quot;io&quot;
    &quot;log&quot;
    &quot;net/http&quot;
    &quot;sync&quot;
    &quot;time&quot;
)

type Result struct {
    Url     string         `json:&quot;url&quot;`             // è¯·æ±‚çš„ URL åœ°å€
    Message string         `json:&quot;message&quot;`         // è®¾ç½®ä¿¡æ¯
    Error   error          `json:&quot;error,omitempty&quot;` // è¯·æ±‚è¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯
    Latency time.Duration  `json:&quot;latency&quot;`         // è¯·æ±‚è€—æ—¶ï¼ˆä»å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´é—´éš”ï¼‰
    Size    int64          `json:&quot;size&quot;`            // å“åº”ä½“ï¼ˆResponse Bodyï¼‰çš„å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰
    Status  int            `json:&quot;status&quot;`          // HTTP çŠ¶æ€ç ï¼ˆå¦‚ 200, 404, 500ç­‰ï¼‰
    Resp    *http.Response `json:&quot;-&quot;`               // ä½¿ç”¨ - å¿½ç•¥è¯¥å­—æ®µ
}

func main() {
    ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
    defer cancel() // ä¿è¯æœ€ç»ˆä»»åŠ¡éƒ½è¦ç»“æŸ

    urls := []string{
        &quot;http://localhost:8000/test1&quot;,
        &quot;http://localhost:8000/test2&quot;,
        &quot;http://localhost:8000/test3&quot;,
    }

    // æ‰§è¡Œç»“æœé€šé“æ•°æ®
    results := make(chan Result, len(urls))

    // ä½¿ç”¨WaitGroupç­‰å¾…æ‰€æœ‰goroutineå®Œæˆ
    var wg sync.WaitGroup

    for _, url := range urls {
        wg.Add(1)
        // åŒ¿åå‡½æ•°æ–¹ä¾¿è·å–æ‰§è¡Œæ˜¯å¦ç»“æŸ
        go func(u string) {
            defer wg.Done()
            fetchAPI(ctx, u, results)
        }(url)
    }

    wg.Wait()  // ç­‰å…¨éƒ¨æ‰§è¡Œå®Œæˆ

    for result := range results {
        marshal, err := json.Marshal(result)
        if err != nil {
            panic(err)
        }
        log.Println(string(marshal))
    }

}

func fetchAPI(ctx context.Context, url string, results chan&lt;- Result) {
    startTime := time.Now()
    result := Result{Url: url}

    req, err := http.NewRequestWithContext(ctx, &quot;GET&quot;, url, nil)
    if err != nil {
        result.Message = fmt.Sprintf(&quot;Failed to create request object based on context, err: %v&quot;, err)
        result.Latency = time.Since(startTime)
        result.Error = err
        results &lt;- result
        return
    }

    resp, err := http.DefaultClient.Do(req)
    if err != nil {
        result.Message = fmt.Sprintf(&quot;Fetch API exception, err: %v&quot;, err)
        result.Latency = time.Since(startTime)
        result.Error = err
        results &lt;- result
        return
    }
    defer resp.Body.Close() // ç»“æŸæ—¶å…³é—­è¯·æ±‚æ•°æ®æµ

    respBody, err := io.ReadAll(resp.Body)
    if err != nil {
        result.Message = fmt.Sprintf(&quot;Read body exception, err: %v&quot;, err)
        result.Latency = time.Since(startTime)
        result.Error = err
        result.Status = resp.StatusCode
        result.Resp = resp
        results &lt;- result
        return
    }
    log.Println(&quot;resp.Body:&quot;, string(respBody))

    result.Message = fmt.Sprintf(&quot;Fetch API Success, Url: %s, Status: %v, Content: %s&quot;, url, resp.StatusCode, respBody)
    result.Latency = time.Since(startTime)
    result.Error = err
    result.Size = int64(len(respBody))
    result.Status = resp.StatusCode
    result.Resp = resp
    results &lt;- result
}

</code></pre>
<h3 id="22-context">2.2 è¶…æ—¶contextç›¸å…³å†…ç½®æ–¹æ³•</h3>
<p>è¶…æ—¶contextæœ‰å››ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>Deadline()ï¼šè¿”å›è¶…æ—¶æˆªæ­¢æ—¶é—´ï¼ˆå½“çˆ¶å­æ´¾ç”Ÿæ—¶ï¼Œä¸”çˆ¶å­éƒ½æœ‰ä¸€ä¸ªæˆªæ­¢æ—¶é—´ï¼›åˆ™æ­¤æ—¶è¿”å›å…¶ä¸­è¾ƒå°çš„é‚£ä¸ªæˆªæ­¢æ—¶é—´ï¼‰</li>
<li>Done()ï¼šcontextå–æ¶ˆåä¼šè°ƒç”¨</li>
<li>Err()ï¼šDoneè¿”å›åï¼Œä½¿ç”¨Err()å¯ä»¥è·å–ç»“æŸåŸå› </li>
<li>Value()ï¼šè·å–é”®å€¼</li>
</ul>
<pre><code class="language-go">package main

import (
    &quot;context&quot;
    &quot;log&quot;
    &quot;time&quot;
)

const timeOutNumber = 5 // è®¾ç½®è¶…æ—¶

func main() {
    rootCtx := context.Background()
    ctx, cancel := context.WithTimeout(rootCtx, time.Duration(timeOutNumber)*time.Second)
    defer cancel()

    go process(ctx) // å¾ªç¯æ‰§è¡Œä»»åŠ¡æ—¶æ¯æ¬¡æ£€æŸ¥æ˜¯å¦è¶…æ—¶
    // processNew(ctx) // ç›‘å¬å¤šä¸ªé€šé“æ–¹å¼

    time.Sleep(10 * time.Second)
    log.Println(&quot;Main Goroutine is Done&quot;)
}

func process(ctx context.Context) {
    // å®é™…å·¥ä½œæ”¾åœ¨è¿™é‡Œ
    for i := 0; i &lt; 10; i++ {
        select {
        case &lt;-ctx.Done():
            log.Println(&quot;Process: Canceled during work&quot;)
            return
        default:
            // æ‰§è¡Œå·¥ä½œå•å…ƒ
            time.Sleep(500 * time.Millisecond)
            log.Println(&quot;Process: Doing work&quot;, i)
        }
    }
    log.Println(&quot;Process: All work completed&quot;)
}

func processNew(ctx context.Context) {
    // 1. åˆ›å»ºä¸€ä¸ªæ— ç¼“å†²channelç”¨äºé€šçŸ¥å·¥ä½œå®Œæˆ
    done := make(chan struct{})

    // 2. å¯åŠ¨goroutineæ‰§è¡Œå®é™…å·¥ä½œ
    go func() {
        time.Sleep(6 * time.Second) // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        close(done)                 // å·¥ä½œå®Œæˆåå…³é—­channelï¼Œè§¦å‘doneé€šé“åˆå§‹åŒ–å®Œæˆæœ‰é›¶å€¼
    }()

    // 3. åŒæ—¶ç›‘å¬ä¸¤ä¸ªchannel
    select {
    case &lt;-ctx.Done(): // ä¸Šä¸‹æ–‡è¢«å–æ¶ˆ/è¶…æ—¶
        log.Println(&quot;Process: Timeout or canceled&quot;)
        return
    case &lt;-done: // å·¥ä½œæ­£å¸¸å®Œæˆ
        log.Println(&quot;Process: Work completed successfully&quot;)
    }
}

</code></pre>
<h3 id="23-withtimeoutcause">2.3 WithTimeoutCause()</h3>
<p><strong>WithTimeoutCause()</strong>æ˜¯Go 1.21æ–°å¢ç‰¹æ€§ï¼›ä¸<strong>WithTimeout()</strong>ä¸åŒçš„æ˜¯ï¼Œ<strong>WithTimeoutCause()</strong>åˆ›å»ºçš„contextï¼Œå¯ä»¥è‡ªå®šä¹‰é”™è¯¯ï¼Œå¢å¼ºæŸ¥çœ‹æ—¥å¿—æ—¶çš„å®ç”¨æ€§ï¼›</p>
<p>ä½¿ç”¨ï¼š<strong>context.Cause(ctx)</strong> è·å–è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯</p>
<pre><code class="language-go">rootCtx := context.Background()
// ctx, cancel := context.WithTimeout(rootCtx, time.Duration(timeOutNumber)*time.Second)
ctx, cancel := context.WithTimeoutCause(rootCtx, time.Duration(timeOutNumber)*time.Second, errors.New(&quot;åç¨‹ä»»åŠ¡å·²è¶…æ—¶ï¼&quot;))
defer cancel()

// ...
case &lt;-ctx.Done():
    log.Printf(&quot;Process: Canceled during work; Error: %s; Cause: %s\n&quot;, ctx.Err(), context.Cause(ctx))
    return
// ...
</code></pre>
<h2 id="3-context">3 å€¼ä¼ é€’context</h2>
<p><strong>WithValue</strong>: ç”¨äºåœ¨ Context ä¸­å­˜å‚¨é”®å€¼å¯¹ã€‚<strong>åº”è°¨æ…ä½¿ç”¨ä¸è¦æ»¥ç”¨ï¼Œä»…ç”¨äºä¼ é€’è¯·æ±‚åŸŸçš„æ•°æ®ï¼ˆå¦‚è¯·æ±‚IDã€ç”¨æˆ·è®¤è¯ä»¤ç‰Œï¼‰ï¼Œè€Œä¸åº”ä¼ é€’å‡½æ•°å¯é€‰å‚æ•°æˆ–ç¨‹åºè¿è¡Œæ—¶çš„å˜é‡</strong></p>
<pre><code class="language-go">package main

import (
    &quot;context&quot;
    &quot;fmt&quot;
    &quot;github.com/google/uuid&quot;
    &quot;sync&quot;
)

func main() {
    var wg sync.WaitGroup

    requestID, _ := uuid.NewRandom()

    rootCtx := context.Background()
    ctx1 := context.WithValue(rootCtx, &quot;requestID&quot;, requestID) // æ ¹æ´¾ç”Ÿ
    ctx2 := context.WithValue(ctx1, &quot;userID&quot;, 5)               // ctx1æ´¾ç”Ÿ

    func(ctx context.Context) {
       defer wg.Done()
       wg.Add(1)
       go process(ctx)
    }(ctx1)

    func(ctx context.Context) {
       defer wg.Done()
       wg.Add(1)
       go process(ctx)
    }(ctx2)

    wg.Wait()
}

func process(ctx context.Context) {
    fmt.Printf(&quot;Processing request ID: %s\n&quot;, ctx.Value(&quot;requestID&quot;))
    fmt.Printf(&quot;Processing user ID: %d\n&quot;, ctx.Value(&quot;userID&quot;))
}

// Processing request ID: 9648a146-4020-4add-b9f0-c37f3b006a4c
// Processing user ID: %!d(&lt;nil&gt;)
// Processing request ID: 9648a146-4020-4add-b9f0-c37f3b006a4c
// Processing user ID: 5
</code></pre>
<h2 id="4-context">4 å¯å–æ¶ˆcontext</h2>
<h3 id="41-withcancelwithcancelcause">4.1 WithCancel()/WithCancelCause()</h3>
<p><strong>WithCancel</strong>: è¿”å›ä¸€ä¸ªå¯å–æ¶ˆçš„ Context å’Œä¸€ä¸ªå–æ¶ˆå‡½æ•° (<code>cancelFunc</code>)</p>
<p>é€šè¿‡WithCancelåˆ›å»ºçš„contextå¯ä»¥å‘å‡ºå–æ¶ˆä¿¡å·ï¼Œè¾¾åˆ°ç»ˆæ­¢ç›¸å…³çš„Goroutineï¼Œä»è€Œé¿å…èµ„æºæ³„éœ²</p>
<pre><code class="language-go">package main

import (
    &quot;context&quot;
    &quot;errors&quot;
    &quot;fmt&quot;
    &quot;time&quot;
)

func main() {
    rootCtx := context.Background()
    // parentCtx, cancel := context.WithCancel(rootCtx)
    parentCtx, cancel := context.WithCancelCause(rootCtx)
    defer cancel(errors.New(&quot;æ­£å¸¸å–æ¶ˆ&quot;))
    childCtx := context.WithoutCancel(parentCtx) // ä¸å—çˆ¶contextå–æ¶ˆå½±å“ï¼Œä¼šä¸€ç›´æ‰§è¡Œç›´åˆ°ä¸»åç¨‹é€€å‡º
    // childCtx, childCancel := context.WithCancel(parentCtx) // çˆ¶contextå–æ¶ˆä¼šä¸€èµ·å–æ¶ˆ
    // defer childCancel()

    go process(parentCtx, &quot;parent&quot;)
    go process(childCtx, &quot;child&quot;)
    time.Sleep(2 * time.Second)
    cancel(errors.New(&quot;å¼ºåˆ¶å–æ¶ˆ&quot;))
    time.Sleep(5 * time.Second)
}

func process(ctx context.Context, role string) {
    for {
        select {
        case &lt;-ctx.Done(): // æ¥æ”¶åˆ°å–æ¶ˆä¿¡å·è§¦å‘
            // è¿™é‡Œä¸»è¦ç¼–å†™ï¼šä»»åŠ¡å…³é—­èµ„æºé‡Šæ”¾é€»è¾‘
            fmt.Printf(&quot;[%s] process canceled during work; Cause: %s\n&quot;, role, context.Cause(ctx))
            return
        default:
            // è¿™é‡Œä¸»è¦ç¼–å†™ï¼šä»»åŠ¡æ­£å¸¸éœ€è¦å¤„ç†é€»è¾‘
            fmt.Printf(&quot;[%s] processing...\n&quot;, role)
            time.Sleep(500 * time.Millisecond)
        }
    }
}

</code></pre>
<h3 id="41-withoutcancel">4.1 WithoutCancel()</h3>
<p><strong>WithoutCancel()</strong>æ˜¯Go 1.21æ–°å¢ç‰¹æ€§ï¼›ä¸<strong>WithCancel()</strong>ä¸åŒçš„æ˜¯ï¼Œ<strong>WithoutCancel()</strong>åˆ›å»ºçš„contextï¼Œä¸ä¼šå› ä¸ºçˆ¶contextå–æ¶ˆè€Œå–æ¶ˆï¼›</p>
<pre><code class="language-go">package main

import (
    &quot;context&quot;
    &quot;fmt&quot;
    &quot;time&quot;
)

func main() {
    rootCtx := context.Background()
    parentCtx, cancel := context.WithCancel(rootCtx)
    defer cancel()
    childCtx := context.WithoutCancel(parentCtx) // ä¸å—çˆ¶contextå–æ¶ˆå½±å“ï¼Œä¼šä¸€ç›´æ‰§è¡Œç›´åˆ°ä¸»åç¨‹é€€å‡º
    // childCtx, childCancel := context.WithCancel(parentCtx) // çˆ¶contextå–æ¶ˆä¼šä¸€èµ·å–æ¶ˆ
    // defer childCancel()

    go process(parentCtx, &quot;parent&quot;)
    go process(childCtx, &quot;child&quot;)
    time.Sleep(2 * time.Second)
    cancel()
    time.Sleep(5 * time.Second)
}

func process(ctx context.Context, role string) {
    for {
        select {
        case &lt;-ctx.Done(): // æ¥æ”¶åˆ°å–æ¶ˆä¿¡å·è§¦å‘
            // è¿™é‡Œä¸»è¦ç¼–å†™ï¼šä»»åŠ¡å…³é—­èµ„æºé‡Šæ”¾é€»è¾‘
            fmt.Printf(&quot;[%s] process done\n&quot;, role)
            return
        default:
            // è¿™é‡Œä¸»è¦ç¼–å†™ï¼šä»»åŠ¡æ­£å¸¸éœ€è¦å¤„ç†é€»è¾‘
            fmt.Printf(&quot;[%s] processing...\n&quot;, role)
            time.Sleep(500 * time.Millisecond)
        }
    }
}

</code></pre>
<h2 id="5-context">5 æŒ‡å®šæ—¶é—´å–æ¶ˆcontext</h2>
<p><strong>WithDeadline()</strong>ç”¨æ³•ä¸è¶…æ—¶æ§åˆ¶contextåŸºæœ¬ä¸€è‡´ï¼›åªæ˜¯å…¥å‚æ”¹ä¸ºæ—¶é—´ç‚¹æ ¼å¼ï¼š</p>
<p>å…¶å®è¶…æ—¶æ§åˆ¶å°±æ˜¯è°ƒç”¨ï¼š<strong>WithDeadline()</strong> å®ç°çš„ï¼›å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªæ—¶é—´ç‚¹éœ€è¦å–æ¶ˆä»»åŠ¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨WithDeadline åˆ›å»ºcontextæ›´åˆé€‚</p>
<pre><code class="language-go">func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc) {
    return WithDeadline(parent, time.Now().Add(timeout))
}
</code></pre>
<pre><code class="language-go">callTime, _ := time.Parse(time.DateTime, &quot;2025-08-23 00:00:00&quot;)
fmt.Println(callTime)
ctx, cancel := context.WithDeadline(context.Background(), callTime)
defer cancel() // ä¿è¯æœ€ç»ˆä»»åŠ¡éƒ½è¦ç»“æŸ

go process(ctx)
// ...
</code></pre>
<h2 id="6-contextafterfunc">6 å£°æ˜å¼å“åº”å–æ¶ˆäº‹ä»¶context.AfterFunc()</h2>
<p><strong>åŸºæœ¬æ¦‚å¿µ</strong>ï¼š<code>context.AfterFunc</code> å…è®¸ä½ æ³¨å†Œä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨ Context <strong>è¢«å–æ¶ˆå</strong>è‡ªåŠ¨åœ¨<strong>ä¸€ä¸ªæ–°çš„ Goroutine ä¸­</strong>è¿è¡Œã€‚</p>
<p><strong>é€šä¿—ä»‹ç»</strong>ï¼š<strong>context.AfterFunc()</strong> æ˜¯åœ¨parent contenxtå®Œæˆæˆ–è€…å–æ¶ˆåï¼Œæ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªstopå‡½æ•°ï¼Œç”¨äºåœæ­¢parent contenxtå’Œfuncçš„å…³è”ï¼›è¿”å›trueä»£è¡¨æˆåŠŸå–æ¶ˆï¼Œfalseä»£è¡¨contextå·²ç»å®Œæˆæˆ–è€…å–æ¶ˆã€‚</p>
<h3 id="61-contextafterfunc">6.1 é€‚åˆä½¿ç”¨ context.AfterFunc çš„åœºæ™¯</h3>
<ol>
<li><strong>èµ„æºæ¸…ç†</strong>ï¼šè¿™æ˜¯æœ€å…¸å‹çš„ç”¨æ³•ã€‚å½“ Context å–æ¶ˆæ—¶ï¼Œè‡ªåŠ¨å…³é—­æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥ç­‰èµ„æºã€‚</li>
<li><strong>çŠ¶æ€é‡ç½®</strong>ï¼šå–æ¶ˆæ—¶é‡ç½®æŸäº›çŠ¶æ€æˆ–æ ‡å¿—ã€‚</li>
<li><strong>æ—¥å¿—è®°å½•</strong>ï¼šè®°å½•æ“ä½œè¢«å–æ¶ˆçš„äº‹å®å’Œç›¸å…³ä¿¡æ¯ã€‚</li>
<li><strong>ç›‘æ§å’ŒæŒ‡æ ‡</strong>ï¼šå‘é€å–æ¶ˆäº‹ä»¶çš„ç›‘æ§æŒ‡æ ‡ã€‚</li>
<li><strong>å¼‚æ­¥é€šçŸ¥</strong>ï¼šé€šçŸ¥å…¶ä»–ç³»ç»Ÿç»„ä»¶è¯¥æ“ä½œå·²è¢«å–æ¶ˆã€‚</li>
</ol>
<h3 id="62">6.2 å¯¹æ¯”ä¼ ç»Ÿçš„æ¸…ç†èµ„æºåšæ³•</h3>
<ul>
<li><strong>ä¼ ç»Ÿæ–¹å¼ï¼ˆä½¿ç”¨ selectï¼‰</strong>ï¼š</li>
</ul>
<pre><code class="language-go">func doWork(ctx context.Context) {
    // å¯åŠ¨å·¥ä½œgoroutine
    go func() {
        // æ¨¡æ‹Ÿå·¥ä½œ
        time.Sleep(time.Second)

        select {
        case &lt;-ctx.Done():
            // Contextè¢«å–æ¶ˆäº†ï¼Œæ‰§è¡Œæ¸…ç†
            cleanup()
            return
        default:
            // æ­£å¸¸å·¥ä½œ
            fmt.Println(&quot;å·¥ä½œå®Œæˆ&quot;)
        }
    }()
}
</code></pre>
<ul>
<li><strong>ä½¿ç”¨ AfterFunc çš„æ–¹å¼</strong>ï¼š</li>
</ul>
<pre><code class="language-go">func doWork(ctx context.Context) {
    // æ³¨å†Œæ¸…ç†å‡½æ•°ï¼Œä¼šåœ¨ctxå–æ¶ˆåè‡ªåŠ¨æ‰§è¡Œ
    context.AfterFunc(ctx, cleanup)

    // å¯åŠ¨å·¥ä½œgoroutineï¼ˆä¸éœ€è¦åœ¨å†…éƒ¨å¤„ç†å–æ¶ˆäº†ï¼‰
    go func() {
        time.Sleep(time.Second)
        fmt.Println(&quot;å·¥ä½œå®Œæˆ&quot;)
    }()
}
</code></pre>
<h3 id="63">6.3 å®é™…åœºæ™¯</h3>
<h4 id="631">6.3.1 åŸºæœ¬çš„èµ„æºæ¸…ç†</h4>
<pre><code class="language-go">func main() {
    ctx, cancel := context.WithTimeoutCause(context.Background(), 2*time.Second, errors.New(&quot;ä»»åŠ¡è¶…æ—¶ï¼&quot;))
    defer cancel()

    // æ¨¡æ‹Ÿæ‰“å¼€ä¸€ä¸ªèµ„æº
    resource := &quot;æ•°æ®åº“è¿æ¥&quot;
    fmt.Printf(&quot;æ‰“å¼€èµ„æº: %s\n&quot;, resource)

    // æ³¨å†Œæ¸…ç†å‡½æ•°ï¼šå½“ctxå–æ¶ˆæ—¶è‡ªåŠ¨æ¸…ç†èµ„æº
    stop := context.AfterFunc(ctx, func() {
        fmt.Printf(&quot;ä»»åŠ¡å‘ç”Ÿå¼‚å¸¸ Cause: %s\n&quot;, context.Cause(ctx))
        fmt.Printf(&quot;æ­£åœ¨è‡ªåŠ¨æ¸…ç†èµ„æº: %s\n&quot;, resource)
        // è¿™é‡Œå¯ä»¥æ‰§è¡ŒçœŸæ­£æ¸…ç†é€»è¾‘ï¼Œå¦‚å…³é—­æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ç­‰
    })
    // é€šå¸¸ä¸éœ€è¦è°ƒç”¨stopï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚
    defer stop() // ä¸ºäº†å®Œæ•´æ€§ï¼Œè¿™é‡Œä¹Ÿdefer stop

    // æ¨¡æ‹Ÿä¸€äº›å·¥ä½œ
    time.Sleep(3 * time.Second) // è¿™ä¼šè¶…è¿‡2ç§’è¶…æ—¶æ—¶é—´
    fmt.Println(&quot;ä¸»å‡½æ•°ç»“æŸ&quot;)
}
</code></pre>
<h4 id="632-stop">6.3.2 ä½¿ç”¨ stop å‡½æ•°å–æ¶ˆæ³¨å†Œ</h4>
<pre><code class="language-go">func main() {
    ctx, cancel := context.WithCancel(context.Background())

    // æ³¨å†Œä¸€ä¸ªå‡½æ•°
    stop := context.AfterFunc(ctx, func() {
        fmt.Println(&quot;è¿™ä¸ªå‡½æ•°ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºä¼šè¢«stopå–æ¶ˆ&quot;)
    })

    // ç«‹å³å–æ¶ˆæ³¨å†Œ
    if stopped := stop(); stopped {
        fmt.Println(&quot;æˆåŠŸå–æ¶ˆäº†AfterFuncçš„æ‰§è¡Œ&quot;)
    }

    cancel() // å–æ¶ˆContextï¼Œä½†æ³¨å†Œçš„å‡½æ•°ä¸ä¼šæ‰§è¡Œ
}
</code></pre>
<h4 id="633-contextafterfunc">6.3.3 å¤šä¸ª context.AfterFunc</h4>
<pre><code class="language-go">func main() {
    ctx, cancel := context.WithCancel(context.Background())

    // æ³¨å†Œå¤šä¸ªæ¸…ç†å‡½æ•°
    context.AfterFunc(ctx, func() {
        fmt.Println(&quot;æ¸…ç†å‡½æ•°1: å…³é—­æ•°æ®åº“è¿æ¥&quot;)
    })

    context.AfterFunc(ctx, func() {
        fmt.Println(&quot;æ¸…ç†å‡½æ•°2: é‡Šæ”¾å†…å­˜ç¼“å­˜&quot;)
    })

    context.AfterFunc(ctx, func() {
        fmt.Println(&quot;æ¸…ç†å‡½æ•°3: å‘é€ç›‘æ§æŒ‡æ ‡&quot;)
    })

    time.Sleep(100 * time.Millisecond)
    cancel() // è§¦å‘æ‰€æœ‰æ³¨å†Œçš„å‡½æ•°æ‰§è¡Œ
    time.Sleep(100 * time.Millisecond) // ç»™goroutineæ—¶é—´æ‰§è¡Œ
}
</code></pre>
<h2 id="7-context">7 contextå­¦ä¹ æ€»ç»“</h2>
<p><strong>æœ€ä½³å®è·µæé†’</strong>ï¼š</p>
<ul>
<li>å¯¹äº <code>WithCancel</code>, <code>WithTimeout</code>, <code>WithDeadline</code>, <code>WithCancelCause</code>ï¼Œ<strong>ä¸€å®šè¦ç«‹å³ä½¿ç”¨ <code>defer cancel()</code></strong> æ¥ç¡®ä¿èµ„æºè¢«æ­£ç¡®é‡Šæ”¾ã€‚</li>
<li>å°† Context ä½œä¸ºå‡½æ•°çš„<strong>ç¬¬ä¸€ä¸ªå‚æ•°</strong>ä¼ é€’ã€‚</li>
<li>ä½¿ç”¨ <code>WithValue</code> æ—¶ï¼Œ<strong>ä¸ºé”®ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</strong>ï¼Œé¿å…åŒ…é—´å†²çªã€‚</li>
</ul>
<p><strong>æ³¨æ„å¼€å‘ä¸­çš„ä¸€äº›é—®é¢˜</strong>ï¼š</p>
<ul>
<li><strong>ä¸ä¼ é€’ä¸Šä¸‹æ–‡ï¼š</strong>å¦‚æœä¸€ä¸ªå‡½æ•°åˆ›å»ºäº†ä¸Šä¸‹æ–‡ï¼Œä½†å¹¶<strong>æ²¡æœ‰ä¼ é€’ç»™å…¶ä»–å‡½æ•°æˆ–åç¨‹ï¼Œè¿™äº›å‡½æ•°å’Œåç¨‹æ— æ³•å“åº”ä¸Šä¸‹æ–‡ç›¸å…³çš„å¤„ç†æ“ä½œ</strong>ã€‚</li>
<li><strong>å¿˜è®°è°ƒç”¨å–æ¶ˆå‡½æ•°ï¼š</strong>ä½¿ç”¨æœ‰å–æ¶ˆå‡½æ•°çš„ä¸Šä¸‹æ–‡æ—¶ï¼Œè®°å¾—å–æ¶ˆ</li>
<li><strong>åç¨‹æ³„éœ²ï¼š</strong>æœ‰ä¸Šä¸‹æ–‡çš„åç¨‹éœ€è¦æ£€æŸ¥Done channelï¼Œå½“æ¥æ”¶åˆ°åˆ°ä¿¡å·æ—¶åŠæ—¶æ¸…ç†èµ„æºå’Œé€€å‡º</li>
<li><strong>è¿‡åº¦ä½¿ç”¨context.Backgroundï¼š</strong>æ²¡æœ‰å–æ¶ˆå’Œè¶…æ—¶åŠŸèƒ½ï¼Œå¾ˆå¯èƒ½å¼•èµ·é—®é¢˜</li>
<li><strong>ä¼ é€’nilçš„ä¸Šä¸‹æ–‡ï¼š</strong>ä¸è¦ä¼ é€’nilçš„ä¸Šä¸‹æ–‡ï¼Œä¼šå¯¼è‡´panic</li>
<li><strong>é˜»å¡è°ƒç”¨ï¼š</strong>åº”è¯¥å°†é˜»å¡æ“ä½œï¼ˆæ¯”å¦‚IOï¼‰åŒ…è£…æˆä½¿ç”¨ä¸Šä¸‹æ–‡æ£€æŸ¥çš„è°ƒç”¨ï¼Œå¯ä»¥é¿å…è¢«æŒ‚èµ·</li>
<li><strong>è¿‡åº¦ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼š</strong>ä¸Šä¸‹æ–‡ä¹Ÿå¹¶ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½ä½¿ç”¨ï¼Œæ¯”å¦‚<strong>å¤„ç†å…¨å±€èµ„æºæˆ–è€…å…±äº«çŠ¶æ€ç­‰ï¼Œå¯èƒ½æ›´ä½¿ç”¨ä½¿ç”¨é”æˆ–è€…channel</strong></li>
<li><strong>ä¸Šä¸‹æ–‡å­˜å‚¨åœ¨ç»“æ„ä½“ä¸­ï¼š</strong>åº”è¯¥å°†context<strong>æ˜¾å¼çš„ä¼ é€’ç»™éœ€è¦çš„å‡½æ•°</strong>ï¼Œå¦åˆ™å¯èƒ½ä¼šå¼•èµ·æ•°æ®ç«æ€ï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰é—®é¢˜</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "search.highlight", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>